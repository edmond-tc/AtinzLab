<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Travail & Ã‰nergie â€” Simulateur | Edmond Atinzoun TCHOKPON</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f5f0e8;--bg2:#ede8dc;--ink:#1a1410;--ink2:#3d3530;
  --muted:#8a7e74;--card:#ffffff;--border:#d4c9bb;
  --E1:#e8521a;--E2:#2563b8;--E3:#16a34a;--E4:#9333ea;--acc:#e8521a;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{min-height:100%;background:var(--bg);color:var(--ink);font-family:'Manrope',sans-serif;overflow-x:hidden;}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:0.5;}
.wrap{max-width:1140px;margin:0 auto;padding:14px;}

header{display:flex;align-items:flex-start;justify-content:space-between;padding:20px 0 16px;border-bottom:2px solid var(--ink);margin-bottom:18px;flex-wrap:wrap;gap:10px;}
.h-left .eyebrow{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--acc);text-transform:uppercase;margin-bottom:5px;}
.h-left h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(32px,6vw,64px);letter-spacing:2px;line-height:0.9;}
.h-left h1 span{color:var(--acc);}
.h-right{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);text-align:right;line-height:2;}
.h-right a{color:var(--acc);text-decoration:none;}

.tabs{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-bottom:18px;}
@media(max-width:600px){.tabs{grid-template-columns:repeat(2,1fr);}}
.tb{padding:10px 5px;background:transparent;border:1.5px solid var(--border);color:var(--muted);font-family:'Manrope',sans-serif;font-size:11px;font-weight:700;cursor:pointer;border-radius:6px;transition:all 0.15s;text-align:center;line-height:1.3;}
.tb:hover{border-color:var(--ink);color:var(--ink);}
.tb.on{background:var(--ink);color:var(--bg);border-color:var(--ink);}

.tc{display:none;}.tc.on{display:block;}

.layout{display:grid;grid-template-columns:1fr 300px;gap:14px;}
@media(max-width:760px){.layout{grid-template-columns:1fr;}}

.ccard{background:var(--card);border:1.5px solid var(--border);border-radius:10px;overflow:hidden;box-shadow:3px 3px 0 var(--border);}
.ctop{padding:7px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px;}
.ctitle{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
.cstatus{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);display:flex;align-items:center;gap:5px;}
.dot{width:7px;height:7px;border-radius:50%;background:var(--muted);transition:all 0.3s;flex-shrink:0;}
.dot.run{background:#16a34a;box-shadow:0 0 7px #16a34a;}
.dot.pause{background:#f59e0b;box-shadow:0 0 7px #f59e0b;}
canvas{width:100%;height:auto;display:block;}

.ebar-wrap{padding:8px 12px;border-top:1px solid var(--border);display:flex;gap:5px;}
.ebar{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;}
.ebar-track{width:100%;height:5px;background:var(--bg2);border-radius:3px;overflow:hidden;}
.ebar-fill{height:100%;border-radius:3px;transition:width 0.06s linear;width:0%;}
.ebar-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);}
.ebar-val{font-family:'DM Mono',monospace;font-size:9px;font-weight:500;}

.cpanel{background:var(--card);border:1.5px solid var(--border);border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:12px;box-shadow:3px 3px 0 var(--border);}
.csec{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--muted);border-bottom:1px solid var(--border);padding-bottom:4px;margin-bottom:5px;text-transform:uppercase;}
.crow{display:flex;align-items:center;gap:7px;margin-bottom:8px;}
.clbl{font-size:11px;font-weight:600;color:var(--ink);min-width:66px;flex-shrink:0;line-height:1.2;}
.clbl small{display:block;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);font-weight:400;}
input[type=range]{-webkit-appearance:none;flex:1;height:3px;background:var(--border);border-radius:2px;outline:none;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:13px;height:13px;background:var(--ink);border-radius:50%;cursor:pointer;}
input[type=range]::-moz-range-thumb{width:13px;height:13px;background:var(--ink);border-radius:50%;border:none;cursor:pointer;}
.vd{font-family:'DM Mono',monospace;font-size:10px;color:var(--acc);min-width:50px;text-align:right;flex-shrink:0;}

.reads{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.rc{background:var(--bg2);border:1px solid var(--border);border-radius:5px;padding:7px;text-align:center;}
.rc .rv{font-family:'DM Mono',monospace;font-size:13px;font-weight:500;}
.rc .rl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-top:1px;}

.brow{display:flex;gap:5px;flex-wrap:wrap;}
.btn{flex:1;min-width:60px;padding:9px 6px;font-family:'Manrope',sans-serif;font-size:11px;font-weight:700;border-radius:5px;cursor:pointer;transition:all 0.15s;border:1.5px solid var(--border);background:transparent;color:var(--ink);}
.btn:hover{background:var(--ink);color:var(--bg);border-color:var(--ink);}
.btn.go{background:var(--ink);color:var(--bg);border-color:var(--ink);}
.btn.go:hover{background:var(--acc);border-color:var(--acc);}
.btn.pau{border-color:#f59e0b;color:#b45309;}
.btn.pau:hover{background:#f59e0b;color:white;}
.btn.pau.active{background:#f59e0b;color:white;}
.btn.rst{border-color:var(--acc);color:var(--acc);}
.btn.rst:hover{background:var(--acc);color:white;}

.theory{background:var(--card);border:1.5px solid var(--border);border-left:3px solid var(--acc);border-radius:8px;padding:12px 15px;margin-top:12px;font-size:12px;line-height:1.75;box-shadow:3px 3px 0 var(--border);}
.theory h4{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--acc);margin-bottom:8px;text-transform:uppercase;}
.fml{display:inline-block;background:var(--bg2);border:1px solid var(--border);padding:4px 9px;border-radius:4px;font-family:'DM Mono',monospace;font-size:11px;color:var(--ink);margin:2px 2px;}
.tip{margin-top:8px;padding:7px 11px;background:rgba(22,163,74,0.07);border-left:2px solid var(--E3);font-size:11px;color:var(--ink2);border-radius:3px;}
.tip b{color:var(--E3);}
.warn{margin-top:7px;padding:7px 11px;background:rgba(232,82,26,0.07);border-left:2px solid var(--acc);font-size:11px;color:var(--ink2);border-radius:3px;}

/* EXERCICES */
.exo-section{margin-top:14px;background:var(--card);border:1.5px solid var(--border);border-radius:10px;overflow:hidden;box-shadow:3px 3px 0 var(--border);}
.exo-header{padding:10px 16px;background:var(--ink);display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;}
.exo-header h3{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:var(--bg);}
.exo-header .toggle-ico{color:var(--bg);font-size:14px;transition:transform 0.2s;}
.exo-body{padding:14px 16px;display:none;}
.exo-body.open{display:block;}

.exo-enonce{font-size:12.5px;line-height:1.75;padding:10px 12px;background:var(--bg2);border-radius:6px;border:1px solid var(--border);margin-bottom:12px;}
.exo-enonce strong{color:var(--acc);}

/* TABLE */
.exo-table{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:10px;}
.exo-table th{background:var(--ink);color:var(--bg);font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;padding:8px 10px;text-align:left;font-weight:500;}
.exo-table td{padding:7px 10px;border-bottom:1px solid var(--border);vertical-align:middle;}
.exo-table tr:last-child td{border-bottom:none;}
.exo-table tr:hover td{background:var(--bg2);}
.exo-table .grandeur{font-weight:700;font-size:12px;}
.exo-table .formule{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.exo-table .sim-val{font-family:'DM Mono',monospace;font-size:11px;color:var(--E2);font-weight:500;}
.exo-input{
  width:80px;padding:5px 7px;
  font-family:'DM Mono',monospace;font-size:11px;
  border:1.5px solid var(--border);border-radius:4px;
  background:var(--bg);color:var(--ink);outline:none;
  text-align:center;
}
.exo-input:focus{border-color:var(--acc);}
.result-ico{font-size:14px;margin-left:4px;}
.corr-val{font-family:'DM Mono',monospace;font-size:10px;color:var(--E3);margin-left:4px;display:none;}
.corr-val.show{display:inline;}
.wrong-val{color:var(--acc)!important;}

.exo-btn-row{display:flex;gap:6px;margin-top:6px;}
.exo-btn{padding:8px 14px;font-family:'Manrope',sans-serif;font-size:11px;font-weight:700;border-radius:5px;cursor:pointer;transition:all 0.15s;border:1.5px solid var(--ink);background:var(--ink);color:var(--bg);}
.exo-btn:hover{background:var(--acc);border-color:var(--acc);}
.exo-btn.reset{background:transparent;color:var(--acc);border-color:var(--acc);}
.exo-btn.reset:hover{background:var(--acc);color:white;}

.score-bar{margin-top:8px;padding:8px 12px;border-radius:5px;font-family:'DM Mono',monospace;font-size:11px;display:none;}
.score-bar.show{display:block;}
.score-bar.good{background:rgba(22,163,74,0.1);border:1px solid var(--E3);color:var(--E3);}
.score-bar.bad{background:rgba(232,82,26,0.08);border:1px solid var(--acc);color:var(--acc);}

.mgraph{width:100%;height:65px;display:block;margin-top:4px;border-radius:4px;}

footer{text-align:center;padding:16px;margin-top:24px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);border-top:2px solid var(--ink);}
footer a{color:var(--acc);text-decoration:none;}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="h-left">
    <div class="eyebrow">âš¡ Travail & Ã‰nergie</div>
    <h1>TRAVAIL<br><span>&</span> Ã‰NERGIE</h1>
  </div>
  <div class="h-right">
    Edmond Atinzoun TCHOKPON<br>
    UniversitÃ© d'Abomey-Calavi<br>
    CPGE / Licence Physique-Chimie<br>
    <a href="https://edmond-atinzoun.netlify.app" target="_blank">edmond-atinzoun.netlify.app</a>
  </div>
</header>

<div class="tabs">
  <button class="tb on"  onclick="ST('pend',this)">ğŸ”µ Pendule<br>Simple</button>
  <button class="tb"     onclick="ST('coni',this)">ğŸŒ€ Pendule<br>Conique</button>
  <button class="tb"     onclick="ST('rssv',this)">ğŸ”´ Ressort<br>Vertical</button>
  <button class="tb"     onclick="ST('rssh',this)">ğŸŸ  Ressort<br>Horizontal</button>
  <button class="tb"     onclick="ST('cons',this)">âš¡ Conservation<br>Ã‰nergie</button>
</div>

<!-- â•â•â• 1. PENDULE SIMPLE â•â•â• -->
<div id="tc-pend" class="tc on">
  <div class="layout">
    <div>
      <div class="ccard">
        <div class="ctop">
          <span class="ctitle">Pendule Simple â€” Huygens (1656)</span>
          <span class="cstatus"><span class="dot" id="dPend"></span><span id="sPend">En attente</span></span>
        </div>
        <canvas id="cvPend" width="700" height="340"></canvas>
        <div class="ebar-wrap">
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E1)">Ec (J)</div><div class="ebar-track"><div class="ebar-fill" id="bPEc" style="background:var(--E1)"></div></div><div class="ebar-val" style="color:var(--E1)" id="vPEc">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E2)">Ep (J)</div><div class="ebar-track"><div class="ebar-fill" id="bPEp" style="background:var(--E2)"></div></div><div class="ebar-val" style="color:var(--E2)" id="vPEp">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E3)">Em (J)</div><div class="ebar-track"><div class="ebar-fill" id="bPEm" style="background:var(--E3)"></div></div><div class="ebar-val" style="color:var(--E3)" id="vPEm">0.000</div></div>
        </div>
      </div>
      <div class="theory">
        <h4>// Pendule Simple â€” Faits rÃ©els</h4>
        <p>Pendule de Foucault (PanthÃ©on, Paris, 1851) : L = 67 m â†’ T â‰ˆ 16.4 s. Pour Î¸ &lt; 15Â° :</p><br>
        <span class="fml">T = 2Ï€âˆš(L/g)</span><span class="fml">Ep = mgL(1âˆ’cosÎ¸)</span><span class="fml">Em = mgL(1âˆ’cosÎ¸â‚€)</span>
        <div class="tip"><b>Conservation :</b> au bas Ec = Em, au sommet Ec = 0. T indÃ©pendant de m (GalilÃ©e, 1602).</div>
      </div>
      <!-- EXERCICE PENDULE -->
      <div class="exo-section">
        <div class="exo-header" onclick="toggleExo('exoPend')">
          <h3>ğŸ“‹ EXERCICE â€” TABLEAU DE MESURES</h3>
          <span class="toggle-ico" id="icoExoPend">â–¼</span>
        </div>
        <div class="exo-body" id="exoPend">
          <div class="exo-enonce">
            RÃ¨gle les paramÃ¨tres : <strong>L = 1.5 m, m = 0.8 kg, Î¸â‚€ = 25Â°, g = 9.81 m/sÂ²</strong>.<br>
            Lance la simulation puis lis les valeurs affichÃ©es. Calcule chaque grandeur et entre ta valeur dans le tableau. TolÃ©rance : Â±5 %.
          </div>
          <table class="exo-table">
            <thead><tr><th>Grandeur</th><th>Formule</th><th>Valeur sim.</th><th>Ta valeur</th><th>RÃ©sultat</th></tr></thead>
            <tbody>
              <tr>
                <td><span class="grandeur">PÃ©riode T</span><br><span class="formule">(s)</span></td>
                <td class="formule">2Ï€âˆš(L/g)</td>
                <td class="sim-val" id="exP_T">â€”</td>
                <td><input class="exo-input" id="inP_T" placeholder="0.00" type="number" step="0.001"></td>
                <td><span class="result-ico" id="resP_T"></span><span class="corr-val" id="corrP_T"></span></td>
              </tr>
              <tr>
                <td><span class="grandeur">Ã‰nergie Em</span><br><span class="formule">(J)</span></td>
                <td class="formule">mgL(1âˆ’cosÎ¸â‚€)</td>
                <td class="sim-val" id="exP_Em">â€”</td>
                <td><input class="exo-input" id="inP_Em" placeholder="0.00" type="number" step="0.0001"></td>
                <td><span class="result-ico" id="resP_Em"></span><span class="corr-val" id="corrP_Em"></span></td>
              </tr>
              <tr>
                <td><span class="grandeur">v_max</span><br><span class="formule">(m/s) au bas</span></td>
                <td class="formule">âˆš(2gL(1âˆ’cosÎ¸â‚€))</td>
                <td class="sim-val" id="exP_Vm">â€”</td>
                <td><input class="exo-input" id="inP_Vm" placeholder="0.00" type="number" step="0.001"></td>
                <td><span class="result-ico" id="resP_Vm"></span><span class="corr-val" id="corrP_Vm"></span></td>
              </tr>
              <tr>
                <td><span class="grandeur">Ep Ã  Î¸=15Â°</span><br><span class="formule">(J)</span></td>
                <td class="formule">mgL(1âˆ’cos15Â°)</td>
                <td class="sim-val" id="exP_Ep15">â€”</td>
                <td><input class="exo-input" id="inP_Ep15" placeholder="0.00" type="number" step="0.0001"></td>
                <td><span class="result-ico" id="resP_Ep15"></span><span class="corr-val" id="corrP_Ep15"></span></td>
              </tr>
            </tbody>
          </table>
          <div class="exo-btn-row">
            <button class="exo-btn" onclick="checkExo('pend')">âœ” VÃ©rifier</button>
            <button class="exo-btn reset" onclick="resetExo('pend')">â†º Effacer</button>
          </div>
          <div class="score-bar" id="scorePend"></div>
        </div>
      </div>
    </div>
    <div class="cpanel">
      <div>
        <div class="csec">// ParamÃ¨tres</div>
        <div class="crow"><div class="clbl">Longueur L<small>(m)</small></div><input type="range" id="pL" min="0.1" max="5" step="0.05" value="1.5" oninput="upPend()"><div class="vd" id="pLv">1.50 m</div></div>
        <div class="crow"><div class="clbl">Masse m<small>(kg)</small></div><input type="range" id="pM" min="0.1" max="5" step="0.1" value="0.8" oninput="upPend()"><div class="vd" id="pMv">0.8 kg</div></div>
        <div class="crow"><div class="clbl">Angle Î¸â‚€<small>initial</small></div><input type="range" id="pTh" min="2" max="60" value="25" oninput="upPend()"><div class="vd" id="pThv">25Â°</div></div>
        <div class="crow"><div class="clbl">g (m/sÂ²)</div><input type="range" id="pG" min="1.6" max="24" step="0.01" value="9.81" oninput="upPend()"><div class="vd" id="pGv">9.81</div></div>
      </div>
      <div>
        <div class="csec">// Mesures live</div>
        <div class="reads">
          <div class="rc"><div class="rv" style="color:var(--E1)" id="rPEc">0.0000</div><div class="rl">Ec (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E2)" id="rPEp">0.0000</div><div class="rl">Ep (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E3)" id="rPEm">â€”</div><div class="rl">Em (J)</div></div>
          <div class="rc"><div class="rv" id="rPT">â€”</div><div class="rl">T (s)</div></div>
        </div>
        <canvas class="mgraph" id="mgPend"></canvas>
      </div>
      <div class="brow">
        <button class="btn go" id="btnGoP" onclick="goP()">â–¶ Lancer</button>
        <button class="btn pau" id="btnPauP" onclick="pauseP()">â¸ Pause</button>
        <button class="btn rst" onclick="rstP()">â†º Reset</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• 2. PENDULE CONIQUE â•â•â• -->
<div id="tc-coni" class="tc">
  <div class="layout">
    <div>
      <div class="ccard">
        <div class="ctop">
          <span class="ctitle">Pendule Conique â€” RÃ©gulateur de Watt (1788)</span>
          <span class="cstatus"><span class="dot" id="dConi"></span><span id="sConi">En attente</span></span>
        </div>
        <canvas id="cvConi" width="700" height="340"></canvas>
        <div class="ebar-wrap">
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E1)">Ec (J)</div><div class="ebar-track"><div class="ebar-fill" id="bCEc" style="background:var(--E1)"></div></div><div class="ebar-val" style="color:var(--E1)" id="vCEc">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E2)">Ep (J)</div><div class="ebar-track"><div class="ebar-fill" id="bCEp" style="background:var(--E2)"></div></div><div class="ebar-val" style="color:var(--E2)" id="vCEp">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E4)">F_c (N)</div><div class="ebar-track"><div class="ebar-fill" id="bCFc" style="background:var(--E4)"></div></div><div class="ebar-val" style="color:var(--E4)" id="vCFc">0.000</div></div>
        </div>
      </div>
      <div class="theory">
        <h4>// Pendule Conique â€” RÃ©gulateur de Watt</h4>
        <span class="fml">cosÎ¸ = g/(Ï‰Â²L)</span><span class="fml">T = mg/cosÎ¸</span><span class="fml">F_c = mÏ‰Â²R</span>
        <div class="tip"><b>Watt (1788) :</b> Ï‰â†‘ â†’ Î¸â†‘ â†’ soupape se ferme â†’ vitesse diminue. SystÃ¨me autorÃ©gulÃ©.</div>
      </div>
      <div class="exo-section">
        <div class="exo-header" onclick="toggleExo('exoConi')">
          <h3>ğŸ“‹ EXERCICE â€” TABLEAU DE MESURES</h3>
          <span class="toggle-ico" id="icoExoConi">â–¼</span>
        </div>
        <div class="exo-body" id="exoConi">
          <div class="exo-enonce">
            RÃ¨gle : <strong>L = 0.8 m, m = 0.5 kg, Ï‰ = 5 rad/s, g = 9.81 m/sÂ²</strong>.<br>
            Lance, lis les valeurs de la simulation, calcule puis entre tes rÃ©sultats.
          </div>
          <table class="exo-table">
            <thead><tr><th>Grandeur</th><th>Formule</th><th>Valeur sim.</th><th>Ta valeur</th><th>RÃ©sultat</th></tr></thead>
            <tbody>
              <tr><td><span class="grandeur">Angle Î¸</span><br><span class="formule">(Â°)</span></td><td class="formule">acos(g/Ï‰Â²L)</td><td class="sim-val" id="exC_Th">â€”</td><td><input class="exo-input" id="inC_Th" placeholder="0.0" type="number" step="0.1"></td><td><span class="result-ico" id="resC_Th"></span><span class="corr-val" id="corrC_Th"></span></td></tr>
              <tr><td><span class="grandeur">Rayon R</span><br><span class="formule">(m)</span></td><td class="formule">LÂ·sinÎ¸</td><td class="sim-val" id="exC_R">â€”</td><td><input class="exo-input" id="inC_R" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resC_R"></span><span class="corr-val" id="corrC_R"></span></td></tr>
              <tr><td><span class="grandeur">Tension T</span><br><span class="formule">(N)</span></td><td class="formule">mg/cosÎ¸</td><td class="sim-val" id="exC_T">â€”</td><td><input class="exo-input" id="inC_T" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resC_T"></span><span class="corr-val" id="corrC_T"></span></td></tr>
              <tr><td><span class="grandeur">Force Fc</span><br><span class="formule">(N)</span></td><td class="formule">mÏ‰Â²R</td><td class="sim-val" id="exC_Fc">â€”</td><td><input class="exo-input" id="inC_Fc" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resC_Fc"></span><span class="corr-val" id="corrC_Fc"></span></td></tr>
            </tbody>
          </table>
          <div class="exo-btn-row"><button class="exo-btn" onclick="checkExo('coni')">âœ” VÃ©rifier</button><button class="exo-btn reset" onclick="resetExo('coni')">â†º Effacer</button></div>
          <div class="score-bar" id="scoreConi"></div>
        </div>
      </div>
    </div>
    <div class="cpanel">
      <div>
        <div class="csec">// ParamÃ¨tres</div>
        <div class="crow"><div class="clbl">Longueur L<small>(m)</small></div><input type="range" id="cL" min="0.1" max="3" step="0.05" value="0.8" oninput="upConi()"><div class="vd" id="cLv">0.80 m</div></div>
        <div class="crow"><div class="clbl">Masse m<small>(kg)</small></div><input type="range" id="cM" min="0.1" max="5" step="0.1" value="0.5" oninput="upConi()"><div class="vd" id="cMv">0.5 kg</div></div>
        <div class="crow"><div class="clbl">Ï‰ (rad/s)</div><input type="range" id="cW" min="1" max="15" step="0.1" value="5" oninput="upConi()"><div class="vd" id="cWv">5.0 rad/s</div></div>
        <div class="crow"><div class="clbl">g (m/sÂ²)</div><input type="range" id="cG" min="1.6" max="24" step="0.01" value="9.81" oninput="upConi()"><div class="vd" id="cGv">9.81</div></div>
      </div>
      <div>
        <div class="csec">// Mesures live</div>
        <div class="reads">
          <div class="rc"><div class="rv" style="color:var(--E1)" id="rCEc">â€”</div><div class="rl">Ec (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E4)" id="rCTfil">â€”</div><div class="rl">T fil (N)</div></div>
          <div class="rc"><div class="rv" id="rCTh">â€”</div><div class="rl">Î¸ (Â°)</div></div>
          <div class="rc"><div class="rv" id="rCR">â€”</div><div class="rl">R (m)</div></div>
        </div>
      </div>
      <div class="brow">
        <button class="btn go" id="btnGoC" onclick="goC()">â–¶ Lancer</button>
        <button class="btn pau" id="btnPauC" onclick="pauseC()">â¸ Pause</button>
        <button class="btn rst" onclick="rstC()">â†º Reset</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• 3. RESSORT VERTICAL â•â•â• -->
<div id="tc-rssv" class="tc">
  <div class="layout">
    <div>
      <div class="ccard">
        <div class="ctop">
          <span class="ctitle">Ressort Vertical â€” Loi de Hooke (1678)</span>
          <span class="cstatus"><span class="dot" id="dRssV"></span><span id="sRssV">En attente</span></span>
        </div>
        <canvas id="cvRssV" width="700" height="340"></canvas>
        <div class="ebar-wrap">
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E1)">Ec (J)</div><div class="ebar-track"><div class="ebar-fill" id="bVEc" style="background:var(--E1)"></div></div><div class="ebar-val" style="color:var(--E1)" id="vVEc">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E4)">Ee (J)</div><div class="ebar-track"><div class="ebar-fill" id="bVEe" style="background:var(--E4)"></div></div><div class="ebar-val" style="color:var(--E4)" id="vVEe">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E3)">Em (J)</div><div class="ebar-track"><div class="ebar-fill" id="bVEm" style="background:var(--E3)"></div></div><div class="ebar-val" style="color:var(--E3)" id="vVEm">0.000</div></div>
        </div>
      </div>
      <div class="theory">
        <h4>// Ressort Vertical â€” Hooke (1678)</h4>
        <span class="fml">x_eq = mg/k</span><span class="fml">Ï‰â‚€ = âˆš(k/m)</span><span class="fml">Em = Â½kuÂ² = cste</span>
        <div class="tip"><b>Autour de x_eq :</b> Em = Ec + Â½kuÂ² (u = Ã©cart Ã  l'Ã©quilibre). T = 2Ï€âˆš(m/k).</div>
      </div>
      <div class="exo-section">
        <div class="exo-header" onclick="toggleExo('exoRssV')">
          <h3>ğŸ“‹ EXERCICE â€” TABLEAU DE MESURES</h3>
          <span class="toggle-ico" id="icoExoRssV">â–¼</span>
        </div>
        <div class="exo-body" id="exoRssV">
          <div class="exo-enonce">
            RÃ¨gle : <strong>k = 80 N/m, m = 0.5 kg, xâ‚€ = +0.10 m, g = 9.81 m/sÂ²</strong>.<br>
            Lance la simulation, observe et complÃ¨te le tableau.
          </div>
          <table class="exo-table">
            <thead><tr><th>Grandeur</th><th>Formule</th><th>Valeur sim.</th><th>Ta valeur</th><th>RÃ©sultat</th></tr></thead>
            <tbody>
              <tr><td><span class="grandeur">PÃ©riode T</span><br><span class="formule">(s)</span></td><td class="formule">2Ï€âˆš(m/k)</td><td class="sim-val" id="exV_T">â€”</td><td><input class="exo-input" id="inV_T" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resV_T"></span><span class="corr-val" id="corrV_T"></span></td></tr>
              <tr><td><span class="grandeur">x_Ã©quilibre</span><br><span class="formule">(m)</span></td><td class="formule">mg/k</td><td class="sim-val" id="exV_Xeq">â€”</td><td><input class="exo-input" id="inV_Xeq" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resV_Xeq"></span><span class="corr-val" id="corrV_Xeq"></span></td></tr>
              <tr><td><span class="grandeur">Ã‰nergie Em</span><br><span class="formule">(J)</span></td><td class="formule">Â½kxâ‚€Â²</td><td class="sim-val" id="exV_Em">â€”</td><td><input class="exo-input" id="inV_Em" placeholder="0.0000" type="number" step="0.0001"></td><td><span class="result-ico" id="resV_Em"></span><span class="corr-val" id="corrV_Em"></span></td></tr>
              <tr><td><span class="grandeur">v_max</span><br><span class="formule">(m/s)</span></td><td class="formule">xâ‚€âˆš(k/m)</td><td class="sim-val" id="exV_Vm">â€”</td><td><input class="exo-input" id="inV_Vm" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resV_Vm"></span><span class="corr-val" id="corrV_Vm"></span></td></tr>
            </tbody>
          </table>
          <div class="exo-btn-row"><button class="exo-btn" onclick="checkExo('rssv')">âœ” VÃ©rifier</button><button class="exo-btn reset" onclick="resetExo('rssv')">â†º Effacer</button></div>
          <div class="score-bar" id="scoreRssV"></div>
        </div>
      </div>
    </div>
    <div class="cpanel">
      <div>
        <div class="csec">// ParamÃ¨tres</div>
        <div class="crow"><div class="clbl">Raideur k<small>(N/m)</small></div><input type="range" id="vK" min="5" max="300" value="80" oninput="upRssV()"><div class="vd" id="vKv">80 N/m</div></div>
        <div class="crow"><div class="clbl">Masse m<small>(kg)</small></div><input type="range" id="vM" min="0.05" max="5" step="0.05" value="0.5" oninput="upRssV()"><div class="vd" id="vMv">0.50 kg</div></div>
        <div class="crow"><div class="clbl">Ã‰cart xâ‚€<small>de l'Ã©quil.</small></div><input type="range" id="vX0" min="-0.3" max="0.3" step="0.01" value="0.1" oninput="upRssV()"><div class="vd" id="vX0v">+0.10 m</div></div>
        <div class="crow"><div class="clbl">g (m/sÂ²)</div><input type="range" id="vG" min="1.6" max="24" step="0.01" value="9.81" oninput="upRssV()"><div class="vd" id="vGv">9.81</div></div>
      </div>
      <div>
        <div class="csec">// Mesures live</div>
        <div class="reads">
          <div class="rc"><div class="rv" style="color:var(--E1)" id="rVEc">0.0000</div><div class="rl">Ec (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E4)" id="rVEe">0.0000</div><div class="rl">Ee (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E3)" id="rVEm">â€”</div><div class="rl">Em (J)</div></div>
          <div class="rc"><div class="rv" id="rVT">â€”</div><div class="rl">T (s)</div></div>
        </div>
        <canvas class="mgraph" id="mgRssV"></canvas>
      </div>
      <div class="brow">
        <button class="btn go" id="btnGoV" onclick="goV()">â–¶ Lancer</button>
        <button class="btn pau" id="btnPauV" onclick="pauseV()">â¸ Pause</button>
        <button class="btn rst" onclick="rstV()">â†º Reset</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• 4. RESSORT HORIZONTAL â•â•â• -->
<div id="tc-rssh" class="tc">
  <div class="layout">
    <div>
      <div class="ccard">
        <div class="ctop">
          <span class="ctitle">Ressort Horizontal â€” Oscillateur Harmonique</span>
          <span class="cstatus"><span class="dot" id="dRssH"></span><span id="sRssH">En attente</span></span>
        </div>
        <canvas id="cvRssH" width="700" height="340"></canvas>
        <div class="ebar-wrap">
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E1)">Ec (J)</div><div class="ebar-track"><div class="ebar-fill" id="bHEc" style="background:var(--E1)"></div></div><div class="ebar-val" style="color:var(--E1)" id="vHEc">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E4)">Ee (J)</div><div class="ebar-track"><div class="ebar-fill" id="bHEe" style="background:var(--E4)"></div></div><div class="ebar-val" style="color:var(--E4)" id="vHEe">0.000</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E3)">Em (J)</div><div class="ebar-track"><div class="ebar-fill" id="bHEm" style="background:var(--E3)"></div></div><div class="ebar-val" style="color:var(--E3)" id="vHEm">0.000</div></div>
        </div>
      </div>
      <div class="theory">
        <h4>// Oscillateur Harmonique Horizontal</h4>
        <span class="fml">Ee = Â½kxÂ²</span><span class="fml">Em = Â½kAÂ²</span><span class="fml">v_max = Aâˆš(k/m)</span>
        <div class="tip"><b>Graphe de phase :</b> x(v) = ellipse parfaite sans frottement. Avec frottement â†’ spirale convergente.</div>
      </div>
      <div class="exo-section">
        <div class="exo-header" onclick="toggleExo('exoRssH')">
          <h3>ğŸ“‹ EXERCICE â€” TABLEAU DE MESURES</h3>
          <span class="toggle-ico" id="icoExoRssH">â–¼</span>
        </div>
        <div class="exo-body" id="exoRssH">
          <div class="exo-enonce">
            RÃ¨gle : <strong>k = 40 N/m, m = 1.0 kg, A = 0.20 m, b = 0 (sans frottement)</strong>.<br>
            Lance, observe, complÃ¨te le tableau.
          </div>
          <table class="exo-table">
            <thead><tr><th>Grandeur</th><th>Formule</th><th>Valeur sim.</th><th>Ta valeur</th><th>RÃ©sultat</th></tr></thead>
            <tbody>
              <tr><td><span class="grandeur">PÃ©riode T</span><br><span class="formule">(s)</span></td><td class="formule">2Ï€âˆš(m/k)</td><td class="sim-val" id="exH_T">â€”</td><td><input class="exo-input" id="inH_T" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resH_T"></span><span class="corr-val" id="corrH_T"></span></td></tr>
              <tr><td><span class="grandeur">Ã‰nergie Em</span><br><span class="formule">(J)</span></td><td class="formule">Â½kAÂ²</td><td class="sim-val" id="exH_Em">â€”</td><td><input class="exo-input" id="inH_Em" placeholder="0.0000" type="number" step="0.0001"></td><td><span class="result-ico" id="resH_Em"></span><span class="corr-val" id="corrH_Em"></span></td></tr>
              <tr><td><span class="grandeur">v_max</span><br><span class="formule">(m/s)</span></td><td class="formule">Aâˆš(k/m)</td><td class="sim-val" id="exH_Vm">â€”</td><td><input class="exo-input" id="inH_Vm" placeholder="0.000" type="number" step="0.001"></td><td><span class="result-ico" id="resH_Vm"></span><span class="corr-val" id="corrH_Vm"></span></td></tr>
              <tr><td><span class="grandeur">Ec Ã  x=A/2</span><br><span class="formule">(J)</span></td><td class="formule">Em âˆ’ Â½k(A/2)Â²</td><td class="sim-val" id="exH_Ec2">â€”</td><td><input class="exo-input" id="inH_Ec2" placeholder="0.0000" type="number" step="0.0001"></td><td><span class="result-ico" id="resH_Ec2"></span><span class="corr-val" id="corrH_Ec2"></span></td></tr>
            </tbody>
          </table>
          <div class="exo-btn-row"><button class="exo-btn" onclick="checkExo('rssh')">âœ” VÃ©rifier</button><button class="exo-btn reset" onclick="resetExo('rssh')">â†º Effacer</button></div>
          <div class="score-bar" id="scoreRssH"></div>
        </div>
      </div>
    </div>
    <div class="cpanel">
      <div>
        <div class="csec">// ParamÃ¨tres</div>
        <div class="crow"><div class="clbl">Raideur k<small>(N/m)</small></div><input type="range" id="hK" min="5" max="300" value="40" oninput="upRssH()"><div class="vd" id="hKv">40 N/m</div></div>
        <div class="crow"><div class="clbl">Masse m<small>(kg)</small></div><input type="range" id="hM" min="0.1" max="5" step="0.05" value="1" oninput="upRssH()"><div class="vd" id="hMv">1.00 kg</div></div>
        <div class="crow"><div class="clbl">Amplitude A<small>(m)</small></div><input type="range" id="hA" min="0.02" max="0.5" step="0.01" value="0.2" oninput="upRssH()"><div class="vd" id="hAv">0.20 m</div></div>
        <div class="crow"><div class="clbl">Frottement b<small>(NÂ·s/m)</small></div><input type="range" id="hB" min="0" max="5" step="0.05" value="0" oninput="upRssH()"><div class="vd" id="hBv">0.00</div></div>
      </div>
      <div>
        <div class="csec">// Mesures live</div>
        <div class="reads">
          <div class="rc"><div class="rv" style="color:var(--E1)" id="rHEc">0.0000</div><div class="rl">Ec (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E4)" id="rHEe">0.0000</div><div class="rl">Ee (J)</div></div>
          <div class="rc"><div class="rv" style="color:var(--E3)" id="rHEm">â€”</div><div class="rl">Em (J)</div></div>
          <div class="rc"><div class="rv" id="rHT">â€”</div><div class="rl">T (s)</div></div>
        </div>
        <canvas class="mgraph" id="mgRssH"></canvas>
      </div>
      <div class="brow">
        <button class="btn go" id="btnGoH" onclick="goH()">â–¶ Lancer</button>
        <button class="btn pau" id="btnPauH" onclick="pauseH()">â¸ Pause</button>
        <button class="btn rst" onclick="rstH()">â†º Reset</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• 5. CONSERVATION Ã‰NERGIE â•â•â• -->
<div id="tc-cons" class="tc">
  <div class="layout">
    <div>
      <div class="ccard">
        <div class="ctop">
          <span class="ctitle">Conservation d'Ã‰nergie â€” Looping / Montagnes Russes</span>
          <span class="cstatus"><span class="dot" id="dCons"></span><span id="sCons">En attente</span></span>
        </div>
        <canvas id="cvCons" width="700" height="340"></canvas>
        <div class="ebar-wrap">
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E1)">Ec (J)</div><div class="ebar-track"><div class="ebar-fill" id="bLoEc" style="background:var(--E1)"></div></div><div class="ebar-val" style="color:var(--E1)" id="vLoEc">0.00</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E2)">Ep (J)</div><div class="ebar-track"><div class="ebar-fill" id="bLoEp" style="background:var(--E2)"></div></div><div class="ebar-val" style="color:var(--E2)" id="vLoEp">0.00</div></div>
          <div class="ebar"><div class="ebar-lbl" style="color:var(--E3)">Em (J)</div><div class="ebar-track"><div class="ebar-fill" id="bLoEm" style="background:var(--E3)"></div></div><div class="ebar-val" style="color:var(--E3)" id="vLoEm">0.00</div></div>
        </div>
      </div>
      <div class="theory">
        <h4>// Conservation Ã‰nergie â€” Montagnes Russes</h4>
        <span class="fml">vÂ²_sommet â‰¥ gR</span><span class="fml">h_min = 5R/2</span><span class="fml">Em = mgh + Â½mvÂ² = cste</span>
        <div class="tip"><b>RÃ©sultat clÃ© :</b> h_min = 5R/2 est indÃ©pendant de la masse.</div>
        <div class="warn">âš  Si h &lt; 5R/2 â†’ perte de contact au sommet du looping.</div>
      </div>
      <div class="exo-section">
        <div class="exo-header" onclick="toggleExo('exoCons')">
          <h3>ğŸ“‹ EXERCICE â€” TABLEAU DE MESURES</h3>
          <span class="toggle-ico" id="icoExoCons">â–¼</span>
        </div>
        <div class="exo-body" id="exoCons">
          <div class="exo-enonce">
            RÃ¨gle : <strong>R = 4 m, m = 500 kg, g = 9.81 m/sÂ²</strong>.<br>
            Teste d'abord h = 8 m, puis h = 12 m. ComplÃ¨te le tableau.
          </div>
          <table class="exo-table">
            <thead><tr><th>Grandeur</th><th>Formule</th><th>Valeur sim.</th><th>Ta valeur</th><th>RÃ©sultat</th></tr></thead>
            <tbody>
              <tr><td><span class="grandeur">h_min</span><br><span class="formule">(m)</span></td><td class="formule">5R/2</td><td class="sim-val" id="exL_Hmin">â€”</td><td><input class="exo-input" id="inL_Hmin" placeholder="0.0" type="number" step="0.1"></td><td><span class="result-ico" id="resL_Hmin"></span><span class="corr-val" id="corrL_Hmin"></span></td></tr>
              <tr><td><span class="grandeur">Em (h=12m)</span><br><span class="formule">(kJ)</span></td><td class="formule">mgh</td><td class="sim-val" id="exL_Em">â€”</td><td><input class="exo-input" id="inL_Em" placeholder="0.00" type="number" step="0.01"></td><td><span class="result-ico" id="resL_Em"></span><span class="corr-val" id="corrL_Em"></span></td></tr>
              <tr><td><span class="grandeur">v au sommet</span><br><span class="formule">(m/s) h=12m</span></td><td class="formule">âˆš(2g(hâˆ’2R))</td><td class="sim-val" id="exL_Vs">â€”</td><td><input class="exo-input" id="inL_Vs" placeholder="0.00" type="number" step="0.01"></td><td><span class="result-ico" id="resL_Vs"></span><span class="corr-val" id="corrL_Vs"></span></td></tr>
              <tr><td><span class="grandeur">v en bas</span><br><span class="formule">(m/s) h=12m</span></td><td class="formule">âˆš(2gh)</td><td class="sim-val" id="exL_Vb">â€”</td><td><input class="exo-input" id="inL_Vb" placeholder="0.00" type="number" step="0.01"></td><td><span class="result-ico" id="resL_Vb"></span><span class="corr-val" id="corrL_Vb"></span></td></tr>
            </tbody>
          </table>
          <div class="exo-btn-row"><button class="exo-btn" onclick="checkExo('cons')">âœ” VÃ©rifier</button><button class="exo-btn reset" onclick="resetExo('cons')">â†º Effacer</button></div>
          <div class="score-bar" id="scoreCons"></div>
        </div>
      </div>
    </div>
    <div class="cpanel">
      <div>
        <div class="csec">// ParamÃ¨tres</div>
        <div class="crow"><div class="clbl">Hauteur h<small>dÃ©part (m)</small></div><input type="range" id="lH" min="1" max="30" step="0.5" value="12" oninput="upCons()"><div class="vd" id="lHv">12.0 m</div></div>
        <div class="crow"><div class="clbl">Rayon R<small>looping (m)</small></div><input type="range" id="lR" min="1" max="10" step="0.5" value="4" oninput="upCons()"><div class="vd" id="lRv">4.0 m</div></div>
        <div class="crow"><div class="clbl">Masse m<small>(kg)</small></div><input type="range" id="lM" min="10" max="2000" step="10" value="500" oninput="upCons()"><div class="vd" id="lMv">500 kg</div></div>
        <div class="crow"><div class="clbl">g (m/sÂ²)</div><input type="range" id="lG" min="1.6" max="24" step="0.01" value="9.81" oninput="upCons()"><div class="vd" id="lGv">9.81</div></div>
      </div>
      <div>
        <div class="csec">// Bilan Ã©nergÃ©tique</div>
        <div class="reads">
          <div class="rc"><div class="rv" id="rLhmin">â€”</div><div class="rl">h_min (m)</div></div>
          <div class="rc"><div class="rv" id="rLpass">â€”</div><div class="rl">Passe ?</div></div>
          <div class="rc"><div class="rv" id="rLvs">â€”</div><div class="rl">v sommet</div></div>
          <div class="rc"><div class="rv" style="color:var(--E3)" id="rLEm">â€”</div><div class="rl">Em (kJ)</div></div>
        </div>
      </div>
      <div class="brow">
        <button class="btn go" id="btnGoL" onclick="goLo()">â–¶ Lancer</button>
        <button class="btn pau" id="btnPauL" onclick="pauseLo()">â¸ Pause</button>
        <button class="btn rst" onclick="rstLo()">â†º Reset</button>
      </div>
    </div>
  </div>
</div>

<footer>
  Travail &amp; Ã‰nergie Â· Edmond Atinzoun TCHOKPON Â·
  <a href="https://edmond-atinzoun.netlify.app" target="_blank">edmond-atinzoun.netlify.app</a>
  Â· UniversitÃ© d'Abomey-Calavi Â· CPGE / Licence PC
</footer>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ST(n,b){
  document.querySelectorAll('.tc').forEach(t=>t.classList.remove('on'));
  document.querySelectorAll('.tb').forEach(x=>x.classList.remove('on'));
  document.getElementById('tc-'+n).classList.add('on');
  b.classList.add('on');
}
function toggleExo(id){
  const body=document.getElementById(id);
  const ico=document.getElementById('ico'+id.charAt(0).toUpperCase()+id.slice(1));
  body.classList.toggle('open');
  if(ico) ico.textContent=body.classList.contains('open')?'â–²':'â–¼';
}
function C(id){return document.getElementById(id);}
function sv(id,v){C(id).textContent=v;}
function sb(id,p){C(id).style.width=Math.min(100,Math.max(0,p*100))+'%';}

function clrCV(id){
  const cv=C(id),ctx=cv.getContext('2d');
  ctx.clearRect(0,0,cv.width,cv.height);
  return {cv,ctx,W:cv.width,H:cv.height};
}
function grd(ctx,W,H){
  ctx.save();ctx.strokeStyle='rgba(0,0,0,0.04)';ctx.lineWidth=1;
  for(let x=0;x<W;x+=50){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();}
  for(let y=0;y<H;y+=50){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
  ctx.restore();
}
function arw(ctx,x1,y1,x2,y2,col,lbl,lw=2){
  const dx=x2-x1,dy=y2-y1,L=Math.sqrt(dx*dx+dy*dy);
  if(L<4)return;
  const ux=dx/L,uy=dy/L,hw=6,hl=10;
  ctx.save();ctx.strokeStyle=col;ctx.fillStyle=col;ctx.lineWidth=lw;
  ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2-ux*hl,y2-uy*hl);ctx.stroke();
  ctx.beginPath();ctx.moveTo(x2,y2);
  ctx.lineTo(x2-ux*hl-uy*hw,y2-uy*hl+ux*hw);
  ctx.lineTo(x2-ux*hl+uy*hw,y2-uy*hl-ux*hw);
  ctx.closePath();ctx.fill();
  if(lbl){ctx.font='bold 10px DM Mono,monospace';ctx.fillText(lbl,(x1+x2)/2+uy*13,(y1+y2)/2-ux*13);}
  ctx.restore();
}
function drawMG(id,hist,cols){
  const cv=C(id),ctx=cv.getContext('2d'),W=cv.width,H=cv.height;
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='rgba(0,0,0,0.03)';ctx.fillRect(0,0,W,H);
  if(!hist||hist.length<2)return;
  for(let s=0;s<cols.length;s++){
    const vals=hist.map(h=>h[s]);
    const mx=Math.max(...vals,0.0001);
    ctx.strokeStyle=cols[s];ctx.lineWidth=1.5;
    ctx.beginPath();
    hist.forEach((h,i)=>{
      const x=i*(W-2)/(hist.length-1)+1,y=H-2-(h[s]/mx)*(H-4);
      i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    });ctx.stroke();
  }
}
function setPauseBtn(id,paused){
  const b=C(id);
  if(paused){b.textContent='â–¶ Reprendre';b.classList.add('active');}
  else{b.textContent='â¸ Pause';b.classList.remove('active');}
}
function setDot(id,state){
  const d=C(id);d.className='dot';
  if(state==='run')d.classList.add('run');
  else if(state==='pause')d.classList.add('pause');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. PENDULE SIMPLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sP={run:false,paused:false,raf:null,th:0,dth:0,t:0,hist:[]};
function getPend(){return{L:+C('pL').value,m:+C('pM').value,th0:+C('pTh').value*Math.PI/180,g:+C('pG').value};}
function upPend(){
  const {L,m,th0,g}=getPend();
  sv('pLv',L.toFixed(2)+' m');sv('pMv',m.toFixed(1)+' kg');
  sv('pThv',Math.round(th0*180/Math.PI)+'Â°');sv('pGv',g.toFixed(2));
  const T=2*Math.PI*Math.sqrt(L/g),Em=m*g*L*(1-Math.cos(th0));
  const vmax=Math.sqrt(2*g*L*(1-Math.cos(th0)));
  sv('rPT',T.toFixed(3)+' s');sv('rPEm',Em.toFixed(4)+' J');
  sv('vPEm',Em.toFixed(3));sb('bPEm',1);
  // Update exercice sim values
  sv('exP_T',T.toFixed(3));sv('exP_Em',Em.toFixed(4));sv('exP_Vm',vmax.toFixed(4));
  const Ep15=m*g*L*(1-Math.cos(15*Math.PI/180));sv('exP_Ep15',Ep15.toFixed(4));
  drawPend(sP.run?sP.th:th0,0);
}
function drawPend(th,dth){
  const {cv,ctx,W,H}=clrCV('cvPend');
  const {L,m,g,th0}=getPend();
  grd(ctx,W,H);
  const ox=W/2,oy=50,sc=Math.min((H-80)/L/1.1,95);
  const bx=ox+Math.sin(th)*L*sc,by=oy+Math.cos(th)*L*sc;
  ctx.save();
  ctx.fillStyle='#1a1410';ctx.fillRect(ox-3,oy-14,6,14);
  ctx.fillStyle='#3d3530';ctx.fillRect(ox-22,oy-16,44,6);
  ctx.strokeStyle='rgba(37,99,184,0.15)';ctx.lineWidth=1;
  ctx.beginPath();
  for(let a=-th0;a<=th0;a+=0.02){
    const px=ox+Math.sin(a)*L*sc,py=oy+Math.cos(a)*L*sc;
    a===-th0?ctx.moveTo(px,py):ctx.lineTo(px,py);
  }ctx.stroke();
  ctx.strokeStyle='#8a7e74';ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(bx,by);ctx.stroke();
  // angle arc
  ctx.strokeStyle='rgba(232,82,26,0.4)';ctx.lineWidth=1.5;ctx.setLineDash([3,3]);
  ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(ox,oy+52);ctx.stroke();ctx.setLineDash([]);
  ctx.strokeStyle='rgba(232,82,26,0.5)';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.arc(ox,oy,52,Math.PI/2-Math.abs(th),Math.PI/2,th<0);ctx.stroke();
  ctx.fillStyle='#e8521a';ctx.font='bold 11px DM Mono,monospace';ctx.textAlign='left';
  ctx.fillText('Î¸='+Math.round(th*180/Math.PI)+'Â°',ox+(th>0?14:-60),oy+55);
  const Em=m*g*L*(1-Math.cos(th0)),Ep=m*g*L*(1-Math.cos(th)),Ec=Math.max(0,Em-Ep);
  const r=Math.max(10,Math.min(20,m*7));
  const g2=ctx.createRadialGradient(bx-r*.3,by-r*.3,0,bx,by,r);
  g2.addColorStop(0,'#6baee8');g2.addColorStop(1,'#1a3a6e');
  ctx.fillStyle=g2;ctx.beginPath();ctx.arc(bx,by,r,0,Math.PI*2);ctx.fill();
  ctx.strokeStyle='#2563b8';ctx.lineWidth=2;ctx.stroke();
  const v=Math.sqrt(2*Ec/m);
  if(v>0.01){const vx=-Math.cos(th)*v*4,vy=Math.sin(th)*v*4;arw(ctx,bx,by,bx+vx*3,by+vy*3,'#e8521a','v',2);}
  // h label
  const h=L*(1-Math.cos(th));
  ctx.fillStyle='#2563b8';ctx.font='10px DM Mono';ctx.textAlign='left';
  ctx.fillText('h='+h.toFixed(3)+'m',bx+r+5,by);
  // readings
  sv('rPEc',Ec.toFixed(4)+' J');sv('rPEp',Ep.toFixed(4)+' J');sv('rPEm',Em.toFixed(4)+' J');
  sb('bPEc',Em>0?Ec/Em:0);sb('bPEp',Em>0?Ep/Em:0);sb('bPEm',1);
  sv('vPEc',Ec.toFixed(3));sv('vPEp',Ep.toFixed(3));sv('vPEm',Em.toFixed(3));
  ctx.restore();
}
function goP(){
  if(sP.run&&!sP.paused)return;
  if(sP.paused){sP.paused=false;setDot('dPend','run');sv('sPend','Oscillationâ€¦');setPauseBtn('btnPauP',false);loopP();return;}
  const {th0}=getPend();sP={run:true,paused:false,raf:null,th:th0,dth:0,t:0,hist:[]};
  setDot('dPend','run');sv('sPend','Oscillation en coursâ€¦');loopP();
}
function loopP(){
  let last=null;
  const step=(ts)=>{
    if(sP.paused)return;
    if(!last)last=ts;
    const dt=Math.min((ts-last)/1000,0.03);last=ts;
    const {L,m,g,th0}=getPend();
    sP.dth+=-(g/L)*Math.sin(sP.th)*dt;sP.th+=sP.dth*dt;sP.t+=dt;
    const Em=m*g*L*(1-Math.cos(th0)),Ep=m*g*L*(1-Math.cos(sP.th)),Ec=Math.max(0,Em-Ep);
    sP.hist.push([Ec,Ep,Em]);if(sP.hist.length>120)sP.hist.shift();
    drawPend(sP.th,sP.dth);drawMG('mgPend',sP.hist,['#e8521a','#2563b8','#16a34a']);
    sv('rPT',(2*Math.PI*Math.sqrt(L/g)).toFixed(3)+' s');
    sP.raf=requestAnimationFrame(step);
  };sP.raf=requestAnimationFrame(step);
}
function pauseP(){
  if(!sP.run)return;
  sP.paused=!sP.paused;
  if(sP.paused){if(sP.raf)cancelAnimationFrame(sP.raf);setDot('dPend','pause');sv('sPend','En pause');setPauseBtn('btnPauP',true);}
  else{setDot('dPend','run');sv('sPend','Oscillationâ€¦');setPauseBtn('btnPauP',false);loopP();}
}
function rstP(){
  if(sP.raf)cancelAnimationFrame(sP.raf);
  sP={run:false,paused:false,raf:null,th:0,dth:0,t:0,hist:[]};
  setDot('dPend','');sv('sPend','En attente');setPauseBtn('btnPauP',false);upPend();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. PENDULE CONIQUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sC={run:false,paused:false,raf:null,phi:0};
function getConi(){return{L:+C('cL').value,m:+C('cM').value,w:+C('cW').value,g:+C('cG').value};}
function upConi(){
  const {L,m,w,g}=getConi();
  sv('cLv',L.toFixed(2)+' m');sv('cMv',m.toFixed(1)+' kg');sv('cWv',w.toFixed(1)+' rad/s');sv('cGv',g.toFixed(2));
  const cosT=Math.min(1,g/(w*w*L)),th=Math.acos(cosT),R=L*Math.sin(th);
  const T=m*g/Math.max(0.001,cosT),Fc=m*w*w*R,v=w*R,Ec=0.5*m*v*v,Ep=m*g*L*cosT;
  sv('rCEc',Ec.toFixed(3)+' J');sv('rCTfil',T.toFixed(3)+' N');sv('rCTh',Math.round(th*180/Math.PI)+'Â°');sv('rCR',R.toFixed(3)+' m');
  // exercice
  sv('exC_Th',Math.round(th*180/Math.PI*10)/10);sv('exC_R',R.toFixed(4));sv('exC_T',T.toFixed(4));sv('exC_Fc',Fc.toFixed(4));
  const Em=Ec+Ep;
  sb('bCEc',Em>0?Ec/Em:0);sb('bCEp',Em>0?Ep/Em:0);sb('bCFc',Math.min(1,Fc/(m*g)));
  sv('vCEc',Ec.toFixed(3));sv('vCEp',Ep.toFixed(3));sv('vCFc',Fc.toFixed(3));
  drawConi(sC.phi||0);
}
function drawConi(phi){
  const {cv,ctx,W,H}=clrCV('cvConi');
  const {L,m,w,g}=getConi();
  grd(ctx,W,H);
  const cosT=Math.min(1,g/(w*w*L)),th=Math.acos(cosT),R=L*Math.sin(th),hc=L*cosT;
  const ox=W*0.3,oy=70,sc=Math.min((H-80)/L/1.1,85);
  ctx.save();
  ctx.strokeStyle='rgba(0,0,0,0.12)';ctx.lineWidth=1;ctx.setLineDash([4,3]);
  ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(ox,oy+L*sc+30);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='#1a1410';ctx.fillRect(ox-3,oy-14,6,14);
  ctx.fillStyle='#3d3530';ctx.fillRect(ox-22,oy-16,44,6);
  // Ellipse trajectoire
  ctx.strokeStyle='rgba(37,99,184,0.18)';ctx.lineWidth=1;
  ctx.beginPath();ctx.ellipse(ox,oy+hc*sc,R*sc,R*sc*0.22,0,0,Math.PI*2);ctx.stroke();
  const bx=ox+Math.cos(phi)*R*sc,by2=oy+hc*sc;
  // Fil
  ctx.strokeStyle='#8a7e74';ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(bx,by2);ctx.stroke();
  // Angle
  ctx.strokeStyle='rgba(232,82,26,0.4)';ctx.lineWidth=1.5;ctx.setLineDash([3,3]);
  ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(ox,oy+55);ctx.stroke();ctx.setLineDash([]);
  ctx.strokeStyle='rgba(232,82,26,0.5)';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.arc(ox,oy,55,Math.PI/2,Math.PI/2+th);ctx.stroke();
  ctx.fillStyle='#e8521a';ctx.font='bold 11px DM Mono';ctx.textAlign='left';
  ctx.fillText('Î¸='+Math.round(th*180/Math.PI)+'Â°',ox+14,oy+58);
  const r=Math.max(9,Math.min(16,m*6));
  const g2=ctx.createRadialGradient(bx-r*.3,by2-r*.3,0,bx,by2,r);
  g2.addColorStop(0,'#fb923c');g2.addColorStop(1,'#92400e');
  ctx.fillStyle=g2;ctx.beginPath();ctx.arc(bx,by2,r,0,Math.PI*2);ctx.fill();
  ctx.strokeStyle='#e8521a';ctx.lineWidth=2;ctx.stroke();
  // Forces
  const Fc=m*w*w*R*sc,Tf=m*g/Math.max(0.001,cosT),sc2=Math.min(70,Fc*8);
  arw(ctx,bx,by2,ox,oy,'#2563b8','T',2);
  arw(ctx,bx,by2,bx,by2+Math.min(50,m*g*sc*0.3),'#1a1410','P',1.5);
  arw(ctx,bx,by2,bx-(bx-ox)/Math.max(0.1,Math.abs(bx-ox||1))*sc2,by2,'#9333ea','Fc',2);
  // Vue du dessus
  const ox2=W*0.73,oy2=H/2,r2=Math.max(5,R*sc);
  ctx.strokeStyle='rgba(0,0,0,0.1)';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.arc(ox2,oy2,r2,0,Math.PI*2);ctx.stroke();
  ctx.fillStyle='rgba(37,99,184,0.05)';ctx.fill();
  const bbx=ox2+Math.cos(phi)*r2,bby=oy2+Math.sin(phi)*r2;
  ctx.strokeStyle='rgba(0,0,0,0.1)';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(ox2,oy2);ctx.lineTo(bbx,bby);ctx.stroke();
  ctx.fillStyle='#e8521a';ctx.beginPath();ctx.arc(bbx,bby,8,0,Math.PI*2);ctx.fill();
  ctx.strokeStyle='white';ctx.lineWidth=1.5;ctx.stroke();
  ctx.fillStyle='#8a7e74';ctx.font='9px DM Mono';ctx.textAlign='center';
  ctx.fillText('VUE DE FACE',ox,H-10);ctx.fillText('VUE DU DESSUS',ox2,H-10);
  ctx.fillStyle='#3d3530';ctx.font='10px DM Mono';ctx.fillText('R='+R.toFixed(3)+'m',ox2,oy2+r2+16);
  ctx.restore();
}
function goC(){
  if(sC.run&&!sC.paused)return;
  if(sC.paused){sC.paused=false;setDot('dConi','run');sv('sConi','Rotationâ€¦');setPauseBtn('btnPauC',false);loopC();return;}
  sC={run:true,paused:false,raf:null,phi:0};
  setDot('dConi','run');sv('sConi','Rotation en coursâ€¦');loopC();
}
function loopC(){
  let last=null;
  const step=(ts)=>{
    if(sC.paused)return;
    if(!last)last=ts;
    const dt=Math.min((ts-last)/1000,0.03);last=ts;
    sC.phi+=getConi().w*dt;
    upConi();drawConi(sC.phi);
    sC.raf=requestAnimationFrame(step);
  };sC.raf=requestAnimationFrame(step);
}
function pauseC(){
  if(!sC.run)return;sC.paused=!sC.paused;
  if(sC.paused){if(sC.raf)cancelAnimationFrame(sC.raf);setDot('dConi','pause');sv('sConi','En pause');setPauseBtn('btnPauC',true);}
  else{setDot('dConi','run');sv('sConi','Rotationâ€¦');setPauseBtn('btnPauC',false);loopC();}
}
function rstC(){
  if(sC.raf)cancelAnimationFrame(sC.raf);
  sC={run:false,paused:false,raf:null,phi:0};
  setDot('dConi','');sv('sConi','En attente');setPauseBtn('btnPauC',false);upConi();drawConi(0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. RESSORT VERTICAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sV={run:false,paused:false,raf:null,x:0,v:0,t:0,hist:[]};
function getRssV(){return{k:+C('vK').value,m:+C('vM').value,x0:+C('vX0').value,g:+C('vG').value};}
function upRssV(){
  const {k,m,x0,g}=getRssV();
  sv('vKv',k+' N/m');sv('vMv',m.toFixed(2)+' kg');sv('vX0v',(x0>=0?'+':'')+x0.toFixed(2)+' m');sv('vGv',g.toFixed(2));
  const T=2*Math.PI*Math.sqrt(m/k),Em=0.5*k*x0*x0,vmax=Math.abs(x0)*Math.sqrt(k/m),xeq=m*g/k;
  sv('rVT',T.toFixed(3)+' s');sv('rVEm',Em.toFixed(4)+' J');sv('vVEm',Em.toFixed(3));sb('bVEm',1);
  sv('exV_T',T.toFixed(4));sv('exV_Xeq',xeq.toFixed(4));sv('exV_Em',Em.toFixed(4));sv('exV_Vm',vmax.toFixed(4));
  drawRssV(sV.run?sV.x:x0,0);
}
function drawRssV(x,v){
  const {cv,ctx,W,H}=clrCV('cvRssV');
  const {k,m,g,x0}=getRssV();grd(ctx,W,H);
  const xeq=m*g/k,cx=W/2,topY=35,sc=Math.min(170,(H-90)/Math.max(0.01,Math.abs(x0)+xeq+0.1));
  ctx.save();
  ctx.fillStyle='#3d3530';ctx.fillRect(cx-50,topY,100,18);
  ctx.fillStyle='#1a1410';ctx.fillRect(cx-3,topY+18,6,6);
  // Eq line
  const eqY=topY+18+xeq*sc+90;
  ctx.strokeStyle='rgba(22,163,74,0.35)';ctx.lineWidth=1;ctx.setLineDash([4,3]);
  ctx.beginPath();ctx.moveTo(cx-65,eqY);ctx.lineTo(cx+65,eqY);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='#16a34a';ctx.font='9px DM Mono';ctx.textAlign='right';ctx.fillText('Ã©quilibre x_eq='+xeq.toFixed(3)+'m',cx-68,eqY+3);
  const bY=eqY+x*sc;
  const sLen=Math.max(10,bY-topY-24);const nS=Math.max(4,Math.round(sLen/10));
  ctx.strokeStyle='#e8521a';ctx.lineWidth=2;ctx.lineJoin='round';
  ctx.beginPath();ctx.moveTo(cx,topY+24);
  for(let i=0;i<=nS*4;i++){
    const yy=topY+24+i*sLen/(nS*4);
    const xx=cx+(i%4<2?18:-18);
    i===0?ctx.moveTo(cx,yy):ctx.lineTo(xx,yy);
  }ctx.lineTo(cx,bY);ctx.stroke();
  const bW=58,bH=36;
  const Em=0.5*k*x0*x0,Ee=0.5*k*x*x,Ec=Math.max(0,0.5*m*v*v);
  const g2=ctx.createLinearGradient(cx-bW/2,bY,cx+bW/2,bY+bH);
  g2.addColorStop(0,'#fde68a');g2.addColorStop(1,'#b45309');
  ctx.fillStyle=g2;ctx.strokeStyle='#e8521a';ctx.lineWidth=2;
  ctx.fillRect(cx-bW/2,bY,bW,bH);ctx.strokeRect(cx-bW/2,bY,bW,bH);
  ctx.fillStyle='#1a1410';ctx.font='bold 10px DM Mono';ctx.textAlign='center';ctx.fillText(m.toFixed(2)+'kg',cx,bY+bH/2+4);
  if(Math.abs(v)>0.001){arw(ctx,cx+bW/2+5,bY+bH/2,cx+bW/2+5,bY+bH/2+(v>0?1:-1)*Math.min(50,Math.abs(v)*15),'#e8521a','v',2);}
  arw(ctx,cx-bW/2-5,bY+bH/2,cx-bW/2-5,bY+bH/2-(x>0?1:-1)*Math.min(55,Math.abs(k*x)*0.5),'#9333ea','F_k',1.5);
  arw(ctx,cx,bY+bH,cx,bY+bH+Math.min(45,m*g*3),'#1a1410','P',1.5);
  ctx.fillStyle='#3d3530';ctx.font='10px DM Mono';ctx.textAlign='left';ctx.fillText('x='+x.toFixed(3)+'m',cx+bW/2+10,bY+bH/2);
  sv('rVEc',Ec.toFixed(4)+' J');sv('rVEe',Ee.toFixed(4)+' J');sv('rVEm',Em.toFixed(4)+' J');
  sb('bVEc',Em>0?Ec/Em:0);sb('bVEe',Em>0?Ee/Em:0);sb('bVEm',1);
  sv('vVEc',Ec.toFixed(3));sv('vVEe',Ee.toFixed(3));sv('vVEm',Em.toFixed(3));
  ctx.restore();
}
function goV(){
  if(sV.run&&!sV.paused)return;
  if(sV.paused){sV.paused=false;setDot('dRssV','run');sv('sRssV','Oscillationâ€¦');setPauseBtn('btnPauV',false);loopV();return;}
  const {x0}=getRssV();sV={run:true,paused:false,raf:null,x:x0,v:0,t:0,hist:[]};
  setDot('dRssV','run');sv('sRssV','Oscillationâ€¦');loopV();
}
function loopV(){
  let last=null;
  const step=(ts)=>{
    if(sV.paused)return;
    if(!last)last=ts;
    const dt=Math.min((ts-last)/1000,0.03);last=ts;
    const {k,m}=getRssV();
    sV.v+=-(k/m)*sV.x*dt;sV.x+=sV.v*dt;sV.t+=dt;
    const Em=0.5*k*getRssV().x0**2,Ee=0.5*k*sV.x**2,Ec=Math.max(0,0.5*m*sV.v**2);
    sV.hist.push([Ec,Ee,Em]);if(sV.hist.length>120)sV.hist.shift();
    drawRssV(sV.x,sV.v);drawMG('mgRssV',sV.hist,['#e8521a','#9333ea','#16a34a']);
    sv('rVT',(2*Math.PI*Math.sqrt(m/k)).toFixed(3)+' s');
    sV.raf=requestAnimationFrame(step);
  };sV.raf=requestAnimationFrame(step);
}
function pauseV(){
  if(!sV.run)return;sV.paused=!sV.paused;
  if(sV.paused){if(sV.raf)cancelAnimationFrame(sV.raf);setDot('dRssV','pause');sv('sRssV','En pause');setPauseBtn('btnPauV',true);}
  else{setDot('dRssV','run');sv('sRssV','Oscillationâ€¦');setPauseBtn('btnPauV',false);loopV();}
}
function rstV(){
  if(sV.raf)cancelAnimationFrame(sV.raf);
  sV={run:false,paused:false,raf:null,x:0,v:0,t:0,hist:[]};
  setDot('dRssV','');sv('sRssV','En attente');setPauseBtn('btnPauV',false);upRssV();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. RESSORT HORIZONTAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sH={run:false,paused:false,raf:null,x:0,v:0,t:0,hist:[],ph:[]};
function getRssH(){return{k:+C('hK').value,m:+C('hM').value,A:+C('hA').value,b:+C('hB').value};}
function upRssH(){
  const {k,m,A,b}=getRssH();
  sv('hKv',k+' N/m');sv('hMv',m.toFixed(2)+' kg');sv('hAv',A.toFixed(2)+' m');sv('hBv',b.toFixed(2));
  const T=2*Math.PI*Math.sqrt(m/k),Em=0.5*k*A*A,vmax=A*Math.sqrt(k/m),Ec2=Em-0.5*k*(A/2)**2;
  sv('rHT',T.toFixed(3)+' s');sv('rHEm',Em.toFixed(4)+' J');sv('vHEm',Em.toFixed(3));sb('bHEm',1);
  sv('exH_T',T.toFixed(4));sv('exH_Em',Em.toFixed(4));sv('exH_Vm',vmax.toFixed(4));sv('exH_Ec2',Math.max(0,Ec2).toFixed(4));
  drawRssH(sH.run?sH.x:A,0,[]);
}
function drawRssH(x,v,ph){
  const {cv,ctx,W,H}=clrCV('cvRssH');
  const {k,m,A,b}=getRssH();grd(ctx,W,H);
  const gY=H*0.62,wallX=55,cx2=W/2,sc=Math.min(190,85/Math.max(0.01,A));
  ctx.save();
  ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(0,gY,W,H-gY);
  ctx.strokeStyle='#3d3530';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,gY);ctx.lineTo(W,gY);ctx.stroke();
  ctx.fillStyle='#3d3530';ctx.fillRect(wallX-12,gY-100,12,100);
  ctx.strokeStyle='#8a7e74';ctx.lineWidth=1;
  for(let i=0;i<8;i++){ctx.beginPath();ctx.moveTo(wallX-12,gY-i*12);ctx.lineTo(wallX-22,gY-i*12-10);ctx.stroke();}
  // ZÃ©ro
  ctx.strokeStyle='rgba(22,163,74,0.3)';ctx.lineWidth=1;ctx.setLineDash([4,3]);
  ctx.beginPath();ctx.moveTo(wallX+cx2,gY-55);ctx.lineTo(wallX+cx2,gY-18);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='#16a34a';ctx.font='9px DM Mono';ctx.textAlign='center';ctx.fillText('O',wallX+cx2,gY+14);
  const bx2=wallX+cx2+x*sc,bY=gY-38,bW=52,bH=38;
  const sLen=Math.max(5,bx2-wallX-bW/2-5);const nS=Math.max(4,Math.round(sLen/10));
  ctx.strokeStyle='#e8521a';ctx.lineWidth=2;ctx.lineJoin='round';
  ctx.beginPath();ctx.moveTo(wallX+2,gY-bH/2);
  for(let i=0;i<=nS*4;i++){
    const xx=wallX+2+i*sLen/(nS*4),yy=(gY-bH/2)+(i%4<2?-12:12);
    i===0?ctx.moveTo(xx,gY-bH/2):ctx.lineTo(xx,yy);
  }ctx.lineTo(bx2-bW/2,gY-bH/2);ctx.stroke();
  const Em=0.5*k*A*A,Ee=0.5*k*x*x,Ec=Math.max(0,0.5*m*v*v);
  const g2=ctx.createLinearGradient(bx2-bW/2,bY,bx2+bW/2,bY+bH);
  g2.addColorStop(0,'#fde68a');g2.addColorStop(1,'#b45309');
  ctx.fillStyle=g2;ctx.strokeStyle='#e8521a';ctx.lineWidth=2;
  ctx.fillRect(bx2-bW/2,bY,bW,bH);ctx.strokeRect(bx2-bW/2,bY,bW,bH);
  ctx.fillStyle='#1a1410';ctx.font='bold 10px DM Mono';ctx.textAlign='center';ctx.fillText(m.toFixed(1)+'kg',bx2,bY+bH/2+4);
  if(Math.abs(v)>0.001)arw(ctx,bx2,bY-6,bx2+v*sc*0.7,bY-6,'#e8521a','v',2);
  arw(ctx,bx2-bW/2-5,bY+bH/2,bx2-bW/2-5-(x>0?1:-1)*Math.min(65,Math.abs(k*x)*sc*0.28),bY+bH/2,'#9333ea','F_k',2);
  // Phase portrait
  if(ph&&ph.length>1){
    const pW=150,pH=85,px=W-pW-12,py=12;
    ctx.fillStyle='rgba(255,255,255,0.88)';ctx.fillRect(px,py,pW,pH);
    ctx.strokeStyle='rgba(0,0,0,0.12)';ctx.lineWidth=1;ctx.strokeRect(px,py,pW,pH);
    ctx.fillStyle='#8a7e74';ctx.font='9px DM Mono';ctx.textAlign='center';ctx.fillText('Phase xâ€“v',px+pW/2,py+10);
    const Amax=A,vmax2=A*Math.sqrt(k/m)||0.001;
    ctx.strokeStyle='#16a34a';ctx.lineWidth=1.5;ctx.beginPath();
    ph.forEach(([px2,pv],i)=>{
      const sx=px+pW/2+px2/Amax*(pW/2-6),sy=py+pH/2-pv/vmax2*(pH/2-10);
      i===0?ctx.moveTo(sx,sy):ctx.lineTo(sx,sy);
    });ctx.stroke();
    ctx.fillStyle='#e8521a';
    const cx3=px+pW/2+x/Amax*(pW/2-6),cy3=py+pH/2-v/(vmax2||1)*(pH/2-10);
    ctx.beginPath();ctx.arc(cx3,cy3,4,0,Math.PI*2);ctx.fill();
  }
  sv('rHEc',Ec.toFixed(4)+' J');sv('rHEe',Ee.toFixed(4)+' J');sv('rHEm',Em.toFixed(4)+' J');
  sb('bHEc',Em>0?Ec/Em:0);sb('bHEe',Em>0?Ee/Em:0);sb('bHEm',1);
  sv('vHEc',Ec.toFixed(3));sv('vHEe',Ee.toFixed(3));sv('vHEm',Em.toFixed(3));
  ctx.restore();
}
function goH(){
  if(sH.run&&!sH.paused)return;
  if(sH.paused){sH.paused=false;setDot('dRssH','run');sv('sRssH','Oscillationâ€¦');setPauseBtn('btnPauH',false);loopH();return;}
  const {A}=getRssH();sH={run:true,paused:false,raf:null,x:A,v:0,t:0,hist:[],ph:[]};
  setDot('dRssH','run');sv('sRssH','Oscillationâ€¦');loopH();
}
function loopH(){
  let last=null;
  const step=(ts)=>{
    if(sH.paused)return;
    if(!last)last=ts;
    const dt=Math.min((ts-last)/1000,0.03);last=ts;
    const {k,m,b}=getRssH();
    sH.v+=-(k/m)*sH.x*dt-(b/m)*sH.v*dt;sH.x+=sH.v*dt;sH.t+=dt;
    sH.ph.push([sH.x,sH.v]);if(sH.ph.length>220)sH.ph.shift();
    const Em=0.5*k*getRssH().A**2,Ee=0.5*k*sH.x**2,Ec=Math.max(0,0.5*m*sH.v**2);
    sH.hist.push([Ec,Ee,Ec+Ee]);if(sH.hist.length>120)sH.hist.shift();
    drawRssH(sH.x,sH.v,sH.ph);drawMG('mgRssH',sH.hist,['#e8521a','#9333ea','#16a34a']);
    sv('rHT',(2*Math.PI*Math.sqrt(m/k)).toFixed(3)+' s');
    sH.raf=requestAnimationFrame(step);
  };sH.raf=requestAnimationFrame(step);
}
function pauseH(){
  if(!sH.run)return;sH.paused=!sH.paused;
  if(sH.paused){if(sH.raf)cancelAnimationFrame(sH.raf);setDot('dRssH','pause');sv('sRssH','En pause');setPauseBtn('btnPauH',true);}
  else{setDot('dRssH','run');sv('sRssH','Oscillationâ€¦');setPauseBtn('btnPauH',false);loopH();}
}
function rstH(){
  if(sH.raf)cancelAnimationFrame(sH.raf);
  sH={run:false,paused:false,raf:null,x:0,v:0,t:0,hist:[],ph:[]};
  setDot('dRssH','');sv('sRssH','En attente');setPauseBtn('btnPauH',false);upRssH();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5. CONSERVATION Ã‰NERGIE â€” LOOPING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sL={run:false,paused:false,raf:null,s:0};
function getLo(){return{h:+C('lH').value,R:+C('lR').value,m:+C('lM').value,g:+C('lG').value};}
function upCons(){
  const {h,R,m,g}=getLo();
  sv('lHv',h.toFixed(1)+' m');sv('lRv',R.toFixed(1)+' m');sv('lMv',m.toFixed(0)+' kg');sv('lGv',g.toFixed(2));
  const hmin=2.5*R,Em=m*g*h,pass=h>=hmin;
  const vs=Math.sqrt(Math.max(0,2*g*(h-2*R))),vb=Math.sqrt(2*g*h);
  sv('rLhmin',hmin.toFixed(2)+' m');sv('rLpass',pass?'âœ… OUI':'âŒ NON');
  sv('rLvs',vs.toFixed(2)+' m/s');sv('rLEm',(Em/1000).toFixed(2)+' kJ');
  C('rLpass').style.color=pass?'var(--E3)':'var(--acc)';
  sv('exL_Hmin',hmin.toFixed(2));sv('exL_Em',(m*9.81*12/1000).toFixed(3));
  sv('exL_Vs',Math.sqrt(Math.max(0,2*9.81*(12-2*4))).toFixed(3));
  sv('exL_Vb',Math.sqrt(2*9.81*12).toFixed(3));
  drawLo(0);
}
function buildTrack(h,R,W,H){
  const gY=H-50,margin=40;
  const maxH=h+2*R;const sc=Math.min((H-85)/maxH,(W*0.48)/(h+4*R));
  const loopCX=W*0.6,loopCY=gY-R*sc;
  const startX=margin+15,startY=gY-h*sc;
  const pts=[];
  pts.push({x:startX,y:startY,rh:h});
  for(let i=1;i<=40;i++){const t=i/40;pts.push({x:startX+(loopCX-R*sc-startX)*t,y:startY+(gY-startY)*t,rh:h*(1-t)});}
  for(let i=0;i<=60;i++){const a=-Math.PI/2+i*(Math.PI*2)/60;pts.push({x:loopCX+R*sc*Math.cos(a),y:loopCY+R*sc*Math.sin(a),rh:R*(1-Math.sin(a))});}
  for(let i=1;i<=20;i++){pts.push({x:loopCX+R*sc+i*11,y:gY,rh:0});}
  return{pts,sc,gY,loopCX,loopCY,startX,startY};
}
function drawLo(progress){
  const {cv,ctx,W,H}=clrCV('cvCons');
  const {h,R,m,g}=getLo();grd(ctx,W,H);
  const {pts,sc,gY,loopCX,loopCY,startX,startY}=buildTrack(h,R,W,H);
  const Em=m*g*h,hmin=2.5*R,pass=h>=hmin;
  ctx.save();
  ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(0,gY,W,H-gY);
  ctx.strokeStyle='#3d3530';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,gY);ctx.lineTo(W,gY);ctx.stroke();
  ctx.strokeStyle='#3d3530';ctx.lineWidth=4;ctx.lineJoin='round';
  ctx.beginPath();pts.forEach((p,i)=>i===0?ctx.moveTo(p.x,p.y):ctx.lineTo(p.x,p.y));ctx.stroke();
  // h
  ctx.strokeStyle='rgba(37,99,184,0.35)';ctx.lineWidth=1;ctx.setLineDash([4,3]);
  ctx.beginPath();ctx.moveTo(startX,startY);ctx.lineTo(startX,gY);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='#2563b8';ctx.font='bold 11px DM Mono';ctx.textAlign='left';ctx.fillText('h='+h.toFixed(1)+'m',startX+6,startY+14);
  // hmin
  const hminY=gY-hmin*sc;
  ctx.strokeStyle=pass?'rgba(22,163,74,0.35)':'rgba(232,82,26,0.45)';
  ctx.lineWidth=1.5;ctx.setLineDash([5,3]);
  ctx.beginPath();ctx.moveTo(startX-8,hminY);ctx.lineTo(startX+55,hminY);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle=pass?'#16a34a':'#e8521a';ctx.font='9px DM Mono';ctx.fillText('h_min='+hmin.toFixed(1)+'m',startX+56,hminY+3);
  // R
  ctx.strokeStyle='rgba(147,51,234,0.5)';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.moveTo(loopCX,loopCY);ctx.lineTo(loopCX+R*sc,loopCY);ctx.stroke();
  ctx.fillStyle='#9333ea';ctx.font='9px DM Mono';ctx.fillText('R='+R.toFixed(1)+'m',loopCX+R*sc+4,loopCY+3);
  // Wagon
  const idx=Math.min(Math.floor(progress*(pts.length-1)),pts.length-1);
  const pt=pts[idx];const realH=Math.max(0,(gY-pt.y)/sc);
  const Ep=m*g*realH,Ec=Math.max(0,Em-Ep),v=Math.sqrt(2*Ec/m);
  ctx.fillStyle=pass?'#1a3a6e':'#6b1a0e';ctx.strokeStyle=pass?'#2563b8':'#e8521a';ctx.lineWidth=2;
  ctx.fillRect(pt.x-15,pt.y-20,30,18);ctx.strokeRect(pt.x-15,pt.y-20,30,18);
  ctx.fillStyle='white';ctx.font='8px DM Mono';ctx.textAlign='center';ctx.fillText('m',pt.x,pt.y-10);
  // Energie info
  ctx.fillStyle='rgba(255,255,255,0.88)';ctx.fillRect(W-185,H-48,170,36);
  ctx.strokeStyle='rgba(0,0,0,0.1)';ctx.lineWidth=1;ctx.strokeRect(W-185,H-48,170,36);
  ctx.fillStyle='#3d3530';ctx.font='10px DM Mono';ctx.textAlign='left';
  ctx.fillText('h='+realH.toFixed(2)+'m Â· v='+v.toFixed(2)+'m/s',W-180,H-33);
  ctx.fillText('Ec='+Ec.toFixed(0)+'J Â· Ep='+Ep.toFixed(0)+'J',W-180,H-18);
  sb('bLoEc',Em>0?Ec/Em:0);sb('bLoEp',Em>0?Ep/Em:0);sb('bLoEm',1);
  sv('vLoEc',(Ec/1000).toFixed(2)+' kJ');sv('vLoEp',(Ep/1000).toFixed(2)+' kJ');sv('vLoEm',(Em/1000).toFixed(2)+' kJ');
  ctx.restore();
}
function goLo(){
  if(sL.run&&!sL.paused)return;
  if(sL.paused){sL.paused=false;setDot('dCons','run');sv('sCons','En mouvementâ€¦');setPauseBtn('btnPauL',false);loopLo();return;}
  sL={run:true,paused:false,raf:null,s:0};
  setDot('dCons','run');sv('sCons','En mouvementâ€¦');loopLo();
}
function loopLo(){
  let last=null;
  const step=(ts)=>{
    if(sL.paused)return;
    if(!last)last=ts;
    const dt=Math.min((ts-last)/1000,0.03);last=ts;
    sL.s+=dt*0.2;drawLo(sL.s%1);
    if(sL.s>3){sL.run=false;setDot('dCons','');sv('sCons','TerminÃ©');return;}
    sL.raf=requestAnimationFrame(step);
  };sL.raf=requestAnimationFrame(step);
}
function pauseLo(){
  if(!sL.run)return;sL.paused=!sL.paused;
  if(sL.paused){if(sL.raf)cancelAnimationFrame(sL.raf);setDot('dCons','pause');sv('sCons','En pause');setPauseBtn('btnPauL',true);}
  else{setDot('dCons','run');sv('sCons','En mouvementâ€¦');setPauseBtn('btnPauL',false);loopLo();}
}
function rstLo(){
  if(sL.raf)cancelAnimationFrame(sL.raf);
  sL={run:false,paused:false,raf:null,s:0};
  setDot('dCons','');sv('sCons','En attente');setPauseBtn('btnPauL',false);upCons();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXERCICES â€” VÃ‰RIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const exoData={
  pend:{
    ids:['T','Em','Vm','Ep15'],
    refs:()=>{
      const L=+C('pL').value,m=+C('pM').value,th0=+C('pTh').value*Math.PI/180,g=+C('pG').value;
      const T=2*Math.PI*Math.sqrt(L/g),Em=m*g*L*(1-Math.cos(th0));
      const vmax=Math.sqrt(2*g*L*(1-Math.cos(th0))),Ep15=m*g*L*(1-Math.cos(15*Math.PI/180));
      return[T,Em,vmax,Ep15];
    },score:'scorePend'
  },
  coni:{
    ids:['Th','R','T','Fc'],
    refs:()=>{
      const L=+C('cL').value,m=+C('cM').value,w=+C('cW').value,g=+C('cG').value;
      const cosT=Math.min(1,g/(w*w*L)),th=Math.acos(cosT),R=L*Math.sin(th);
      const T=m*g/Math.max(0.001,cosT),Fc=m*w*w*R;
      return[th*180/Math.PI,R,T,Fc];
    },score:'scoreConi'
  },
  rssv:{
    ids:['T','Xeq','Em','Vm'],
    refs:()=>{
      const k=+C('vK').value,m=+C('vM').value,x0=+C('vX0').value,g=+C('vG').value;
      return[2*Math.PI*Math.sqrt(m/k),m*g/k,0.5*k*x0*x0,Math.abs(x0)*Math.sqrt(k/m)];
    },score:'scoreRssV'
  },
  rssh:{
    ids:['T','Em','Vm','Ec2'],
    refs:()=>{
      const k=+C('hK').value,m=+C('hM').value,A=+C('hA').value;
      const T=2*Math.PI*Math.sqrt(m/k),Em=0.5*k*A*A,vm=A*Math.sqrt(k/m);
      const Ec2=Math.max(0,Em-0.5*k*(A/2)**2);
      return[T,Em,vm,Ec2];
    },score:'scoreRssH'
  },
  cons:{
    ids:['Hmin','Em','Vs','Vb'],
    refs:()=>{
      const R=+C('lR').value,m=500,g=9.81,h=12;
      return[2.5*R,m*g*h/1000,Math.sqrt(Math.max(0,2*g*(h-2*R))),Math.sqrt(2*g*h)];
    },score:'scoreCons'
  }
};

function checkExo(key){
  const d=exoData[key];const refs=d.refs();
  let ok=0;
  d.ids.forEach((id,i)=>{
    const inp=C('in'+key.replace(/^\w/,c=>c.toUpperCase()).replace('Rssv','V').replace('Rssh','H').replace('Coni','C').replace('Pend','P').replace('Cons','L')+'_'+id.charAt(0).toUpperCase()+id.slice(1));
    // simpler key map
    const inpEl=document.querySelector(`#in${mapKey(key)}_${id}`);
    const resEl=document.querySelector(`#res${mapKey(key)}_${id}`);
    const corrEl=document.querySelector(`#corr${mapKey(key)}_${id}`);
    if(!inpEl)return;
    const val=parseFloat(inpEl.value);
    const ref=refs[i];
    if(isNaN(val)){resEl.textContent='';corrEl.classList.remove('show');return;}
    const tol=Math.abs(ref)*0.05;
    const correct=Math.abs(val-ref)<=tol;
    resEl.textContent=correct?'âœ…':'âŒ';
    corrEl.textContent=correct?'':`â†’ ${ref.toFixed(4)}`;
    corrEl.className='corr-val show'+(correct?'':' wrong-val');
    if(correct)ok++;
  });
  const sc=C(d.score);
  sc.textContent=`Score : ${ok} / ${d.ids.length} ${ok===d.ids.length?'ğŸ‰ Parfait !':ok>0?'â€” Continue !':'â€” RÃ©essaie !'}`;
  sc.className=`score-bar show ${ok===d.ids.length?'good':'bad'}`;
}

function mapKey(k){
  const m={pend:'P',coni:'C',rssv:'V',rssh:'H',cons:'L'};return m[k]||k;
}

function resetExo(key){
  const d=exoData[key];
  d.ids.forEach(id=>{
    const inpEl=document.querySelector(`#in${mapKey(key)}_${id}`);
    const resEl=document.querySelector(`#res${mapKey(key)}_${id}`);
    const corrEl=document.querySelector(`#corr${mapKey(key)}_${id}`);
    if(inpEl)inpEl.value='';
    if(resEl)resEl.textContent='';
    if(corrEl){corrEl.textContent='';corrEl.className='corr-val';}
  });
  const sc=C(d.score);sc.className='score-bar';sc.textContent='';
}

// INIT
upPend();upConi();drawConi(0);upRssV();upRssH();upCons();
</script>
</body>
</html>
