<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SimuTR v1.0 â€” Chimie des Terres Rares | Edmond Atinzoun TCHOKPON</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,700;1,9..144,400&family=Fira+Code:wght@400;500;600&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f4f1ec;--ink:#1a1410;--panel:#ffffff;--panel2:#ede8df;
  --p1:#7b3f00;--p2:#1a4a6b;--p3:#2d6a4f;--p4:#6b0f3a;--p5:#4a4a00;
  --gold:#c8920a;--silver:#8a8a9a;--muted:#7a6f64;--border:#ddd5c4;
  --light:#faf7f2;--shadow:rgba(28,20,16,0.1);
  --ln:#c0392b;--ce:#27ae60;--pr:#8e44ad;--nd:#2980b9;--pm:#e67e22;
  --sm:#16a085;--eu:#d35400;--gd:#2c3e50;--tb:#1abc9c;--dy:#e74c3c;
  --ho:#3498db;--er:#9b59b6;--tm:#f39c12;--yb:#1e8bc3;--lu:#27ae60;
  --sc:#e67e22;--y:#8e44ad;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--ink);font-family:'Manrope',sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='4'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");}

/* â”€â”€ HEADER â”€â”€ */
header{position:relative;z-index:10;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);border-bottom:3px solid var(--gold);padding:12px 22px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 30px rgba(0,0,50,.5);}
.logo{display:flex;align-items:center;gap:14px;}
.logo-atom{width:50px;height:50px;border-radius:50%;background:conic-gradient(#c8920a,#e8b84b,#c8920a,#7b3f00,#c8920a);display:flex;align-items:center;justify-content:center;font-size:22px;animation:atomSpin 8s linear infinite;box-shadow:0 0 20px rgba(200,146,10,.5);}
@keyframes atomSpin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.logo-text h1{font-family:'Fraunces',serif;font-size:1.65rem;font-weight:700;color:white;letter-spacing:3px;}
.logo-text p{font-size:.58rem;color:rgba(255,255,255,.55);letter-spacing:2px;font-family:'Fira Code',monospace;}
.header-right{display:flex;align-items:center;gap:9px;}
.author-tag{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);border-radius:8px;padding:6px 13px;text-align:right;}
.author-tag .n{font-family:'Fraunces',serif;font-size:.85rem;font-weight:700;color:var(--gold);}
.author-tag .i{font-size:.56rem;color:rgba(255,255,255,.5);font-family:'Fira Code',monospace;letter-spacing:1px;}
.hbtn{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.25);color:white;border-radius:6px;padding:6px 12px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.76rem;transition:all .2s;}
.hbtn:hover{background:rgba(255,255,255,.22);}

/* â”€â”€ TABS â”€â”€ */
.tabs{position:relative;z-index:5;background:var(--panel);border-bottom:2px solid var(--border);padding:7px 18px;display:flex;gap:4px;overflow-x:auto;scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab{padding:6px 14px;border-radius:7px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.73rem;letter-spacing:.3px;transition:all .22s;white-space:nowrap;}
.tab.active{background:var(--p1);border-color:var(--p1);color:white;box-shadow:0 3px 12px rgba(123,63,0,.3);}
.tab:hover:not(.active){border-color:var(--p1);color:var(--p1);}

/* â”€â”€ APP PANELS â”€â”€ */
.app{display:none;padding:16px 18px;gap:14px;flex-wrap:wrap;position:relative;z-index:1;min-height:calc(100vh - 150px);}
.app.active{display:flex;}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px;position:relative;box-shadow:0 2px 14px var(--shadow);}
.panel::before{content:'';position:absolute;top:0;left:16px;right:16px;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);opacity:.3;border-radius:2px;}
.ptitle{font-family:'Fraunces',serif;font-size:.84rem;font-weight:700;color:var(--p1);letter-spacing:1px;margin-bottom:13px;display:flex;align-items:center;gap:7px;}

/* â”€â”€ FORM â”€â”€ */
.fg{margin-bottom:10px;}
.fg label{display:block;font-size:.62rem;color:var(--muted);letter-spacing:1.2px;margin-bottom:3px;font-family:'Fira Code',monospace;text-transform:uppercase;}
.fg select,.fg input{width:100%;background:var(--panel2);border:1px solid var(--border);color:var(--ink);border-radius:6px;padding:7px 9px;font-family:'Manrope',sans-serif;font-size:.82rem;outline:none;transition:border-color .2s;}
.fg select:focus,.fg input:focus{border-color:var(--p1);}
.btn{width:100%;padding:8px;border-radius:7px;border:none;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:700;font-size:.85rem;letter-spacing:.6px;transition:all .22s;margin-top:4px;}
.btn-p{background:var(--p1);color:white;box-shadow:0 3px 11px rgba(123,63,0,.3);}
.btn-p:hover{background:#6a3500;transform:translateY(-1px);}
.btn-o{background:var(--p2);color:white;}
.btn-o:hover{background:#153d5a;}
.btn-b{background:var(--p3);color:white;}
.btn-b:hover{background:#245a42;}

/* â”€â”€ PERIODIC TABLE â”€â”€ */
.pt-grid{display:grid;gap:3px;margin:10px 0;}
.pt-cell{border-radius:5px;padding:5px 4px;text-align:center;cursor:pointer;transition:all .2s;border:1.5px solid transparent;min-width:52px;}
.pt-cell:hover{transform:scale(1.08);z-index:10;position:relative;box-shadow:0 4px 16px rgba(0,0,0,.25);}
.pt-cell.sel{border-color:var(--gold)!important;box-shadow:0 0 0 2px var(--gold);}
.pt-symbol{font-family:'Fraunces',serif;font-size:.95rem;font-weight:700;}
.pt-num{font-family:'Fira Code',monospace;font-size:.58rem;color:rgba(0,0,0,.5);}
.pt-name{font-size:.52rem;color:rgba(0,0,0,.6);margin-top:1px;font-family:'Manrope',sans-serif;}
.pt-tr{background:linear-gradient(135deg,#fff3cd,#fde68a);border:1.5px solid #c8920a;}
.pt-sc{background:linear-gradient(135deg,#e8d5f0,#d4b0e8);border:1.5px solid #8e44ad;}
.pt-y{background:linear-gradient(135deg,#d5e8f0,#b0d4e8);border:1.5px solid #2980b9;}
.pt-empty{background:transparent;border:none;cursor:default;}
.pt-empty:hover{transform:none;box-shadow:none;}

/* â”€â”€ ELEMENT CARD â”€â”€ */
.elem-card{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid var(--gold);border-radius:12px;padding:18px;color:white;}
.elem-symbol-big{font-family:'Fraunces',serif;font-size:3.5rem;font-weight:700;color:var(--gold);line-height:1;}
.elem-num-big{font-family:'Fira Code',monospace;font-size:.8rem;color:rgba(255,255,255,.5);margin-bottom:4px;}
.elem-name-big{font-family:'Fraunces',serif;font-size:1.2rem;color:white;margin-bottom:12px;}
.elem-data{display:flex;flex-direction:column;gap:5px;font-size:.76rem;font-family:'Fira Code',monospace;}
.elem-data .row{display:flex;justify-content:space-between;padding:4px 8px;background:rgba(255,255,255,.06);border-radius:4px;}
.elem-data .key{color:rgba(255,255,255,.5);}
.elem-data .val{color:var(--gold);font-weight:600;}
.config-4f{background:#1c1410;border:1px solid var(--gold);border-radius:7px;padding:8px;font-family:'Fira Code',monospace;font-size:.75rem;color:#a8e6cf;margin-top:8px;text-align:center;line-height:1.7;}

/* â”€â”€ INFO BOXES â”€â”€ */
.info-box{background:var(--panel2);border:1px solid var(--border);border-radius:9px;padding:12px;margin-bottom:9px;font-size:.8rem;line-height:1.7;}
.info-box h4{font-family:'Fraunces',serif;font-size:.88rem;color:var(--p1);margin-bottom:6px;}
.code-dark{background:#1a1a2e;color:#a8e6cf;font-family:'Fira Code',monospace;font-size:.78rem;border-radius:6px;padding:9px 12px;margin:7px 0;line-height:1.8;border-left:3px solid var(--gold);}
.code-dark.blue{border-left-color:#3498db;}
.code-dark.green{border-left-color:var(--p3);}

/* â”€â”€ STEP BOXES â”€â”€ */
.step-box{background:var(--panel2);border:1px solid var(--border);border-radius:9px;padding:13px;margin-bottom:8px;display:none;animation:fadeIn .3s ease;}
.step-box.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.step-head{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.step-badge{width:26px;height:26px;border-radius:50%;background:var(--p1);color:white;font-family:'Fira Code',monospace;font-size:.72rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.step-title{font-weight:700;font-size:.88rem;color:var(--p1);}
.step-desc{font-size:.79rem;color:var(--muted);line-height:1.65;}
.step-note{background:rgba(123,63,0,.1);border-radius:5px;padding:4px 9px;font-size:.7rem;color:var(--p1);font-family:'Fira Code',monospace;margin-top:6px;}
.step-nav{display:flex;gap:7px;align-items:center;justify-content:center;margin-top:10px;}
.step-dot{width:7px;height:7px;border-radius:50%;background:var(--border);transition:all .25s;cursor:pointer;}
.step-dot.active{background:var(--p1);width:17px;border-radius:4px;}

/* â”€â”€ QUIZ â”€â”€ */
.quiz-card{background:var(--panel2);border:2px solid var(--border);border-radius:11px;padding:16px;margin-bottom:11px;}
.quiz-q{font-weight:700;font-size:.9rem;color:var(--ink);margin-bottom:11px;line-height:1.55;}
.quiz-opts{display:flex;flex-direction:column;gap:6px;}
.quiz-opt{background:var(--panel);border:1.5px solid var(--border);border-radius:7px;padding:8px 12px;cursor:pointer;font-size:.8rem;transition:all .18s;text-align:left;font-family:'Manrope',sans-serif;}
.quiz-opt:hover{border-color:var(--p1);background:rgba(123,63,0,.06);}
.quiz-opt.correct{background:#d4edda;border-color:#2d6a4f;color:#1a4a33;}
.quiz-opt.wrong{background:#f8d7da;border-color:#9b2226;color:#6b0f13;}
.quiz-feedback{margin-top:9px;border-radius:7px;padding:9px 13px;font-size:.79rem;line-height:1.6;display:none;}
.quiz-feedback.show{display:block;}
.qf-c{background:#d4edda;color:#1a4a33;border-left:4px solid #2d6a4f;}
.qf-w{background:#f8d7da;color:#6b0f13;border-left:4px solid #9b2226;}
.quiz-score{font-family:'Fraunces',serif;font-size:1.35rem;font-weight:700;color:var(--p1);text-align:center;margin:7px 0;}

/* â”€â”€ THEORY CARDS â”€â”€ */
.thy-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:12px;}
.thy-card{background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:15px;}
.thy-card h3{font-family:'Fraunces',serif;font-weight:700;color:var(--p1);margin-bottom:8px;font-size:.93rem;}
.thy-card p,.thy-card li{font-size:.78rem;color:var(--muted);line-height:1.65;}
.fbox{background:#1a1a2e;border-radius:6px;padding:8px;margin:6px 0;font-family:'Fira Code',monospace;color:#a8e6cf;font-size:.76rem;text-align:center;}
.lvl-tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.58rem;font-weight:700;letter-spacing:1px;margin-bottom:7px;font-family:'Fira Code',monospace;}
.lv-l1{background:rgba(45,106,79,.15);color:#2d6a4f;border:1px solid #2d6a4f;}
.lv-l2{background:rgba(26,74,107,.15);color:#1a4a6b;border:1px solid #1a4a6b;}
.lv-l3{background:rgba(107,15,58,.15);color:#6b0f3a;border:1px solid #6b0f3a;}

/* â”€â”€ APP CARDS (apps, magnetics, etc.) â”€â”€ */
.app-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:10px;}
.app-card{background:var(--panel2);border:1.5px solid var(--border);border-radius:9px;padding:13px;cursor:pointer;transition:all .2s;}
.app-card:hover,.app-card.sel{background:var(--p1);border-color:var(--p1);color:white;}
.app-card:hover .app-sub,.app-card.sel .app-sub{color:rgba(255,255,255,.7);}
.app-name{font-weight:700;font-size:.83rem;margin-bottom:4px;}
.app-sub{font-size:.7rem;color:var(--muted);font-family:'Fira Code',monospace;}

/* â”€â”€ CANVAS â”€â”€ */
canvas{display:block;border-radius:8px;}
.energy-canvas{border-radius:8px;background:#1a1a2e;border:1px solid var(--border);}

/* â”€â”€ MINE CARDS â”€â”€ */
.mine-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px;}
.mine-card{background:var(--panel2);border:1.5px solid var(--border);border-radius:9px;padding:13px;transition:all .2s;cursor:pointer;}
.mine-card:hover{border-color:var(--gold);box-shadow:0 4px 14px rgba(200,146,10,.2);}
.mine-name{font-weight:700;font-size:.88rem;color:var(--p1);margin-bottom:4px;}
.mine-loc{font-size:.7rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;}
.mine-bar-wrap{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin:4px 0;}
.mine-bar{height:100%;background:linear-gradient(90deg,var(--gold),#e8b84b);border-radius:3px;transition:width .6s ease;}
.mine-detail{display:none;margin-top:10px;font-size:.76rem;color:var(--muted);line-height:1.7;border-top:1px solid var(--border);padding-top:8px;}
.mine-card.open .mine-detail{display:block;}

/* â”€â”€ EXTRACTION STEPS â”€â”€ */
.extr-flow{display:flex;flex-direction:column;gap:0;}
.extr-step{display:flex;align-items:stretch;gap:0;}
.extr-line{display:flex;flex-direction:column;align-items:center;width:36px;flex-shrink:0;}
.extr-dot{width:20px;height:20px;border-radius:50%;background:var(--p1);border:2px solid var(--gold);flex-shrink:0;}
.extr-connector{width:2px;flex:1;background:linear-gradient(180deg,var(--gold),rgba(200,146,10,.2));min-height:20px;}
.extr-content{background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px 13px;margin-bottom:8px;flex:1;}
.extr-title{font-weight:700;font-size:.86rem;color:var(--p1);margin-bottom:4px;}
.extr-desc{font-size:.76rem;color:var(--muted);line-height:1.6;}
.extr-chem{background:#1a1a2e;color:#a8e6cf;font-family:'Fira Code',monospace;font-size:.72rem;border-radius:5px;padding:5px 9px;margin-top:6px;line-height:1.7;}

/* â”€â”€ STATUS BAR â”€â”€ */
.statusbar{position:relative;z-index:5;background:var(--panel);border-top:2px solid var(--border);padding:6px 20px;display:flex;align-items:center;gap:16px;font-family:'Fira Code',monospace;font-size:.63rem;color:var(--muted);flex-wrap:wrap;}
.sdot{width:6px;height:6px;border-radius:50%;background:#c8920a;box-shadow:0 0 5px #c8920a;animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.sindic{display:flex;align-items:center;gap:5px;}

/* â”€â”€ DARK MODE â”€â”€ */
body.dark{--bg:#0a0e1a;--ink:#e8ddd4;--panel:#111827;--panel2:#0f172a;--border:#1e293b;--muted:#8a9e8c;--shadow:rgba(0,0,0,.5);}
body.dark .elem-card{background:linear-gradient(135deg,#0d1117,#1a1a2e);}

::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-atom">âš›</div>
    <div class="logo-text"><h1>SIMUTR</h1><p>SIMULATEUR DE CHIMIE DES TERRES RARES â€” v1.0</p></div>
  </div>
  <div class="header-right">
    <button class="hbtn" onclick="toggleTheme()">ğŸŒ™</button>
    <div class="author-tag"><div class="n">Edmond Atinzoun TCHOKPON</div><div class="i">LICENCE PHYSIQUE-CHIMIE | SIMUTR 2025</div></div>
  </div>
</header>

<div class="tabs">
  <button class="tab active" onclick="showTab('tableau')" id="tab-tableau">âš›ï¸ TABLEAU PÃ‰RIODIQUE</button>
  <button class="tab" onclick="showTab('proprietes')" id="tab-proprietes">ğŸ”¬ PROPRIÃ‰TÃ‰S 4f</button>
  <button class="tab" onclick="showTab('complexes')" id="tab-complexes">ğŸ§² COMPLEXES</button>
  <button class="tab" onclick="showTab('gisements')" id="tab-gisements">ğŸŒ GISEMENTS</button>
  <button class="tab" onclick="showTab('extraction')" id="tab-extraction">âš™ï¸ EXTRACTION</button>
  <button class="tab" onclick="showTab('applications')" id="tab-applications">ğŸ­ APPLICATIONS</button>
  <button class="tab" onclick="showTab('magnetisme')" id="tab-magnetisme">ğŸ§² MAGNÃ‰TISME</button>
  <button class="tab" onclick="showTab('luminescence')" id="tab-luminescence">ğŸ’¡ LUMINESCENCE</button>
  <button class="tab" onclick="showTab('calcul')" id="tab-calcul">ğŸ§® CALCULS</button>
  <button class="tab" onclick="showTab('quiz')" id="tab-quiz">ğŸ¯ QUIZ</button>
  <button class="tab" onclick="showTab('theorie')" id="tab-theorie">ğŸ“š THÃ‰ORIE</button>
  <button class="tab" onclick="showTab('rapport')" id="tab-rapport">ğŸ“‹ RAPPORT</button>
</div>

<!-- â•â•â•â•â•â• 1. TABLEAU PÃ‰RIODIQUE â•â•â•â•â•â• -->
<div class="app active" id="app-tableau">
  <div class="panel" style="width:100%">
    <div class="ptitle">âš›ï¸ TABLEAU PÃ‰RIODIQUE â€” TERRES RARES (REE) & Ã‰LÃ‰MENTS ASSOCIÃ‰S</div>
    <div style="display:flex;flex-wrap:wrap;gap:16px;">
      <div style="flex:1;min-width:500px;">
        <div style="font-size:.7rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:10px;display:flex;gap:14px;flex-wrap:wrap;">
          <span style="display:flex;align-items:center;gap:5px;"><span style="width:14px;height:14px;border-radius:3px;background:linear-gradient(135deg,#fff3cd,#fde68a);border:1px solid #c8920a;display:inline-block;"></span>Lanthanides (Laâ€“Lu)</span>
          <span style="display:flex;align-items:center;gap:5px;"><span style="width:14px;height:14px;border-radius:3px;background:linear-gradient(135deg,#e8d5f0,#d4b0e8);border:1px solid #8e44ad;display:inline-block;"></span>Scandium (Sc)</span>
          <span style="display:flex;align-items:center;gap:5px;"><span style="width:14px;height:14px;border-radius:3px;background:linear-gradient(135deg,#d5e8f0,#b0d4e8);border:1px solid #2980b9;display:inline-block;"></span>Yttrium (Y)</span>
        </div>
        <!-- Lanthanides grid -->
        <div style="display:grid;grid-template-columns:repeat(8,1fr);gap:3px;max-width:680px;">
          <div id="pt-57" class="pt-cell pt-tr" onclick="selectElement(57)"><div class="pt-num">57</div><div class="pt-symbol">La</div><div class="pt-name">Lanthane</div></div>
          <div id="pt-58" class="pt-cell pt-tr" onclick="selectElement(58)"><div class="pt-num">58</div><div class="pt-symbol">Ce</div><div class="pt-name">CÃ©rium</div></div>
          <div id="pt-59" class="pt-cell pt-tr" onclick="selectElement(59)"><div class="pt-num">59</div><div class="pt-symbol">Pr</div><div class="pt-name">PrasÃ©odyme</div></div>
          <div id="pt-60" class="pt-cell pt-tr" onclick="selectElement(60)"><div class="pt-num">60</div><div class="pt-symbol">Nd</div><div class="pt-name">NÃ©odyme</div></div>
          <div id="pt-61" class="pt-cell pt-tr" onclick="selectElement(61)"><div class="pt-num">61</div><div class="pt-symbol">Pm</div><div class="pt-name">PromÃ©thium</div></div>
          <div id="pt-62" class="pt-cell pt-tr" onclick="selectElement(62)"><div class="pt-num">62</div><div class="pt-symbol">Sm</div><div class="pt-name">Samarium</div></div>
          <div id="pt-63" class="pt-cell pt-tr" onclick="selectElement(63)"><div class="pt-num">63</div><div class="pt-symbol">Eu</div><div class="pt-name">Europium</div></div>
          <div id="pt-64" class="pt-cell pt-tr" onclick="selectElement(64)"><div class="pt-num">64</div><div class="pt-symbol">Gd</div><div class="pt-name">Gadolinium</div></div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(8,1fr);gap:3px;max-width:680px;margin-top:3px;">
          <div id="pt-65" class="pt-cell pt-tr" onclick="selectElement(65)"><div class="pt-num">65</div><div class="pt-symbol">Tb</div><div class="pt-name">Terbium</div></div>
          <div id="pt-66" class="pt-cell pt-tr" onclick="selectElement(66)"><div class="pt-num">66</div><div class="pt-symbol">Dy</div><div class="pt-name">Dysprosium</div></div>
          <div id="pt-67" class="pt-cell pt-tr" onclick="selectElement(67)"><div class="pt-num">67</div><div class="pt-symbol">Ho</div><div class="pt-name">Holmium</div></div>
          <div id="pt-68" class="pt-cell pt-tr" onclick="selectElement(68)"><div class="pt-num">68</div><div class="pt-symbol">Er</div><div class="pt-name">Erbium</div></div>
          <div id="pt-69" class="pt-cell pt-tr" onclick="selectElement(69)"><div class="pt-num">69</div><div class="pt-symbol">Tm</div><div class="pt-name">Thulium</div></div>
          <div id="pt-70" class="pt-cell pt-tr" onclick="selectElement(70)"><div class="pt-num">70</div><div class="pt-symbol">Yb</div><div class="pt-name">Ytterbium</div></div>
          <div id="pt-71" class="pt-cell pt-tr" onclick="selectElement(71)"><div class="pt-num">71</div><div class="pt-symbol">Lu</div><div class="pt-name">LutÃ©tium</div></div>
          <div class="pt-cell pt-empty"></div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(8,1fr);gap:3px;max-width:680px;margin-top:6px;">
          <div id="pt-21" class="pt-cell pt-sc" onclick="selectElement(21)"><div class="pt-num">21</div><div class="pt-symbol">Sc</div><div class="pt-name">Scandium</div></div>
          <div id="pt-39" class="pt-cell pt-y" onclick="selectElement(39)"><div class="pt-num">39</div><div class="pt-symbol">Y</div><div class="pt-name">Yttrium</div></div>
          <div class="pt-cell pt-empty"></div><div class="pt-cell pt-empty"></div>
          <div class="pt-cell pt-empty"></div><div class="pt-cell pt-empty"></div>
          <div class="pt-cell pt-empty"></div><div class="pt-cell pt-empty"></div>
        </div>
        <!-- Classification lÃ©gÃ¨re/lourde -->
        <div style="margin-top:14px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:12px;">
          <div style="font-size:.62rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:8px;">CLASSIFICATION LREE / HREE</div>
          <div style="display:flex;flex-wrap:wrap;gap:6px;">
            <div style="background:rgba(200,146,10,.15);border:1px solid rgba(200,146,10,.4);border-radius:6px;padding:5px 10px;font-size:.73rem;">
              <div style="font-weight:700;color:#8a6000;margin-bottom:3px;">LREE â€” LÃ©gÃ¨res (Laâ€“Eu)</div>
              <div style="font-family:'Fira Code',monospace;font-size:.68rem;color:var(--muted);">La Ce Pr Nd (Pm) Sm Eu</div>
              <div style="font-size:.68rem;color:var(--muted);margin-top:2px;">Plus abondantes â€” BastnÃ¤site, Monazite</div>
            </div>
            <div style="background:rgba(26,74,107,.15);border:1px solid rgba(26,74,107,.4);border-radius:6px;padding:5px 10px;font-size:.73rem;">
              <div style="font-weight:700;color:#1a4a6b;margin-bottom:3px;">HREE â€” Lourdes (Gdâ€“Lu + Y)</div>
              <div style="font-family:'Fira Code',monospace;font-size:.68rem;color:var(--muted);">Gd Tb Dy Ho Er Tm Yb Lu Y</div>
              <div style="font-size:.68rem;color:var(--muted);margin-top:2px;">Plus rares â€” XÃ©notime, Ion adsorption clays</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Element info card -->
      <div style="flex:0 0 280px;">
        <div class="elem-card" id="elem-display">
          <div style="text-align:center;padding:30px 0;color:rgba(255,255,255,.3);font-size:.85rem;">
            ğŸ”¬ Cliquez sur un Ã©lÃ©ment<br>pour afficher ses propriÃ©tÃ©s
          </div>
        </div>
        <div style="margin-top:10px;background:var(--panel2);border:1px solid var(--border);border-radius:9px;padding:12px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">CONTRACTION LANTHANIDIQUE</div>
          <canvas id="contractionCanvas" width="250" height="130" style="width:100%;border-radius:6px;background:#1a1a2e;"></canvas>
          <div style="font-size:.7rem;color:var(--muted);margin-top:6px;line-height:1.6;">Le rayon ionique MÂ³âº <strong>diminue</strong> de LaÂ³âº (103 pm) Ã  LuÂ³âº (86 pm) en raison du mauvais blindage des Ã©lectrons 4f.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 2. PROPRIÃ‰TÃ‰S 4f â•â•â•â•â•â• -->
<div class="app" id="app-proprietes">
  <div class="panel" style="flex:0 0 260px;">
    <div class="ptitle">ğŸ”¬ SÃ‰LECTION</div>
    <div class="fg"><label>Ã‰LÃ‰MENT</label>
      <select id="propSel" onchange="showPropElement()">
        <option value="57">La â€” Lanthane (4fâ°)</option>
        <option value="58">Ce â€” CÃ©rium (4fÂ¹)</option>
        <option value="59">Pr â€” PrasÃ©odyme (4fÂ²)</option>
        <option value="60">Nd â€” NÃ©odyme (4fÂ³)</option>
        <option value="61">Pm â€” PromÃ©thium (4fâ´)</option>
        <option value="62">Sm â€” Samarium (4fâµ)</option>
        <option value="63">Eu â€” Europium (4fâ¶)</option>
        <option value="64">Gd â€” Gadolinium (4fâ·)</option>
        <option value="65">Tb â€” Terbium (4fâ¸)</option>
        <option value="66">Dy â€” Dysprosium (4fâ¹)</option>
        <option value="67">Ho â€” Holmium (4fÂ¹â°)</option>
        <option value="68">Er â€” Erbium (4fÂ¹Â¹)</option>
        <option value="69">Tm â€” Thulium (4fÂ¹Â²)</option>
        <option value="70">Yb â€” Ytterbium (4fÂ¹Â³)</option>
        <option value="71">Lu â€” LutÃ©tium (4fÂ¹â´)</option>
        <option value="21">Sc â€” Scandium</option>
        <option value="39">Y â€” Yttrium</option>
      </select>
    </div>
    <div class="fg"><label>PROPRIÃ‰TÃ‰ Ã€ VISUALISER</label>
      <select id="propChart" onchange="drawPropChart()">
        <option value="radius">Rayon ionique MÂ³âº (pm)</option>
        <option value="potential">Potentiel standard EÂ° (V)</option>
        <option value="melting">Point de fusion (Â°C)</option>
        <option value="electrons">Nombre d'Ã©lectrons 4f</option>
        <option value="abundance">Abondance croÃ»te (ppm)</option>
      </select>
    </div>
    <button class="btn btn-p" onclick="showPropElement()">â–¶ AFFICHER</button>
    <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
      <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">Ã‰TATS D'OXYDATION COURANTS</div>
      <div style="font-size:.74rem;color:var(--ink);line-height:1.8;">
        <b style="color:var(--p1);">+III</b> universel â€” tous les lanthanides<br>
        <b style="color:var(--p2);">+IV</b> Ce (stable), Tb, Pr (fort oxydant)<br>
        <b style="color:var(--p3);">+II</b> Eu (le + stable), Sm, Yb<br>
        <b style="color:var(--gold);">Gd</b> seul avec 4fâ· demi-rempli stable
      </div>
    </div>
  </div>
  <div class="panel" style="flex:1;min-width:300px;" id="prop-detail">
    <div class="ptitle">ğŸ“Š FICHE PROPRIÃ‰TÃ‰S</div>
    <div style="text-align:center;padding:30px;color:var(--muted);">SÃ©lectionnez un Ã©lÃ©ment</div>
  </div>
  <div class="panel" style="flex:0 0 300px;">
    <div class="ptitle">ğŸ“ˆ GRAPHIQUE COMPARATIF</div>
    <canvas id="propCanvas" width="280" height="280" style="width:100%;border-radius:8px;background:#1a1a2e;border:1px solid var(--border);"></canvas>
    <div style="margin-top:9px;font-size:.72rem;color:var(--muted);text-align:center;" id="prop-chart-label">SÃ©lectionnez une propriÃ©tÃ©</div>
  </div>
</div>

<!-- â•â•â•â•â•â• 3. COMPLEXES â•â•â•â•â•â• -->
<div class="app" id="app-complexes">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ§² COMPLEXES & COORDINATION DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 255px;">
        <div class="fg"><label>LANTHANIDE CENTRAL</label>
          <select id="complexLn" onchange="showComplex()">
            <option value="La">LaÂ³âº â€” Lanthane</option>
            <option value="Ce">CeÂ³âº/â´âº â€” CÃ©rium</option>
            <option value="Nd">NdÂ³âº â€” NÃ©odyme</option>
            <option value="Eu">EuÂ³âº â€” Europium</option>
            <option value="Gd">GdÂ³âº â€” Gadolinium</option>
            <option value="Tb">TbÂ³âº â€” Terbium</option>
            <option value="Dy">DyÂ³âº â€” Dysprosium</option>
            <option value="Er">ErÂ³âº â€” Erbium</option>
            <option value="Yb">YbÂ³âº â€” Ytterbium</option>
          </select>
        </div>
        <div class="fg"><label>LIGAND</label>
          <select id="complexLig" onchange="showComplex()">
            <option value="H2O">Hâ‚‚O â€” Eau (monodentate)</option>
            <option value="EDTA">EDTAâ´â» (hexadentate)</option>
            <option value="DTPA">DTPAâµâ» (octadentate)</option>
            <option value="acac">acacâ» (Î²-dicÃ©tonato, bidentate)</option>
            <option value="NO3">NOâ‚ƒâ» (bidentate)</option>
            <option value="Cl">Clâ» (monodentate)</option>
            <option value="phen">1,10-phÃ©nanthroline (bidentate)</option>
          </select>
        </div>
        <div class="fg"><label>SOLVANT</label>
          <select id="complexSolv">
            <option value="H2O">Hâ‚‚O (aqueux)</option>
            <option value="MeOH">MeOH (mÃ©thanolique)</option>
            <option value="DMF">DMF (aprotique)</option>
            <option value="DMSO">DMSO</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="showComplex()">â–¶ AFFICHER COMPLEXE</button>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">NOMBRES DE COORDINATION TR</div>
          <div style="font-size:.74rem;color:var(--ink);line-height:1.8;">NC = <b style="color:var(--p1);">6 Ã  12</b> (grand rayon â†’ NC Ã©levÃ©)<br>Le plus courant : <b style="color:var(--p1);">8 et 9</b><br>Eau : [Ln(Hâ‚‚O)â‚‰]Â³âº pour LREE<br>EDTA : NC = 9 (6 + 3 Hâ‚‚O)<br>DTPA : NC = 8 (Gd-DTPA, IRM)</div>
        </div>
      </div>
      <div style="flex:1;min-width:280px;" id="complex-content">
        <div style="text-align:center;padding:35px;color:var(--muted);">SÃ©lectionnez un complexe</div>
      </div>
      <div style="flex:0 0 260px;">
        <canvas id="complexCanvas" width="240" height="270" style="width:100%;border-radius:10px;background:radial-gradient(ellipse at center,#1a1a2e 0%,#0a0e1a 100%);border:1.5px solid var(--border);"></canvas>
        <div style="margin-top:9px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">LIAISON DANS LES COMPLEXES TR</div>
          <div style="font-size:.73rem;color:var(--ink);line-height:1.7;">CaractÃ¨re <b style="color:var(--p1);">ionique dominant</b> (â‰  mÃ©taux de transition).<br>Orbitales 4f <b>trÃ¨s contractÃ©es</b> â†’ peu de recouvrement avec ligands.<br>StabilitÃ© : <b>ordre Ã©lectrostatique</b> = dÃ©pend du rayon MÂ³âº et de la charge du ligand.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 4. GISEMENTS â•â•â•â•â•â• -->
<div class="app" id="app-gisements">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸŒ GISEMENTS MONDIAUX & GÃ‰OCHIMIE DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div style="background:var(--panel2);border:1px solid var(--border);border-radius:9px;padding:12px;margin-bottom:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">PRODUCTION MONDIALE 2023</div>
          <div style="font-size:.73rem;color:var(--ink);line-height:1.9;">
            ğŸ‡¨ğŸ‡³ <b>Chine :</b> ~240 000 t (68%)<br>
            ğŸ‡ºğŸ‡¸ <b>USA :</b> ~43 000 t (12%)<br>
            ğŸ‡¦ğŸ‡º <b>Australie :</b> ~18 000 t (5%)<br>
            ğŸ‡²ğŸ‡¬ <b>Myanmar :</b> ~38 000 t (11%)<br>
            ğŸ‡®ğŸ‡³ <b>Inde :</b> ~2 900 t (1%)<br>
            <span style="color:var(--muted);">Autres : ~3%</span>
          </div>
        </div>
        <div style="background:var(--panel2);border:1px solid var(--border);border-radius:9px;padding:12px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">MINÃ‰RAUX PORTEURS</div>
          <div style="font-size:.73rem;color:var(--ink);line-height:1.9;">
            <b style="color:var(--p1);">BastnÃ¤site</b> (La,Ce)(COâ‚ƒ)F â€” LREE<br>
            <b style="color:var(--p2);">Monazite</b> (La,Ce,Th)POâ‚„ â€” LREE<br>
            <b style="color:var(--p3);">XÃ©notime</b> YPOâ‚„ â€” HREE<br>
            <b style="color:var(--gold);">Ion adsorption clays</b> â€” HREE (Chine)
          </div>
        </div>
      </div>
      <div style="flex:1;min-width:300px;" id="mines-content"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 5. EXTRACTION â•â•â•â•â•â• -->
<div class="app" id="app-extraction">
  <div class="panel" style="width:100%">
    <div class="ptitle">âš™ï¸ PROCÃ‰DÃ‰S D'EXTRACTION & MÃ‰TALLURGIE DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>MINERAI SOURCE</label>
          <select id="extrMineral" onchange="loadExtraction()">
            <option value="bastnaesite">BastnÃ¤site (Bayan Obo, Mountain Pass)</option>
            <option value="monazite">Monazite (Inde, BrÃ©sil, Australie)</option>
            <option value="xenotime">XÃ©notime (Malaisie, Australie)</option>
            <option value="iaclay">Ion Adsorption Clays (Chine du Sud)</option>
          </select>
        </div>
        <div class="fg"><label>Ã‰TAPE DE TRAITEMENT</label>
          <select id="extrStep" onchange="loadExtractionStep()">
            <option value="all">ProcÃ©dÃ© complet</option>
            <option value="mining">1. Extraction miniÃ¨re</option>
            <option value="beneficiation">2. PrÃ©concentration</option>
            <option value="leaching">3. Lixiviation chimique</option>
            <option value="sx">4. Extraction par solvants (SX)</option>
            <option value="precipitation">5. PrÃ©cipitation sÃ©lective</option>
            <option value="calcination">6. Calcination â†’ oxydes</option>
            <option value="reduction">7. RÃ©duction mÃ©tallotherme</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="loadExtraction()">â–¶ AFFICHER PROCÃ‰DÃ‰</button>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">ENJEUX ENVIRONNEMENTAUX</div>
          <div style="font-size:.72rem;color:var(--ink);line-height:1.75;">âš ï¸ Monazite contient Th et U (radioactivitÃ©)<br>âš ï¸ HF, Hâ‚‚SOâ‚„ conc. utilisÃ©s en lixiviation<br>âš ï¸ Bassins de rÃ©sidus (tailings)<br>âš ï¸ Consommation eau et Ã©nergie Ã©levÃ©e<br>â™»ï¸ Recyclage : < 1% actuellement (2023)</div>
        </div>
      </div>
      <div style="flex:1;min-width:320px;" id="extr-content">
        <div style="text-align:center;padding:35px;color:var(--muted);">SÃ©lectionnez un minerai pour voir le procÃ©dÃ©</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 6. APPLICATIONS â•â•â•â•â•â• -->
<div class="app" id="app-applications">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ­ APPLICATIONS INDUSTRIELLES DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:14px;">
      <div style="flex:0 0 260px;">
        <div style="font-size:.63rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:8px;">DOMAINE D'APPLICATION</div>
        <div class="app-grid" style="grid-template-columns:1fr 1fr;gap:7px;" id="app-selector"></div>
      </div>
      <div style="flex:1;min-width:300px;" id="app-content">
        <div style="text-align:center;padding:35px;color:var(--muted);">SÃ©lectionnez un domaine</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 7. MAGNÃ‰TISME â•â•â•â•â•â• -->
<div class="app" id="app-magnetisme">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ§² PROPRIÃ‰TÃ‰S MAGNÃ‰TIQUES DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>COMPOSÃ‰ MAGNÃ‰TIQUE</label>
          <select id="magSel" onchange="showMagnetism()">
            <option value="NdFeB">Ndâ‚‚Feâ‚â‚„B â€” Aimant NdFeB</option>
            <option value="SmCo5">SmCoâ‚… â€” Aimant SmCo</option>
            <option value="Sm2Co17">Smâ‚‚Coâ‚â‚‡ â€” SmCo (haute TÂ°)</option>
            <option value="Gd">Gd mÃ©tal â€” ferromagnÃ©tique T < Tc</option>
            <option value="DyFe">DyFeâ‚‚ â€” Magnetostriction</option>
            <option value="MnBi">Comparaison : Fe ordinaire</option>
          </select>
        </div>
        <div class="fg"><label>TEMPÃ‰RATURE : <span id="mag-temp-label">20Â°C</span></label>
          <input type="range" id="magTemp" min="-200" max="400" value="20" oninput="updateMagTemp()" style="width:100%;accent-color:var(--p1);">
        </div>
        <button class="btn btn-p" onclick="showMagnetism()">â–¶ AFFICHER</button>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;" id="mag-data-box">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">DONNÃ‰ES MAGNÃ‰TIQUES</div>
          <div style="font-size:.74rem;color:var(--ink);line-height:1.8;" id="mag-data">â€”</div>
        </div>
      </div>
      <div style="flex:1;min-width:290px;" id="mag-content">
        <div style="text-align:center;padding:35px;color:var(--muted);">SÃ©lectionnez un composÃ©</div>
      </div>
      <div style="flex:0 0 280px;">
        <canvas id="magCanvas" width="260" height="280" style="width:100%;border-radius:9px;background:#1a1a2e;border:1.5px solid var(--border);"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 8. LUMINESCENCE â•â•â•â•â•â• -->
<div class="app" id="app-luminescence">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ’¡ LUMINESCENCE & PROPRIÃ‰TÃ‰S OPTIQUES DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>ION LUMINESCENT</label>
          <select id="lumiSel" onchange="showLuminescence()">
            <option value="Eu3">EuÂ³âº â€” Rouge (âµDâ‚€â†’â·Fâ±¼) 615 nm</option>
            <option value="Eu2">EuÂ²âº â€” Bleu large (400â€“450 nm)</option>
            <option value="Tb3">TbÂ³âº â€” Vert (âµDâ‚„â†’â·Fâ±¼) 545 nm</option>
            <option value="Er3">ErÂ³âº â€” IR/Vert (up-conversion)</option>
            <option value="Nd3">NdÂ³âº â€” NIR (1064 nm, laser YAG)</option>
            <option value="Yb3">YbÂ³âº â€” NIR (980 nm)</option>
            <option value="Tm3">TmÂ³âº â€” Bleu (450 nm, up-conv.)</option>
            <option value="Ce3">CeÂ³âº â€” UV/Bleu (350â€“450 nm)</option>
            <option value="Sm3">SmÂ³âº â€” Orange-rouge (600 nm)</option>
          </select>
        </div>
        <div class="fg"><label>MATRICE HÃ”TE</label>
          <select id="lumiMatrix">
            <option value="Y2O3">Yâ‚‚Oâ‚ƒ (oxyde d'yttrium)</option>
            <option value="YAG">YAG (Yâ‚ƒAlâ‚…Oâ‚â‚‚)</option>
            <option value="LaF3">LaFâ‚ƒ (fluorure)</option>
            <option value="NaYF4">NaYFâ‚„ (fluorure double)</option>
            <option value="BaMgAl">BaMgAlâ‚â‚€Oâ‚â‚‡ (aluminate)</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="showLuminescence()">â–¶ SIMULER Ã‰MISSION</button>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">APPLICATIONS CLÃ‰S</div>
          <div style="font-size:.72rem;color:var(--ink);line-height:1.8;">ğŸ’¡ LED blanches : CeÂ³âº:YAG<br>ğŸ“º Ã‰crans OLED/plasma : Eu, Tb, Tm<br>ğŸ”¬ Bioimagerie : ErÂ³âº up-conversion<br>ğŸ”¦ Lasers Nd-YAG (chirurgie)<br>ğŸ¥ Scintillateurs : CeÂ³âº, Gd<br>ğŸªŸ Vitres auto-nettoyantes : Ceâ´âº</div>
        </div>
      </div>
      <div style="flex:1;min-width:280px;" id="lumi-content">
        <div style="text-align:center;padding:35px;color:var(--muted);">SÃ©lectionnez un ion</div>
      </div>
      <div style="flex:0 0 280px;">
        <canvas id="lumiCanvas" width="260" height="300" style="width:100%;border-radius:9px;background:#0a0e1a;border:1.5px solid var(--border);"></canvas>
        <div style="margin-top:8px;font-size:.7rem;color:var(--muted);text-align:center;" id="lumi-spectrum-label">Spectre d'Ã©mission simulÃ©</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 9. CALCULS â•â•â•â•â•â• -->
<div class="app" id="app-calcul">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ§® CALCULATEUR â€” CHIMIE DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 260px;">
        <div class="fg"><label>TYPE DE CALCUL</label>
          <select id="calcType" onchange="updateCalcUI()">
            <option value="mol">Masse molaire (oxyde REE)</option>
            <option value="enrichissement">Facteur d'enrichissement / Clarke</option>
            <option value="constante">Constante de stabilitÃ© complexe</option>
            <option value="moment">Moment magnÃ©tique effectif Î¼â‚‘ff</option>
            <option value="contraction">Rayon ionique (contraction lanthanidique)</option>
            <option value="rendement">Rendement extraction SX (%)</option>
          </select>
        </div>
        <div id="calc-inputs"></div>
        <button class="btn btn-p" onclick="calculate()">= CALCULER</button>
        <button class="btn" onclick="clearCalc()" style="background:transparent;border:1px solid var(--p4);color:var(--p4);border-radius:7px;margin-top:5px;">âœ• EFFACER</button>
      </div>
      <div style="flex:1;min-width:270px;">
        <div style="background:#1a1a2e;color:#a8e6cf;font-family:'Fira Code',monospace;border-radius:8px;padding:13px;font-size:.88rem;line-height:1.75;min-height:65px;" id="calc-result">SÃ©lectionnez un type de calcul...</div>
        <div style="margin-top:10px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">FORMULE UTILISÃ‰E</div>
          <div id="calc-formula" style="font-family:'Fira Code',monospace;font-size:.76rem;color:var(--ink);line-height:1.8;">â€”</div>
        </div>
        <div style="margin-top:10px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">MASSES ATOMIQUES REE (g/mol)</div>
          <div style="font-family:'Fira Code',monospace;font-size:.65rem;color:var(--ink);columns:2;gap:12px;line-height:1.85;">La:138.91 | Ce:140.12 | Pr:140.91 | Nd:144.24 | Pm:145 | Sm:150.36 | Eu:151.96 | Gd:157.25 | Tb:158.93 | Dy:162.50 | Ho:164.93 | Er:167.26 | Tm:168.93 | Yb:173.04 | Lu:174.97 | Sc:44.96 | Y:88.91</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 10. QUIZ â•â•â•â•â•â• -->
<div class="app" id="app-quiz">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ¯ QUIZ INTERACTIF â€” CHIMIE DES TERRES RARES</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>CATÃ‰GORIE</label>
          <select id="quizCat">
            <option value="general">GÃ©nÃ©ralitÃ©s & tableau pÃ©riodique</option>
            <option value="proprietes">PropriÃ©tÃ©s atomiques & Ã©lectroniques</option>
            <option value="complexes">Complexes & coordination</option>
            <option value="extraction">Extraction & mÃ©tallurgie</option>
            <option value="applications">Applications industrielles</option>
            <option value="mixed">Quiz gÃ©nÃ©ral (tous thÃ¨mes)</option>
          </select>
        </div>
        <div class="fg"><label>NIVEAU</label>
          <select id="quizLevel">
            <option value="L1">Licence 1 (bases)</option>
            <option value="L2">Licence 2 (intermÃ©diaire)</option>
            <option value="L3">Licence 3 (avancÃ©)</option>
          </select>
        </div>
        <div class="fg"><label>NOMBRE DE QUESTIONS</label>
          <select id="quizCount">
            <option value="5">5 questions</option>
            <option value="8" selected>8 questions</option>
            <option value="12">12 questions</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="startQuiz()">â–¶ NOUVEAU QUIZ</button>
        <div style="margin-top:13px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:.56rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">SCORE SESSION</div>
          <div class="quiz-score" id="quiz-score">0 / 0</div>
          <div style="font-size:.68rem;color:var(--muted);" id="quiz-pct">â€”</div>
          <div style="margin-top:7px;height:8px;background:var(--border);border-radius:4px;overflow:hidden;">
            <div id="score-bar" style="height:100%;width:0%;background:var(--p1);border-radius:4px;transition:width .4s;"></div>
          </div>
        </div>
      </div>
      <div style="flex:1;min-width:300px;" id="quiz-area">
        <div style="text-align:center;padding:38px;color:var(--muted);">ğŸ¯ DÃ©marrez un quiz pour tester vos connaissances sur les terres rares</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â• 11. THÃ‰ORIE â•â•â•â•â•â• -->
<div class="app" id="app-theorie">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ“š COURS â€” CHIMIE DES TERRES RARES</div>
    <div class="thy-grid" id="theory-grid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â• 12. RAPPORT â•â•â•â•â•â• -->
<div class="app" id="app-rapport">
  <div class="panel" style="width:100%">
    <div class="ptitle">ğŸ“‹ RAPPORT DE SÃ‰ANCE</div>
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:17px;font-family:'Fira Code',monospace;font-size:.72rem;color:var(--ink);line-height:1.9;white-space:pre;" id="rpt-content">
Explorez les modules pour gÃ©nÃ©rer votre rapport.</div>
    <div style="display:flex;gap:7px;margin-top:10px;">
      <button class="btn btn-p" style="flex:1" onclick="generateReport()">ğŸ“‹ GÃ‰NÃ‰RER RAPPORT</button>
      <button class="btn" style="flex:1;background:rgba(123,63,0,.1);border:1px solid var(--p1);color:var(--p1);border-radius:7px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:700;font-size:.82rem;" onclick="window.print()">ğŸ–¨ï¸ IMPRIMER</button>
    </div>
  </div>
</div>

<div class="statusbar">
  <div class="sindic"><div class="sdot" id="sdot"></div><span id="stext">SimuTR v1.0 â€” PrÃªt</span></div>
  <span>|</span><span>SimuTR v1.0 â€” Terres Rares</span>
  <span>|</span><span id="session-stats">Quiz : 0/0</span>
  <span style="margin-left:auto" id="sclock"></span>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â•
const ELEMENTS = {
  57:{sym:'La',name:'Lanthane',Z:57,mass:138.91,config:'[Xe] 5dÂ¹ 6sÂ²',config4f:'4fâ°',ion:'+III',radius_ion3:103,oxStates:['+III'],melt:918,boil:3464,density:6.162,abundance:39,color:'#c8920a',Estandard:-2.38,notes:'Prototype des lanthanides. 4f vide. Plus grand rayon. NC 9 en solution. Catalyseur automobile (Laâ‚‚Oâ‚ƒ). Optique (LaFâ‚ƒ). Batteries NiMH (La en alliage ABâ‚…).',crystal:'hexagonal compact',electronegativity:1.10},
  58:{sym:'Ce',name:'CÃ©rium',Z:58,mass:140.12,config:'[Xe] 4fÂ¹ 5dÂ¹ 6sÂ²',config4f:'4fÂ¹',ion:'+III/+IV',radius_ion3:101,oxStates:['+III','+IV'],melt:798,boil:3443,density:6.770,abundance:66.5,color:'#e74c3c',Estandard:-2.34,notes:'Ã‰lÃ©ment le + abondant des TR. Seul lanthanide stable Ã  +IV en solution aqueuse (CeOâ‚‚). Oxydant fort Ceâ´âº/CeÂ³âº (EÂ°=+1.72 V). Catalyseur 3 voies. Verre UV. Polissage (CeOâ‚‚). Stockage Oâ‚‚ (OSC).',crystal:'cubique faces centrÃ©es',electronegativity:1.12},
  59:{sym:'Pr',name:'PrasÃ©odyme',Z:59,mass:140.91,config:'[Xe] 4fÂ³ 6sÂ²',config4f:'4fÂ²',ion:'+III',radius_ion3:99,oxStates:['+III','+IV'],melt:931,boil:3520,density:6.773,abundance:9.2,color:'#9b59b6',Estandard:-2.35,notes:'4fÂ² non appariÃ©. Couleur verte en solution PrÂ³âº. Alliage NdFeB (substitution partielle Nd). Verre jaune-vert (Prâ‚‚Oâ‚ƒ). CÃ©ramiques (jaune). Faible magnÃ©tisme.',crystal:'hexagonal double',electronegativity:1.13},
  60:{sym:'Nd',name:'NÃ©odyme',Z:60,mass:144.24,config:'[Xe] 4fâ´ 6sÂ²',config4f:'4fÂ³',ion:'+III',radius_ion3:98.3,oxStates:['+III'],melt:1021,boil:3074,density:7.007,abundance:41.5,color:'#3498db',Estandard:-2.32,notes:'4fÂ³ â€” moment magnÃ©tique Ã©levÃ© (Î¼=3.62 Î¼B). Aimants Ndâ‚‚Feâ‚â‚„B (les plus puissants au monde, BHmax=512 kJ/mÂ³). Lasers Nd:YAG. Verre rose-violet. Moteurs VE, Ã©oliennes. Ã‰lÃ©ment critique pour la transition Ã©nergÃ©tique.',crystal:'hexagonal double',electronegativity:1.14},
  61:{sym:'Pm',name:'PromÃ©thium',Z:61,mass:145,config:'[Xe] 4fâµ 6sÂ²',config4f:'4fâ´',ion:'+III',radius_ion3:97,oxStates:['+III'],melt:1100,boil:3000,density:7.26,abundance:0,color:'#e67e22',Estandard:-2.30,notes:'Seul lanthanide sans isotope stable. Â¹â´â·Pm : tâ‚/â‚‚ = 2.62 ans (Î²â»). Produit de fission uranium. Aucune occurrence naturelle significative. UtilisÃ© en gÃ©nÃ©rateurs isotopiques (pacemakers anciens), Ã©paisseur-mÃ¨tres (Î²). Purement synthÃ©tique.',crystal:'hexagonal',electronegativity:1.13},
  62:{sym:'Sm',name:'Samarium',Z:62,mass:150.36,config:'[Xe] 4fâ¶ 6sÂ²',config4f:'4fâµ',ion:'+III',radius_ion3:95.8,oxStates:['+II','+III'],melt:1074,boil:1794,density:7.52,abundance:7.05,color:'#16a085',Estandard:-2.30,notes:'4fâµ â€” SmÂ²âº stable (rÃ©ducteur fort). Aimants SmCoâ‚… et Smâ‚‚Coâ‚â‚‡ (rÃ©sistants Ã  TÂ° Ã©levÃ©e, Tc>700Â°C). Â¹â´â¹Sm : bonne section de capture neutronique (rÃ©acteurs). Catalyse (SmIâ‚‚ en synthÃ¨se organique). Neutronique.',crystal:'rhomboÃ©drique',electronegativity:1.17},
  63:{sym:'Eu',name:'Europium',Z:63,mass:151.96,config:'[Xe] 4fâ· 6sÂ²',config4f:'4fâ¶',ion:'+II/+III',radius_ion3:94.7,oxStates:['+II','+III'],melt:822,boil:1529,density:5.244,abundance:2.0,color:'#d35400',Estandard:-1.99,notes:'4fâ· semi-rempli. EuÂ²âº isoÃ©lectronique GdÂ³âº (rayon similaire SrÂ²âº). EuÂ³âº : luminophore rouge pur (âµDâ‚€â†’â·Fâ‚‚, 615 nm). EuÂ²âº : luminophore bleu large. Ã‰crans TV, LED, scintillateurs, â‚¬uro billets (sÃ©curitÃ©). Le moins abondant des lanthanides stables (hors Pm).',crystal:'cubique centrÃ©',electronegativity:1.20},
  64:{sym:'Gd',name:'Gadolinium',Z:64,mass:157.25,config:'[Xe] 4fâ· 5dÂ¹ 6sÂ²',config4f:'4fâ·',ion:'+III',radius_ion3:93.8,oxStates:['+III'],melt:1313,boil:3273,density:7.90,abundance:6.2,color:'#2c3e50',Estandard:-2.28,notes:'4fâ· plein (demi-rempli â†’ stabilitÃ© max). Plus grand moment magnÃ©tique des lanthanides libres (7 Ã©lectrons non appariÃ©s, J=7/2). Contraste IRM (Gd-DTPA). FerromagnÃ©tique < 293 K (Tc ambiante). Absorbant neutrons (reacteurs). Effet magnÃ©tocalorique pour rÃ©frigÃ©ration magnÃ©tique.',crystal:'hexagonal compact',electronegativity:1.20},
  65:{sym:'Tb',name:'Terbium',Z:65,mass:158.93,config:'[Xe] 4fâ¹ 6sÂ²',config4f:'4fâ¸',ion:'+III',radius_ion3:92.3,oxStates:['+III','+IV'],melt:1356,boil:3230,density:8.23,abundance:1.2,color:'#1abc9c',Estandard:-2.28,notes:'4fâ¸. TbÂ³âº : luminophore vert (âµDâ‚„â†’â·Fâ‚…, 545 nm). Terfenol-D (TbFeâ‚‚) : plus grande magnetostriction Ã  TÂ° ambiante (~2000 ppm). Tbâ´âº dans TbOâ‚‚ (oxydant fort). Alliage aimants NdFeB (2â€“4% Tb amÃ©liore Hc). Rare mais critique.',crystal:'hexagonal compact',electronegativity:1.10},
  66:{sym:'Dy',name:'Dysprosium',Z:66,mass:162.50,config:'[Xe] 4fÂ¹â° 6sÂ²',config4f:'4fâ¹',ion:'+III',radius_ion3:91.2,oxStates:['+III'],melt:1412,boil:2567,density:8.55,abundance:5.2,color:'#e74c3c',Estandard:-2.29,notes:'4fâ¹. Le + grand moment magnÃ©tique mesurÃ© pour un ion libre (J=15/2, Î¼=10.63 Î¼B). Ajout 1-3% Dy dans NdFeB â†’ amÃ©liore coercitivitÃ© Ã  TÂ° Ã©levÃ©e (moteurs VE, Ã©oliennes). MatÃ©riaux aimants "high-performance". Terfenol-D (avec Tb). Neutronique (absorbant).',crystal:'hexagonal compact',electronegativity:1.22},
  67:{sym:'Ho',name:'Holmium',Z:67,mass:164.93,config:'[Xe] 4fÂ¹Â¹ 6sÂ²',config4f:'4fÂ¹â°',ion:'+III',radius_ion3:90.1,oxStates:['+III'],melt:1474,boil:2700,density:8.795,abundance:1.3,color:'#3498db',Estandard:-2.33,notes:'4fÂ¹â°. Aimant Ã  champ fort (aimant Ho mÃ©tal pour NMR). Laser Ho:YAG (2.1 Î¼m, chirurgie). Stockage donnÃ©es magnÃ©tiques. Absorbant rÃ©acteur. Coloration verre (jaune). Holmium pole pieces NMR supraconducteurs. Usage trÃ¨s spÃ©cialisÃ©.',crystal:'hexagonal compact',electronegativity:1.23},
  68:{sym:'Er',name:'Erbium',Z:68,mass:167.26,config:'[Xe] 4fÂ¹Â² 6sÂ²',config4f:'4fÂ¹Â¹',ion:'+III',radius_ion3:89.0,oxStates:['+III'],melt:1529,boil:2868,density:9.066,abundance:3.5,color:'#9b59b6',Estandard:-2.32,notes:'4fÂ¹Â¹. ErÂ³âº : amplificateur EDFA (Erbium Doped Fiber Amplifier) â€” Ã©mission 1550 nm = fenÃªtre transparence fibre optique. Up-conversion (IRâ†’vert visible). Laser Er:YAG (dermatologie). Coloration verre rose. Applications tÃ©lÃ©com critiques.',crystal:'hexagonal compact',electronegativity:1.24},
  69:{sym:'Tm',name:'Thulium',Z:69,mass:168.93,config:'[Xe] 4fÂ¹Â³ 6sÂ²',config4f:'4fÂ¹Â²',ion:'+III',radius_ion3:88.0,oxStates:['+III'],melt:1545,boil:1950,density:9.321,abundance:0.52,color:'#f39c12',Estandard:-2.32,notes:'4fÂ¹Â². TmÂ³âº : up-conversion bleu (450â€“470 nm). Â¹â·â°Tm : source X portable (tâ‚/â‚‚=128.6 j). Laser Tm:YAG (2 Î¼m, mÃ©dical). Parmi les TR les moins abondantes (non Pm). Peu d\'applications majeures actuellement.',crystal:'hexagonal compact',electronegativity:1.25},
  70:{sym:'Yb',name:'Ytterbium',Z:70,mass:173.04,config:'[Xe] 4fÂ¹â´ 6sÂ²',config4f:'4fÂ¹Â³',ion:'+III',radius_ion3:86.8,oxStates:['+II','+III'],melt:819,boil:1196,density:6.965,abundance:3.2,color:'#1e8bc3',Estandard:-2.22,notes:'4fÂ¹Â³ quasi-rempli. YbÂ²âº (rÃ©ducteur, bleuÃ¢tre). YbÂ³âº : pompe laser (980 nm) pour Er. Amplificateur fibre Yb (1064 nm, kW). Laser Yb:YAG industriel. Up-conversion (sensitizer). Pt de fusion bas â†’ volatilisation mÃ©tallurgie.',crystal:'cubique faces centrÃ©es',electronegativity:1.10},
  71:{sym:'Lu',name:'LutÃ©tium',Z:71,mass:174.97,config:'[Xe] 4fÂ¹â´ 5dÂ¹ 6sÂ²',config4f:'4fÂ¹â´',ion:'+III',radius_ion3:86.1,oxStates:['+III'],melt:1663,boil:3402,density:9.841,abundance:0.8,color:'#27ae60',Estandard:-2.28,notes:'4fÂ¹â´ complet. Dernier lanthanide. Plus petit rayon, plus dense, plus dur. Luâ‚‚Oâ‚ƒ scintillateur PET (tomographie). Catalyseur (LUOX). Â¹â·â·Lu : radiothÃ©rapie ciblÃ©e (dotatate Lu-177, cancer neuroendocrinien). CoÃ»teux â€” usage trÃ¨s spÃ©cialisÃ©.',crystal:'hexagonal compact',electronegativity:1.27},
  21:{sym:'Sc',name:'Scandium',Z:21,mass:44.96,config:'[Ar] 3dÂ¹ 4sÂ²',config4f:'3dÂ¹ (pas de 4f)',ion:'+III',radius_ion3:74.5,oxStates:['+III'],melt:1541,boil:2836,density:2.989,abundance:22,color:'#8e44ad',Estandard:-2.03,notes:'Pas un lanthanide mais classÃ© TR. 3dÂ¹ â†’ chimie proche mais orbitalles diffÃ©rentes. Alliage Al-Sc (aÃ©rospatial, sport). Lampes iodures mÃ©talliques (stades). TrÃ¨s cher (rare concentration). Souvent co-produit extraction Ti.',crystal:'hexagonal compact',electronegativity:1.36},
  39:{sym:'Y',name:'Yttrium',Z:39,mass:88.91,config:'[Kr] 4dÂ¹ 5sÂ²',config4f:'4dÂ¹ (pas de 4f)',ion:'+III',radius_ion3:90.0,oxStates:['+III'],melt:1526,boil:3345,density:4.472,abundance:33,color:'#2980b9',Estandard:-2.37,notes:'Comportement gÃ©ochimique HREE. 4dÂ¹ â†’ pas d\'Ã©lectrons 4f. Matrice YAG (laser, LED). Yâ‚‚Oâ‚ƒ (luminophore, rÃ©fractaire). YBCO (supraconducteur HTc). Blindage rÃ©acteur. YSZ (zircone stabilisÃ©e yttrium, barriÃ¨res thermiques). Co-produit lanthanides HREE.',crystal:'hexagonal compact',electronegativity:1.22}
};

const IONIC_RADII = {57:103,58:101,59:99,60:98.3,61:97,62:95.8,63:94.7,64:93.8,65:92.3,66:91.2,67:90.1,68:89.0,69:88.0,70:86.8,71:86.1};
const ABUNDANCES = {57:39,58:66.5,59:9.2,60:41.5,61:0.001,62:7.05,63:2.0,64:6.2,65:1.2,66:5.2,67:1.3,68:3.5,69:0.52,70:3.2,71:0.8,21:22,39:33};
const MELTING_POINTS = {57:918,58:798,59:931,60:1021,61:1100,62:1074,63:822,64:1313,65:1356,66:1412,67:1474,68:1529,69:1545,70:819,71:1663};
const E_STANDARD = {57:-2.38,58:-2.34,59:-2.35,60:-2.32,61:-2.30,62:-2.30,63:-1.99,64:-2.28,65:-2.28,66:-2.29,67:-2.33,68:-2.32,69:-2.32,70:-2.22,71:-2.28};

let sessionStats={quizCorrect:0,quizTotal:0};
let darkMode=false;
function toggleTheme(){darkMode=!darkMode;document.body.classList.toggle('dark',darkMode);document.querySelector('.hbtn').textContent=darkMode?'â˜€ï¸':'ğŸŒ™';}

function showTab(n){
  document.querySelectorAll('.app').forEach(a=>a.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('app-'+n).classList.add('active');
  document.getElementById('tab-'+n).classList.add('active');
  if(n==='tableau'){drawContractionChart();}
  if(n==='proprietes'){drawPropChart();}
  if(n==='gisements'){initMines();}
  if(n==='extraction'){loadExtraction();}
  if(n==='applications'){initApps();}
  if(n==='magnetisme'){showMagnetism();}
  if(n==='luminescence'){showLuminescence();}
  if(n==='calcul'){updateCalcUI();}
  if(n==='theorie'){initTheory();}
}
function updateSessionStats(){document.getElementById('session-stats').textContent=`Quiz : ${sessionStats.quizCorrect}/${sessionStats.quizTotal}`;}

// â•â•â•â•â•â•â• TABLEAU PÃ‰RIODIQUE â•â•â•â•â•â•â•
function selectElement(Z){
  document.querySelectorAll('.pt-cell').forEach(c=>c.classList.remove('sel'));
  document.getElementById('pt-'+Z)?.classList.add('sel');
  const el=ELEMENTS[Z];if(!el)return;
  const d=document.getElementById('elem-display');
  d.innerHTML=`
    <div style="display:flex;align-items:flex-end;gap:12px;margin-bottom:14px;">
      <div>
        <div class="elem-num-big">Z = ${el.Z}</div>
        <div class="elem-symbol-big">${el.sym}</div>
        <div class="elem-name-big">${el.name}</div>
      </div>
      <div style="flex:1;">
        <div style="background:rgba(200,146,10,.2);border:1px solid rgba(200,146,10,.4);border-radius:6px;padding:6px 10px;text-align:center;">
          <div style="font-size:.58rem;color:rgba(255,255,255,.5);font-family:'Fira Code',monospace;">MASSE ATOMIQUE</div>
          <div style="font-size:1.1rem;color:var(--gold);font-family:'Fira Code',monospace;font-weight:700;">${el.mass} g/mol</div>
        </div>
      </div>
    </div>
    <div class="elem-data">
      <div class="row"><span class="key">Config. Ã©lec.</span><span class="val" style="font-size:.68rem;">${el.config}</span></div>
      <div class="row"><span class="key">Sous-couche 4f</span><span class="val">${el.config4f}</span></div>
      <div class="row"><span class="key">DegrÃ©s oxydation</span><span class="val">${el.oxStates.join(', ')}</span></div>
      <div class="row"><span class="key">Rayon MÂ³âº (pm)</span><span class="val">${el.radius_ion3} pm</span></div>
      <div class="row"><span class="key">EÂ° MÂ³âº/M (V)</span><span class="val">${el.Estandard} V</span></div>
      <div class="row"><span class="key">Fusion (Â°C)</span><span class="val">${el.melt}Â°C</span></div>
      <div class="row"><span class="key">DensitÃ© (g/cmÂ³)</span><span class="val">${el.density}</span></div>
      <div class="row"><span class="key">Abondance (ppm)</span><span class="val">${el.abundance} ppm</span></div>
      <div class="row"><span class="key">Ã‰lectronÃ©gativitÃ©</span><span class="val">${el.electronegativity}</span></div>
    </div>
    <div class="config-4f" style="margin-top:10px;">ğŸ”¬ ${el.notes}</div>`;
  setStatus('Ã‰lÃ©ment chargÃ© : '+el.name+' (Z='+Z+')');
}

// Contraction lanthanidique canvas
function drawContractionChart(){
  const c=document.getElementById('contractionCanvas');if(!c)return;
  const ctx=c.getContext('2d'),w=c.width,h=c.height;
  ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,w,h);
  const Zs=[57,58,59,60,61,62,63,64,65,66,67,68,69,70,71];
  const syms=['La','Ce','Pr','Nd','Pm','Sm','Eu','Gd','Tb','Dy','Ho','Er','Tm','Yb','Lu'];
  const radii=Zs.map(z=>IONIC_RADII[z]);
  const minR=Math.min(...radii),maxR=Math.max(...radii);
  const pad={l:28,r:10,t:10,b:30};
  const cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
  ctx.strokeStyle='rgba(200,146,10,.15)';ctx.lineWidth=1;
  [86,90,94,98,102].forEach(rv=>{
    const y=pad.t+ch-(rv-minR)/(maxR-minR)*ch;
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+cw,y);ctx.stroke();
    ctx.fillStyle='rgba(200,146,10,.4)';ctx.font='9px Fira Code';ctx.fillText(rv,2,y+3);
  });
  ctx.beginPath();ctx.strokeStyle='rgba(200,146,10,.8)';ctx.lineWidth=2;
  Zs.forEach((z,i)=>{
    const x=pad.l+i/(Zs.length-1)*cw;
    const y=pad.t+ch-(radii[i]-minR)/(maxR-minR)*ch;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.stroke();
  Zs.forEach((z,i)=>{
    const x=pad.l+i/(Zs.length-1)*cw;
    const y=pad.t+ch-(radii[i]-minR)/(maxR-minR)*ch;
    ctx.fillStyle=i===7?'#f1c40f':'#c8920a';
    ctx.beginPath();ctx.arc(x,y,3.5,0,Math.PI*2);ctx.fill();
    if(i%2===0||i===14){
      ctx.fillStyle='rgba(255,255,255,.6)';ctx.font='8px Manrope';
      ctx.fillText(syms[i],x-5,h-4);
    }
  });
  ctx.fillStyle='rgba(255,255,255,.4)';ctx.font='9px Fira Code';
  ctx.fillText('r(MÂ³âº) pm',2,14);
}

// â•â•â•â•â•â•â• PROPRIÃ‰TÃ‰S â•â•â•â•â•â•â•
function showPropElement(){
  const Z=parseInt(document.getElementById('propSel').value);
  const el=ELEMENTS[Z];if(!el)return;
  // Calc number of 4f electrons
  const f4={57:0,58:1,59:2,60:3,61:4,62:5,63:6,64:7,65:8,66:9,67:10,68:11,69:12,70:13,71:14,21:0,39:0};
  const n4f=f4[Z]||0;
  // Spin-only moment approx (for display)
  const mu_eff_map={57:0,58:2.54,59:3.58,60:3.62,61:2.68,62:0.85,63:3.4,64:7.94,65:9.72,66:10.63,67:10.60,68:9.59,69:7.57,70:4.54,71:0,21:0,39:0};
  const mu=mu_eff_map[Z]||0;
  const doc=document.getElementById('prop-detail');
  doc.innerHTML=`<div class="ptitle">${el.sym} â€” ${el.name}</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:13px;">
      <div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;">
        <div style="font-size:.62rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">CONFIGURATION Ã‰LECTRONIQUE</div>
        <div style="font-family:'Fira Code',monospace;font-size:.85rem;color:var(--p1);line-height:1.7;">${el.config}<br><span style="color:var(--gold);">Sous-couche 4f : ${el.config4f}</span></div>
        <div style="font-size:.72rem;color:var(--muted);margin-top:6px;line-height:1.6;">Ã‰lectrons 4f : <b>${n4f}</b> | Spin non appariÃ©s â‰ˆ <b>${Math.min(n4f,14-n4f)}</b></div>
      </div>
      <div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;">
        <div style="font-size:.62rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">PROPRIÃ‰TÃ‰S MAGNÃ‰TIQUES</div>
        <div style="font-family:'Fira Code',monospace;font-size:.85rem;color:var(--p2);">Î¼â‚‘ff = ${mu} Î¼B</div>
        <div style="font-size:.72rem;color:var(--muted);margin-top:6px;line-height:1.6;">${mu===0?'DiamagnÃ©tique (4f vide ou plein)':mu>5?'Fortement paramagnÃ©tique':'ParamagnÃ©tique'}</div>
      </div>
    </div>
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:10px;">
      <div style="font-size:.62rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">DONNÃ‰ES PHYSICO-CHIMIQUES</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:7px;">
        ${[
          ['Masse molaire',el.mass+' g/mol'],
          ['Rayon MÂ³âº',el.radius_ion3+' pm'],
          ['Point de fusion',el.melt+'Â°C'],
          ['Point d\'Ã©bullition',el.boil+'Â°C'],
          ['DensitÃ©',el.density+' g/cmÂ³'],
          ['Abondance terrestre',el.abundance+' ppm'],
          ['EÂ° (MÂ³âº/M)',el.Estandard+' V'],
          ['Ã‰lectronÃ©gativitÃ©',el.electronegativity+' (Pauling)'],
          ['Struct. cristalline',el.crystal]
        ].map(([k,v])=>`<div style="background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:7px 9px;"><div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;">${k}</div><div style="font-size:.82rem;font-weight:700;color:var(--ink);">${v}</div></div>`).join('')}
      </div>
    </div>
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:12px;">
      <div style="font-size:.62rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">Ã‰TATS D'OXYDATION & APPLICATIONS</div>
      <div style="font-size:.8rem;color:var(--muted);line-height:1.75;">${el.notes}</div>
    </div>`;
  drawPropChart();
  setStatus('PropriÃ©tÃ©s : '+el.name);
}

function drawPropChart(){
  const c=document.getElementById('propCanvas');if(!c)return;
  const ctx=c.getContext('2d'),w=c.width,h=c.height;
  ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,w,h);
  const type=document.getElementById('propChart').value;
  const Zs=[57,58,59,60,62,63,64,65,66,67,68,69,70,71];
  const labels=['La','Ce','Pr','Nd','Sm','Eu','Gd','Tb','Dy','Ho','Er','Tm','Yb','Lu'];
  let data,label,unit;
  if(type==='radius'){data=Zs.map(z=>IONIC_RADII[z]||0);label='Rayon ionique MÂ³âº';unit='pm';}
  else if(type==='potential'){data=Zs.map(z=>E_STANDARD[z]||0);label='Potentiel standard EÂ°';unit='V';}
  else if(type==='melting'){data=Zs.map(z=>MELTING_POINTS[z]||0);label='Point de fusion';unit='Â°C';}
  else if(type==='electrons'){data=[0,1,2,3,5,6,7,8,9,10,11,12,13,14];label='Ã‰lectrons 4f';unit='eâ»';}
  else{data=Zs.map(z=>ABUNDANCES[z]||0);label='Abondance';unit='ppm';}
  document.getElementById('prop-chart-label').textContent=label+' ('+unit+')';
  const minV=Math.min(...data),maxV=Math.max(...data);
  const pad={l:35,r:10,t:20,b:30},cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
  const bw=cw/data.length-3;
  ctx.strokeStyle='rgba(200,146,10,.12)';ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const y=pad.t+ch*(i/4);
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+cw,y);ctx.stroke();
    const v=(maxV-(maxV-minV)*(i/4));
    ctx.fillStyle='rgba(200,146,10,.5)';ctx.font='9px Fira Code';
    ctx.fillText(v.toFixed(type==='radius'||type==='melting'?0:2),2,y+3);
  }
  const selZ=parseInt(document.getElementById('propSel').value);
  data.forEach((v,i)=>{
    const x=pad.l+i*(bw+3);
    const barH=((v-minV)/(maxV-minV||1))*ch;
    const y=pad.t+ch-barH;
    const isSel=(Zs[i]===selZ);
    ctx.fillStyle=isSel?'var(--gold)':'rgba(200,146,10,.5)';
    ctx.fillRect(x,y,bw,barH);
    ctx.fillStyle='rgba(255,255,255,.5)';ctx.font='8px Manrope';
    ctx.fillText(labels[i],x+1,h-4);
  });
}

// â•â•â•â•â•â•â• COMPLEXES â•â•â•â•â•â•â•
const COMPLEXES={
  La:{H2O:{nc:9,geo:'Tricapped trigonal prismatic',formula:'[La(Hâ‚‚O)â‚‰]Â³âº',logK:'â€”',app:'ModÃ¨le rÃ©fÃ©rence',color:'#c8920a'},EDTA:{nc:9,geo:'Distorted square antiprismatic + Hâ‚‚O',formula:'[La(EDTA)(Hâ‚‚O)â‚ƒ]â»',logK:'15.36',app:'SÃ©paration chromatographique',color:'#e74c3c'},DTPA:{nc:9,geo:'Tricapped trigonal prismatic',formula:'[La(DTPA)]Â²â»',logK:'19.48',app:'IRM (analogue Gd)',color:'#3498db'},acac:{nc:6,geo:'OctaÃ©drique',formula:'[La(acac)â‚ƒ(Hâ‚‚O)â‚‚]',logK:'~9',app:'PrÃ©curseur CVD, catalyse',color:'#27ae60'},phen:{nc:6,geo:'OctaÃ©drique',formula:'[La(phen)â‚ƒ]Â³âº',logK:'~14',app:'Luminescence (sensitizer)',color:'#9b59b6'}},
  Eu:{H2O:{nc:9,geo:'Tricapped trigonal prismatic',formula:'[Eu(Hâ‚‚O)â‚‰]Â³âº',logK:'â€”',app:'RÃ©fÃ©rence luminescence rouge',color:'#d35400'},EDTA:{nc:8,geo:'Square antiprismatic',formula:'[Eu(EDTA)(Hâ‚‚O)â‚‚]â»',logK:'17.37',app:'SÃ©paration Eu/Sm',color:'#e74c3c'},DTPA:{nc:8,geo:'Square antiprismatic',formula:'[Eu(DTPA)]Â²â»',logK:'22.39',app:'Analogue Gd-IRM',color:'#3498db'},acac:{nc:6,geo:'Pseudo-octaÃ©drique',formula:'[Eu(acac)â‚ƒ]',logK:'~13',app:'OLED Ã©mission rouge, spectroscopie',color:'#27ae60'},phen:{nc:6,geo:'OctaÃ©drique',formula:'[Eu(phen)â‚ƒ]Â³âº',logK:'~18',app:'Capteur chimioluminescent',color:'#9b59b6'}},
  Gd:{H2O:{nc:9,geo:'Tricapped trigonal prismatic',formula:'[Gd(Hâ‚‚O)â‚‰]Â³âº',logK:'â€”',app:'ModÃ¨le IRM',color:'#c8920a'},EDTA:{nc:8,geo:'Square antiprismatic',formula:'[Gd(EDTA)(Hâ‚‚O)â‚‚]â»',logK:'17.40',app:'Agent contraste IRM proto',color:'#e74c3c'},DTPA:{nc:8,geo:'Square antiprismatic + q=1',formula:'[Gd(DTPA)(Hâ‚‚O)]Â²â»',logK:'22.46',app:'MagnevistÂ® (IRM clinique, rÃ©fÃ©rence)',color:'#3498db'},acac:{nc:6,geo:'Pseudo-octaÃ©drique',formula:'[Gd(acac)â‚ƒ]',logK:'~14',app:'PrÃ©curseur matÃ©riaux magnÃ©tiques',color:'#27ae60'},NO3:{nc:11,geo:'Complexe Ã©levÃ©',formula:'[Gd(NOâ‚ƒ)â‚…]Â²â»',logK:'3.8',app:'Chimie coordination HTc',color:'#f39c12'}},
};
function getComplex(ln,lig){
  const def={nc:8,geo:'Prismatique bicappÃ©',formula:`[${ln}L]Â³âº`,logK:'~15',app:'Complexe TR typique',color:'#c8920a'};
  return (COMPLEXES[ln]&&COMPLEXES[ln][lig])||def;
}
function showComplex(){
  const ln=document.getElementById('complexLn').value;
  const lig=document.getElementById('complexLig').value;
  const cx=getComplex(ln,lig);
  document.getElementById('complex-content').innerHTML=`
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px;">
      <div style="font-family:'Fraunces',serif;font-size:1.1rem;color:var(--p1);margin-bottom:10px;">Complexe : ${cx.formula}</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:9px;">
        ${[['Nombre de coordination',cx.nc],['GÃ©omÃ©trie',cx.geo],['log K (stabilitÃ©)',cx.logK||'Non tabulÃ©'],['Application',cx.app]].map(([k,v])=>`<div style="background:var(--panel);border:1px solid var(--border);border-radius:7px;padding:9px;"><div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;">${k}</div><div style="font-size:.85rem;font-weight:700;color:var(--ink);">${v}</div></div>`).join('')}
      </div>
    </div>
    <div class="code-dark" style="margin-bottom:10px;">RÃ¨gle de formation :
  LnÂ³âº + nL  â‡Œ  [LnÂ·Lâ‚™]^(3-nq)+
  Î²_n = [LnLâ‚™] / ([LnÂ³âº]Â·[L]â¿)
  log Î² pour ${ln}-${lig} : ${cx.logK||'voir littÃ©rature'}</div>
    <div class="info-box"><h4>âš¡ StabilitÃ© des complexes de TR</h4>
      <p>Les complexes de TR obÃ©issent Ã  l'<b>ordre Irving-Williams inversÃ©</b> (dominÃ© par la charge et le rayon) : la stabilitÃ© augmente de <b>Laâ†’Lu</b> (contraction lanthanidique â†’ liaison plus forte).<br><br>
      Contrairement aux mÃ©taux de transition, les TR forment des liaisons <b>essentiellement ioniques</b> (peu de covalence 4f). La force d'interaction dÃ©pend donc quasi exclusivement du <b>rapport charge/rayon = Z_eff/r</b>.</p>
    </div>
    <div class="info-box"><h4>ğŸ”¬ IntÃ©rÃªt du ligand ${lig}</h4>
      <p>${getComplexNote(lig)}</p>
    </div>`;
  drawComplexCanvas(cx);
  setStatus('Complexe : '+cx.formula);
}
function getComplexNote(lig){
  const notes={H2O:'Eau : ligand de rÃ©fÃ©rence. En solution, les LREE forment [Ln(Hâ‚‚O)â‚‰]Â³âº, les HREE [Ln(Hâ‚‚O)â‚ˆ]Â³âº (rÃ©duction NC avec la contraction). Ã‰changeable facilement.',EDTA:'EDTAâ´â» hexadentate (2N + 4O). TrÃ¨s utilisÃ© en sÃ©paration analytique. log Î² croÃ®t Laâ†’Lu. Base des colonnes Ã©changeuses d\'ions.',DTPA:'DTPAâµâ» octadentate (3N + 5O). Le complexe le + stable pour TR. Gd-DTPA = MagnevistÂ® (agent contraste IRM clinique, 1 eau coordinÃ©e q=1).',acac:'Î²-dicÃ©tonato bidentate (O,O). PrÃ©curseur CVD pour films minces. Complexes luminescents (Eu, Tb). Volatils Ã  TÂ° modÃ©rÃ©e.',NO3:'NOâ‚ƒâ» bidentate (chÃ©late Ã  3 centres O-N-O). Favorise NC Ã©levÃ©s. UtilisÃ© pour former des poudres d\'oxydes de haute puretÃ© par pyrolyse.',phen:'1,10-phÃ©nanthroline : ligand N,N bidentate Ï€-acide. Excellent "antenne" pour la luminescence des TR (transfert d\'Ã©nergie ligandâ†’mÃ©tal). UtilisÃ© en chimie analytique.',Cl:'Clâ» monodentate. Complexes faibles. Coordination uniquement Ã  haute concentration. UtilisÃ© dans les procÃ©dÃ©s d\'Ã©lectrodÃ©position.'};
  return notes[lig]||'Ligand utilisÃ© en chimie de coordination des terres rares.';
}
function drawComplexCanvas(cx){
  const c=document.getElementById('complexCanvas');if(!c)return;
  const ctx=c.getContext('2d'),w=c.width,h=c.height;
  ctx.fillStyle='#0a0e1a';ctx.fillRect(0,0,w,h);
  const cx0=w/2,cy0=h/2-20,r=72;
  // Central ion
  ctx.shadowBlur=20;ctx.shadowColor=cx.color||'#c8920a';
  ctx.fillStyle=cx.color||'#c8920a';
  ctx.beginPath();ctx.arc(cx0,cy0,20,0,Math.PI*2);ctx.fill();
  ctx.shadowBlur=0;
  ctx.fillStyle='white';ctx.font='bold 11px Fraunces';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(document.getElementById('complexLn').value+'Â³âº',cx0,cy0);
  // Ligands
  const nc=Math.min(cx.nc,9);
  for(let i=0;i<nc;i++){
    const angle=(i/nc)*Math.PI*2-Math.PI/2;
    const lx=cx0+r*Math.cos(angle),ly=cy0+r*Math.sin(angle);
    ctx.strokeStyle='rgba(200,146,10,.5)';ctx.lineWidth=1.5;
    ctx.setLineDash([4,3]);
    ctx.beginPath();ctx.moveTo(cx0,cy0);ctx.lineTo(lx,ly);ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='#3498db';
    ctx.beginPath();ctx.arc(lx,ly,8,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='white';ctx.font='bold 7px Fira Code';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText('L',lx,ly);
  }
  ctx.fillStyle='rgba(255,255,255,.6)';ctx.font='11px Manrope';ctx.textAlign='center';
  ctx.fillText('NC = '+cx.nc+' | '+cx.geo.split(' ')[0],cx0,h-14);
}

// â•â•â•â•â•â•â• GISEMENTS â•â•â•â•â•â•â•
const MINES=[
  {name:'Bayan Obo',loc:'Mongolie IntÃ©rieure, Chine',type:'Carbonatite-Fe',mineraux:'BastnÃ¤site + Monazite',reserves:'~44 Mt TRâ‚‚Oâ‚ƒ',production:'~70% prod. mondiale Chine',lree:'95%',hree:'5%',radioact:'Th modÃ©rÃ©',det:'Plus grand gisement TR du monde. CoexploitÃ© avec le fer (minerai de fer magnÃ©tite). DÃ©couvert 1927. Exploitation depuis 1957. BastnÃ¤site (Ce, La, Nd) + Monazite. Richesse en LREE (La, Ce, Nd, Pr). Faible teneur HREE. RÃ©serves estimÃ©es 800 Mt minerai.',pct:100},
  {name:'Mountain Pass',loc:'Californie, USA',type:'Carbonatite',mineraux:'BastnÃ¤site',reserves:'~1.5 Mt TRâ‚‚Oâ‚ƒ',production:'~43 000 t/an (2023)',lree:'98%',hree:'2%',radioact:'TrÃ¨s faible',det:'Principal gisement amÃ©ricain. ExploitÃ© 1952â€“2002, puis fermÃ© (compÃ©tition chinoise), rouvert 2017 par MP Materials. Teneur trÃ¨s Ã©levÃ©e en La, Ce, Nd, Pr. Quasi exclusivement LREE. SÃ©paration on-site Ã  Freeport.',pct:38},
  {name:'Lynas Mount Weld',loc:'Australie Occidentale',type:'LatÃ©rite carbonatitique',mineraux:'Monazite + BastnÃ¤site',reserves:'~1.8 Mt TRâ‚‚Oâ‚ƒ',production:'~18 000 t/an',lree:'90%',hree:'10%',radioact:'Th + U faible',det:'Gisement australien de Lynas Rare Earths. Teneur TR parmi les plus Ã©levÃ©es au monde (>8% TRâ‚‚Oâ‚ƒ). Transformation en Malaisie (LAMP) + Australie. LREE majoritaires (La, Ce, Nd). Expansion capacitÃ© prÃ©vue.',pct:35},
  {name:'Ion Adsorption Clays',loc:'Jiangxi, Fujian, Guangdong (Chine)',type:'AltÃ©ration latÃ©ritique argileuse',mineraux:'TR adsorbÃ©es sur argiles (halloysite)',reserves:'DistribuÃ©es, difficiles Ã  chiffrer',production:'~38 000 t/an (HREE)',lree:'30%',hree:'70%',radioact:'TrÃ¨s faible (< 50 Bq/g)',det:'Source dominante de HREE (Dy, Tb, Eu, Er, Ybâ€¦). Extraction in situ : injection (NHâ‚„)â‚‚SOâ‚„ ou (NHâ‚„)Cl â†’ dÃ©sorption des ions TRÂ³âº des argiles. ProcÃ©dÃ© "solution mining" doux mais impact environnemental (sols). Teneur 0.05â€“0.2% TRâ‚‚Oâ‚ƒ â€” trÃ¨s basse mais HREE prÃ©cieuses.',pct:72},
  {name:'Kvanefjeld',loc:'Groenland',type:'SyÃ©nite peralcaline',mineraux:'Steenstrupine (La, Ce, Nd)',reserves:'~9 Mt TRâ‚‚Oâ‚ƒ',production:'En dÃ©veloppement',lree:'85%',hree:'15%',radioact:'U + Th Ã©levÃ©s (mine uranifÃ¨re)',det:'Ã‰norme gisement potentiel mais fort contenu uranium. Projet controversÃ© (environnement, radioactivitÃ©). Moratoire gouvernemental 2021. Co-produit : uranium. Si exploitÃ© : second mondial. Importante source potentielle.',pct:45},
  {name:'Nolans Bore',loc:'Territoire du Nord, Australie',type:'Phosphate-silicate',mineraux:'Apatite, brisbanite',reserves:'~0.9 Mt TRâ‚‚Oâ‚ƒ',production:'En dÃ©veloppement (Arafura)',lree:'92%',hree:'8%',radioact:'Faible',det:'Projet Arafura Resources. Contient NdPr (nÃ©odyme-prasÃ©odyme) trÃ¨s riche â€” critique pour aimants NdFeB. Teneur : ~2.6% TRâ‚‚Oâ‚ƒ. Production visÃ©e pour 2025â€“2026. Financement partiel australien et corÃ©en.',pct:25},
];
function initMines(){
  const cont=document.getElementById('mines-content');
  cont.innerHTML=`<div class="mine-grid">${MINES.map((m,i)=>`
    <div class="mine-card" id="mine-${i}" onclick="toggleMine(${i})">
      <div class="mine-name">${m.name}</div>
      <div class="mine-loc">ğŸ“ ${m.loc}</div>
      <div style="display:flex;justify-content:space-between;font-size:.7rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">
        <span>${m.type}</span><span>${m.reserves}</span>
      </div>
      <div style="display:flex;gap:5px;margin:5px 0;flex-wrap:wrap;">
        <span style="background:rgba(200,146,10,.15);border:1px solid rgba(200,146,10,.3);border-radius:4px;padding:1px 7px;font-size:.62rem;font-family:'Fira Code',monospace;">LREE ${m.lree}</span>
        <span style="background:rgba(26,74,107,.15);border:1px solid rgba(26,74,107,.3);border-radius:4px;padding:1px 7px;font-size:.62rem;font-family:'Fira Code',monospace;">HREE ${m.hree}</span>
        <span style="background:${m.radioact.includes('faible')||m.radioact==='TrÃ¨s faible'?'rgba(45,106,79,.12)':'rgba(181,69,27,.12)'};border:1px solid ${m.radioact.includes('faible')||m.radioact==='TrÃ¨s faible'?'rgba(45,106,79,.3)':'rgba(181,69,27,.3)'};border-radius:4px;padding:1px 7px;font-size:.62rem;font-family:'Fira Code',monospace;">â˜¢ ${m.radioact}</span>
      </div>
      <div class="mine-bar-wrap"><div class="mine-bar" style="width:${m.pct}%"></div></div>
      <div style="font-size:.65rem;color:var(--muted);font-family:'Fira Code',monospace;">Production relative : ${m.production}</div>
      <div class="mine-detail">${m.det}</div>
    </div>`).join('')}</div>`;
}
function toggleMine(i){
  document.querySelectorAll('.mine-card').forEach((c,j)=>{j===i?c.classList.toggle('open'):c.classList.remove('open');});
}

// â•â•â•â•â•â•â• EXTRACTION â•â•â•â•â•â•â•
const EXTRACTION_DATA={
  bastnaesite:{name:'BastnÃ¤site',steps:[
    {title:'Extraction miniÃ¨re (open-pit)',chem:'CeCOâ‚ƒF + Gangue â†’ Concassage + Broyage',desc:'Extraction Ã  ciel ouvert. Concassage primaire et secondaire. Broyage Ã  billes jusqu\'Ã  P80 ~75 Î¼m. La gangue contient calcite, dolomite, barytine, fluorite.',env:'PoussiÃ¨res, bruit, surfaces dÃ©forestÃ©es.',yield:95},
    {title:'PrÃ©concentration (flottation)',chem:'BastnÃ¤site â†’ Collecteur (acide olÃ©ique + Naâ‚‚COâ‚ƒ) â†’ Mousse enrichie ~60% TRâ‚‚Oâ‚ƒ',desc:'Flottation sÃ©lective : bastnÃ¤site est hydrophobe avec collecteur. Gangue hydrophile reste dans l\'eau. Rapport de concentration : 10â€“20x. Produit : concentrÃ© flotation.',env:'RÃ©actifs flotation, eaux usÃ©es.',yield:85},
    {title:'Lixiviation acide (HCl ou Hâ‚‚SOâ‚„)',chem:'CeCOâ‚ƒF + 2 HCl â†’ CeClâ‚ƒ + COâ‚‚â†‘ + HFâ†‘\n2Ce(COâ‚ƒ)â‚ƒ + 3Hâ‚‚SOâ‚„ â†’ Ceâ‚‚(SOâ‚„)â‚ƒ + 3Hâ‚‚O + 3COâ‚‚',desc:'Dissolution sÃ©lective des TR par HCl diluÃ© (10â€“15%) ou Hâ‚‚SOâ‚„ Ã  60â€“80Â°C. HF dÃ©gagÃ© avec HCl = dangereux (neutralisation). La gangue silicatÃ©e rÃ©siste mieux.',env:'âš ï¸ HF gazeux toxique. Effluents acides.',yield:90},
    {title:'Extraction par solvants (SX) â€” SÃ©paration',chem:'LnÂ³âº(aq) + 3 HDEHP(org) â‡Œ LnDEHPâ‚ƒ(org) + 3Hâº\nD = [Ln]org / [Ln]aq â†’ sÃ©lectivitÃ© par Z',desc:'Extraction liquide-liquide en continu (mÃ©langeurs-dÃ©canteurs en batterie). Extractants : D2EHPA, EHEHPA, Cyanex 572. SÃ©paration la + difficile car propriÃ©tÃ©s TR trÃ¨s proches. NÃ©cessite dizaines d\'Ã©tapes pour Nd/Pr ou Eu/Sm.',env:'Solvants organiques, pertes extractants.',yield:99},
    {title:'PrÃ©cipitation sÃ©lective des oxyalates',chem:'LnÂ³âº + 3/2 Hâ‚‚Câ‚‚Oâ‚„ â†’ Lnâ‚‚(Câ‚‚Oâ‚„)â‚ƒâ†“ + 3Hâº',desc:'PrÃ©cipitation Ã  l\'acide oxalique Ã  pH contrÃ´lÃ© (1.5â€“2.0). Filtre la totalitÃ© des TR sous forme d\'oxalates insolubles. Ã‰tape de purification finale. Filtration centrifuge.',env:'Hâ‚‚Câ‚‚Oâ‚„ â€” dÃ©chets oxaliques Ã  traiter.',yield:98},
    {title:'Calcination â†’ Oxydes REE (REO)',chem:'Lnâ‚‚(Câ‚‚Oâ‚„)â‚ƒ â†’ Lnâ‚‚Oâ‚ƒ + 3CO + 3COâ‚‚ (900Â°C)',desc:'Calcination dans four rotatif Ã  800â€“1000Â°C. DÃ©composition des oxalates â†’ oxydes purs REO. Produit commercial : TRâ‚‚Oâ‚ƒ Ã  99â€“99.99% (selon sÃ©paration SX). Ce sous forme CeOâ‚‚.',env:'Emissions COâ‚‚, fours Ã©nergivores.',yield:99},
    {title:'RÃ©duction mÃ©tallotherme (mÃ©tal pur)',chem:'Lnâ‚‚Oâ‚ƒ + 3Ca â†’ 2Ln + 3CaO (650â€“1100Â°C)\nLnFâ‚ƒ + 3/2Ca â†’ Ln + 3/2CaFâ‚‚',desc:'Production du mÃ©tal TR pur : rÃ©duction de l\'oxyde (ou fluorure) par calcium ou magnÃ©sium mÃ©tallique. Conditions anhydres sous Ar. NÃ©odyme mÃ©tal ainsi obtenu pour aimants NdFeB.',env:'Ca mÃ©tal, dÃ©chets CaO/CaFâ‚‚.',yield:95},
  ]},
  monazite:{name:'Monazite',steps:[
    {title:'Extraction et sÃ©paration gravimÃ©trique',chem:'Monazite (dense : 5.0â€“5.3 g/cmÂ³) â†’ tables de gravitÃ©',desc:'La monazite est rÃ©cupÃ©rÃ©e comme sous-produit des sables miniers (Ti, Zr). SÃ©paration par densitÃ© (spirales, tables), puis sÃ©paration magnÃ©tique (monazite lÃ©gÃ¨rement magnÃ©tique). Produit : concentrÃ© >90% monazite.',env:'Manipulation sables radioactifs.',yield:85},
    {title:'DÃ©composition alcaline (NaOH fondu)',chem:'(La,Ce,Th)POâ‚„ + 3NaOH â†’ La(OH)â‚ƒ + Naâ‚ƒPOâ‚„\nThOâ‚‚ reste insoluble â†’ sÃ©paration Th',desc:'Attaque par NaOH Ã  140Â°C pendant 4h. Les TR passent en hydroxydes solubles, le Th reste comme ThOâ‚‚ (insoluble en milieu alcalin). SÃ©paration critique Th/TR pour gestion radioactivitÃ©.',env:'âš ï¸ Thorium radioactif Ã  gÃ©rer.',yield:92},
    {title:'Lixiviation HNOâ‚ƒ puis SX Th/TR',chem:'TR(OH)â‚ƒ + 3HNOâ‚ƒ â†’ TR(NOâ‚ƒ)â‚ƒ + 3Hâ‚‚O\nTBP/kÃ©rosÃ¨ne â†’ extraction sÃ©lective Th',desc:'Dissolution dans HNOâ‚ƒ, puis extraction du thorium rÃ©siduel par TBP/kÃ©rosÃ¨ne. Le raffinat contient les TR purifiÃ©es de Th (< 10 ppm Th requis pour commercialisation).',env:'HNOâ‚ƒ, TBP. DÃ©chets Th Ã  stocker.',yield:90},
    {title:'SX individuelle des TR et prÃ©cipitation',chem:'MÃªme que bastnÃ¤site (HDEHP, Cyanex)',desc:'SÃ©paration individuelle des TR par SX multistage. La monazite est riche en LREE (La, Ce, Nd). PrÃ©cipitation oxalate puis calcination.',env:'Identique bastnÃ¤site.',yield:98},
  ]},
  xenotime:{name:'XÃ©notime',steps:[
    {title:'RÃ©cupÃ©ration sables miniers + tri',chem:'YPOâ‚„ + (Er,Dy,Yb,Gd)POâ‚„ â†’ dense (4.5 g/cmÂ³)',desc:'XÃ©notime = phosphate d\'yttrium avec substitutions HREE. RÃ©cupÃ©rÃ© dans les sables de riviÃ¨res et placers (Malaisie, Australie). DensitÃ© ~4.5 g/cmÂ³ â†’ sÃ©paration par spirales + tables.',env:'Sables, poussiÃ¨res. Th/U trÃ¨s faibles.',yield:80},
    {title:'Lixiviation Hâ‚‚SOâ‚„ Ã  chaud',chem:'YPOâ‚„ + Hâ‚‚SOâ‚„ â†’ Yâ‚‚(SOâ‚„)â‚ƒ + Hâ‚ƒPOâ‚„',desc:'Attaque sulfurique concentrÃ©e Ã  250Â°C. Dissolution complÃ¨te du xÃ©notime. Hâ‚ƒPOâ‚„ libÃ©rÃ© â€” peut Ãªtre rÃ©cupÃ©rÃ© comme co-produit. Milieu trÃ¨s corrosif.',env:'Hâ‚‚SOâ‚„ concentrÃ©, Hâ‚ƒPOâ‚„.',yield:95},
    {title:'Neutralisation et prÃ©cipitation HREE',chem:'YÂ³âº + DyÂ³âº + ErÂ³âº... + NHâ‚ƒÂ·Hâ‚‚O â†’ Ln(OH)â‚ƒâ†“',desc:'Neutralisation progressive Ã  pH 4â€“5 : prÃ©cipitation des HREE comme hydroxydes ou sels basiques. Yttrium et HREE rÃ©cupÃ©rÃ©s ensemble. SÃ©paration individuelle ensuite par SX.',env:'Effluents ammoniacaux.',yield:90},
    {title:'SX â€” SÃ©paration HREE individuelles',chem:'YÂ³âº/DyÂ³âº/ErÂ³âº â†’ sÃ©paration par PC88A ou EHEHPA',desc:'SÃ©paration des HREE entre elles est particuliÃ¨rement difficile (rayon trÃ¨s proches). Y se sÃ©pare relativement bien. Dy/Ho, Er/Tm/Yb nÃ©cessitent nombreuses Ã©tapes. CoÃ»teux mais HREE = marchÃ© premium.',env:'Extractants organiques.',yield:95},
  ]},
  iaclay:{name:'Ion Adsorption Clays',steps:[
    {title:'Exploration et dÃ©limitation des zones',chem:'Teneur 0.05â€“0.2% TRâ‚‚Oâ‚ƒ / kg argile',desc:'Mesures gÃ©ophysiques et gÃ©ochimiques pour cartographier les profils d\'altÃ©ration. Les TRÂ³âº sont adsorbÃ©es sur les argiles (illite, halloysite, kaolinite) par Ã©change ionique rÃ©versible. Profils 3â€“20 m de profondeur.',env:'DÃ©forestation lÃ©gÃ¨re.',yield:85},
    {title:'Lixiviation in situ (solution mining)',chem:'[Argile-Ln]Â³âº + 3/2(NHâ‚„)â‚‚SOâ‚„ â†’ 3NHâ‚„-Argile + Lnâ‚‚(SOâ‚„)â‚ƒ(aq)',desc:'Injection de solution (NHâ‚„)â‚‚SOâ‚„ (3â€“5%) dans des puits. Les NHâ‚„âº Ã©changent avec les TRÂ³âº adsorbÃ©es. Les lixiviats TR sont collectÃ©s par des drains en aval. ProcÃ©dÃ© peu destructeur mais parfois fuites.',env:'NHâ‚„âº dans nappes phrÃ©atiques. Sols compactÃ©s.',yield:70},
    {title:'PrÃ©cipitation par NHâ‚ƒ + filtration',chem:'LnÂ³âº(aq) + NHâ‚ƒÂ·Hâ‚‚O â†’ Ln(OH)â‚ƒâ†“ (pH 7â€“8)',desc:'Neutralisation des lixiviats avec NHâ‚ƒ. PrÃ©cipitation des TR sous forme d\'hydroxydes. Filtration presse. Produit : concentrÃ© hydroxydes HREE riche en Y, Dy, Eu, Tb.',env:'Effluents ammoniacaux Ã  traiter.',yield:92},
    {title:'Calcination â†’ ConcentrÃ© HREE mixed oxides',chem:'Ln(OH)â‚ƒ â†’ Lnâ‚‚Oâ‚ƒ + Hâ‚‚O (600â€“800Â°C)',desc:'Produit final : mÃ©lange d\'oxydes HREE. Teneur HREE Ã©levÃ©e (Dy 3â€“7%, Tb 0.5â€“2%, Eu 2â€“5%). Envoi vers usines de sÃ©paration SX pour oxydes individuels. Chine exporte concentrÃ©s et oxydes sÃ©parÃ©s.',env:'COâ‚‚, fours. Impact global faible.',yield:97},
  ]}
};
function loadExtraction(){
  const key=document.getElementById('extrMineral').value;
  const data=EXTRACTION_DATA[key];
  if(!data)return;
  const cont=document.getElementById('extr-content');
  cont.innerHTML=`
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:9px;padding:12px;margin-bottom:12px;font-size:.82rem;">
      <b>Minerai :</b> ${data.name} | <b>Ã‰tapes :</b> ${data.steps.length} | Cliquez sur chaque Ã©tape pour les dÃ©tails.
    </div>
    <div class="extr-flow">${data.steps.map((s,i)=>`
      <div class="extr-step">
        <div class="extr-line">
          <div class="extr-dot"></div>
          ${i<data.steps.length-1?'<div class="extr-connector"></div>':''}
        </div>
        <div class="extr-content" onclick="this.classList.toggle('open2')" style="cursor:pointer;">
          <div class="extr-title">Ã‰tape ${i+1} : ${s.title} <span style="float:right;font-size:.7rem;color:var(--gold);">Rendement ~${s.yield}%</span></div>
          <div class="extr-desc">${s.desc}</div>
          <div class="extr-chem">${s.chem}</div>
          <div style="font-size:.7rem;color:var(--p4);margin-top:5px;font-family:'Fira Code',monospace;">âš ï¸ ${s.env}</div>
        </div>
      </div>`).join('')}
    </div>`;
  setStatus('ProcÃ©dÃ© chargÃ© : '+data.name);
}

// â•â•â•â•â•â•â• APPLICATIONS â•â•â•â•â•â•â•
const APPS_DATA=[
  {key:'magnets',icon:'ğŸ§²',name:'Aimants permanents',sub:'NdFeB, SmCo',detail:{title:'Aimants NdFeB & SmCo',elems:['Nd (73%)','Pr (~5%)','Dy (3â€“5%)','Tb (1â€“2%)','Sm (SmCo)'],reactions:['Ndâ‚‚Feâ‚â‚„B : Structure tÃ©tragonale P4â‚‚/mnm','BHmax = 512 kJ/mÂ³ (record mondial)','Tc = 585 K (NdFeB) | > 1000 K (SmCoâ‚…)','Ajout Dy â†’ Hcâ†‘ Ã  TÂ° Ã©levÃ©e (VE, Ã©oliennes)'],facts:'MarchÃ©s : moteurs VE (2 kg/voiture), Ã©oliennes (650 kg/MW), Ã©lectronique (HDD, Ã©couteurs). Consommation mondiale Nd : ~40 000 t/an (2023). Valeur marchÃ©e aimants TR : 12 Mds$/an.',color:'#c8920a'}},
  {key:'batteries',icon:'ğŸ”‹',name:'Batteries & stockage',sub:'NiMH, alliages ABâ‚…',detail:{title:'Batteries NiMH (Ni-MH)',elems:['La (~35%)','Ce (~50%)','Nd (~10%)','Pr (~5%)'],reactions:['Ã‰lectrode : MH + OHâ» â‡Œ M + Hâ‚‚O + eâ»','Alliage ABâ‚… : LaNiâ‚… (modifiÃ© La,Ce,Nd,Pr)','DensitÃ© Ã©nergie : 60â€“120 Wh/kg','VÃ©hicules hybrides (Toyota Prius : ~10 kg TR)'],facts:'Un hybride NiMH contient 10â€“15 kg de misc-mÃ©tal (La, Ce, Nd, Pr). Remplacement progressif par Li-ion mais NiMH reste pour hybrides. Recyclage NiMH : ~90% Ni rÃ©cupÃ©rÃ©, TR < 1%.',color:'#3498db'}},
  {key:'luminophores',icon:'ğŸ’¡',name:'Luminophores & Ã©clairage',sub:'LED, Ã©crans, scintillateurs',detail:{title:'Luminophores TR â€” Ã‰clairage & Ã‰crans',elems:['EuÂ³âº (rouge, 615 nm)','TbÂ³âº (vert, 545 nm)','EuÂ²âº (bleu, ~450 nm)','CeÂ³âº:YAG (blanc LED)','SmÂ³âº, DyÂ³âº'],reactions:['LED blanche = puce bleue (InGaN) + CeÂ³âº:YAG','Tube fluorescent : 3 bandes (Eu, Tb, EuÂ²âº)','Ã‰mission 4fâ†’4f : raies fines, grande puretÃ© colorimÃ©trique','EfficacitÃ© lumineuse > 100 lm/W'],facts:'CeÂ³âº:YAG = rÃ©volution LED blanche (Nobel 2014). ~4 000 t TRâ‚‚Oâ‚ƒ/an consommÃ©es en luminophores. Enjeu : luminophores recyclables (lampes CFL contiennent Tb, Eu, Yâ‚‚Oâ‚ƒ).',color:'#f1c40f'}},
  {key:'catalyse',icon:'âš—ï¸',name:'Catalyse',sub:'Automobile, pÃ©trochimie',detail:{title:'Catalyseurs TR â€” Automobile & PÃ©trochimie',elems:['Ce (OSC, autocatalyseur)','La (FCC, zeolites)','Nd (catalyse polymÃ©risation)'],reactions:['Ceria CeOâ‚‚ : Ceâ´âº â†” CeÂ³âº â†’ stockage/relÃ¢che Oâ‚‚ (OSC)','TWC : CO + HC + NOx â†’ COâ‚‚ + Hâ‚‚O + Nâ‚‚ (Ce essentiel)','FCC (Fluid Catalytic Cracking) : La-zeolite stabilitÃ© thermique','CeOâ‚‚ = polissant verre (0.2â€“1 Î¼m finesse)'],facts:'Catalyse auto = 50 000 t/an Ceâ‚‚Oâ‚ƒ. Laâ‚‚Oâ‚ƒ dans FCC : 25 000 t/an. CeOâ‚‚ polissant : 15 000 t/an. La ceria = 2e application TR aprÃ¨s aimants.',color:'#27ae60'}},
  {key:'optique',icon:'ğŸ”¬',name:'Optique & Laser',sub:'Nd:YAG, Er fibres, Lu:PET',detail:{title:'Applications Optiques & Lasers',elems:['NdÂ³âº:YAG (1064 nm)','ErÂ³âº (EDFA, 1550 nm)','YbÂ³âº:YAG (kW)','Ho:YAG (2 Î¼m)','Luâ‚‚SiOâ‚…:Ce (PET)'],reactions:['Laser Nd:YAG : â´Fâ‚ƒ/â‚‚ â†’ â´Iâ‚â‚/â‚‚ (1064 nm) â†’ SHG â†’ 532 nm','EDFA : ErÂ³âº pompÃ© 980 nm â†’ amplification 1550 nm','LuSO (Luâ‚‚SiOâ‚…:Ce) : scintillateur rapide (1.5 ns), Emax 511 keV'],facts:'Amplificateurs Er-EDFA = Ã©pine dorsale d\'Internet (fibres tÃ©lÃ©com mondiales). Laser Nd-YAG industriel : > 1 GW puissance crÃªte. Lu-PET : dÃ©tection cancer prÃ©coce.',color:'#9b59b6'}},
  {key:'medical',icon:'ğŸ¥',name:'MÃ©decine & IRM',sub:'Gd-IRM, Lu-177, Pm',detail:{title:'Applications MÃ©dicales des TR',elems:['Gd-DTPA (IRM)','Lu-177 (radiothÃ©rapie)','Pm-147 (pacemaker historique)','Ho-166 (thÃ©rapie)'],reactions:['Gd-DTPA : relaxivitÃ© râ‚ = 4.3 mMâ»Â¹sâ»Â¹ Ã  1.5 T','Lu-177 : Î²â» (0.5 MeV) + Î³ (208 keV) â†’ tâ‚/â‚‚ = 6.6 j','Dotatate-Lu177 â†’ rÃ©cepteur sst2 (cancer NET) â†’ irradiation locale'],facts:'Gd-DTPA (Magnevist) : > 30 millions d\'injections/an. Lu-177 Dotatate (Lutathera) = 1Ã¨re radioligand thÃ©rapie approuvÃ©e FDA (2018). MarchÃ© Gd-IRM > 500 M$/an.',color:'#e74c3c'}},
  {key:'energie',icon:'âš¡',name:'Ã‰nergie propre',sub:'Ã‰oliennes, VE, hydrogÃ¨ne',detail:{title:'TR & Transition Ã‰nergÃ©tique',elems:['Nd, Pr (aimants Ã©oliennes)','Dy, Tb (performance TÂ° Ã©levÃ©e)','La, Ce (stockage Hâ‚‚ NiMH)','Y (SOFC, YSZ)'],reactions:['Ã‰olienne offshore 5 MW : 650 kg d\'aimants NdFeB','VE (Model 3) : ~2 kg Nd/Pr par moteur','YSZ (Yâ‚‚Oâ‚ƒÂ·ZrOâ‚‚) : Ã©lectrolyte pile SOFC (>800Â°C)','ScÃ©nario IEA 2030 : besoin Nd x2.5, Dy x5'],facts:'La transition Ã©nergÃ©tique = explosion de la demande TR. Risque de pÃ©nurie Dy, Tb d\'ici 2030 si recyclage < 10%. Initiatives : mines EU, recyclage NdFeB, substitution par ferrite (moins performant).',color:'#1abc9c'}},
  {key:'verre',icon:'ğŸªŸ',name:'Verre & CÃ©ramiques',sub:'Optique, polissage, rÃ©fractaires',detail:{title:'Verres & CÃ©ramiques aux TR',elems:['CeOâ‚‚ (polissant, verre UV-absorbant)','Ndâ‚‚Oâ‚ƒ (verre rose/violet)','Laâ‚‚Oâ‚ƒ (verre haute rÃ©fraction)','Prâ‚†Oâ‚â‚ (cÃ©ramique jaune)','Erâ‚‚Oâ‚ƒ (verre rose)'],reactions:['CeOâ‚‚ : filtre UV (lunettes, vitres auto)','LaFâ‚ƒ : basse dispersion optique â†’ microscopes, appareils photo','Verre Nd : soudure et verre de protection laser'],facts:'CeOâ‚‚ polissant = 15 000 t/an. Laâ‚‚Oâ‚ƒ optique : 4 000 t/an. Verre colorÃ© TR : applications dÃ©coratives et industrielles. CÃ©ramiques TR haute tempÃ©rature (turbines, nuclÃ©aire).',color:'#e67e22'}},
];
function initApps(){
  const sel=document.getElementById('app-selector');
  sel.innerHTML=APPS_DATA.map((a,i)=>`<div class="app-card" id="appc-${i}" onclick="selectApp(${i})"><div class="app-name">${a.icon} ${a.name}</div><div class="app-sub">${a.sub}</div></div>`).join('');
  selectApp(0);
}
function selectApp(i){
  document.querySelectorAll('.app-card').forEach((c,j)=>c.classList.toggle('sel',j===i));
  const d=APPS_DATA[i].detail;
  document.getElementById('app-content').innerHTML=`
    <div style="background:linear-gradient(135deg,rgba(200,146,10,.08),rgba(200,146,10,.03));border:1px solid rgba(200,146,10,.2);border-radius:10px;padding:16px;margin-bottom:12px;">
      <div style="font-family:'Fraunces',serif;font-size:1.15rem;color:var(--p1);margin-bottom:12px;">${d.title}</div>
      <div style="display:flex;flex-wrap:wrap;gap:12px;">
        <div style="flex:1;min-width:200px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">Ã‰LÃ‰MENTS UTILISÃ‰S</div>
          <div style="display:flex;flex-wrap:wrap;gap:5px;">${d.elems.map(e=>`<span style="background:rgba(200,146,10,.15);border:1px solid rgba(200,146,10,.3);border-radius:5px;padding:3px 9px;font-size:.76rem;font-family:'Fira Code',monospace;">${e}</span>`).join('')}</div>
        </div>
        <div style="flex:1;min-width:200px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">RÃ‰ACTIONS / DONNÃ‰ES CLÃ‰S</div>
          ${d.reactions.map(r=>`<div class="code-dark" style="margin-bottom:5px;font-size:.72rem;">${r}</div>`).join('')}
        </div>
      </div>
    </div>
    <div class="info-box"><h4>ğŸ“Š Faits et chiffres (donnÃ©es 2023â€“2024)</h4><p>${d.facts}</p></div>`;
  setStatus('Application : '+d.title);
}

// â•â•â•â•â•â•â• MAGNÃ‰TISME â•â•â•â•â•â•â•
const MAG_DATA={
  NdFeB:{name:'Ndâ‚‚Feâ‚â‚„B',Br:1.4,Hc:1000,BHmax:512,Tc:585,notes:'Aimant le plus puissant. Structure tÃ©tragonale. Applications : moteurs VE, Ã©oliennes offshore, disques durs. InconvÃ©nient : Tc relativement basse (312Â°C) â†’ perte performances Ã  TÂ° Ã©levÃ©e. Ajout Dy/Tb amÃ©liore Hc.',color:'#c8920a'},
  SmCo5:{name:'SmCoâ‚…',Br:1.05,Hc:900,BHmax:200,Tc:1003,notes:'Excellent Ã  TÂ° Ã©levÃ©e (Tc=730Â°C). RÃ©sistant Ã  la corrosion. Applications : moteurs aÃ©ronautique, applications militaires. Plus cher (Co) mais stable. DÃ©couverte 1970 (Strnat).',color:'#3498db'},
  Sm2Co17:{name:'Smâ‚‚Coâ‚â‚‡',Br:1.15,Hc:700,BHmax:260,Tc:1073,notes:'Meilleure gÃ©nÃ©ration SmCo. Tc=800Â°C. BHmax=260 kJ/mÂ³. Structure 2:17. UtilisÃ© dans les systÃ¨mes hautes TÂ° : moteurs gÃ©othermiques, aÃ©rospatial.',color:'#9b59b6'},
  Gd:{name:'Gd mÃ©tal',Br:0.24,Hc:2,BHmax:4,Tc:293,notes:'FerromagnÃ©tique unique Ã  TÂ° ambiante (Tc=20Â°C). Fort effet magnÃ©tocalorique â†’ rÃ©frigÃ©ration magnÃ©tique. Recherche fondamentale. Î¼=7.94 Î¼B (max lanthanides).',color:'#1abc9c'},
  DyFe:{name:'DyFeâ‚‚ (Terfenol-D type)',Br:0,Hc:0,BHmax:0,Tc:600,notes:'MatÃ©riaux magnÃ©tostrictifs : Terfenol-D = Tbâ‚€.â‚ƒDyâ‚€.â‚‡Feâ‚‚ â†’ plus grande magnÃ©tostriction Ã  TÂ° ambiante (~2000 ppm). Applications : actionneurs, sonar, capteurs, transducteurs haute puissance.',color:'#e74c3c'},
  MnBi:{name:'Fer ordinaire (comparaison)',Br:2.15,Hc:0.001,BHmax:0.5,Tc:1043,notes:'RÃ©fÃ©rence : fer doux. Fort Br mais Hc quasi nul (aimant mou). UtilisÃ© dans transformateurs, moteurs Ã  induction (pas permanent). Montre pourquoi les aimants TR sont incomparables.',color:'#7f8c8d'},
};
function updateMagTemp(){
  const T=parseInt(document.getElementById('magTemp').value);
  document.getElementById('mag-temp-label').textContent=T+'Â°C';
  showMagnetism();
}
function showMagnetism(){
  const key=document.getElementById('magSel').value;
  const m=MAG_DATA[key];
  const T=parseInt(document.getElementById('magTemp').value);
  const Tc_K=m.Tc;
  const T_K=T+273;
  const frac=Math.max(0,1-Math.pow(T_K/Tc_K,1.5));
  const Br_T=+(m.Br*frac).toFixed(3);
  document.getElementById('mag-data').innerHTML=`Br Ã  ${T}Â°C : <b>${Br_T} T</b><br>Hcâ‚€ : <b>${m.Hc} kA/m</b><br>(BH)max : <b>${m.BHmax} kJ/mÂ³</b><br>Tc : <b>${m.Tc} K (${m.Tc-273}Â°C)</b>`;
  document.getElementById('mag-content').innerHTML=`
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:15px;margin-bottom:11px;">
      <div style="font-family:'Fraunces',serif;font-size:1.1rem;color:var(--p1);margin-bottom:10px;">${m.name}</div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:10px;">
        ${[['Br (rÃ©manence)',m.Br+' T'],['Hc (coercitivitÃ©)',m.Hc+' kA/m'],['(BH)max',m.BHmax+' kJ/mÂ³'],['Tc (Curie)',m.Tc-273+'Â°C']].map(([k,v])=>`<div style="background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:8px;"><div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;">${k}</div><div style="font-size:.9rem;font-weight:700;color:var(--ink);">${v}</div></div>`).join('')}
      </div>
      <div class="code-dark">${m.notes}</div>
    </div>
    <div class="info-box"><h4>ğŸŒ¡ï¸ Effet de la tempÃ©rature : T = ${T}Â°C</h4>
      <p>Ã€ ${T}Â°C (T/Tc = ${(T_K/Tc_K).toFixed(2)}), la rÃ©manence estimÃ©e est <b>Br â‰ˆ ${Br_T} T</b> (${((1-frac)*100).toFixed(0)}% de perte par rapport Ã  TÂ° ambiante).<br>${T_K>Tc_K?'âš ï¸ <b>T > Tc : matÃ©riau PARAMAGNÃ‰TIQUE â€” perte totale de l\'aimantation permanente !</b>':frac>0.9?'âœ… Bonnes performances magnÃ©tiques.':'âš ï¸ Performances dÃ©gradÃ©es.'}</p>
    </div>`;
  drawMagCanvas(m,frac);
}
function drawMagCanvas(m,frac){
  const c=document.getElementById('magCanvas');if(!c)return;
  const ctx=c.getContext('2d'),w=c.width,h=c.height;
  ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,w,h);
  // BH curve simulation
  const cx0=50,cw=w-60,pad_top=20,ch=h-50;
  ctx.strokeStyle='rgba(200,146,10,.15)';ctx.lineWidth=1;
  [0.25,0.5,0.75,1].forEach(f=>{
    const y=pad_top+ch*(1-f);
    ctx.beginPath();ctx.moveTo(cx0,y);ctx.lineTo(cx0+cw,y);ctx.stroke();
    ctx.fillStyle='rgba(200,146,10,.4)';ctx.font='9px Fira Code';
    ctx.fillText((m.Br*f*frac).toFixed(2),2,y+3);
  });
  // Draw hysteresis loop
  ctx.beginPath();ctx.strokeStyle=m.color||'#c8920a';ctx.lineWidth=2;
  const pts=[];
  for(let i=0;i<=60;i++){
    const hNorm=(i/30)-1;
    const B=m.Br*frac*Math.tanh((hNorm+0.5)*3);
    pts.push([cx0+cw*(i/60),pad_top+ch*(1-Math.max(0,Math.min(1,(B/m.Br+1)/2)))]);
  }
  ctx.moveTo(pts[0][0],pts[0][1]);pts.forEach(p=>ctx.lineTo(p[0],p[1]));
  ctx.stroke();
  // Axis labels
  ctx.fillStyle='rgba(255,255,255,.5)';ctx.font='10px Fira Code';ctx.textAlign='center';
  ctx.fillText('H (champ appliquÃ© â†’)',cx0+cw/2,h-5);
  ctx.save();ctx.translate(12,pad_top+ch/2);ctx.rotate(-Math.PI/2);ctx.fillText('B (T)',0,0);ctx.restore();
  ctx.fillStyle='rgba(255,255,255,.6)';ctx.font='10px Manrope';ctx.textAlign='left';
  ctx.fillText(`Br=${(m.Br*frac).toFixed(2)}T  Tc=${m.Tc-273}Â°C`,cx0+4,pad_top+12);
}

// â•â•â•â•â•â•â• LUMINESCENCE â•â•â•â•â•â•â•
const LUMI_DATA={
  Eu3:{name:'EuÂ³âº',color:'#e74c3c',emission:'Rouge pur â€” 615 nm (âµDâ‚€â†’â·Fâ‚‚)',peaks:[{wl:579,I:0.2},{wl:592,I:0.6},{wl:615,I:1.0},{wl:651,I:0.25},{wl:700,I:0.15}],QY:'>90% (EuÂ³âº:Yâ‚‚Oâ‚ƒ)',tau:'1.0â€“2.5 ms',notes:'Emission âµDâ‚€â†’â·Fâ‚‚ (transition Ã©lectrique dipolaire, hypersensible). PuretÃ© colorimÃ©trique exceptionnelle (CIE y=0.62). Standard rouge des Ã©crans. Billets de banque euro (sÃ©curitÃ©). Luminophore rouge LED blanc chaud.'},
  Eu2:{name:'EuÂ²âº',color:'#3498db',emission:'Bleu large â€” 440â€“460 nm (transition 4fâ†’5d)',peaks:[{wl:420,I:0.2},{wl:440,I:0.8},{wl:460,I:1.0},{wl:490,I:0.6},{wl:520,I:0.2}],QY:'80â€“90%',tau:'1 Î¼s',notes:'EuÂ²âº (4fâ· â†’ 5dÂ¹) : bande large (â‰  raies fines EuÂ³âº). Couleur bleue Ã  verte selon matrice. BaMgAlâ‚â‚€Oâ‚â‚‡:EuÂ²âº = luminophore bleu tubes fluorescents. SrAlâ‚‚Oâ‚„:EuÂ²âº = photoluminescence persistante verte. LED tricolore.'},
  Tb3:{name:'TbÂ³âº',color:'#27ae60',emission:'Vert pur â€” 545 nm (âµDâ‚„â†’â·Fâ‚…)',peaks:[{wl:490,I:0.25},{wl:545,I:1.0},{wl:588,I:0.45},{wl:622,I:0.2}],QY:'70â€“90%',tau:'0.5â€“2 ms',notes:'âµDâ‚„â†’â·Fâ‚… (545 nm) = vert pur. LaPOâ‚„:Ce,Tb et LaOBr:Tb = luminophores tubes fluorescents. DÃ©tection TNT (quenching). Biocapteurs. EfficacitÃ© quantique Ã©levÃ©e. RÃ©sistant Ã  la dÃ©sactivation thermique.'},
  Er3:{name:'ErÂ³âº',color:'#e67e22',emission:'NIR 1530 nm + Vert 550 nm (up-conversion)',peaks:[{wl:520,I:0.4},{wl:550,I:1.0},{wl:660,I:0.4},{wl:800,I:0.3}],QY:'~1% (up-conv.)',tau:'10â€“12 ms (1550 nm)',notes:'Up-conversion : absorption 2 photons IR â†’ Ã©mission 1 photon visible. ErÂ³âº dans NaYFâ‚„ : efficacitÃ© up-conversion la + Ã©levÃ©e. EDFA : amplification 1550 nm (fenÃªtre telecom fibre optique). Bioimagerie IR (fenÃªtre biologique 700â€“1700 nm).'},
  Nd3:{name:'NdÂ³âº',color:'#9b59b6',emission:'NIR â€” 1064 nm (â´Fâ‚ƒ/â‚‚â†’â´Iâ‚â‚/â‚‚)',peaks:[{wl:900,I:0.4},{wl:1064,I:1.0},{wl:1340,I:0.5}],QY:'Variable selon matrice',tau:'0.2â€“0.5 ms',notes:'Laser Nd:YAG = laser solide le + rÃ©pandu (1964, Geusic). Puissance : mW Ã  GW (impulsionnel). Applications : dÃ©coupe mÃ©tal, chirurgie (SHG 532 nm = vert), dÃ©tection distance militaire, spectroscopie. Standard industriel laser.'},
  Ce3:{name:'CeÂ³âº',color:'#f1c40f',emission:'UV/Bleu large â€” 350â€“500 nm (4fâ†’5d)',peaks:[{wl:350,I:0.5},{wl:390,I:0.85},{wl:430,I:1.0},{wl:470,I:0.7},{wl:510,I:0.3}],QY:'>90% (CeÂ³âº:YAG)',tau:'~60 ns (rapide)',notes:'CeÂ³âº:YAG = rÃ©volution LED blanche (Nakamura/Akasaki/Amano, Nobel 2014). Bande large 5dâ†’4f â†’ conversion efficace bleuâ†’jaune. Scintillateurs rapides (60 ns) : LSO, LuAG. LuSO:Ce = PET mÃ©dical. Scintillateur Cherenkov (physique des particules).'},
  Yb3:{name:'YbÂ³âº',color:'#1e8bc3',emission:'NIR â€” 980â€“1030 nm (Â²Fâ‚…/â‚‚â†’Â²Fâ‚‡/â‚‚)',peaks:[{wl:970,I:0.7},{wl:1000,I:1.0},{wl:1030,I:0.8}],QY:'Variable',tau:'1â€“2 ms',notes:'YbÂ³âº = sensibilisateur universel (absorbe Ã  980 nm, transfÃ¨re Ã  Er, Tm, Ho). Laser Yb:YAG Ã  fibre = standard industriel (kW, couper acier). Up-conversion avec Er. Pompage lasers en tÃ©lÃ©com.'},
  Tm3:{name:'TmÂ³âº',color:'#8e44ad',emission:'Bleu â€” 450â€“480 nm (up-conversion)',peaks:[{wl:450,I:0.7},{wl:475,I:1.0},{wl:650,I:0.3},{wl:800,I:0.6}],QY:'~0.1% (up-conv.)',tau:'1â€“3 ms',notes:'Up-conversion bleue (tripling : 3 photons NIR â†’ 1 photon bleu). Laser Tm:YAG (2 Î¼m) : chirurgie soft-tissue. Bioimagerie (bleu visible dans tissus). Â¹â·â°Tm : gÃ©nÃ©rateur rayons X portable.'},
  Sm3:{name:'SmÂ³âº',color:'#e67e22',emission:'Orange-rouge â€” 600â€“650 nm (â´Gâ‚…/â‚‚â†’â¶Hâ±¼)',peaks:[{wl:565,I:0.3},{wl:600,I:0.8},{wl:645,I:1.0},{wl:705,I:0.4}],QY:'20â€“60%',tau:'1â€“2 ms',notes:'SmÂ³âº moins utilisÃ© qu\'Eu/Tb mais Ã©mission orange-rouge intÃ©ressante. SmClâ‚ƒ = coupleur C-C (Sm(II) rÃ©ducteur en chimie org.). SmÂ²âº photochrome (borosilicate). Pigments cÃ©ramiques (rouge-orange).'},
};
function showLuminescence(){
  const key=document.getElementById('lumiSel').value;
  const d=LUMI_DATA[key];
  document.getElementById('lumi-content').innerHTML=`
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:15px;margin-bottom:11px;">
      <div style="font-family:'Fraunces',serif;font-size:1.1rem;color:var(--p1);margin-bottom:4px;">${d.name} â€” PropriÃ©tÃ©s Luminescentes</div>
      <div style="font-family:'Fira Code',monospace;font-size:.8rem;color:${d.color};margin-bottom:11px;">${d.emission}</div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;">
        ${[['Rendement quantique',d.QY],['DurÃ©e de vie Ï„',d.tau],['Matrice hÃ´te',document.getElementById('lumiMatrix').options[document.getElementById('lumiMatrix').selectedIndex].text]].map(([k,v])=>`<div style="background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:8px;"><div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;">${k}</div><div style="font-size:.83rem;font-weight:700;color:var(--ink);">${v}</div></div>`).join('')}
      </div>
    </div>
    <div class="info-box"><h4>ğŸ“¡ Transitions et mÃ©canisme</h4><p>${d.notes}</p></div>
    <div class="code-dark" style="margin-top:9px;">Niveau excitÃ© â†’ niveau fondamental
  Emission ${key.includes('3')||key.includes('2')?'4fâ†”4f (raies fines) ou 4f-5d (bande)':'4fâ†”5d (bande large)'}
  Ï„ â‰ˆ ${d.tau} | QY â‰ˆ ${d.QY}</div>`;
  drawLumiCanvas(d);
  setStatus('Luminescence : '+d.name+' â†’ '+d.emission);
}
function drawLumiCanvas(d){
  const c=document.getElementById('lumiCanvas');if(!c)return;
  const ctx=c.getContext('2d'),w=c.width,h=c.height;
  ctx.fillStyle='#06090f';ctx.fillRect(0,0,w,h);
  const pad={l:35,r:10,t:20,b:35};
  const cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
  // Determine wavelength range
  const allWL=d.peaks.map(p=>p.wl);
  const minWL=Math.max(350,Math.min(...allWL)-40),maxWL=Math.min(1600,Math.max(...allWL)+80);
  // Grid
  ctx.strokeStyle='rgba(255,255,255,.06)';ctx.lineWidth=1;
  [0,0.25,0.5,0.75,1].forEach(f=>{
    const y=pad.t+ch*(1-f);
    ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+cw,y);ctx.stroke();
    ctx.fillStyle='rgba(255,255,255,.3)';ctx.font='8px Fira Code';ctx.textAlign='right';
    ctx.fillText(f.toFixed(2),pad.l-3,y+3);
  });
  // WL axis
  const wlRange=maxWL-minWL;
  [400,500,600,700,800,980,1064,1550].filter(wl=>wl>=minWL&&wl<=maxWL).forEach(wl=>{
    const x=pad.l+(wl-minWL)/wlRange*cw;
    ctx.beginPath();ctx.moveTo(x,pad.t);ctx.lineTo(x,pad.t+ch);ctx.stroke();
    ctx.fillStyle='rgba(255,255,255,.3)';ctx.font='8px Fira Code';ctx.textAlign='center';
    ctx.fillText(wl,x,pad.t+ch+12);
  });
  // Spectrum (Gaussian peaks)
  ctx.beginPath();
  const colorFn=(wl)=>{
    if(wl<380)return'rgba(130,0,180,';
    if(wl<440)return'rgba(90,0,220,';
    if(wl<490)return'rgba(0,80,220,';
    if(wl<560)return'rgba(0,200,80,';
    if(wl<590)return'rgba(200,200,0,';
    if(wl<640)return'rgba(240,120,0,';
    if(wl<750)return'rgba(220,0,0,';
    return'rgba(150,0,0,';
  };
  for(let px=0;px<cw;px++){
    const wl=minWL+(px/cw)*wlRange;
    let I=0;
    d.peaks.forEach(p=>{
      const sig=key.includes('2')||key==='Ce3'?30:12;
      I+=p.I*Math.exp(-0.5*Math.pow((wl-p.wl)/sig,2));
    });
    I=Math.min(1,I);
    const x=pad.l+px,y=pad.t+ch*(1-I);
    const col=colorFn(wl);
    ctx.fillStyle=col+(I*0.9).toFixed(2)+')';
    ctx.fillRect(x,y,1.5,pad.t+ch-y);
  }
  // Main peak label
  const mainPeak=d.peaks.reduce((a,b)=>a.I>b.I?a:b);
  const mx=pad.l+(mainPeak.wl-minWL)/wlRange*cw;
  ctx.strokeStyle='white';ctx.lineWidth=1.5;ctx.setLineDash([3,3]);
  ctx.beginPath();ctx.moveTo(mx,pad.t+5);ctx.lineTo(mx,pad.t+ch);ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle='white';ctx.font='bold 11px Fira Code';ctx.textAlign='center';
  ctx.fillText(mainPeak.wl+' nm',mx,pad.t+3);
  ctx.fillStyle='rgba(255,255,255,.4)';ctx.font='9px Fira Code';
  ctx.fillText('Î» (nm)',pad.l+cw/2,h-3);
  ctx.save();ctx.translate(10,pad.t+ch/2);ctx.rotate(-Math.PI/2);
  ctx.fillText('IntensitÃ© (u.a.)',0,0);ctx.restore();
  document.getElementById('lumi-spectrum-label').textContent=`Spectre d'Ã©mission simulÃ© â€” ${d.name} | pic principal : ${mainPeak.wl} nm`;
}

// â•â•â•â•â•â•â• CALCULS â•â•â•â•â•â•â•
function updateCalcUI(){
  const type=document.getElementById('calcType').value;
  const cont=document.getElementById('calc-inputs');
  const formules={
    mol:'<div class="fg"><label>OXYDE TR (ex: Ndâ‚‚Oâ‚ƒ, CeOâ‚‚, Yâ‚‚Oâ‚ƒ)</label><input type="text" id="c1" placeholder="ex: Nd2O3" value="Nd2O3"></div>',
    enrichissement:'<div class="fg"><label>CONCENTRATION Ã‰CHANTILLON (ppm)</label><input type="number" id="c1" value="150"></div><div class="fg"><label>ABONDANCE CLARKE (ppm)</label><input type="number" id="c2" value="41.5"></div>',
    constante:'<div class="fg"><label>ION LnÂ³âº</label><select id="c1"><option value="La">LaÂ³âº</option><option value="Ce">CeÂ³âº</option><option value="Nd">NdÂ³âº</option><option value="Eu">EuÂ³âº</option><option value="Gd">GdÂ³âº</option><option value="Dy">DyÂ³âº</option><option value="Lu">LuÂ³âº</option></select></div><div class="fg"><label>LIGAND</label><select id="c2"><option value="EDTA">EDTAâ´â»</option><option value="DTPA">DTPAâµâ»</option></select></div>',
    moment:'<div class="fg"><label>NOMBRE D\'Ã‰LECTRONS 4f (0 Ã  14)</label><input type="number" id="c1" min="0" max="14" value="3"></div>',
    contraction:'<div class="fg"><label>NUMÃ‰RO ATOMIQUE Z (57 Ã  71)</label><input type="number" id="c1" min="57" max="71" value="60"></div>',
    rendement:'<div class="fg"><label>CONCENTRATION INITIALE Câ‚€ (g/L)</label><input type="number" id="c1" step="0.01" value="5.0"></div><div class="fg"><label>CONCENTRATION RAFFINAT Câ‚ (g/L)</label><input type="number" id="c2" step="0.01" value="0.25"></div><div class="fg"><label>RAPPORT V_ORG/V_AQ (D)</label><input type="number" id="c3" step="0.1" value="2.0"></div>',
  };
  cont.innerHTML=formules[type]||'';
  document.getElementById('calc-result').textContent='Configurez les paramÃ¨tres et cliquez sur CALCULER';
}
function calculate(){
  const type=document.getElementById('calcType').value;
  let result='';let formula='';
  if(type==='mol'){
    const f=document.getElementById('c1').value.trim();
    const atoms={La:138.91,Ce:140.12,Pr:140.91,Nd:144.24,Pm:145,Sm:150.36,Eu:151.96,Gd:157.25,Tb:158.93,Dy:162.50,Ho:164.93,Er:167.26,Tm:168.93,Yb:173.04,Lu:174.97,Sc:44.96,Y:88.91,O:15.999,H:1.008,F:18.998,Cl:35.453,N:14.007,C:12.011};
    let M=0;
    const matches=f.match(/([A-Z][a-z]?)(\d*)/g)||[];
    matches.forEach(m=>{
      const p=m.match(/([A-Z][a-z]?)(\d*)/);
      if(p&&atoms[p[1]]){M+=atoms[p[1]]*(parseInt(p[2])||1);}
    });
    result=`Formule : ${f}\nMasse molaire M = ${M.toFixed(2)} g/mol`;
    formula='M = Î£ (n_i Ã— M_atomique_i)';
  }else if(type==='enrichissement'){
    const C=parseFloat(document.getElementById('c1').value),Cl=parseFloat(document.getElementById('c2').value);
    const FE=(C/Cl).toFixed(2);
    result=`C_Ã©chantillon = ${C} ppm\nC_clarke = ${Cl} ppm\nFacteur d'enrichissement FE = ${FE}\n${FE>10?'â†’ Gisement significatif (FE > 10)':FE>3?'â†’ Enrichissement notable':FE<1?'â†’ Appauvrissement':'â†’ Teneur proche clarke'}`;
    formula='FE = C_Ã©ch / C_clarke';
  }else if(type==='constante'){
    const ln=document.getElementById('c1').value,lig=document.getElementById('c2').value;
    const logK={La:{EDTA:'15.36',DTPA:'19.48'},Ce:{EDTA:'16.00',DTPA:'20.50'},Nd:{EDTA:'16.61',DTPA:'21.60'},Eu:{EDTA:'17.37',DTPA:'22.39'},Gd:{EDTA:'17.40',DTPA:'22.46'},Dy:{EDTA:'18.30',DTPA:'22.83'},Lu:{EDTA:'19.83',DTPA:'22.44'}};
    const lk=(logK[ln]&&logK[ln][lig])||'â€”';
    result=`Complexe : [${ln}(${lig})]^(3-n)+\nlog Î² = ${lk}\nK_stab = 10^${lk} M^-n\nâ†’ StabilitÃ© augmente Laâ†’Lu (contraction lanthanidique)`;
    formula='log Î² = log([LnLâ‚™]/([LnÂ³âº]Â·[L]â¿))';
  }else if(type==='moment'){
    const n=parseInt(document.getElementById('c1').value);
    const J_map={0:0,1:2.54,2:3.58,3:3.62,4:2.68,5:0.85,6:3.40,7:7.94,8:9.72,9:10.63,10:10.60,11:9.59,12:7.57,13:4.54,14:0};
    const mu=J_map[n]||0;
    result=`Ã‰lectrons 4f : ${n}\nÎ¼â‚‘ff (Van Vleck) = ${mu} Î¼B\n${mu===0?'DiamagnÃ©tique':'ParamagnÃ©tique â€” ordre : '+(['La','Ce','Pr','Nd','Pm','Sm','Eu','Gd','Tb','Dy','Ho','Er','Tm','Yb','Lu'][n]||'?')}`;
    formula='Î¼â‚‘ff = g_J âˆš[J(J+1)] Î¼B\ng_J = facteur de LandÃ©';
  }else if(type==='contraction'){
    const Z=parseInt(document.getElementById('c1').value);
    const r=IONIC_RADII[Z];
    const Zs=Object.keys(IONIC_RADII).map(Number).sort();
    result=r?`Z = ${Z} | r(MÂ³âº) = ${r} pm\nContraction depuis La (103 pm) : Î”r = ${(103-r).toFixed(1)} pm\nRationale : blindage 4f inefficace â†’ Zeffâ†‘ â†’ atomes se contractent.`:`Z ${Z} non disponible.`;
    formula='r_MÂ³âº = f(Z) â€” Contraction lanthanidique\n(103 pm â†’ 86 pm : LaÂ³âº â†’ LuÂ³âº)';
  }else if(type==='rendement'){
    const C0=parseFloat(document.getElementById('c1').value);
    const C1=parseFloat(document.getElementById('c2').value);
    const D=parseFloat(document.getElementById('c3').value);
    const E=((C0-C1)/C0*100).toFixed(1);
    const D_calc=((C0-C1)/C1).toFixed(2);
    result=`Câ‚€ = ${C0} g/L | Câ‚ = ${C1} g/L\nRendement extraction : E = ${E}%\nD calculÃ© = ${D_calc}\nPhases nÃ©cessaires (99%) : n = ${Math.ceil(Math.log(100)/Math.log(1+D))}`;
    formula='E = (Câ‚€-Câ‚)/Câ‚€ Ã— 100\nD = [MÃ©tal]org/[MÃ©tal]aq';
  }
  document.getElementById('calc-result').textContent=result;
  document.getElementById('calc-formula').textContent=formula;
}
function clearCalc(){
  document.getElementById('calc-result').textContent='Configurez les paramÃ¨tres...';
  document.getElementById('calc-formula').textContent='â€”';
}

// â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•
const QUIZ_BANK={
  general:[
    {q:'Combien y a-t-il d\'Ã©lÃ©ments chimiques classifiÃ©s comme "terres rares" officiellement ?',opts:['15','17','19','14'],ans:1,exp:'Les 17 TR = 15 lanthanides (La Ã  Lu) + Sc + Y. Le terme "terres rares" est donc lÃ©gÃ¨rement trompeur car ils sont 17 et pas si rares gÃ©ochimiquement.'},
    {q:'Quel est l\'Ã©tat d\'oxydation le plus commun pour tous les lanthanides ?',opts:['+II','+III','+IV','+V'],ans:1,exp:'+III est universel pour tous les lanthanides. Ceâ´âº (ceria CeOâ‚‚) et EuÂ²âº sont des exceptions notables mais instables ou particuliÃ¨res.'},
    {q:'Le phÃ©nomÃ¨ne de "contraction lanthanidique" signifie que le rayon ionique MÂ³âº :',opts:['Augmente de La Ã  Lu','Diminue de La Ã  Lu','Reste constant','Oscille'],ans:1,exp:'Le rayon MÂ³âº diminue de 103 pm (LaÂ³âº) Ã  86 pm (LuÂ³âº). Cause : les Ã©lectrons 4f blindent mal la charge nuclÃ©aire â†’ Zeff augmente â†’ atome se contracte.'},
    {q:'Quel minÃ©ral est la principale source de LREE (terres rares lÃ©gÃ¨res) dans le monde ?',opts:['XÃ©notime','Coltan','BastnÃ¤site','Spessartine'],ans:2,exp:'La bastnÃ¤site (CeCOâ‚ƒF) est le minÃ©ral le plus exploitÃ© pour les LREE. Le gisement de Bayan Obo (Chine) en contient de grandes quantitÃ©s.'},
    {q:'Quel pays produit environ 68% des terres rares mondiales (2023) ?',opts:['USA','Australie','Russie','Chine'],ans:3,exp:'La Chine domine avec ~68% de la production mondiale (2023), principalement via Bayan Obo (LREE) et les "ion adsorption clays" du sud (HREE).'},
    {q:'Quel lanthanide a la configuration 4fâ· (demi-remplie) confÃ©rant une stabilitÃ© particuliÃ¨re ?',opts:['Eu','Tb','Gd','Nd'],ans:2,exp:'Gd (Z=64) : [Xe]4fâ·5dÂ¹6sÂ². La demi-couche 4fâ· est particuliÃ¨rement stable. GdÂ³âº possÃ¨de le plus grand moment magnÃ©tique des lanthanides libres (7 Ã©lectrons non appariÃ©s).'},
    {q:'Les HREE (terres rares lourdes) sont principalement extraites de quel type de gisement en Chine ?',opts:['BastnÃ¤site','Monazite','XÃ©notime','Ion adsorption clays (argiles)'],ans:3,exp:'Les ion adsorption clays (argiles d\'adsorption ionique) du sud de la Chine sont la principale source de HREE. Les TRÂ³âº sont adsorbÃ©es sur les argiles et extraites par lixiviation (NHâ‚„)â‚‚SOâ‚„.'},
    {q:'Quel lanthanide radioactif n\'a aucun isotope stable ?',opts:['Eu','Pm','Sm','Tb'],ans:1,exp:'Le promÃ©thium (Pm, Z=61) est le seul lanthanide sans isotope stable. Â¹â´â·Pm (tâ‚/â‚‚ = 2.62 ans) est un produit de fission. Pas d\'occurrence naturelle significative.'},
  ],
  proprietes:[
    {q:'La configuration Ã©lectronique du NdÂ³âº (nÃ©odyme) est :',opts:['[Xe]4fÂ³','[Xe]4fâ´','[Kr]4fÂ³','[Xe]4fÂ³5dÂ¹'],ans:0,exp:'Nd (Z=60) : [Xe]4fâ´6sÂ². En perdant 3 Ã©lectrons â†’ NdÂ³âº : [Xe]4fÂ³. Les 3 Ã©lectrons retirÃ©s viennent d\'abord de 5d et 6s, laissant 4f intact.'},
    {q:'Pourquoi EuÂ²âº est-il l\'Ã©tat +II le plus stable parmi les lanthanides ?',opts:['Rayon le plus grand','Configuration 4fâ· (demi-remplie)','Potentiel redox favorable','Configuration 4fâ¶ (demi-remplie)'],ans:1,exp:'EuÂ²âº a la configuration [Xe]4fâ· â€” demi-couche remplie, particuliÃ¨rement stable. C\'est la mÃªme raison pour laquelle GdÂ³âº (aussi 4fâ·) est trÃ¨s stable.'},
    {q:'Le potentiel standard EÂ°(MÂ³âº/M) des lanthanides est en gÃ©nÃ©ral :',opts:['TrÃ¨s nÃ©gatif (< -2 V)','LÃ©gÃ¨rement nÃ©gatif (-0.5 Ã  -1 V)','Positif (> +1 V)','Proche de 0 V'],ans:0,exp:'EÂ° â‰ˆ -2.0 Ã  -2.4 V pour la plupart des lanthanides, confirmant leur caractÃ¨re fortement rÃ©ducteur. Les mÃ©taux TR brÃ»lent dans l\'air humide et rÃ©agissent avec l\'eau.'},
    {q:'Le moment magnÃ©tique effectif Î¼â‚‘ff de GdÂ³âº est approximativement :',opts:['3.5 Î¼B','5.9 Î¼B','7.94 Î¼B','10.6 Î¼B'],ans:2,exp:'GdÂ³âº ([Xe]4fâ·) : S=7/2, L=0, J=7/2, g=2. Î¼â‚‘ff = gâˆš[J(J+1)] = 2âˆš(7/2Â·9/2) = 7.94 Î¼B. Maximum parmi les ions lanthanides libres.'},
    {q:'La "sous-couche 4f" des lanthanides est caractÃ©risÃ©e par :',opts:['Grande extension spatiale, bon blindage','Faible extension, mauvais blindage â†’ contraction'],ans:1,exp:'Les orbitales 4f sont trÃ¨s contractÃ©es et blindÃ©es par 5s, 5p. Elles blindent elles-mÃªmes trÃ¨s peu la charge nuclÃ©aire â†’ Zeff augmente de La Ã  Lu â†’ contraction lanthanidique.'},
  ],
  complexes:[
    {q:'Le nombre de coordination le plus frÃ©quent des lanthanides en solution aqueuse est :',opts:['4','6','8â€“9','12'],ans:2,exp:'Les LREE forment [Ln(Hâ‚‚O)â‚‰]Â³âº (NC=9) et les HREE [Ln(Hâ‚‚O)â‚ˆ]Â³âº (NC=8) en raison de la contraction lanthanidique (rayon plus petit = moins de ligands autour).'},
    {q:'Pourquoi les complexes de TR sont-ils principalement ioniques ?',opts:['Ã‰lectrons 4f trÃ¨s Ã©tendus','Ã‰lectrons 4f contractÃ©s et peu disponibles au recouvrement','Haute covalence des liaisons Ln-O','Forte electronÃ©gativitÃ© des TR'],ans:1,exp:'Les orbitales 4f sont blindÃ©es par les couches 5s et 5p â†’ peu de recouvrement avec les orbitales des ligands â†’ liaison quasi-purement ionique (Ã©lectrostatique). DiffÃ©rence fondamentale avec les mÃ©taux de transition 3d.'},
    {q:'Quel complexe de Gd est utilisÃ© comme agent de contraste en IRM clinique ?',opts:['[Gd(EDTA)]â»','[Gd(DTPA)]Â²â» (Magnevist)','[Gd(acac)â‚ƒ]','[Gd(Hâ‚‚O)â‚‰]Â³âº'],ans:1,exp:'Gd-DTPA (MagnevistÂ®, 1988) : 1er agent de contraste IRM TR approuvÃ©. NC=8+1 eau (q=1). La relaxivitÃ© râ‚=4.3 mMâ»Â¹sâ»Â¹ amÃ©liore le contraste T1. > 30 millions d\'injections/an.'},
    {q:'Pourquoi la stabilitÃ© des complexes Ln-EDTA augmente-t-elle de La Ã  Lu ?',opts:['Plus d\'Ã©lectrons 4f','Rayon ionique plus grand','Rayon ionique plus petit â†’ charge/rayon plus Ã©levÃ©','Meilleure covalence'],ans:2,exp:'Contraction lanthanidique : r(MÂ³âº) diminue Laâ†’Lu â†’ le rapport charge/rayon (densitÃ© de charge) augmente â†’ interaction Ã©lectrostatique Ln-ligand plus forte â†’ log K augmente (15.4 pour La Ã  19.8 pour Lu).'},
  ],
  extraction:[
    {q:'Lors de la lixiviation de la bastnÃ¤site par HCl, quel gaz dangereux est dÃ©gagÃ© ?',opts:['Clâ‚‚','HF','Hâ‚‚S','SOâ‚‚'],ans:1,exp:'CeCOâ‚ƒF + 2HCl â†’ CeClâ‚ƒ + COâ‚‚ + HFâ†‘. L\'ion fluorure de la bastnÃ¤site rÃ©agit avec Hâº pour former HF gazeux â€” trÃ¨s toxique et corrosif. Neutralisation immÃ©diate requise (Ca(OH)â‚‚).'},
    {q:'Qu\'est-ce que le procÃ©dÃ© "SX" dans l\'extraction des TR ?',opts:['StÃ©rilisation par rayons X','Extraction par solvants (solvent extraction)','Sublimation-Xylol','SÃ©chage XÃ©non'],ans:1,exp:'SX = Solvent Extraction = extraction liquide-liquide. Le mÃ©tal est transfÃ©rÃ© d\'une phase aqueuse vers une phase organique (solvant extractant : D2EHPA, EHEHPA). NÃ©cessite des dizaines d\'Ã©tapes pour sÃ©parer des TR trÃ¨s proches.'},
    {q:'Quel est le principal avantage des "ion adsorption clays" pour l\'extraction des HREE ?',opts:['Teneur trÃ¨s Ã©levÃ©e','TrÃ¨s faible radioactivitÃ© et extraction douce','PrÃ©sence d\'LREE uniquement','Extraction Ã  chaud (> 300Â°C)'],ans:1,exp:'IAC : trÃ¨s faible radioactivitÃ© (Th/U traces), extraction par lixiviation douce Ã  (NHâ‚„)â‚‚SOâ‚„ â€” pas besoin d\'acides forts. Principale source de HREE (Dy, Tb, Eu) malgrÃ© des teneurs trÃ¨s basses (0.05â€“0.2%).'},
    {q:'Pourquoi la monazite prÃ©sente-t-elle un dÃ©fi environnemental particulier ?',opts:['Trop peu de TR','Forte teneur en uranium et thorium radioactifs','Minerai trop mou','PrÃ©sence de mÃ©taux de transition'],ans:1,exp:'La monazite [(La,Ce,Th)POâ‚„] contient naturellement du Th (0.1â€“10%) et parfois U â†’ matiÃ¨re nuclÃ©aire. Les rÃ©sidus de traitement sont radioactifs et nÃ©cessitent un stockage long terme contrÃ´lÃ©.'},
  ],
  applications:[
    {q:'Quel lanthanide est INDISPENSABLE aux aimants NdFeB les plus performants ?',opts:['Sm','Eu','Nd (et Pr)','Gd'],ans:2,exp:'Ndâ‚‚Feâ‚â‚„B = formule de base. Nd et Pr sont les lanthanides principaux (>75%). Dy et Tb sont ajoutÃ©s pour amÃ©liorer la coercitivitÃ© Ã  TÂ° Ã©levÃ©e (moteurs VE, Ã©oliennes).'},
    {q:'L\'EDFA (amplificateur Ã  fibre optique) utilise quel ion TR pour amplifier le signal tÃ©lÃ©com Ã  1550 nm ?',opts:['NdÂ³âº','ErÂ³âº','YbÂ³âº','CeÂ³âº'],ans:1,exp:'ErÂ³âº dans fibre de silice dopÃ©e : transition â´Iâ‚â‚ƒ/â‚‚â†’â´Iâ‚â‚…/â‚‚ Ã  1550 nm = fenÃªtre de transparence des fibres silice. L\'EDFA est la technologie de base d\'Internet mondial.'},
    {q:'Quel agent de contraste IRM contenant du Gd est le plus utilisÃ© cliniquement ?',opts:['Gd-EDTA','Gd-DTPA (Magnevist)','GdClâ‚ƒ','Gd-acac'],ans:1,exp:'Gd-DTPA (MagnevistÂ®) : approuvÃ© FDA 1988. GdÂ³âº (4fâ·) raccourcit T1 des protons voisins â†’ rehaussement en IRM T1. Attention : nÃ©phrogÃ¨ne en cas d\'insuffisance rÃ©nale.'},
    {q:'La LED blanche moderne repose sur quel luminophore clÃ© ?',opts:['EuÂ³âº:Yâ‚‚Oâ‚ƒ','TbÂ³âº:LaPOâ‚„','CeÂ³âº:YAG','NdÂ³âº:LaFâ‚ƒ'],ans:2,exp:'CeÂ³âº:YAG (Yâ‚ƒAlâ‚…Oâ‚â‚‚ dopÃ© CeÂ³âº) convertit la lumiÃ¨re bleue (450 nm, puce InGaN) en jaune large â†’ mÃ©lange = blanc. Base de la rÃ©volution LED (Nobel 2014). EfficacitÃ© > 100 lm/W.'},
    {q:'Quel alliage prÃ©sente la plus grande magnÃ©tostriction Ã  tempÃ©rature ambiante ?',opts:['Ndâ‚‚Feâ‚â‚„B','Terfenol-D (TbFeâ‚‚/DyFeâ‚‚)','SmCoâ‚…','Alnico'],ans:1,exp:'Terfenol-D = Tbâ‚€.â‚ƒDyâ‚€.â‚‡Feâ‚‚ : magnÃ©tostriction ~2000 ppm Ã  TÂ° ambiante (record). Applications : actionneurs de haute prÃ©cision, sonar sous-marin (DARPA), capteurs.'},
  ],
  mixed:[
    {q:'La "transition de Mott" dans les composÃ©s de TR fait rÃ©fÃ©rence Ã  :',opts:['Passage mÃ©tal-isolant','Contraction lanthanidique','MagnÃ©tisation Ã  Tc','pH de prÃ©cipitation'],ans:0,exp:'Transition mÃ©tal-isolant : certains composÃ©s TR (SmS, TmSe) sont isolants Ã  P ambiante et deviennent conducteurs sous pression (collapse de la bande 4fâ†’5d).'},
    {q:'Quel aimant TR supporte mieux les hautes tempÃ©ratures (Tc > 700Â°C) ?',opts:['NdFeB (Tc=585 K)','SmCoâ‚… (Tc=1003 K)','Smâ‚‚Coâ‚â‚‡ (Tc=1073 K)','Ferrite Ba (Tc=723 K)'],ans:2,exp:'Smâ‚‚Coâ‚â‚‡ a la plus haute Tc (~800Â°C). SmCoâ‚… aussi excellent. NdFeB est limitÃ© Ã  Tc=312Â°C. Pour aÃ©ronautique et applications haute TÂ°, SmCo est prÃ©fÃ©rÃ©.'},
    {q:'En sÃ©paration par SX des TR, pourquoi faut-il de nombreux Ã©tages ?',opts:['TR trÃ¨s diffÃ©rentes entre elles','TR trÃ¨s similaires â€” faible sÃ©lectivitÃ© (D â‰ˆ 1.5â€“3)','SX inefficace pour TR','TR ne s\'extraient pas organiquement'],ans:1,exp:'Les TR ont des propriÃ©tÃ©s trÃ¨s proches (rayon, charge identiques) â†’ le facteur de sÃ©paration Î± entre deux TR adjacentes est faible (1.5â€“3). Il faut 20â€“50 Ã©tages de mÃ©langeurs-dÃ©canteurs pour une puretÃ© >99.9%.'},
    {q:'L\'isotope Â¹â·â·Lu (Lu-177) est utilisÃ© en mÃ©decine nuclÃ©aire pour :',opts:['Imagerie PET','RadiothÃ©rapie ciblÃ©e (rÃ©cepteurs sst2)','Contraste IRM','Scintillation'],ans:1,exp:'Lu-177 Ã©met Î²â» (E=0.5 MeV) + Î³ (208 keV). CouplÃ© au DOTA-TATE (analogue somatostatine), il cible les rÃ©cepteurs sst2 des tumeurs neuroendocrines. LutatheraÂ® approuvÃ© FDA 2018.'},
    {q:'La spectroscopie de luminescence des complexes EuÂ³âº est particuliÃ¨rement utile pour :',opts:['Mesurer le pH','DÃ©terminer le nombre de molÃ©cules d\'eau coordinÃ©es (q)','Calculer la masse molaire','Analyser les impuretÃ©s de Fe'],ans:1,exp:'La durÃ©e de vie Ï„ de âµDâ‚€ d\'EuÂ³âº varie selon le nombre de OH oscillateurs (eau coordinÃ©e). q = A_Eu Ã— (1/Ï„_Hâ‚‚O - 1/Ï„_Dâ‚‚O). MÃ©thode standard pour dÃ©terminer q des complexes Ln en solution.'},
  ]
};
let quizQ=[],quizCurr=0,quizScore=0;
function startQuiz(){
  const cat=document.getElementById('quizCat').value;
  const lvl=document.getElementById('quizLevel').value;
  const n=parseInt(document.getElementById('quizCount').value);
  const pool=cat==='mixed'?Object.values(QUIZ_BANK).flat():(QUIZ_BANK[cat]||[]);
  quizQ=[];
  const shuffled=[...pool].sort(()=>Math.random()-.5);
  quizQ=shuffled.slice(0,Math.min(n,shuffled.length));
  quizCurr=0;quizScore=0;
  document.getElementById('quiz-score').textContent='0 / 0';
  document.getElementById('quiz-pct').textContent='â€”';
  document.getElementById('score-bar').style.width='0%';
  renderQuizQ();
}
function renderQuizQ(){
  if(quizCurr>=quizQ.length){
    const pct=(quizScore/quizQ.length*100).toFixed(0);
    document.getElementById('quiz-area').innerHTML=`<div style="text-align:center;padding:30px;"><div style="font-family:'Fraunces',serif;font-size:1.5rem;color:var(--p1);margin-bottom:10px;">ğŸ“ Quiz terminÃ© !</div><div style="font-size:1.2rem;margin-bottom:14px;">Score final : <b style="color:var(--p1);">${quizScore} / ${quizQ.length}</b> (${pct}%)</div><div style="font-size:.9rem;color:var(--muted);">${pct>=85?'ğŸŒŸ Excellent ! MaÃ®trise solide.':pct>=70?'âœ… Bon niveau. Quelques points Ã  revoir.':pct>=50?'ğŸ“š Bases prÃ©sentes. RÃ©visez la thÃ©orie.':'ğŸ”„ Reprenez le cours depuis la thÃ©orie.'}</div><button onclick="startQuiz()" class="btn btn-p" style="width:auto;padding:9px 24px;margin-top:16px;">ğŸ”„ Nouveau quiz</button></div>`;
    return;
  }
  const q=quizQ[quizCurr];
  const qn=quizCurr+1;
  document.getElementById('quiz-area').innerHTML=`<div class="quiz-card">
    <div style="font-size:.65rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">QUESTION ${qn} / ${quizQ.length}</div>
    <div class="quiz-q">${q.q}</div>
    <div class="quiz-opts">${q.opts.map((o,i)=>`<button class="quiz-opt" onclick="answerQ(${i})">${String.fromCharCode(65+i)}. ${o}</button>`).join('')}</div>
    <div class="quiz-feedback" id="qf"></div>
  </div>`;
}
function answerQ(i){
  const q=quizQ[quizCurr];
  const correct=(i===q.ans);
  if(correct)quizScore++;
  sessionStats.quizTotal++;
  if(correct)sessionStats.quizCorrect++;
  document.querySelectorAll('.quiz-opt').forEach((b,j)=>{
    b.disabled=true;
    if(j===q.ans)b.classList.add('correct');
    else if(j===i&&!correct)b.classList.add('wrong');
  });
  const fb=document.getElementById('qf');
  fb.className='quiz-feedback show '+(correct?'qf-c':'qf-w');
  fb.innerHTML=(correct?'âœ… <b>Correct !</b> ':'âŒ <b>Incorrect.</b> ')+q.exp;
  const sc=document.getElementById('quiz-score');
  sc.textContent=`${quizScore} / ${quizCurr+1}`;
  const pct=(quizScore/(quizCurr+1)*100).toFixed(0);
  document.getElementById('quiz-pct').textContent=pct+'%';
  document.getElementById('score-bar').style.width=pct+'%';
  updateSessionStats();
  setTimeout(()=>{quizCurr++;renderQuizQ();},2800);
}

// â•â•â•â•â•â•â• THÃ‰ORIE â•â•â•â•â•â•â•
const THEORY_CARDS=[
  {lvl:'lv-l1',t:'L1',title:'Introduction aux Terres Rares',content:'Les <b>terres rares (TR)</b> regroupent 17 Ã©lÃ©ments : les 15 lanthanides (Laâ€“Lu, Z=57â€“71) + Sc (Z=21) + Y (Z=39). Leur nom est trompeur : ils ne sont pas si rares (Nd aussi abondant que Cu). Leur Ã©tat d\'oxydation dominant est <b>+III</b> pour tous.',formula:'[Xe] 4f^n 5d^0-1 6sÂ²  (n = 0 Ã  14)',extra:'Classification : LREE (Laâ€“Eu) lÃ©gÃ¨res | HREE (Gdâ€“Lu + Y) lourdes'},
  {lvl:'lv-l1',t:'L1',title:'Tableau PÃ©riodique & Position des TR',content:'Les lanthanides occupent la <b>sÃ©rie 4f</b> du tableau pÃ©riodique (pÃ©riode 6). Sc et Y sont en groupe 3 (3dÂ¹ et 4dÂ¹). La structure Ã©lectronique [Xe]4f^n est responsable de leurs propriÃ©tÃ©s similaires â†’ difficultÃ©s de sÃ©paration (SX multiple).',formula:'Configuration : [Xe] 4f^n 6sÂ² (La : n=0, Ce : n=1... Lu : n=14)',extra:'Contraction lanthanidique : r(MÂ³âº) = 103 pm (La) â†’ 86 pm (Lu)'},
  {lvl:'lv-l1',t:'L1',title:'Gisements & Production Mondiale',content:'Sources principales : <b>BastnÃ¤site</b> (CeCOâ‚ƒF, LREE, Bayan Obo), <b>Monazite</b> (LREE+Th), <b>XÃ©notime</b> (HREE, YPOâ‚„), <b>Ion Adsorption Clays</b> (HREE, sud Chine). La Chine domine Ã  68% de la production (2023).',formula:'LREE : La, Ce, Pr, Nd, (Pm), Sm, Eu\nHREE : Gd, Tb, Dy, Ho, Er, Tm, Yb, Lu, Y',extra:'Enjeux gÃ©opolitiques : criticitÃ©, dÃ©pendance, recyclage < 1%'},
  {lvl:'lv-l2',t:'L2',title:'Contraction Lanthanidique',content:'De La Ã  Lu, le rayon ionique MÂ³âº <b>diminue</b> de 103 Ã  86 pm. Cause : mauvais blindage des Ã©lectrons 4f â†’ Zeff augmente rÃ©guliÃ¨rement. ConsÃ©quences : LnÂ³âº tardifs sont plus petits, forment des complexes plus stables, propriÃ©tÃ©s chimiques similaires Ã  Y.',formula:'Zeff = Z - Ïƒ (Ïƒ = constante de blindage 4f < 5sÂ²5pâ¶)',extra:'Effet direct : Hf (4fÂ¹â´) â‰ˆ mÃªme rayon que Zr (mÃªme groupe) â†’ sÃ©paration trÃ¨s difficile'},
  {lvl:'lv-l2',t:'L2',title:'PropriÃ©tÃ©s Ã‰lectroniques & MagnÃ©tiques',content:'La sous-couche 4f est trÃ¨s contractÃ©e â†’ faible recouvrement â†’ propriÃ©tÃ©s <b>ioniques</b>. Moment magnÃ©tique : Î¼â‚‘ff = g_Jâˆš[J(J+1)] Î¼B. GdÂ³âº (4fâ·) : Î¼ = 7.94 Î¼B (max). EuÂ³âº, LaÂ³âº, LuÂ³âº : diamagnÃ©tiques.',formula:'Î¼â‚‘ff (Gd) = 7.94 Î¼B\nÎ¼â‚‘ff (Dy) = 10.63 Î¼B (le + grand)',extra:'Applications : IRM (Gd), aimants NdFeB, magnÃ©tostriction (Tb,Dy)'},
  {lvl:'lv-l2',t:'L2',title:'Chimie de Coordination des TR',content:'Liaisons essentiellement <b>ioniques</b>. NC Ã©levÃ©s : 6 Ã  12, le + frÃ©quent 8â€“9. LREE â†’ NC=9, HREE â†’ NC=8. StabilitÃ© complexes augmente Laâ†’Lu (contraction lanthanidique). Ligands prÃ©fÃ©rÃ©s : O-donneurs (durs).',formula:'log Î²(La-EDTA) = 15.36  |  log Î²(Lu-EDTA) = 19.83\n[Gd(DTPA)(Hâ‚‚O)]Â²â» â†’ IRM clinique (MagnevistÂ®)',extra:'Ligands "antennes" : phen, acac â†’ luminescence TR (transfert Ã©nergÃ©tique)'},
  {lvl:'lv-l2',t:'L2',title:'ProcÃ©dÃ© d\'Extraction (SX)',content:'Extraction par solvants (liquid-liquid extraction). Extractants : <b>D2EHPA, EHEHPA, Cyanex 572</b>. Le facteur de sÃ©paration Î± entre TR adjacentes est faible (1.5â€“3) â†’ besoin de <b>30â€“50 Ã©tages</b> pour puretÃ© > 99.9%. SÃ©parer Nd/Pr reste le plus difficile.',formula:'D = [Ln]org / [Ln]aq\nÎ± = D_Ln1 / D_Ln2 (faible!)',extra:'Ordre extraction D2EHPA : Lu > Yb > ... > La (inverse LREE â†’ HREE)'},
  {lvl:'lv-l3',t:'L3',title:'Luminescence des TR â€” Niveaux 4f',content:'Ã‰missions 4fâ†’4f : <b>raies fines</b> (transitions Ã©crantÃ©es â†’ insensibles Ã  la matrice). EuÂ³âº : âµDâ‚€â†’â·Fâ‚‚ (615 nm, rouge). TbÂ³âº : âµDâ‚„â†’â·Fâ‚… (545 nm, vert). Up-conversion ErÂ³âº/YbÂ³âº : NIRâ†’visible. DurÃ©e de vie Ï„=ms (longue comparÃ©e aux fluorophores organiques).',formula:'QY(EuÂ³âº:Yâ‚‚Oâ‚ƒ) > 90% | Ï„ = 1â€“3 ms\nCeÂ³âº:YAG â†’ LED blanche (Nobel 2014)',extra:'q = A_Eu(1/Ï„_Hâ‚‚O - 1/Ï„_Dâ‚‚O) â†’ nb d\'eau coordinÃ©es'},
  {lvl:'lv-l3',t:'L3',title:'Aimants TR â€” NdFeB & SmCo',content:'<b>Ndâ‚‚Feâ‚â‚„B</b> : aimant permanent le plus puissant (BHmax=512 kJ/mÂ³, Tc=312Â°C). <b>SmCoâ‚…/Smâ‚‚Coâ‚â‚‡</b> : hautes tempÃ©ratures (Tc=730â€“800Â°C). Ajout Dy/Tb dans NdFeB â†’ amÃ©liore coercitivitÃ© Ã  TÂ° Ã©levÃ©e. CriticitÃ© : Dy et Tb pour VE/Ã©oliennes.',formula:'Ndâ‚‚Feâ‚â‚„B : structure P4â‚‚/mnm, 4 atomes Nd/maille\nBHmax = Â¼Î¼â‚€MÂ²_s (thÃ©orie)',extra:'1 VE = 2 kg Nd/Pr | 1 MW Ã©olien = 650 kg aimants NdFeB'},
];
function initTheory(){
  const g=document.getElementById('theory-grid');
  if(g.children.length>0)return;
  g.innerHTML=THEORY_CARDS.map(c=>`<div class="thy-card"><span class="lvl-tag lv-${c.lvl.split('-')[1]}">${c.t.toUpperCase()}</span><h3>${c.title}</h3><p style="margin-bottom:7px;">${c.content}</p><div class="fbox">${c.formula}</div><p style="margin-top:6px;font-size:.72rem;color:var(--p2);">${c.extra}</p></div>`).join('');
}

// â•â•â•â•â•â•â• RAPPORT â•â•â•â•â•â•â•
function generateReport(){
  const now=new Date();
  const elmSel=document.getElementById('propSel');const elmName=elmSel.options[elmSel.selectedIndex]?.text||'Non Ã©tudiÃ©';
  const magSel=document.getElementById('magSel');const magName=magSel.options[magSel.selectedIndex]?.text||'Non Ã©tudiÃ©';
  const lumiSel=document.getElementById('lumiSel');const lumiName=lumiSel.options[lumiSel.selectedIndex]?.text||'Non Ã©tudiÃ©';
  document.getElementById('rpt-content').textContent=`â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         SIMUTR v1.0 â€” RAPPORT DE SÃ‰ANCE                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  Nom       : Edmond Atinzoun TCHOKPON
  Programme : Licence Physique-Chimie
  Date      : ${now.toLocaleDateString('fr-FR')} | ${now.toLocaleTimeString('fr-FR')}
  Outil     : SimuTR v1.0 â€” Chimie des Terres Rares
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  Ã‰LÃ‰MENTS Ã‰TUDIÃ‰S (Tableau PÃ©riodique)
    â†’ Dernier Ã©lÃ©ment : ${elmName}
  COMPLEXE Ã‰TUDIÃ‰
    â†’ ${document.getElementById('complexLn').value}-${document.getElementById('complexLig').value} (solvant : ${document.getElementById('complexSolv').value})
  MAGNÃ‰TISME
    â†’ ComposÃ© : ${magName}
    â†’ TÂ° analysÃ©e : ${document.getElementById('magTemp').value}Â°C
  LUMINESCENCE
    â†’ Ion Ã©tudiÃ© : ${lumiName}
    â†’ Matrice : ${document.getElementById('lumiMatrix').value}
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  QUIZ & Ã‰VALUATION
    â†’ Score session : ${sessionStats.quizCorrect} / ${sessionStats.quizTotal}
    â†’ Pourcentage : ${sessionStats.quizTotal>0?(sessionStats.quizCorrect/sessionStats.quizTotal*100).toFixed(0):'â€”'}%
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  MODULES COUVERTS
  âœ“ Tableau PÃ©riodique (17 Ã©lÃ©ments TR)
  âœ“ PropriÃ©tÃ©s 4f (configs. Ã©lectroniques, Î¼â‚‘ff)
  âœ“ Complexes & Coordination (NC 6â€“12)
  âœ“ Gisements mondiaux (6 sites)
  âœ“ ProcÃ©dÃ©s Extraction (4 minerais)
  âœ“ Applications Industrielles (8 domaines)
  âœ“ MagnÃ©tisme TR (NdFeB, SmCo, Gd)
  âœ“ Luminescence (9 ions, spectre)
  âœ“ Calculateur (6 types)
  âœ“ Quiz (${sessionStats.quizTotal} questions)
  âœ“ Fiches ThÃ©orie (9 fiches L1/L2/L3)
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  CONCLUSION
  SÃ©ance rÃ©alisÃ©e sur SimuTR v1.0 dans le cadre des Ã©tudes
  de Chimie des Terres Rares en Licence Physique-Chimie.
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
}

// â•â•â•â•â•â•â• STATUT â•â•â•â•â•â•â•
function setStatus(t){document.getElementById('stext').textContent=t;}
function updateClock(){document.getElementById('sclock').textContent=new Date().toLocaleTimeString('fr-FR');}
setInterval(updateClock,1000);updateClock();

// â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded',()=>{
  drawContractionChart();
  showPropElement();
  initMines();
  loadExtraction();
  initApps();
  showMagnetism();
  showLuminescence();
  showComplex();
  updateCalcUI();
  initTheory();
  setStatus('SimuTR v1.0 chargÃ© â€” Bienvenue, Edmond Atinzoun TCHOKPON');
  setTimeout(()=>setStatus('PrÃªt â€” Explorez les terres rares'),3000);
});
</script>
</body>
</html>
