<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SimuOrg v2.0 ‚Äî Chimie Organique | Edmond Atinzoun TCHOKPON</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,700;1,9..144,400&family=Fira+Code:wght@400;500;600&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f7f3ee;--ink:#1c1410;--panel:#ffffff;--panel2:#f0ebe2;
  --p1:#2d6a4f;--p2:#b5451b;--p3:#1d3557;--p4:#9b2226;--p5:#606c38;
  --gold:#d4a017;--muted:#7a6f64;--border:#ddd5c8;--light:#faf7f2;
  --shadow:rgba(28,20,16,0.1);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--ink);font-family:'Manrope',sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
}
header{position:relative;z-index:10;background:linear-gradient(135deg,var(--p1) 0%,#1e4d38 100%);border-bottom:3px solid var(--gold);padding:12px 22px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 24px rgba(45,106,79,.35);}
.logo{display:flex;align-items:center;gap:13px;}
.logo-hex{width:46px;height:46px;background:var(--gold);clip-path:polygon(50% 0%,93.3% 25%,93.3% 75%,50% 100%,6.7% 75%,6.7% 25%);display:flex;align-items:center;justify-content:center;font-size:19px;animation:hexPulse 4s ease-in-out infinite;}
@keyframes hexPulse{0%,100%{box-shadow:0 0 20px rgba(212,160,23,.5)}50%{box-shadow:0 0 40px rgba(212,160,23,.9)}}
.logo-text h1{font-family:'Fraunces',serif;font-size:1.6rem;font-weight:700;color:white;letter-spacing:3px;}
.logo-text p{font-size:.58rem;color:rgba(255,255,255,.6);letter-spacing:2px;font-family:'Fira Code',monospace;}
.header-right{display:flex;align-items:center;gap:9px;}
.author-tag{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.25);border-radius:8px;padding:6px 13px;text-align:right;}
.author-tag .n{font-family:'Fraunces',serif;font-size:.83rem;font-weight:700;color:var(--gold);}
.author-tag .i{font-size:.56rem;color:rgba(255,255,255,.55);font-family:'Fira Code',monospace;letter-spacing:1px;}
.hbtn{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.3);color:white;border-radius:6px;padding:6px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.76rem;letter-spacing:.8px;transition:all .2s;}
.hbtn:hover{background:rgba(255,255,255,.25);}
.tabs{position:relative;z-index:5;background:var(--panel);border-bottom:2px solid var(--border);padding:7px 18px;display:flex;gap:4px;overflow-x:auto;scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab{padding:6px 15px;border-radius:7px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.76rem;letter-spacing:.4px;transition:all .22s;white-space:nowrap;}
.tab.active{background:var(--p1);border-color:var(--p1);color:white;box-shadow:0 3px 12px rgba(45,106,79,.28);}
.tab:hover:not(.active){border-color:var(--p1);color:var(--p1);}
.app{display:none;padding:16px 18px;gap:14px;flex-wrap:wrap;position:relative;z-index:1;min-height:calc(100vh - 145px);}
.app.active{display:flex;}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:15px;position:relative;box-shadow:0 2px 14px var(--shadow);}
.panel::before{content:'';position:absolute;top:0;left:16px;right:16px;height:2px;background:linear-gradient(90deg,transparent,var(--p1),transparent);opacity:.3;}
.ptitle{font-family:'Fraunces',serif;font-size:.82rem;font-weight:700;color:var(--p1);letter-spacing:1px;margin-bottom:12px;display:flex;align-items:center;gap:7px;}
.fg{margin-bottom:10px;}
.fg label{display:block;font-size:.63rem;color:var(--muted);letter-spacing:1.2px;margin-bottom:3px;font-family:'Fira Code',monospace;text-transform:uppercase;}
.fg select,.fg input{width:100%;background:var(--panel2);border:1px solid var(--border);color:var(--ink);border-radius:6px;padding:7px 9px;font-family:'Manrope',sans-serif;font-size:.81rem;outline:none;transition:border-color .2s;}
.fg select:focus,.fg input:focus{border-color:var(--p1);}
.btn{width:100%;padding:8px;border-radius:7px;border:none;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:700;font-size:.85rem;letter-spacing:.7px;transition:all .22s;margin-top:4px;}
.btn-p{background:var(--p1);color:white;box-shadow:0 3px 11px rgba(45,106,79,.28);}
.btn-p:hover{background:#245a42;transform:translateY(-1px);}
.btn-o{background:var(--p2);color:white;}
.btn-o:hover{background:#9a3a16;}
.btn-d{background:transparent;color:var(--p4);border:1px solid var(--p4);}
.btn-d:hover{background:var(--p4);color:white;}
.btn-b{background:var(--p3);color:white;}
.btn-b:hover{background:#162840;}
.mech-step-box{background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:8px;display:none;animation:fadeIn .35s ease;}
.mech-step-box.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.step-num{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:var(--p1);color:white;font-family:'Fira Code',monospace;font-size:.72rem;margin-right:8px;flex-shrink:0;}
.step-title{font-weight:700;font-size:.85rem;color:var(--p1);}
.step-eq{background:#1c1410;color:#a8e6cf;font-family:'Fira Code',monospace;font-size:.8rem;border-radius:6px;padding:8px 11px;margin:6px 0;text-align:center;}
.step-desc{font-size:.78rem;color:var(--muted);line-height:1.65;margin-top:5px;}
.step-note{margin-top:6px;background:rgba(45,106,79,.1);border-radius:5px;padding:4px 8px;font-size:.7rem;color:var(--p1);font-family:'Fira Code',monospace;}
.mech-nav{display:flex;gap:7px;align-items:center;justify-content:center;margin-top:9px;}
.mech-dot{width:7px;height:7px;border-radius:50%;background:var(--border);transition:all .25s;cursor:pointer;}
.mech-dot.active{background:var(--p1);width:17px;border-radius:4px;}
.fg-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(125px,1fr));gap:8px;}
.fg-card{background:var(--panel2);border:1.5px solid var(--border);border-radius:8px;padding:10px;text-align:center;cursor:pointer;transition:all .2s;}
.fg-card:hover,.fg-card.sel{background:var(--p1);border-color:var(--p1);color:white;}
.fg-card:hover .fgf,.fg-card.sel .fgf{color:rgba(255,255,255,.75);}
.fgn{font-weight:700;font-size:.78rem;margin-bottom:3px;}
.fgf{font-family:'Fira Code',monospace;font-size:.7rem;color:var(--muted);}
.quiz-card{background:var(--panel2);border:2px solid var(--border);border-radius:11px;padding:16px;margin-bottom:11px;}
.quiz-q{font-weight:700;font-size:.9rem;color:var(--ink);margin-bottom:11px;line-height:1.55;}
.quiz-opts{display:flex;flex-direction:column;gap:6px;}
.quiz-opt{background:var(--panel);border:1.5px solid var(--border);border-radius:7px;padding:8px 12px;cursor:pointer;font-size:.8rem;transition:all .18s;text-align:left;font-family:'Manrope',sans-serif;}
.quiz-opt:hover{border-color:var(--p1);background:rgba(45,106,79,.06);}
.quiz-opt.correct{background:#d4edda;border-color:#2d6a4f;color:#1a4a33;}
.quiz-opt.wrong{background:#f8d7da;border-color:#9b2226;color:#6b0f13;}
.quiz-feedback{margin-top:9px;border-radius:7px;padding:9px 13px;font-size:.79rem;line-height:1.6;display:none;}
.quiz-feedback.show{display:block;}
.qf-correct{background:#d4edda;color:#1a4a33;border-left:4px solid #2d6a4f;}
.qf-wrong{background:#f8d7da;color:#6b0f13;border-left:4px solid #9b2226;}
.thy-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;}
.thy-card{background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:14px;}
.thy-card h3{font-family:'Fraunces',serif;font-weight:700;color:var(--p1);margin-bottom:8px;font-size:.93rem;}
.thy-card p,.thy-card li{font-size:.78rem;color:var(--muted);line-height:1.65;}
.thy-card ul{padding-left:14px;}
.fbox{background:#1c1410;border-radius:6px;padding:8px;margin:6px 0;font-family:'Fira Code',monospace;color:#a8e6cf;font-size:.78rem;text-align:center;}
.lvl{display:inline-block;padding:2px 7px;border-radius:4px;font-size:.58rem;font-weight:700;letter-spacing:1px;margin-bottom:6px;font-family:'Fira Code',monospace;}
.lv-g{background:rgba(45,106,79,.15);color:var(--p1);border:1px solid var(--p1);}
.lv-o{background:rgba(181,69,27,.15);color:var(--p2);border:1px solid var(--p2);}
.lv-b{background:rgba(29,53,87,.15);color:var(--p3);border:1px solid var(--p3);}
.nomen-builder{background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:14px;}
.nomen-chain{display:flex;gap:5px;flex-wrap:wrap;margin:9px 0;align-items:center;}
.nomen-c{width:40px;height:40px;background:var(--p1);color:white;border-radius:7px;display:flex;align-items:center;justify-content:center;font-family:'Fira Code',monospace;font-size:.75rem;font-weight:600;cursor:pointer;transition:transform .2s;}
.nomen-c:hover{transform:scale(1.1);}
.nomen-result{background:#1c1410;color:#a8e6cf;font-family:'Fira Code',monospace;border-radius:7px;padding:11px;font-size:1rem;text-align:center;margin-top:9px;}
.isomer-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px;}
.isomer-card{background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;text-align:center;cursor:pointer;transition:all .2s;}
.isomer-card:hover{border-color:var(--p1);background:rgba(45,106,79,.06);}
.calc-result{background:#1c1410;color:#a8e6cf;font-family:'Fira Code',monospace;border-radius:8px;padding:13px;font-size:.9rem;line-height:1.75;min-height:65px;}
.energy-canvas{border-radius:8px;background:#1c1410;border:1px solid var(--border);}
.config-badge{display:inline-block;padding:2px 9px;border-radius:20px;font-family:'Fira Code',monospace;font-size:.71rem;font-weight:500;margin:2px;}
.cfg-R{background:#dbeafe;color:#1d3557;border:1px solid #1d3557;}
.cfg-S{background:#fce7f3;color:#9b2226;border:1px solid #9b2226;}
.cfg-Z{background:#fef3c7;color:#92400e;border:1px solid #d97706;}
.cfg-E{background:#d1fae5;color:#065f46;border:1px solid #059669;}
.statusbar{position:relative;z-index:5;background:var(--panel);border-top:2px solid var(--border);padding:6px 20px;display:flex;align-items:center;gap:16px;font-family:'Fira Code',monospace;font-size:.63rem;color:var(--muted);flex-wrap:wrap;}
.sindic{display:flex;align-items:center;gap:5px;}
.sdot{width:6px;height:6px;border-radius:50%;background:var(--p1);box-shadow:0 0 5px var(--p1);animation:blink 2s infinite;}
.sdot.orange{background:var(--p2);box-shadow:0 0 5px var(--p2);}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.quiz-score{font-family:'Fraunces',serif;font-size:1.35rem;font-weight:700;color:var(--p1);text-align:center;margin:7px 0;}
body.dark{--bg:#0f1a14;--ink:#e8ded4;--panel:#1a2a1f;--panel2:#162217;--border:#2a3d2c;--muted:#8a9e8c;--shadow:rgba(0,0,0,.4);}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
canvas{display:block;}
</style>
</head>
<body>
<header>
  <div class="logo">
    <div class="logo-hex">üß¨</div>
    <div class="logo-text"><h1>SIMUORG</h1><p>SIMULATEUR DE CHIMIE ORGANIQUE ‚Äî v2.0 COMPLET</p></div>
  </div>
  <div class="header-right">
    <button class="hbtn" onclick="toggleTheme()">üåô</button>
    <button class="hbtn" onclick="toggleLang()" id="langBtn">EN</button>
    <div class="author-tag"><div class="n">Edmond Atinzoun TCHOKPON</div><div class="i">LICENCE PHYSIQUE-CHIMIE | SIMUORG 2025</div></div>
  </div>
</header>
<div class="tabs">
  <button class="tab active" onclick="showTab('mecanismes')" id="tab-mecanismes">‚öóÔ∏è M√âCANISMES</button>
  <button class="tab" onclick="showTab('stereo')" id="tab-stereo">üîÑ ST√âR√âOCHIMIE</button>
  <button class="tab" onclick="showTab('groupes')" id="tab-groupes">üß© GROUPES FONCT.</button>
  <button class="tab" onclick="showTab('synthese')" id="tab-synthese">üîó SYNTH√àSE</button>
  <button class="tab" onclick="showTab('mol3d')" id="tab-mol3d">üîÆ MOL√âCULES 3D</button>
  <button class="tab" onclick="showTab('energie')" id="tab-energie">üìà √âNERGIE</button>
  <button class="tab" onclick="showTab('nomen')" id="tab-nomen">üè∑Ô∏è NOMENCLATURE</button>
  <button class="tab" onclick="showTab('isomeres')" id="tab-isomeres">ü™û ISOM√àRES</button>
  <button class="tab" onclick="showTab('calcul')" id="tab-calcul">üßÆ CALCULS</button>
  <button class="tab" onclick="showTab('quiz')" id="tab-quiz">üéØ QUIZ</button>
  <button class="tab" onclick="showTab('theorie')" id="tab-theorie">üìö TH√âORIE</button>
  <button class="tab" onclick="showTab('rapport')" id="tab-rapport">üìã RAPPORT</button>
</div>

<!-- M√âCANISMES -->
<div class="app active" id="app-mecanismes">
  <div class="panel" style="flex:0 0 260px;">
    <div class="ptitle">‚öôÔ∏è S√âLECTION</div>
    <div class="fg"><label>TYPE DE R√âACTION</label>
      <select id="mechSel" onchange="loadMechanism()">
        <optgroup label="Substitutions">
          <option value="sn1">SN1 ‚Äî Substitution Nucl√©ophile Unimol√©culaire</option>
          <option value="sn2">SN2 ‚Äî Substitution Nucl√©ophile Bimol√©culaire</option>
        </optgroup>
        <optgroup label="Additions">
          <option value="ae">AE ‚Äî Addition √âlectrophile (alc√®nes)</option>
          <option value="an">AN ‚Äî Addition Nucl√©ophile (carbonyles)</option>
          <option value="ar">AR ‚Äî Addition Radicalaire (anti-Markovnikov)</option>
        </optgroup>
        <optgroup label="√âliminations">
          <option value="e1">E1 ‚Äî √âlimination Unimol√©culaire</option>
          <option value="e2">E2 ‚Äî √âlimination Bimol√©culaire</option>
        </optgroup>
        <optgroup label="Aromatiques">
          <option value="sear">SEAr ‚Äî Substitution √âlectrophile Aromatique</option>
          <option value="acyl">Acylation de Friedel-Crafts</option>
          <option value="nitrat">Nitration du Benz√®ne</option>
        </optgroup>
        <optgroup label="Fonctions oxyg√©n√©es">
          <option value="estherif">Est√©rification / Hydrolyse (Fischer)</option>
          <option value="sapo">Saponification (Hydrolyse alcaline)</option>
          <option value="oxred">Oxydation des Alcools</option>
        </optgroup>
        <optgroup label="Amines & organom√©talliques">
          <option value="diazot">Diazotation des Anilines</option>
          <option value="grignard">R√©actif de Grignard</option>
        </optgroup>
      </select>
    </div>
    <div class="fg"><label>SUBSTRAT</label>
      <select id="substrateSel">
        <option value="tertiary">Halog√©nure tertiaire R‚ÇÉC-X</option>
        <option value="secondary">Halog√©nure secondaire R‚ÇÇCH-X</option>
        <option value="primary">Halog√©nure primaire RCH‚ÇÇ-X</option>
        <option value="allylic">Halog√©nure allylique/benzylique</option>
      </select>
    </div>
    <div class="fg"><label>NUCL√âOPHILE / R√âACTIF</label>
      <select id="nucleophileSel">
        <option value="OH">OH‚Åª (soude)</option>
        <option value="Br">Br‚Åª (bromure)</option>
        <option value="CN">CN‚Åª (cyanure)</option>
        <option value="NH3">NH‚ÇÉ (ammoniac)</option>
        <option value="H2O">H‚ÇÇO (eau)</option>
        <option value="RMgX">R-MgX (Grignard)</option>
        <option value="LiAlH4">LiAlH‚ÇÑ</option>
        <option value="NaBH4">NaBH‚ÇÑ</option>
      </select>
    </div>
    <div class="fg"><label>SOLVANT</label>
      <select id="solventSel">
        <option value="polar_protic">Polaire protique (EtOH, H‚ÇÇO)</option>
        <option value="polar_aprotic">Polaire aprotique (DMSO, DMF)</option>
        <option value="nonpolar">Apolaire (CH‚ÇÇCl‚ÇÇ, √©ther)</option>
      </select>
    </div>
    <button class="btn btn-p" onclick="loadMechanism()">‚ñ∂ CHARGER M√âCANISME</button>
    <button class="btn btn-o" onclick="nextStep()" style="margin-top:5px;">‚Üí √âTAPE SUIVANTE</button>
    <button class="btn btn-d" onclick="resetMech()" style="margin-top:5px;">‚Ü∫ RECOMMENCER</button>
    <button class="btn btn-b" onclick="autoPlay()" id="btn-auto" style="margin-top:5px;">‚èµ AUTO-PLAY</button>
    <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:10px;">
      <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">CONDITIONS OPTIMALES</div>
      <div id="conditions-box" style="font-size:.74rem;color:var(--ink);line-height:1.7;">‚Äî</div>
    </div>
    <div style="margin-top:8px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:10px;">
      <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">PRODUIT(S) ATTENDU(S)</div>
      <div id="product-box" style="font-family:'Fira Code',monospace;font-size:.82rem;color:var(--p1);">‚Äî</div>
    </div>
    <div style="margin-top:8px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:10px;">
      <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">COMP√âTITION SN/E</div>
      <div id="competition-box" style="font-size:.73rem;color:var(--ink);line-height:1.6;">‚Äî</div>
    </div>
  </div>

  <div class="panel" style="flex:1;min-width:300px;">
    <div class="ptitle">üî¨ SUIVI M√âCANISTIQUE</div>
    <div id="rxn-header" style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;margin-bottom:11px;text-align:center;">
      <div id="rxn-title" style="font-family:'Fraunces',serif;font-size:1rem;font-weight:700;color:var(--p1);margin-bottom:3px;">S√©lectionnez un m√©canisme</div>
      <div id="rxn-global" style="font-family:'Fira Code',monospace;font-size:.78rem;color:var(--muted);">Choisissez dans le panneau gauche et cliquez ‚ñ∂</div>
    </div>
    <div id="balance-container" style="display:none;margin-bottom:11px;">
      <div id="balance-eq" style="background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:10px;text-align:center;font-family:'Fira Code',monospace;font-size:.8rem;"></div>
    </div>
    <div id="steps-container">
      <div id="step-placeholder" style="text-align:center;padding:35px;color:var(--muted);font-size:.83rem;">‚öóÔ∏è Chargez un m√©canisme pour voir les √©tapes</div>
    </div>
    <div class="mech-nav" id="mech-nav" style="display:none;">
      <button onclick="prevStep()" style="background:var(--panel2);border:1px solid var(--border);border-radius:6px;padding:5px 12px;cursor:pointer;font-family:'Manrope',sans-serif;font-size:.74rem;font-weight:600;">‚óÄ Pr√©c.</button>
      <div id="mech-dots" style="display:flex;gap:5px;"></div>
      <button onclick="nextStep()" style="background:var(--p1);border:none;border-radius:6px;padding:5px 12px;cursor:pointer;font-family:'Manrope',sans-serif;font-size:.74rem;font-weight:600;color:white;">Suiv. ‚ñ∂</button>
    </div>
    <div style="text-align:center;margin-top:8px;font-family:'Fira Code',monospace;font-size:.65rem;color:var(--muted);" id="step-counter"></div>
  </div>

  <div class="panel" style="flex:0 0 270px;">
    <div class="ptitle">üé® ANIMATION MOL√âCULAIRE</div>
    <canvas id="mechCanvas" width="240" height="255" style="border-radius:8px;background:#1c1410;border:1.5px solid var(--border);width:100%;"></canvas>
    <div style="margin-top:10px;">
      <div class="ptitle" style="margin-bottom:7px;font-size:.76rem;">üìà PROFIL √âNERG√âTIQUE</div>
      <canvas id="energyMini" width="240" height="90" class="energy-canvas" style="width:100%;"></canvas>
    </div>
    <div id="mech-stereochem" style="margin-top:8px;background:rgba(45,106,79,.1);border-radius:7px;padding:8px;font-size:.72rem;color:var(--p1);display:none;font-family:'Fira Code',monospace;"></div>
    <div style="margin-top:8px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:9px;">
      <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">L√âGENDE</div>
      <div style="display:flex;flex-direction:column;gap:3px;font-size:.68rem;">
        <div style="display:flex;align-items:center;gap:5px;"><div style="width:10px;height:10px;border-radius:50%;background:#a8e6cf;"></div> Carbone C</div>
        <div style="display:flex;align-items:center;gap:5px;"><div style="width:10px;height:10px;border-radius:50%;background:#ff6b6b;"></div> Oxyg√®ne O</div>
        <div style="display:flex;align-items:center;gap:5px;"><div style="width:10px;height:10px;border-radius:50%;background:#74b9ff;"></div> Azote N / Nucl√©ophile</div>
        <div style="display:flex;align-items:center;gap:5px;"><div style="width:10px;height:10px;border-radius:50%;background:#ffeaa7;"></div> Hydrog√®ne H</div>
        <div style="display:flex;align-items:center;gap:5px;"><div style="width:10px;height:10px;border-radius:50%;background:#fd79a8;"></div> ‚Ä° √âtat de transition</div>
        <div style="display:flex;align-items:center;gap:5px;"><div style="width:10px;height:10px;border-radius:50%;background:#fdcb6e;"></div> Halog√®ne X</div>
      </div>
    </div>
  </div>
</div>

<!-- ST√âR√âOCHIMIE -->
<div class="app" id="app-stereo">
  <div class="panel" style="width:100%">
    <div class="ptitle">üîÑ ST√âR√âOCHIMIE ‚Äî CHIRALIT√â & CONFIGURATIONS</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 245px;">
        <div class="fg"><label>CONCEPT</label>
          <select id="stereoConcept" onchange="showStereoConcept()">
            <option value="chiral">Centre chiral & chiralit√©</option>
            <option value="rs">Configurations R et S (CIP)</option>
            <option value="ez">Isom√®res E/Z (g√©om√©triques)</option>
            <option value="diastereomers">Diast√©r√©oisom√®res & √©nantiom√®res</option>
            <option value="fischer">Projection de Fischer</option>
            <option value="newman">Projection de Newman</option>
            <option value="meso">Compos√© m√©so</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="showStereoConcept()">‚ñ∂ AFFICHER</button>
        <div style="margin-top:12px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">OUTIL CIP ‚Äî CALCULER R/S</div>
          <div style="font-size:.74rem;color:var(--muted);margin-bottom:8px;">Entrez les 4 num√©ros atomiques :</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-bottom:7px;">
            <div><div style="font-size:.6rem;color:var(--muted);">a (priorit√© 1)</div><input type="number" id="cip-a" value="17" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:4px;padding:5px;color:var(--ink);font-family:'Fira Code',monospace;font-size:.78rem;"></div>
            <div><div style="font-size:.6rem;color:var(--muted);">b (priorit√© 2)</div><input type="number" id="cip-b" value="8" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:4px;padding:5px;color:var(--ink);font-family:'Fira Code',monospace;font-size:.78rem;"></div>
            <div><div style="font-size:.6rem;color:var(--muted);">c (priorit√© 3)</div><input type="number" id="cip-c" value="6" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:4px;padding:5px;color:var(--ink);font-family:'Fira Code',monospace;font-size:.78rem;"></div>
            <div><div style="font-size:.6rem;color:var(--muted);">d (priorit√© 4)</div><input type="number" id="cip-d" value="1" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:4px;padding:5px;color:var(--ink);font-family:'Fira Code',monospace;font-size:.78rem;"></div>
          </div>
          <select id="cip-sens" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:4px;padding:6px;color:var(--ink);font-family:'Manrope',sans-serif;font-size:.78rem;margin-bottom:6px;">
            <option value="cw">Sens horaire ‚Üª</option>
            <option value="ccw">Sens antihoraire ‚Ü∫</option>
          </select>
          <button onclick="computeCIP()" style="width:100%;background:var(--p1);color:white;border:none;border-radius:6px;padding:6px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:700;font-size:.76rem;">CALCULER R/S</button>
          <div id="cip-result" style="margin-top:7px;font-family:'Fira Code',monospace;font-size:.82rem;text-align:center;min-height:28px;"></div>
        </div>
      </div>
      <div style="flex:1;min-width:280px;" id="stereo-content"></div>
      <div style="flex:0 0 260px;">
        <canvas id="stereoCanvas" width="250" height="265" style="width:100%;border-radius:8px;background:#1c1410;border:1.5px solid var(--border);"></canvas>
        <div style="margin-top:7px;text-align:center;font-family:'Fira Code',monospace;font-size:.68rem;color:var(--muted);" id="stereo-canvas-label">S√©lectionnez un concept</div>
      </div>
    </div>
  </div>
</div>

<!-- GROUPES FONCTIONNELS -->
<div class="app" id="app-groupes">
  <div class="panel" style="width:100%">
    <div class="ptitle">üß© GROUPES FONCTIONNELS & R√âACTIVIT√â</div>
    <p style="font-size:.8rem;color:var(--muted);margin-bottom:13px;">Cliquez sur un groupe fonctionnel pour voir ses propri√©t√©s et r√©activit√©.</p>
    <div class="fg-grid" id="fg-grid"></div>
    <div id="fg-detail" style="margin-top:15px;display:none;">
      <div style="display:flex;flex-wrap:wrap;gap:13px;">
        <div style="flex:1;min-width:230px;">
          <div style="background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:14px;">
            <div style="font-family:'Fraunces',serif;font-size:1.1rem;font-weight:700;color:var(--p1);margin-bottom:5px;" id="fg-name-detail">‚Äî</div>
            <div style="font-family:'Fira Code',monospace;font-size:.9rem;color:var(--p2);margin-bottom:9px;" id="fg-formula-detail">‚Äî</div>
            <div style="font-size:.78rem;color:var(--muted);line-height:1.7;margin-bottom:9px;" id="fg-desc-detail">‚Äî</div>
            <div style="font-size:.72rem;font-family:'Fira Code',monospace;">
              <div style="color:var(--p3);margin-bottom:3px;">R√âACTIVIT√â :</div>
              <div id="fg-react-detail" style="color:var(--muted);line-height:1.7;">‚Äî</div>
            </div>
          </div>
        </div>
        <div style="flex:1;min-width:230px;">
          <div style="background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:14px;">
            <div style="font-size:.65rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:8px;">EXEMPLES</div>
            <div id="fg-examples-detail" style="font-size:.78rem;color:var(--ink);line-height:1.8;">‚Äî</div>
            <div style="margin-top:9px;background:#1c1410;border-radius:6px;padding:8px;">
              <div style="font-size:.6rem;color:rgba(255,255,255,.45);font-family:'Fira Code',monospace;margin-bottom:4px;">PROPRI√âT√âS PHYSIQUES</div>
              <div id="fg-phys-detail" style="font-family:'Fira Code',monospace;font-size:.72rem;color:#a8e6cf;line-height:1.7;">‚Äî</div>
            </div>
          </div>
        </div>
        <div style="flex:0 0 215px;">
          <canvas id="fgCanvas" width="198" height="195" style="border-radius:8px;background:#1c1410;border:1px solid var(--border);width:100%;"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SYNTH√àSE -->
<div class="app" id="app-synthese">
  <div class="panel" style="width:100%">
    <div class="ptitle">üîó SYNTH√àSE ORGANIQUE ‚Äî VOIES R√âACTIONNELLES</div>
    <div style="display:flex;flex-wrap:wrap;gap:7px;margin-bottom:14px;">
      <button onclick="showSynthesis('alcool',this)" class="syn-btn" style="background:var(--p1);color:white;border:none;border-radius:7px;padding:7px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.78rem;">üç∑ Alcools</button>
      <button onclick="showSynthesis('aldehyde',this)" class="syn-btn" style="background:var(--panel2);border:1px solid var(--border);color:var(--muted);border-radius:7px;padding:7px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.78rem;">üî∂ Ald√©hydes/C√©tones</button>
      <button onclick="showSynthesis('acide',this)" class="syn-btn" style="background:var(--panel2);border:1px solid var(--border);color:var(--muted);border-radius:7px;padding:7px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.78rem;">üî¥ Acides carboxyliques</button>
      <button onclick="showSynthesis('amine',this)" class="syn-btn" style="background:var(--panel2);border:1px solid var(--border);color:var(--muted);border-radius:7px;padding:7px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.78rem;">üîµ Amines</button>
      <button onclick="showSynthesis('ester',this)" class="syn-btn" style="background:var(--panel2);border:1px solid var(--border);color:var(--muted);border-radius:7px;padding:7px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.78rem;">üü¢ Esters</button>
      <button onclick="showSynthesis('arene',this)" class="syn-btn" style="background:var(--panel2);border:1px solid var(--border);color:var(--muted);border-radius:7px;padding:7px 13px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:600;font-size:.78rem;">‚ö´ Ar√®nes</button>
    </div>
    <div id="synth-content"><div style="text-align:center;padding:35px;color:var(--muted);">üîó Choisissez une famille chimique</div></div>
  </div>
</div>

<!-- MOL 3D -->
<div class="app" id="app-mol3d">
  <div class="panel" style="width:100%">
    <div class="ptitle">üîÆ VISUALISATION 3D DES MOL√âCULES</div>
    <div style="display:flex;flex-wrap:wrap;gap:17px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>MOL√âCULE</label>
          <select id="mol3dSel" onchange="draw3DMol()">
            <optgroup label="Alcanes"><option value="methane">M√©thane CH‚ÇÑ</option><option value="ethane">√âthane C‚ÇÇH‚ÇÜ</option><option value="propane">Propane C‚ÇÉH‚Çà</option><option value="butane">Butane C‚ÇÑH‚ÇÅ‚ÇÄ</option></optgroup>
            <optgroup label="Alc√®nes & alcynes"><option value="ethylene">√âthyl√®ne C‚ÇÇH‚ÇÑ</option><option value="acetylene">Ac√©tyl√®ne C‚ÇÇH‚ÇÇ</option></optgroup>
            <optgroup label="Fonctions oxyg√©n√©es"><option value="ethanol">√âthanol C‚ÇÇH‚ÇÖOH</option><option value="acetone">Ac√©tone (CH‚ÇÉ)‚ÇÇCO</option><option value="acac">Acide ac√©tique CH‚ÇÉCOOH</option><option value="ethylacetate">Ac√©tate d'√©thyle</option></optgroup>
            <optgroup label="Aromatiques"><option value="benzene">Benz√®ne C‚ÇÜH‚ÇÜ</option><option value="toluene">Tolu√®ne C‚ÇáH‚Çà</option><option value="phenol">Ph√©nol C‚ÇÜH‚ÇÖOH</option></optgroup>
            <optgroup label="Amines"><option value="methylamine">M√©thylamine CH‚ÇÉNH‚ÇÇ</option><option value="aniline">Aniline C‚ÇÜH‚ÇÖNH‚ÇÇ</option></optgroup>
            <optgroup label="Biologie"><option value="glucose">D-Glucose (forme ouverte)</option><option value="alanine">L-Alanine (acide amin√©)</option></optgroup>
          </select>
        </div>
        <div class="fg"><label>MODE D'AFFICHAGE</label>
          <select id="mol3dMode" onchange="draw3DMol()">
            <option value="balls">Sph√®res & b√¢tons</option>
            <option value="sticks">B√¢tons</option>
            <option value="vdw">Van der Waals</option>
            <option value="wireframe">Fil de fer</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="draw3DMol()">üîÑ ACTUALISER</button>
        <button class="btn btn-o" onclick="rotateMol()" style="margin-top:5px;" id="btn-rotate">‚ü≥ ROTATION AUTO</button>
        <div style="display:flex;gap:5px;margin-top:5px;flex-wrap:wrap;">
          <button onclick="rotateX(15)" style="flex:1;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:5px;cursor:pointer;font-size:.7rem;font-weight:600;">‚ÜëX</button>
          <button onclick="rotateX(-15)" style="flex:1;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:5px;cursor:pointer;font-size:.7rem;font-weight:600;">‚ÜìX</button>
          <button onclick="rotateY(15)" style="flex:1;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:5px;cursor:pointer;font-size:.7rem;font-weight:600;">‚ÜêY</button>
          <button onclick="rotateY(-15)" style="flex:1;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:5px;cursor:pointer;font-size:.7rem;font-weight:600;">‚ÜíY</button>
          <button onclick="resetRotation()" style="flex:1;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:5px;cursor:pointer;font-size:.7rem;font-weight:600;">‚äô</button>
        </div>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-family:'Fraunces',serif;font-size:.95rem;font-weight:700;color:var(--p1);" id="mol3d-name">‚Äî</div>
          <div style="font-family:'Fira Code',monospace;font-size:.78rem;color:var(--p2);margin:4px 0;" id="mol3d-formula">‚Äî</div>
          <div style="font-size:.74rem;color:var(--muted);line-height:1.6;margin-top:5px;" id="mol3d-desc">‚Äî</div>
          <div style="margin-top:7px;display:flex;gap:6px;flex-wrap:wrap;">
            <span style="background:rgba(45,106,79,.1);color:var(--p1);padding:2px 7px;border-radius:4px;font-size:.65rem;font-family:'Fira Code',monospace;" id="mol3d-geom">‚Äî</span>
            <span style="background:rgba(181,69,27,.1);color:var(--p2);padding:2px 7px;border-radius:4px;font-size:.65rem;font-family:'Fira Code',monospace;" id="mol3d-hybrid">‚Äî</span>
          </div>
          <div id="mol3d-extra" style="margin-top:6px;font-size:.7rem;color:var(--muted);font-family:'Fira Code',monospace;line-height:1.7;"></div>
        </div>
      </div>
      <div style="flex:1;min-width:290px;">
        <canvas id="mol3dCanvas" width="490" height="375" style="width:100%;border-radius:11px;background:radial-gradient(ellipse at center,#1a2e1a 0%,#0a0f0a 100%);border:1.5px solid var(--border);"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- √âNERGIE -->
<div class="app" id="app-energie">
  <div class="panel" style="width:100%">
    <div class="ptitle">üìà PROFIL √âNERG√âTIQUE & CIN√âTIQUE</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>R√âACTION</label>
          <select id="energySel" onchange="drawEnergyDiagram()">
            <option value="sn1">SN1 (2 √©tapes, carbocation)</option>
            <option value="sn2">SN2 (concert√©e, 1 ‚Ä°)</option>
            <option value="e1">E1 (2 √©tapes)</option>
            <option value="e2">E2 (concert√©e)</option>
            <option value="ae">Addition √âlectrophile AE</option>
            <option value="an">Addition Nucl√©ophile AN</option>
            <option value="estherif">Est√©rification (r√©versible)</option>
          </select>
        </div>
        <div class="fg"><label>SUBSTRAT</label>
          <select id="substrateType" onchange="drawEnergyDiagram()">
            <option value="tertiary">Tertiaire (Ea basse)</option>
            <option value="secondary">Secondaire (Ea moyenne)</option>
            <option value="primary">Primaire (Ea haute)</option>
          </select>
        </div>
        <div class="fg"><label>TEMP√âRATURE : <span id="temp-display">25¬∞C</span></label>
          <input type="range" id="tempRange" min="0" max="200" value="25" oninput="updateTemp()" style="width:100%;accent-color:var(--p1);">
        </div>
        <button class="btn btn-p" onclick="drawEnergyDiagram()">üîÑ METTRE √Ä JOUR</button>
        <div style="margin-top:10px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">DONN√âES CIN√âTIQUES</div>
          <div id="kinetics-box" style="font-family:'Fira Code',monospace;font-size:.74rem;color:var(--ink);line-height:1.8;">‚Äî</div>
        </div>
        <div style="margin-top:8px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">LOI D'ARRH√âNIUS</div>
          <div class="fbox" style="margin:0;">k = A ¬∑ e^(-Ea/RT)</div>
          <div style="font-size:.7rem;color:var(--muted);margin-top:5px;line-height:1.6;">R = 8.314 J/(mol¬∑K) | T en Kelvin</div>
        </div>
      </div>
      <div style="flex:1;min-width:290px;">
        <canvas id="energyCanvas" width="555" height="375" class="energy-canvas" style="width:100%;border-radius:10px;"></canvas>
        <div style="margin-top:9px;display:flex;gap:9px;flex-wrap:wrap;">
          <div style="flex:1;min-width:135px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:9px;">
            <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">ŒîH¬∞ (kJ/mol)</div>
            <div id="enthalpy" style="font-family:'Fira Code',monospace;font-size:.9rem;color:var(--p1);">‚Äî</div>
          </div>
          <div style="flex:1;min-width:135px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:9px;">
            <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">Ea (kJ/mol)</div>
            <div id="ea-display" style="font-family:'Fira Code',monospace;font-size:.9rem;color:var(--p2);">‚Äî</div>
          </div>
          <div style="flex:1;min-width:135px;background:var(--panel2);border:1px solid var(--border);border-radius:7px;padding:9px;">
            <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">INTERM√âDIAIRES</div>
            <div id="inter-display" style="font-family:'Fira Code',monospace;font-size:.8rem;color:var(--p3);">‚Äî</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- NOMENCLATURE -->
<div class="app" id="app-nomen">
  <div class="panel" style="width:100%">
    <div class="ptitle">üè∑Ô∏è NOMENCLATURE IUPAC ‚Äî CONSTRUCTEUR INTERACTIF</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 260px;">
        <div class="fg"><label>TYPE DE COMPOS√â</label>
          <select id="nomenType" onchange="updateNomen()">
            <option value="alcane">Alcane</option><option value="alcool">Alcool (-OH)</option>
            <option value="aldehyde">Ald√©hyde (-CHO)</option><option value="cetone">C√©tone (>C=O)</option>
            <option value="acide">Acide carboxylique (-COOH)</option><option value="amine">Amine (-NH‚ÇÇ)</option>
            <option value="ester">Ester (-COO-)</option><option value="alcene">Alc√®ne (C=C)</option>
          </select>
        </div>
        <div class="fg"><label>LONGUEUR CHA√éNE : <span id="chain-display">3 C</span></label>
          <input type="range" id="chainLength" min="1" max="10" value="3" oninput="updateNomen()" style="width:100%;accent-color:var(--p1);">
        </div>
        <div class="fg"><label>POSITION GROUPE FONCT.</label>
          <input type="number" id="funcPos" min="1" max="10" value="1" oninput="updateNomen()" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:6px;color:var(--ink);font-family:'Fira Code',monospace;">
        </div>
        <div class="fg"><label>RAMIFICATION</label>
          <select id="nomenBranch" onchange="updateNomen()">
            <option value="">Aucune</option><option value="methyl">M√©thyle (-CH‚ÇÉ)</option>
            <option value="ethyl">√âthyle (-C‚ÇÇH‚ÇÖ)</option><option value="dimethyl">Di-m√©thyle</option>
          </select>
        </div>
        <div class="fg"><label>POSITION RAMIFICATION</label>
          <input type="number" id="branchPos" min="1" max="10" value="2" oninput="updateNomen()" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:6px;color:var(--ink);font-family:'Fira Code',monospace;">
        </div>
        <button class="btn btn-p" onclick="updateNomen()">üè∑Ô∏è NOMMER</button>
        <div style="margin-top:10px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">R√àGLES CL√âS</div>
          <div style="font-size:.72rem;color:var(--ink);line-height:1.7;"><b style="color:var(--p1);">1.</b> Cha√Æne principale la plus longue<br><b style="color:var(--p1);">2.</b> -ol > -al > -one > -√®ne > -ane<br><b style="color:var(--p1);">3.</b> Groupe fonct. = n¬∞ le plus bas<br><b style="color:var(--p1);">4.</b> 1=m√©th, 2=√©th, 3=prop, 4=but, 5=pent, 6=hex</div>
        </div>
      </div>
      <div style="flex:1;min-width:280px;">
        <div class="nomen-builder">
          <div style="font-size:.63rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:7px;">CHA√éNE CARBON√âE :</div>
          <div class="nomen-chain" id="nomen-chain"></div>
          <div class="nomen-result" id="nomen-result" style="font-size:1.05rem;font-family:'Fraunces',serif;">‚Äî</div>
          <div style="margin-top:9px;font-size:.76rem;color:var(--muted);line-height:1.7;" id="nomen-explanation">‚Äî</div>
        </div>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:13px;">
          <div class="ptitle" style="margin-bottom:8px;font-size:.76rem;">üé≤ EXERCICE DE NOMENCLATURE</div>
          <div id="nomen-quiz">
            <button onclick="genNomenQuiz()" class="btn btn-o" style="width:auto;padding:7px 16px;font-size:.78rem;">üé≤ G√âN√âRER UN EXERCICE</button>
          </div>
        </div>
      </div>
      <div style="flex:0 0 235px;">
        <canvas id="nomenCanvas" width="220" height="215" style="width:100%;border-radius:8px;background:#1c1410;border:1.5px solid var(--border);"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- ISOM√àRES -->
<div class="app" id="app-isomeres">
  <div class="panel" style="width:100%">
    <div class="ptitle">ü™û EXPLORATEUR D'ISOM√àRES</div>
    <div style="display:flex;flex-wrap:wrap;gap:14px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>FORMULE BRUTE</label>
          <select id="isomerFormula" onchange="showIsomers()">
            <option value="C4H10">C‚ÇÑH‚ÇÅ‚ÇÄ (butane)</option>
            <option value="C5H12">C‚ÇÖH‚ÇÅ‚ÇÇ (pentane)</option>
            <option value="C4H8">C‚ÇÑH‚Çà (but√®nes)</option>
            <option value="C3H8O">C‚ÇÉH‚ÇàO (propanol)</option>
            <option value="C4H8O">C‚ÇÑH‚ÇàO (butanal/butanone)</option>
            <option value="C4H9Br">C‚ÇÑH‚ÇâBr (bromobutanes)</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="showIsomers()">‚ñ∂ AFFICHER</button>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">TYPES D'ISOM√âRIE</div>
          <div style="font-size:.74rem;color:var(--ink);line-height:1.8;">
            <b style="color:var(--p1);">Constitution :</b> squelette diff√©rent<br>
            <b style="color:var(--p2);">Position :</b> groupe fonct. diff√©rent<br>
            <b style="color:var(--p3);">Fonction :</b> groupe fonct. diff√©rent<br>
            <b style="color:var(--p5);">St√©r√©o :</b> arrangement spatial diff√©rent
          </div>
        </div>
      </div>
      <div style="flex:1;min-width:290px;" id="isomers-content">
        <div style="text-align:center;padding:35px;color:var(--muted);">ü™û Choisissez une formule pour voir les isom√®res</div>
      </div>
    </div>
  </div>
</div>

<!-- CALCULS -->
<div class="app" id="app-calcul">
  <div class="panel" style="width:100%">
    <div class="ptitle">üßÆ CALCULATEUR DE CHIMIE ORGANIQUE</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 260px;">
        <div class="fg"><label>TYPE DE CALCUL</label>
          <select id="calcType" onchange="updateCalcUI()">
            <option value="mol">Masse molaire (formule brute)</option>
            <option value="yield">Rendement de r√©action (%)</option>
            <option value="dilution">Dilution (C‚ÇÅV‚ÇÅ = C‚ÇÇV‚ÇÇ)</option>
            <option value="ph">pH acide carboxylique</option>
            <option value="degree">Degr√© d'insaturation (DBE)</option>
            <option value="rf">Rapport frontal (CCM / Rf)</option>
          </select>
        </div>
        <div id="calc-inputs"></div>
        <button class="btn btn-p" onclick="calculate()">= CALCULER</button>
        <button class="btn btn-d" onclick="clearCalc()" style="margin-top:5px;">‚úï EFFACER</button>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:10px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">MASSES MOLAIRES</div>
          <div style="font-family:'Fira Code',monospace;font-size:.7rem;color:var(--ink);columns:2;gap:12px;line-height:1.8;">H:1.008 | C:12.011 | N:14.007 | O:15.999 | F:18.998 | Cl:35.453 | Br:79.904 | I:126.9 | S:32.06 | P:30.97</div>
        </div>
      </div>
      <div style="flex:1;min-width:270px;">
        <div class="calc-result" id="calc-result">S√©lectionnez un type de calcul...</div>
        <div style="margin-top:11px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:11px;">
          <div style="font-size:.6rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:6px;">FORMULE UTILIS√âE</div>
          <div id="calc-formula" style="font-family:'Fira Code',monospace;font-size:.76rem;color:var(--ink);line-height:1.8;">‚Äî</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="app" id="app-quiz">
  <div class="panel" style="width:100%">
    <div class="ptitle">üéØ QUIZ INTERACTIF ‚Äî CHIMIE ORGANIQUE</div>
    <div style="display:flex;flex-wrap:wrap;gap:15px;">
      <div style="flex:0 0 250px;">
        <div class="fg"><label>CAT√âGORIE</label>
          <select id="quizCat">
            <option value="mechanisms">M√©canismes r√©actionnels</option>
            <option value="functional">Groupes fonctionnels</option>
            <option value="stereo">St√©r√©ochimie</option>
            <option value="nomenclature">Nomenclature IUPAC</option>
            <option value="synthesis">Synth√®se organique</option>
            <option value="mixed">Quiz g√©n√©ral (tous th√®mes)</option>
          </select>
        </div>
        <div class="fg"><label>NOMBRE DE QUESTIONS</label>
          <select id="quizCount">
            <option value="5">5 questions</option>
            <option value="8" selected>8 questions</option>
            <option value="12">12 questions</option>
          </select>
        </div>
        <button class="btn btn-p" onclick="startQuiz()">‚ñ∂ NOUVEAU QUIZ</button>
        <div style="margin-top:13px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:.56rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">SCORE</div>
          <div class="quiz-score" id="quiz-score">0 / 0</div>
          <div style="font-size:.68rem;color:var(--muted);" id="quiz-pct">‚Äî</div>
          <div style="margin-top:7px;height:8px;background:var(--border);border-radius:4px;overflow:hidden;">
            <div id="score-bar" style="height:100%;width:0%;background:var(--p1);border-radius:4px;transition:width .4s;"></div>
          </div>
        </div>
        <div style="margin-top:8px;background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:9px;">
          <div style="font-size:.58rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:4px;">PROGRESSION</div>
          <div id="quiz-progress-text" style="font-size:.74rem;color:var(--ink);">Question 0 / 0</div>
          <div style="margin-top:4px;height:5px;background:var(--border);border-radius:3px;overflow:hidden;">
            <div id="quiz-prog-bar" style="height:100%;width:0%;background:var(--p2);border-radius:3px;transition:width .3s;"></div>
          </div>
        </div>
      </div>
      <div style="flex:1;min-width:300px;" id="quiz-area">
        <div style="text-align:center;padding:38px;color:var(--muted);">üéØ D√©marrez un quiz pour tester vos connaissances</div>
      </div>
    </div>
  </div>
</div>

<!-- TH√âORIE -->
<div class="app" id="app-theorie">
  <div class="panel" style="width:100%">
    <div class="ptitle">üìö COURS ‚Äî CHIMIE ORGANIQUE</div>
    <div class="thy-grid" id="theory-grid"></div>
  </div>
</div>

<!-- RAPPORT -->
<div class="app" id="app-rapport">
  <div class="panel" style="width:100%">
    <div class="ptitle">üìã RAPPORT DE S√âANCE</div>
    <div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:17px;font-family:'Fira Code',monospace;font-size:.72rem;color:var(--ink);line-height:1.9;" id="rpt-content">
      <div style="text-align:center;color:var(--muted);padding:35px;">üß¨ Explorez les modules pour g√©n√©rer votre rapport.</div>
    </div>
    <div style="display:flex;gap:7px;margin-top:10px;">
      <button class="btn btn-p" style="flex:1" onclick="generateReport()">üìã G√âN√âRER RAPPORT</button>
      <button class="btn" style="flex:1;background:rgba(45,106,79,.1);border:1px solid var(--p1);color:var(--p1);border-radius:7px;cursor:pointer;font-family:'Manrope',sans-serif;font-weight:700;font-size:.82rem;letter-spacing:.7px;" onclick="window.print()">üñ®Ô∏è IMPRIMER</button>
    </div>
  </div>
</div>

<div class="statusbar">
  <div class="sindic"><div class="sdot" id="sdot"></div><span id="stext">Pr√™t ‚Äî Choisissez un m√©canisme</span></div>
  <span>|</span><span>SimuOrg v2.0 ‚Äî Edmond Atinzoun TCHOKPON</span>
  <span>|</span><span id="session-stats">M√©canismes : 0 | Quiz : 0/0</span>
  <span style="margin-left:auto" id="sclock"></span>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GLOBAL STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let lang='fr',darkMode=false;
let sessionStats={mechLoaded:0,questAnswered:0,quizCorrect:0,quizTotal:0};
function toggleLang(){lang=lang==='fr'?'en':'fr';document.getElementById('langBtn').textContent=lang==='fr'?'EN':'FR';}
function toggleTheme(){darkMode=!darkMode;document.body.classList.toggle('dark',darkMode);document.querySelector('.hbtn').textContent=darkMode?'‚òÄÔ∏è':'üåô';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showTab(n){
  document.querySelectorAll('.app').forEach(a=>a.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('app-'+n).classList.add('active');
  document.getElementById('tab-'+n).classList.add('active');
  if(n==='groupes')initFGGrid();
  if(n==='mol3d')draw3DMol();
  if(n==='quiz')startQuiz();
  if(n==='stereo')showStereoConcept();
  if(n==='energie')drawEnergyDiagram();
  if(n==='nomen')updateNomen();
  if(n==='isomeres')showIsomers();
  if(n==='calcul')updateCalcUI();
  if(n==='theorie')initTheory();
}
function updateSessionStats(){document.getElementById('session-stats').textContent=`M√©canismes : ${sessionStats.mechLoaded} | Quiz : ${sessionStats.quizCorrect}/${sessionStats.quizTotal}`;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MECHANISMS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MECHS={
  sn1:{title:'SN1 ‚Äî Substitution Nucl√©ophile Unimol√©culaire',global:'R‚ÇÉC-X + Nu‚Åª ‚Üí R‚ÇÉC-Nu + X‚Åª (via carbocation)',balance:'R‚ÇÉC-X ‚Üí [R‚ÇÉC‚Å∫] + X‚Åª ‚Üí R‚ÇÉC-Nu',conditions:'‚Ä¢ Substrat tertiaire (ou benzylique/allylique)\n‚Ä¢ Solvant polaire protique (EtOH, H‚ÇÇO)\n‚Ä¢ Nucl√©ophile faible (H‚ÇÇO, EtOH)\n‚Ä¢ T¬∞ mod√©r√©e',product:'R‚ÇÉC-Nu (m√©lange rac√©mique si C chiral)',competition:'E1 en comp√©tition ‚Äî T¬∞‚Üë ‚Üí E1',stereo:'‚ö†Ô∏è Rac√©misation : carbocation plan ‚Üí attaque 2 c√¥t√©s ‚Üí 50/50 R + S',steps:[{title:'Ionisation h√©t√©rolytique (ECD)',eq:'R‚ÇÉC-X ‚Üí R‚ÇÉC‚Å∫ + X‚Åª',desc:'La liaison C-X se rompt h√©t√©rolytiquement. X‚Åª part. Formation d\'un carbocation plan sp¬≤ (120¬∞). √âtape lente cin√©tiquement d√©terminante.',note:'v = k‚ÇÅ[RX] ‚Äî Ordre 1 ‚Äî Solvant polaire protique stabilise X‚Åª'},{title:'Stabilisation du carbocation (sp¬≤)',eq:'R‚ÇÉC‚Å∫ ‚Üí stabilis√© par hyperconjugaison (alkyle)',desc:'Carbocation plan sp¬≤ stabilis√© par hyperconjugaison. Stabilit√© : 3¬∞ > allylique ‚âà benzylique > 2¬∞ > 1¬∞ > m√©thyle. R√©arrangements possibles.',note:'R√©arrangement ‚Üí carbocation plus stable possible'},{title:'Attaque nucl√©ophile des 2 c√¥t√©s',eq:'R‚ÇÉC‚Å∫ + Nu‚Åª ‚Üí R‚ÇÉC-Nu (2 faces)',desc:'Le nucl√©ophile attaque les deux faces du carbocation plan √©quiprobablement. Si le C √©tait chiral ‚Üí m√©lange rac√©mique 50/50.',note:'Rapidit√© de Nu‚Åª ne d√©termine pas la loi de vitesse'},{title:'Produit + comp√©tition E1',eq:'R‚ÇÉC-Nu ¬± alc√®ne (E1 si base pr√©sente)',desc:'Produit SN1 form√©. Comp√©tition avec E1 si base ou haute temp√©rature. T¬∞‚Üë ‚Üí E1 favoris√©e sur SN1.',note:'T¬∞‚Üë ‚Üí E1 // Nucl√©ophile fort ‚Üí SN1 // Solvant ‚Üí influence'}]},
  sn2:{title:'SN2 ‚Äî Substitution Nucl√©ophile Bimol√©culaire',global:'Nu‚Åª + R-X ‚Üí Nu-R + X‚Åª (m√©canisme concert√©)',balance:'Nu‚Åª + R-X ‚Üí [Nu¬∑¬∑¬∑C¬∑¬∑¬∑X]‚Ä° ‚Üí Nu-R + X‚Åª',conditions:'‚Ä¢ Substrat primaire (m√©thyle id√©al)\n‚Ä¢ Solvant polaire aprotique (DMSO, DMF)\n‚Ä¢ Nucl√©ophile fort et peu encombr√©\n‚Ä¢ T¬∞ mod√©r√©e',product:'Nu-R avec inversion totale (Walden)',competition:'E2 si base encombr√©e ou T¬∞‚Üë',stereo:'‚úÖ St√©r√©osp√©cifique : attaque 180¬∞ ‚Üí inversion 100% R‚ÜîS',steps:[{title:'Approche Nu‚Åª √† 180¬∞ de X',eq:'Nu‚Åª ¬∑¬∑¬∑¬∑¬∑ [C-X] (angle d\'attaque 180¬∞)',desc:'Nu‚Åª approche le carbone √©lectrophile exactement √† l\'oppos√© de X. Approche lin√©aire stricte. Pas d\'interm√©diaire. M√©canisme concert√©.',note:'Substrats primaires : moins encombr√©s ‚Üí r√©action plus rapide'},{title:'√âtat de transition ‚Ä° (bipyramidal)',eq:'Nu¬∑¬∑¬∑C¬∑¬∑¬∑X (structure trigonale bipyramidale sp¬≤)',desc:'Unique √©tat de transition : C li√© simultan√©ment √† Nu et X. 3 substituants restants en plan √† 90¬∞. Point d\'√©nergie maximale.',note:'Encombrement ‚Üí substrat 3¬∞ pratiquement inerte en SN2'},{title:'Rupture C-X + formation Nu-C simultan√©es',eq:'Nu-C + X‚Åª (inversion du parapluie)',desc:'Dans le m√™me √©lan : C-X se rompt, Nu-C se forme. Les 3 substituants basculent (parapluie retourn√©). Inversion spatiale totale.',note:'v = k‚ÇÇ[Nu‚Åª][RX] ‚Äî Ordre 2 global'},{title:'Produit : inversion de Walden',eq:'Produit Nu-C avec config. invers√©e (R‚ÜíS ou S‚ÜíR)',desc:'Inversion totale de configuration. Signature de SN2. Solvant aprotique stabilise Nu‚Åª sans le complexer (contrairement aux solvants protiques).',note:'St√©r√©osp√©cificit√© 100% ‚Äî solvant aprotique essentiel'}]},
  ae:{title:'AE ‚Äî Addition √âlectrophile sur Alc√®nes',global:'R-CH=CH‚ÇÇ + HX ‚Üí R-CHX-CH‚ÇÉ (Markovnikov)',balance:'R-CH=CH‚ÇÇ + H‚Å∫ ‚Üí R-CH‚Å∫-CH‚ÇÉ ‚Üí R-CHX-CH‚ÇÉ',conditions:'‚Ä¢ Alc√®ne (liaison œÄ nucl√©ophile)\n‚Ä¢ √âlectrophile : HX, H‚ÇÇSO‚ÇÑ, X‚ÇÇ, H‚ÇÇO/H‚Å∫\n‚Ä¢ Solvant variable\n‚Ä¢ T¬∞ ambiante',product:'Produit Markovnikov (H‚Å∫ sur C le plus H) // Anti-Markovnikov par hydroboration',competition:'X‚ÇÇ : ion bromonium ‚Üí anti-addition st√©r√©osp√©cifique',stereo:'Anti-addition pour X‚ÇÇ ‚Üí produit trans',steps:[{title:'Polarisation √©lectrophile au contact de œÄ',eq:'H-X ‚Üí HŒ¥‚Å∫ ¬∑¬∑¬∑ XŒ¥‚Åª (double liaison nucl√©ophile)',desc:'La double liaison œÄ est un nucl√©ophile naturel. L\'√©lectrophile H-X est polaris√©. La liaison œÄ attire H‚Å∫.',note:'Alc√®ne plus substitu√© = plus riche en √©lectrons = plus r√©actif'},{title:'Protonation ‚Äî R√®gle de Markovnikov',eq:'R-CH=CH‚ÇÇ + H‚Å∫ ‚Üí R-CH‚Å∫-CH‚ÇÉ (carbocation 2¬∞ ou 3¬∞)',desc:'H‚Å∫ s\'additionne sur le C le plus riche en H ‚Üí carbocation le plus stable (Markovnikov). √âtape lente.',note:'Markovnikov : H ‚Üí C le + pauvre en substituants ‚Üí carbocation + stable'},{title:'Carbocation interm√©diaire',eq:'Carbocation sp¬≤ plan ‚Äî r√©arrangements possibles',desc:'Carbocation plan stabilis√© par hyperconjugaison. R√©arrangements possibles vers le C‚Å∫ plus stable.',note:'Pour X‚ÇÇ : ion bromonium cyclique (pas de C‚Å∫ libre)'},{title:'Capture par X‚Åª',eq:'C‚Å∫ + X‚Åª ‚Üí produit Markovnikov',desc:'X‚Åª capture le carbocation. Pour X‚ÇÇ via bromonium ‚Üí anti-addition ‚Üí produit trans. Pour HX ‚Üí m√©lange de faces.',note:'X‚ÇÇ : bromonium ‚Üí anti-addition st√©r√©osp√©cifique'}]},
  an:{title:'AN ‚Äî Addition Nucl√©ophile sur D√©riv√©s Carbonyl√©s',global:'Nu‚Åª + R-CHO ‚Üí R-CH(Nu)-O‚Åª ‚Üí R-CH(Nu)-OH',balance:'Nu‚Åª + C=O ‚Üí Nu-C-O‚Åª ‚Üí Nu-C-OH (alcool)',conditions:'‚Ä¢ Ald√©hyde (plus r√©actif) ou c√©tone\n‚Ä¢ Nucl√©ophile : RMgX, NaBH‚ÇÑ, HCN...\n‚Ä¢ Milieu acide ou basique\n‚Ä¢ T¬∞ variable',product:'Alcool 2¬∞ (depuis ald√©hyde) ou 3¬∞ (depuis c√©tone)',competition:'√ânolisation en milieu basique si H Œ± pr√©sent',stereo:'M√©lange R+S si nouveau centre chiral',steps:[{title:'Activation du carbonyle (C=O Œ¥+)',eq:'R-C(=O) : C Œ¥+ tr√®s √©lectrophile',desc:'La liaison C=O est fortement polaris√©e (O √©lectron√©gatif). Le C carbonylique est appauvri (Œ¥+). Les ald√©hydes sont plus r√©actifs que les c√©tones (st√©rique + √©lectronique).',note:'Ald√©hyde > c√©tone : moins encombr√© et plus √©lectrophile'},{title:'Attaque nucl√©ophile (angle de B√ºrgi-Dunitz 107¬∞)',eq:'Nu‚Åª + C=O ‚Üí Nu-C-O‚Åª (alcoxyde t√©tra√©drique)',desc:'Nu‚Åª attaque le C carbonylique √† l\'angle de B√ºrgi-Dunitz (107¬∞), perpendiculairement au plan. Formation d\'un alcoxyde t√©tra√©drique anionique.',note:'Angle 107¬∞ optimal ‚Äî pas perpendiculaire mais oblique'},{title:'Protonation de l\'alcoxyde',eq:'Nu-C-O‚Åª + H‚Å∫ ‚Üí Nu-C-OH (alcool)',desc:'L\'alcoxyde est proton√© par le solvant ou lors du traitement acide. Formation de l\'alcool final. En milieu basique : traitement final.',note:'pH contr√¥le la r√©versibilit√©'},{title:'Produit alcool + applications',eq:'R-CH(Nu)-OH (alcool) selon le nucl√©ophile',desc:'NaBH‚ÇÑ ‚Üí H‚Åª ‚Üí alcool 1¬∞ ou 2¬∞. RMgX ‚Üí carbanion ‚Üí alcool 2¬∞ ou 3¬∞. HCN ‚Üí cyanohydrine. Amines primaires ‚Üí imine (condensation).',note:'RMgX = Grignard ‚Äî extension de cha√Æne carbon√©e'}]},
  ar:{title:'AR ‚Äî Addition Radicalaire (anti-Markovnikov)',global:'R-CH=CH‚ÇÇ + HBr ‚Üí R-CH‚ÇÇ-CH‚ÇÇBr (anti-Markov.)',balance:'Initiation ‚Üí Br‚Ä¢ + alc√®ne ‚Üí radical ‚Üí HBr ‚Üí produit',conditions:'‚Ä¢ Alc√®ne + HBr (pas HCl/HI)\n‚Ä¢ Initiateur : ROOR ou hŒΩ\n‚Ä¢ Solvant apolaire\n‚Ä¢ Attention : produit OPPOS√â √† AE',product:'Produit anti-Markovnikov : Br sur C terminal',competition:'Sans initiateur ‚Üí ionique (Markovnikov) ‚Üí AE !',stereo:'M√©lange peu s√©lectif',steps:[{title:'Initiation ‚Äî g√©n√©ration du radical Br‚Ä¢',eq:'ROOR ‚Üí 2 RO‚Ä¢ ; RO‚Ä¢ + HBr ‚Üí Br‚Ä¢ + ROH',desc:'L\'initiateur (peroxyde ou lumi√®re UV) g√©n√®re RO‚Ä¢ qui arrache H √† HBr, lib√©rant Br‚Ä¢. √âtape d\'initiation. Les radicaux sont des esp√®ces √† 1 √©lectron non appari√©.',note:'Radical = 1 √©lectron non appari√© ‚Äî tr√®s r√©actif'},{title:'Propagation 1 : Br‚Ä¢ attaque l\'alc√®ne',eq:'Br‚Ä¢ + R-CH=CH‚ÇÇ ‚Üí R-CHBr-CH‚ÇÇ‚Ä¢ (radical secondaire)',desc:'Br‚Ä¢ s\'additionne sur le C le plus substitu√© (forme le radical carbon√© le plus stable). Radical secondaire > radical primaire en stabilit√©.',note:'Radical 3¬∞ > 2¬∞ > 1¬∞ (comme carbocations)'},{title:'Propagation 2 : abstraction de H sur HBr',eq:'R-CHBr-CH‚ÇÇ‚Ä¢ + HBr ‚Üí R-CHBr-CH‚ÇÉ + Br‚Ä¢',desc:'Le radical carbon√© arrache H de HBr ‚Üí produit anti-Markovnikov + r√©g√©n√®re Br‚Ä¢ (continuit√© de la cha√Æne). Produit Br sur C terminal.',note:'Cha√Æne radicalaire auto-entretenue'},{title:'Terminaison',eq:'2 R‚Ä¢ ‚Üí R-R (fin de cha√Æne)',desc:'Combinaison de 2 radicaux met fin √† la r√©action. Le produit final est l\'halog√©nure anti-Markovnikov (Br sur C terminal). Diff√©rent de AE (Markovnikov).',note:'Anti-Markovnikov = signature de la r√©action radicalaire'}]},
  e1:{title:'E1 ‚Äî √âlimination Unimol√©culaire',global:'R‚ÇÉCH-CR‚ÇÇ-X ‚Üí R‚ÇÇC=CR‚ÇÇ + HX',balance:'R‚ÇÉCH-CR‚ÇÇ-X ‚Üí [R‚ÇÉCH-CR‚ÇÇ‚Å∫] + X‚Åª ‚Üí alc√®ne + H‚Å∫',conditions:'‚Ä¢ Substrat tertiaire (ou secondaire)\n‚Ä¢ Base faible (EtOH, H‚ÇÇO) ou neutre\n‚Ä¢ Solvant polaire protique\n‚Ä¢ T¬∞ haute (‚Üë E1 vs SN1)',product:'Alc√®ne Za√Øtsev (+ substitu√©) majoritaire',competition:'E1 toujours en comp√©tition avec SN1 (m√™me substrat)',stereo:'M√©lange E/Z ‚Äî Za√Øtsev majoritaire',steps:[{title:'Ionisation C-X (m√™me que SN1)',eq:'R‚ÇÉCH-CR‚ÇÇ-X ‚Üí R‚ÇÉCH-CR‚ÇÇ‚Å∫ + X‚Åª',desc:'Identique √† SN1 : rupture h√©t√©rolytique C-X, formation du carbocation. M√™me substrats, m√™mes conditions. √âtape cin√©tiquement d√©terminante.',note:'v = k‚ÇÅ[substrat] ‚Äî Ordre 1 ‚Äî m√™me comp√©tition SN1'},{title:'D√©part du proton HŒ≤ par une base',eq:'Base + H-CŒ≤-C‚Å∫ ‚Üí alc√®ne + BH‚Å∫',desc:'Une base (m√™me faible comme EtOH) arrache H sur CŒ≤ (adjacent au C‚Å∫). Formation de la liaison œÄ. Multiples Œ≤-H possibles ‚Üí m√©lange d\'alc√®nes.',note:'Za√Øtsev : H sur CŒ≤ le plus substitu√© ‚Üí alc√®ne + stable'},{title:'Alc√®ne majoritaire ‚Äî R√®gle de Za√Øtsev',eq:'Alc√®ne + substitu√© (Za√Øtsev) majoritaire',desc:'L\'alc√®ne le plus substitu√© (plus stable) est favori : thermodynamique. Base encombr√©e (t-BuOK) ‚Üí Hofmann (alc√®ne moins substitu√©). T¬∞‚Üë ‚Üí E1 dominant sur SN1.',note:'Za√Øtsev : base faible // Hofmann : base volumineuse (t-BuOK)'}]},
  e2:{title:'E2 ‚Äî √âlimination Bimol√©culaire',global:'Base + H-C-C-X ‚Üí alc√®ne + BH + X‚Åª (concert√©)',balance:'Base¬∑¬∑¬∑H-CŒ±-CŒ≤-X ‚Üí [‚Ä° concert√©] ‚Üí alc√®ne + BH + X‚Åª',conditions:'‚Ä¢ Base forte et encombr√©e (t-BuOK, NaOH conc.)\n‚Ä¢ Substrat 1¬∞, 2¬∞ ou 3¬∞\n‚Ä¢ G√©om√©trie anti-p√©riplanaire requise !\n‚Ä¢ T¬∞ haute',product:'Alc√®ne Za√Øtsev ou Hofmann (selon base)',competition:'E2 vs SN2 : base encombr√©e ‚Üí E2',stereo:'‚úÖ St√©r√©osp√©cifique : H et X anti-p√©riplanaires obligatoires',steps:[{title:'Conformation anti-p√©riplanaire (Newman)',eq:'H-CŒ±-CŒ≤-X : di√®dre H-C-C-X = 180¬∞',desc:'Exigence g√©om√©trique stricte : H sur CŒ± et X sur CŒ≤ doivent √™tre anti-p√©riplanaires (di√®dre 180¬∞). Visualiser en projection de Newman. La conformation dicte le produit E/Z.',note:'Projection de Newman ‚Äî di√®dre 180¬∞ obligatoire'},{title:'Attaque concert√©e √† 4 centres',eq:'Base¬∑¬∑¬∑H-CŒ±=CŒ≤¬∑¬∑¬∑X ‚Üí ‚Ä° (4 centres en ligne)',desc:'Processus concert√© : base attaque H, œÄ C=C se forme entre CŒ±-CŒ≤, X‚Åª part. Simultan√©. Pas d\'interm√©diaire. M√©canisme le plus direct.',note:'v = k‚ÇÇ[substrat][base] ‚Äî Ordre 2 global'},{title:'Alc√®ne st√©r√©osp√©cifique (E ou Z)',eq:'Alc√®ne E ou Z selon la conformation anti du substrat',desc:'La g√©om√©trie E ou Z de l\'alc√®ne est dict√©e par la conformation anti. Base encombr√©e (t-BuOK) ‚Üí Hofmann (alc√®ne moins substitu√©). Base petite ‚Üí Za√Øtsev.',note:'t-BuOK ‚Üí Hofmann // NaOH ‚Üí Za√Øtsev // Anti-p√©riplanaire'}]},
  sear:{title:'SEAr ‚Äî Substitution √âlectrophile Aromatique',global:'ArH + E‚Å∫ ‚Üí Ar-E + H‚Å∫ (aromaticit√© pr√©serv√©e)',balance:'ArH + E‚Å∫ ‚Üí [œÉ-complexe]‚Å∫ ‚Üí Ar-E + H‚Å∫',conditions:'‚Ä¢ Ar√®ne (benz√®ne ou d√©riv√©)\n‚Ä¢ √âlectrophile fort (NO‚ÇÇ‚Å∫, Br‚Å∫, SO‚ÇÉ)\n‚Ä¢ Catalyseur Lewis (AlCl‚ÇÉ, FeBr‚ÇÉ)\n‚Ä¢ Solvant apolaire',product:'Ar√®ne mono-substitu√© (orientation ortho/para ou m√©ta)',competition:'Donneurs ‚Üí ortho/para // Attracteurs ‚Üí m√©ta',stereo:'Pas de st√©r√©ochimie',steps:[{title:'G√©n√©ration de l\'√©lectrophile E‚Å∫',eq:'HNO‚ÇÉ + H‚ÇÇSO‚ÇÑ ‚Üí NO‚ÇÇ‚Å∫ + H‚ÇÇO (nitration)',desc:'Selon la r√©action : NO‚ÇÇ‚Å∫ pour nitration, X‚Å∫ pour halog√©nation (avec Lewis), SO‚ÇÉ pour sulfonation, RCO‚Å∫ pour acylation de F-C. √âlectrophile tr√®s r√©actif.',note:'Halog√©nation : Br‚ÇÇ + FeBr‚ÇÉ ‚Üí Br‚Å∫FeBr‚ÇÑ‚Åª'},{title:'Attaque sur le cycle ‚Üí œÉ-complexe (Wheland)',eq:'ArH + E‚Å∫ ‚Üí [Ar(E)H]‚Å∫ (œÉ-complexe)',desc:'E‚Å∫ attaque le cycle, rompant temporairement l\'aromaticit√©. Formation du œÉ-complexe charg√© positif (carbocation de Wheland). √âtape lente.',note:'Substituants donneurs (OH, OR, NR‚ÇÇ) activent et orientent ortho/para'},{title:'R√©tablissement de l\'aromaticit√©',eq:'[Ar(E)H]‚Å∫ ‚Üí Ar-E + H‚Å∫',desc:'La base arrache H‚Å∫ pour r√©tablir l\'aromaticit√©. Force motrice : stabilisation aromatique retrouv√©e. Produit = ar√®ne substitu√©. Contraire de AE sur alc√®nes (qui retient l\'addition).',note:'Attracteurs (NO‚ÇÇ, CN, COOH) d√©sactivent et orientent m√©ta'}]},
  acyl:{title:'Acylation de Friedel-Crafts',global:'ArH + RCOCl + AlCl‚ÇÉ ‚Üí Ar-CO-R + HCl',balance:'RCOCl + AlCl‚ÇÉ ‚Üí RCO‚Å∫ + AlCl‚ÇÑ‚Åª ‚Üí SEAr ‚Üí Ar-CO-R',conditions:'‚Ä¢ Ar√®ne (sans groupes d√©sactivants forts)\n‚Ä¢ Chlorure d\'acyle + AlCl‚ÇÉ\n‚Ä¢ Solvant apolaire (CH‚ÇÇCl‚ÇÇ)\n‚Ä¢ T¬∞ ambiante √† reflux',product:'C√©tone aromatique (pas de r√©arrangement!)',competition:'‚â† Alkylation FC qui donne r√©arrangements',stereo:'Pas de st√©r√©ochimie',steps:[{title:'Activation par AlCl‚ÇÉ ‚Üí ion acylium',eq:'RCOCl + AlCl‚ÇÉ ‚Üí [RCO]‚Å∫ + [AlCl‚ÇÑ]‚Åª',desc:'AlCl‚ÇÉ (acide de Lewis fort) arrache Cl‚Åª du chlorure d\'acyle. Formation de l\'ion acylium RCO‚Å∫ stabilis√© par r√©sonance R-C‚â°O‚Å∫ ‚Üî R‚Å∫C=O. Tr√®s √©lectrophile. PAS de r√©arrangement.',note:'Ion acylium = stable par r√©sonance ‚Üí ‚â† alkylation FC (r√©arrangement possible)'},{title:'SEAr : attaque de l\'ion acylium',eq:'ArH + RCO‚Å∫ ‚Üí [œÉ-complexe]‚Å∫',desc:'L\'ion acylium attaque le cycle aromatique. Formation du œÉ-complexe. L\'aromaticit√© est temporairement perdue. √âtape lente.',note:'Cycle activ√© (OH, alkyle) ‚Üí plus rapide / cycle d√©sactiv√© (NO‚ÇÇ) ‚Üí lent'},{title:'Restauration de l\'aromaticit√© ‚Üí c√©tone',eq:'œÉ-complexe + AlCl‚ÇÑ‚Åª ‚Üí Ar-CO-R + HCl + AlCl‚ÇÉ',desc:'La base AlCl‚ÇÑ‚Åª arrache H‚Å∫. Aromaticit√© r√©tablie. La c√©tone produite complexe AlCl‚ÇÉ ‚Üí 1 √©quivalent consomm√©. Produit = c√©tone aromatique (stable, pas monosubstitu√© + Ar-CO d√©sactivant).',note:'1 √©quiv. AlCl‚ÇÉ minimal requis (complex√© par la c√©tone produite)'}]},
  nitrat:{title:'Nitration du Benz√®ne',global:'C‚ÇÜH‚ÇÜ + HNO‚ÇÉ ‚Üí C‚ÇÜH‚ÇÖNO‚ÇÇ + H‚ÇÇO (H‚ÇÇSO‚ÇÑ conc.)',balance:'HNO‚ÇÉ + H‚ÇÇSO‚ÇÑ ‚Üí NO‚ÇÇ‚Å∫ + HSO‚ÇÑ‚Åª + H‚ÇÇO ‚Üí C‚ÇÜH‚ÇÖNO‚ÇÇ',conditions:'‚Ä¢ Benz√®ne + HNO‚ÇÉ fumant\n‚Ä¢ H‚ÇÇSO‚ÇÑ concentr√© (catalyseur/protonant)\n‚Ä¢ T¬∞ < 60¬∞C (√©viter di/trinitration)\n‚Ä¢ T¬∞ 0¬∞C pour nitration douce',product:'Nitrobenz√®ne (jaune p√¢le, odeur d\'amandes am√®res)',competition:'T¬∞‚Üë ‚Üí dinitration, trinitration (TNT !)',stereo:'Pas de st√©r√©ochimie',steps:[{title:'G√©n√©ration de l\'ion nitronium NO‚ÇÇ‚Å∫',eq:'HNO‚ÇÉ + 2H‚ÇÇSO‚ÇÑ ‚Üí NO‚ÇÇ‚Å∫ + H‚ÇÉO‚Å∫ + 2HSO‚ÇÑ‚Åª',desc:'H‚ÇÇSO‚ÇÑ concentr√© protone l\'acide nitrique. Formation de l\'ion nitronium NO‚ÇÇ‚Å∫ (√©lectrophile puissant, lin√©aire). C\'est l\'agent nitrant r√©el de la r√©action.',note:'T¬∞ < 60¬∞C imp√©rative pour √©viter la polynitration'},{title:'Attaque du NO‚ÇÇ‚Å∫ sur le benz√®ne',eq:'C‚ÇÜH‚ÇÜ + NO‚ÇÇ‚Å∫ ‚Üí [C‚ÇÜH‚ÇÜNO‚ÇÇ]‚Å∫ (œÉ-complexe)',desc:'NO‚ÇÇ‚Å∫ attaque le cycle benz√©nique. Formation du œÉ-complexe (ar√©nonium). L\'aromaticit√© est temporairement perdue. √âtape lente et d√©terminante.',note:'Substituts donneurs ‚Üí nitration plus rapide en ortho/para'},{title:'Perte de H‚Å∫ ‚Üí nitrobenz√®ne',eq:'[C‚ÇÜH‚ÇÜNO‚ÇÇ]‚Å∫ ‚Üí C‚ÇÜH‚ÇÖNO‚ÇÇ + H‚Å∫',desc:'HSO‚ÇÑ‚Åª arrache H‚Å∫. Aromaticit√© r√©tablie. Nitrobenz√®ne form√©. Le groupe NO‚ÇÇ est d√©sactivant m√©ta (pour les nitrations suivantes). R√©duction ‚Üí aniline.',note:'NO‚ÇÇ est fortement d√©sactivant m√©ta ‚Üí mono-nitration favoris√©e'}]},
  estherif:{title:'Est√©rification de Fischer / Hydrolyse',global:'RCOOH + R\'OH ‚áå RCOOR\' + H‚ÇÇO (√©quilibre)',balance:'RCOOH + R\'OH ‚áå RCOOR\' + H‚ÇÇO (Keq ‚âà 1-10)',conditions:'‚Ä¢ Acide carboxylique + alcool 1¬∞\n‚Ä¢ Catalyseur H‚Å∫ (H‚ÇÇSO‚ÇÑ conc.)\n‚Ä¢ Reflux prolong√©\n‚Ä¢ √âliminer H‚ÇÇO ‚Üí d√©place l\'√©quilibre',product:'Ester RCOOR\' + eau (r√©versible ‚Äî taux max ‚âà 67%)',competition:'Hydrolyse (inverse) / Saponification (OH‚Åª, irr√©versible)',stereo:'Pas de st√©r√©ochimie',steps:[{title:'Protonation du C=O par H‚Å∫',eq:'RCOOH + H‚Å∫ ‚Üí RC(=OH)‚ÇÇ‚Å∫ (cation activ√©)',desc:'H‚Å∫ protone le carbonyle de l\'acide carboxylique. Activation du C carbonylique vers l\'attaque nucl√©ophile de l\'alcool.',note:'Catalyse acide ‚Äî m√©canisme r√©versible √† chaque √©tape'},{title:'Attaque nucl√©ophile de R\'OH',eq:'R\'OH + RC(=OH)‚ÇÇ‚Å∫ ‚Üí interm√©diaire t√©tra√©drique',desc:'L\'alcool (nucl√©ophile) attaque le C carbonylique activ√©. Interm√©diaire t√©tra√©drique avec deux OH et un OR\'.',note:'Deux groupes OH pouvant partir (l\'un deviendra H‚ÇÇO)'},{title:'√âlimination de H‚ÇÇO',eq:'Interm√©diaire ‚Üí RCOOR\' + H‚ÇÇO + H‚Å∫',desc:'Une des fonctions OH est proton√©e et part comme H‚ÇÇO. H‚Å∫ est r√©g√©n√©r√©. L\'ester se forme.',note:'√âliminer H‚ÇÇO (tamis mol√©culaire, Soxhlet) d√©place l\'√©quilibre'},{title:'√âquilibre est√©rification/hydrolyse',eq:'RCOOR\' + H‚ÇÇO ‚áå RCOOH + R\'OH (Keq‚âà1-10)',desc:'R√©action r√©versible. Pour favoriser l\'ester : exc√®s alcool, √©liminer H‚ÇÇO, extraire l\'ester. Hydrolyse = sens inverse avec exc√®s d\'eau.',note:'Keq ‚âà 1 √† 10 selon R et R\' // taux max sans manipulation ‚âà 67%'}]},
  sapo:{title:'Saponification (Hydrolyse Alcaline)',global:'RCOOR\' + OH‚Åª ‚Üí RCOO‚Åª + R\'OH (irr√©versible)',balance:'RCOOR\' + NaOH ‚Üí RCOONa + R\'OH',conditions:'‚Ä¢ Ester + base forte (NaOH, KOH concentr√©)\n‚Ä¢ H‚ÇÇO ou m√©lange H‚ÇÇO/EtOH\n‚Ä¢ Reflux\n‚Ä¢ Irr√©versible (carboxylate stable)',product:'Carboxylate RCOO‚Åª + alcool R\'OH (savon = C‚ÇÅ‚ÇÇ-C‚ÇÅ‚Çà)',competition:'‚â† Hydrolyse acide (r√©versible) // Saponification compl√®te',stereo:'R√©tention de configuration (AN-2)',steps:[{title:'Attaque nucl√©ophile de OH‚Åª sur C=O',eq:'OH‚Åª + RCOOR\' ‚Üí RC(OH)(OR\')(O‚Åª) t√©tra√©drique',desc:'OH‚Åª (fort nucl√©ophile) attaque le C carbonylique de l\'ester. Formation d\'un interm√©diaire anionique t√©tra√©drique.',note:'OH‚Åª >> H‚ÇÇO en r√©activit√© comme nucl√©ophile'},{title:'D√©part de OR\'‚Åª (alcoolate)',eq:'Interm√©diaire ‚Üí RCOOH + R\'O‚Åª',desc:'L\'alcoolate OR\'‚Åª part. L\'acide carboxylique est form√© transitoirement.',note:'Irr√©versibilit√© due √† la neutralisation suivante'},{title:'Neutralisation irr√©versible ‚Üí carboxylate',eq:'RCOOH + OH‚Åª ‚Üí RCOO‚Åª + H‚ÇÇO (irr√©versible!)',desc:'L\'acide est imm√©diatement neutralis√© par OH‚Åª ‚Üí carboxylate RCOO‚Åª. C\'est ce qui rend la saponification irr√©versible. Diff√©rence fondamentale avec l\'hydrolyse acide.',note:'Savon = sel Na/K d\'acide gras (st√©arate, palmitate...)'}]},
  oxred:{title:'Oxydation des Alcools',global:'1¬∞ ‚Üí ald√©hyde (doux) ou acide (fort) // 2¬∞ ‚Üí c√©tone',balance:'R-CH‚ÇÇOH + [O] ‚Üí R-CHO ‚Üí R-COOH',conditions:'‚Ä¢ PCC/Swern (doux) : alcool 1¬∞ ‚Üí ald√©hyde\n‚Ä¢ KMnO‚ÇÑ/H‚ÇÇSO‚ÇÑ (fort) : alcool 1¬∞ ‚Üí acide\n‚Ä¢ Alcool 2¬∞ ‚Üí c√©tone (tous oxydants)\n‚Ä¢ Alcool 3¬∞ : r√©sistant!',product:'1¬∞ doux ‚Üí ald√©hyde // 1¬∞ fort ‚Üí acide // 2¬∞ ‚Üí c√©tone',competition:'Alcool 3¬∞ (R‚ÇÉC-OH) ne s\'oxyde pas (pas de H sur C-OH)',stereo:'Perte du centre chiral si 2¬∞ ‚Üí c√©tone',steps:[{title:'Complexation de l\'alcool avec l\'oxydant',eq:'R-CH‚ÇÇOH + Cr(VI) ‚Üí ester chromique interm√©diaire',desc:'L\'alcool r√©agit avec l\'oxydant chrom√© (PCC, K‚ÇÇCr‚ÇÇO‚Çá). Formation d\'un ester chromique interm√©diaire sur le C-OH. La liaison C-H du C-OH est activ√©e.',note:'PCC = chlorochromate de pyridinium ‚Äî oxydant doux'},{title:'Rupture C-H via m√©canisme E2-like',eq:'C-H ‚Üí C=O (Œ≤-√©limination interne)',desc:'Une base (interne au complexe) arrache H sur le carbone portant l\'oxyg√®ne. M√©canisme E2-like. La liaison C-H se rompt simultan√©ment √† la formation de C=O.',note:'Alcool 3¬∞ (R‚ÇÉC-OH) : pas de H sur C ‚Üí non oxydable!'},{title:'Produit selon l\'oxydant',eq:'Doux(PCC) ‚Üí R-CHO // Fort(KMnO‚ÇÑ) ‚Üí R-COOH',desc:'PCC : s\'arr√™te √† l\'ald√©hyde car en solvant anhydre, l\'ald√©hyde ne peut pas s\'hydrater en gem-diol. KMnO‚ÇÑ en milieu aqueux oxyde l\'ald√©hyde en acide via le gem-diol.',note:'Alcool 2¬∞ ‚Üí c√©tone avec TOUS les oxydants (m√™me PCC)'}]},
  diazot:{title:'Diazotation des Anilines',global:'ArNH‚ÇÇ + NaNO‚ÇÇ + HCl ‚Üí [ArN‚â°N]‚Å∫Cl‚Åª + NaCl + H‚ÇÇO',balance:'ArNH‚ÇÇ + NO‚Å∫ ‚Üí ArN‚ÇÇ‚Å∫ (√† 0-5¬∞C)',conditions:'‚Ä¢ Amine aromatique primaire (aniline)\n‚Ä¢ NaNO‚ÇÇ + HCl (ou H‚ÇÇSO‚ÇÑ)\n‚Ä¢ T¬∞ ‚â§ 5¬∞C imp√©rative\n‚Ä¢ Traitement imm√©diat du diazonium',product:'Sel de diazonium [Ar-N‚â°N]‚Å∫ (interm√©diaire polyvalent)',competition:'T¬∞ > 5¬∞C ‚Üí d√©composition explosive du diazonium',stereo:'Pas de st√©r√©ochimie',steps:[{title:'Formation de NO‚Å∫ (ion nitrosonium)',eq:'NaNO‚ÇÇ + HCl ‚Üí HNO‚ÇÇ ; HNO‚ÇÇ ‚Üí NO‚Å∫ + H‚ÇÇO',desc:'En milieu acide, HNO‚ÇÇ (instable, pr√©par√© in situ) se forme et g√©n√®re l\'ion nitrosonium NO‚Å∫ tr√®s √©lectrophile. √Ä 0-5¬∞C pour √©viter la d√©composition.',note:'HNO‚ÇÇ instable : pr√©par√© in situ ‚Äî jamais stock√©'},{title:'Attaque de NO‚Å∫ sur l\'aniline',eq:'ArNH‚ÇÇ + NO‚Å∫ ‚Üí Ar-NH-N=O (nitrosamine)',desc:'NO‚Å∫ attaque le doublet de N de l\'aniline. Formation d\'une nitrosamine interm√©diaire Ar-NH-N=O.',note:'Amine aliphatique : r√©action similaire mais diazonium instable'},{title:'Tautom√©risation ‚Üí sel de diazonium',eq:'Ar-NH-N=O ‚Üí [Ar-N‚â°N]‚Å∫ X‚Åª (stable √† 0-5¬∞C)',desc:'La nitrosamine se tautom√©rise et se protone ‚Üí sel de diazonium stabilis√© par r√©sonance avec le cycle. Stable uniquement √† 0-5¬∞C.',note:'T¬∞ ‚â§ 5¬∞C imp√©rative ‚Äî d√©composition au-del√†'},{title:'Utilisation du diazonium (r√©actions)',eq:'[ArN‚ÇÇ]‚Å∫ ‚Üí Ar-X (Sandmeyer), Ar-OH, Ar-H, Ar-N=N-Ar\'',desc:'Le diazonium est extr√™mement polyvalent : Sandmeyer (CuBr ‚Üí Ar-Br, CuCN ‚Üí Ar-CN), Ph√©nol (H‚ÇÇO, Œî ‚Üí Ar-OH), R√©duction (H‚ÇÉPO‚ÇÇ ‚Üí Ar-H), Couplage azo√Øque.',note:'Sandmeyer : Cu‚ÇÇX‚ÇÇ ‚Üí remplacement N‚ÇÇ par halog√®ne ou CN'}]},
  grignard:{title:'R√©actif de Grignard (Organo-magn√©sien)',global:'R-X + Mg ‚Üí R-MgX (√©ther) // R-MgX + C=O ‚Üí alcool',balance:'R-X + Mg ‚Üí R-MgX ‚Üí R-C(OMgX)- ‚Üí H‚ÇÉO‚Å∫ ‚Üí alcool',conditions:'‚Ä¢ Halog√©nure + Mg m√©tal\n‚Ä¢ √âther ANHYDRE (Et‚ÇÇO, THF)\n‚Ä¢ Atmosph√®re inerte (N‚ÇÇ ou Ar)\n‚Ä¢ Ajout lent et contr√¥l√©',product:'Alcool 1¬∞ (HCHO), 2¬∞ (RCHO), 3¬∞ (RCOR\') ou acide (CO‚ÇÇ)',competition:'L\'eau d√©truit instantan√©ment le Grignard!',stereo:'M√©lange R+S si nouveau centre chiral',steps:[{title:'Formation R-MgX ‚Äî insertion de Mg',eq:'R-X + Mg ‚Üí R-MgX (conditions anhydres)',desc:'Le Mg m√©tal s\'ins√®re dans la liaison C-X. Formation de R-MgX en milieu √©th√©r√© anhydre. R est un carbanion fort. Toute trace d\'eau ou d\'alcool d√©truit le r√©actif.',note:'Anhydre imp√©ratif ‚Äî H‚ÇÇO, EtOH, acides d√©truisent imm√©diatement'},{title:'Propri√©t√©s de R-MgX',eq:'R-MgX ‚â° R‚Åª (carbanion fort) + MgX‚Å∫',desc:'R-MgX est un nucl√©ophile et base tr√®s fort. R√©agit avec : eau (‚Üí R-H), CO‚ÇÇ (‚Üí acide), alcool (‚Üí R-H), nitrile (‚Üí c√©tone), ester (‚Üí alcool 3¬∞), ald√©hyde/c√©tone (‚Üí alcool).',note:'Applications : HCHO ‚Üí alcool 1¬∞ // RCHO ‚Üí 2¬∞ // RCOR\' ‚Üí 3¬∞ // CO‚ÇÇ ‚Üí acide'},{title:'Addition sur le C=O √©lectrophile',eq:'R-MgX + RCHO ‚Üí R-CH(OMgX)-R\' ‚Üí H‚ÇÉO‚Å∫ ‚Üí alcool',desc:'R-MgX (carbanion √©quivalent) attaque le C=O √©lectrophile. Formation d\'un alcoolate de magn√©sium. Traitement par acide dilu√© (H‚ÇÉO‚Å∫) lib√®re l\'alcool.',note:'Extension de cha√Æne : + n carbones provenant de R-X'},{title:'Applications et traitement acide',eq:'Alcoolate MgX + H‚ÇÉO‚Å∫ ‚Üí alcool + Mg(OH)X',desc:'Traitement acide dilu√© lib√®re l\'alcool. Autres : CO‚ÇÇ ‚Üí acide (+1C), Ester ‚Üí alcool 3¬∞ (2 cha√Ænes R ajout√©es), Nitrile ‚Üí c√©tone. Indispensable en synth√®se pour cr√©er des liaisons C-C.',note:'Grignard = outil puissant pour cr√©er des liaisons C-C'}]}
};

let mechState={current:null,step:0,total:0,autoInterval:null};

function loadMechanism(){
  const sel=document.getElementById('mechSel').value;
  const mech=MECHS[sel];if(!mech)return;
  mechState={current:sel,step:0,total:mech.steps.length,autoInterval:null};
  sessionStats.mechLoaded++;updateSessionStats();
  document.getElementById('rxn-title').textContent=mech.title;
  document.getElementById('rxn-global').textContent=mech.global;
  document.getElementById('conditions-box').innerHTML=mech.conditions.replace(/\n/g,'<br>');
  document.getElementById('product-box').textContent=mech.product;
  document.getElementById('competition-box').innerHTML=(mech.competition||'‚Äî').replace(/\n/g,'<br>');
  if(mech.stereo){document.getElementById('mech-stereochem').textContent=mech.stereo;document.getElementById('mech-stereochem').style.display='block';}
  else{document.getElementById('mech-stereochem').style.display='none';}
  if(mech.balance){document.getElementById('balance-container').style.display='block';document.getElementById('balance-eq').textContent=mech.balance;}
  else{document.getElementById('balance-container').style.display='none';}
  const container=document.getElementById('steps-container');
  container.innerHTML='';
  mech.steps.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className='mech-step-box'+(i===0?' active':'');div.id='step-'+i;
    div.innerHTML=`<div style="display:flex;align-items:center;margin-bottom:6px;"><span class="step-num">${i+1}</span><span class="step-title">${s.title}</span></div><div class="step-eq">${s.eq}</div><div class="step-desc">${s.desc}</div><div class="step-note">‚ö° ${s.note}</div>`;
    container.appendChild(div);
  });
  const dotsEl=document.getElementById('mech-dots');dotsEl.innerHTML='';
  mech.steps.forEach((_,i)=>{const d=document.createElement('div');d.className='mech-dot'+(i===0?' active':'');d.onclick=()=>goToStep(i);dotsEl.appendChild(d);});
  document.getElementById('mech-nav').style.display='flex';
  updateStepCounter();drawMechMol(sel,0);drawEnergyMini(sel);
  setStatus('green','M√©canisme : '+mech.title.split('‚Äî')[0].trim());
}

function goToStep(n){
  if(!mechState.current)return;
  const mech=MECHS[mechState.current];
  mechState.step=Math.max(0,Math.min(n,mech.steps.length-1));
  document.querySelectorAll('.mech-step-box').forEach((b,i)=>b.classList.toggle('active',i===mechState.step));
  document.querySelectorAll('.mech-dot').forEach((d,i)=>d.classList.toggle('active',i===mechState.step));
  updateStepCounter();drawMechMol(mechState.current,mechState.step);
}
function nextStep(){goToStep(mechState.step+1);}
function prevStep(){goToStep(mechState.step-1);}
function resetMech(){
  if(mechState.autoInterval)clearInterval(mechState.autoInterval);
  mechState={current:null,step:0,total:0,autoInterval:null};
  document.getElementById('steps-container').innerHTML='<div id="step-placeholder" style="text-align:center;padding:35px;color:var(--muted);font-size:.82rem;">‚öóÔ∏è Chargez un m√©canisme</div>';
  document.getElementById('mech-nav').style.display='none';
  document.getElementById('rxn-title').textContent='S√©lectionnez un m√©canisme';
  document.getElementById('mech-stereochem').style.display='none';
  document.getElementById('balance-container').style.display='none';
  document.getElementById('btn-auto').textContent='‚èµ AUTO-PLAY';
}
function autoPlay(){
  if(!mechState.current)return;
  if(mechState.autoInterval){clearInterval(mechState.autoInterval);mechState.autoInterval=null;document.getElementById('btn-auto').textContent='‚èµ AUTO-PLAY';return;}
  document.getElementById('btn-auto').textContent='‚èπ STOP';
  mechState.autoInterval=setInterval(()=>{
    if(mechState.step>=mechState.total-1){clearInterval(mechState.autoInterval);mechState.autoInterval=null;document.getElementById('btn-auto').textContent='‚èµ AUTO-PLAY';}
    else{nextStep();}
  },2500);
}
function updateStepCounter(){if(mechState.current)document.getElementById('step-counter').textContent=`√âtape ${mechState.step+1} / ${mechState.total}`;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CANVAS DRAWING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function drawMechMol(mech,step){
  const c=document.getElementById('mechCanvas');if(!c)return;
  const ctx=c.getContext('2d');const w=c.width,h=c.height;
  ctx.fillStyle='#1c1410';ctx.fillRect(0,0,w,h);
  const colors={C:'#a8e6cf',O:'#ff6b6b',N:'#74b9ff',H:'#ffeaa7',X:'#fdcb6e',Nu:'#74b9ff',T:'#fd79a8'};
  function atom(x,y,el,r=14,extra=''){ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);const g=ctx.createRadialGradient(x-2,y-2,1,x,y,r);g.addColorStop(0,'rgba(255,255,255,0.2)');g.addColorStop(1,'rgba(0,0,0,0.1)');ctx.fillStyle=colors[el]||'#ccc';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.2)';ctx.lineWidth=1;ctx.stroke();ctx.fillStyle='#1c1410';ctx.font=`bold 9px Fira Code`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(el,x,y);if(extra){ctx.fillStyle='rgba(255,255,255,0.7)';ctx.font='7px Fira Code';ctx.fillText(extra,x,y+18);}}
  function bond(x1,y1,x2,y2,t='single'){ctx.strokeStyle='rgba(200,200,200,0.55)';ctx.lineWidth=t==='double'?4:2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();if(t==='double'){ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.lineWidth=1;ctx.beginPath();const dx=y2-y1,dy=x1-x2,l=Math.sqrt(dx*dx+dy*dy)||1;ctx.moveTo(x1+4*dx/l,y1+4*dy/l);ctx.lineTo(x2+4*dx/l,y2+4*dy/l);ctx.stroke();}}
  function arrow(x1,y1,x2,y2,col='#fdcb6e'){ctx.strokeStyle=col;ctx.fillStyle=col;ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);const a=Math.atan2(y2-y1,x2-x1);ctx.lineTo(x2-8*Math.cos(a-0.4),y2-8*Math.sin(a-0.4));ctx.moveTo(x2,y2);ctx.lineTo(x2-8*Math.cos(a+0.4),y2-8*Math.sin(a+0.4));ctx.stroke();}
  function label(x,y,t,col='rgba(255,255,255,0.5)',sz='8px'){ctx.fillStyle=col;ctx.font=`${sz} Fira Code`;ctx.textAlign='center';ctx.fillText(t,x,y);}

  const mtype=mech||'sn1';
  if(mtype==='sn1'){
    if(step===0){bond(55,80,120,80);atom(55,80,'C');atom(120,80,'C');atom(175,80,'X','#fdcb6e');bond(120,80,175,80);atom(120,130,'H');bond(120,80,120,130);atom(75,130,'H');bond(55,80,75,130);label(125,60,'R‚ÇÉC‚ÄîX ‚Üí C‚Å∫ + X‚Åª','#fd79a8');}
    else if(step===1){atom(120,100,'C','#fd79a8',18);label(120,125,'carbocation sp¬≤','#fd79a8','9px');label(120,62,'plan ‚Üí 120¬∞','rgba(255,255,255,.45)');}
    else if(step===2){atom(60,100,'Nu','#74b9ff',18);atom(180,100,'Nu','#74b9ff',18);atom(120,100,'C',16);arrow(75,100,105,100,'#74b9ff');arrow(165,100,135,100,'#74b9ff');label(120,145,'2 faces ‚Üí rac√©misation','rgba(212,160,23,.9)');}
    else{atom(120,100,'C',16);atom(60,90,'Nu','#74b9ff');atom(185,90,'X','#fdcb6e');bond(120,100,60,90);label(120,145,'R‚ÇÉC-Nu (R/S)','#a8e6cf');}
  } else if(mtype==='sn2'){
    if(step===0){atom(50,105,'Nu','#74b9ff',16);atom(145,105,'C',16);atom(220,105,'X','#fdcb6e',16);bond(80,105,125,105);bond(165,105,205,105);arrow(65,95,135,105,'#74b9ff');label(135,60,'180¬∞ lin√©aire','rgba(255,255,255,.5)');}
    else if(step===1){atom(50,105,'Nu','#74b9ff',16);atom(145,105,'C','#fd79a8',16);atom(220,105,'X','#fdcb6e',16);bond(80,105,129,105);bond(161,105,205,105);[100,180].forEach(y=>{atom(145,y,'R',12);bond(145,121,145,100+y/180*-24+24);});label(135,50,'‚Ä° bipyramidal','#fd79a8');}
    else if(step===2){atom(145,105,'C',16);atom(50,105,'Nu','#74b9ff',16);atom(220,105,'X','#fdcb6e',16);bond(75,105,130,105);bond(160,105,210,105);arrow(200,90,160,105,'rgba(255,100,100,.8)');label(135,60,'parapluie retourn√©','rgba(255,255,255,.5)');}
    else{atom(145,105,'C',16);atom(50,105,'Nu','#74b9ff',16);bond(75,105,130,105);label(135,60,'inversion Walden 100%','#a8e6cf');}
  } else if(mtype==='ae'){
    if(step===0){bond(60,105,140,105,'double');atom(60,105,'C',14);atom(140,105,'C',14);atom(185,75,'H','#ffeaa7',12);label(100,140,'œÄ nucl√©ophile','#a8e6cf');arrow(155,90,175,80,'#ffeaa7');}
    else if(step===1){atom(60,105,'C',14);atom(140,105,'C','#fd79a8',16);bond(60,105,140,105);atom(185,75,'H','#ffeaa7',12);bond(140,105,185,75);label(100,140,'Markovnikov ‚Üí C‚Å∫ stable','#fd79a8');}
    else if(step===2){atom(60,105,'C',14);atom(140,105,'C','#fd79a8',16);bond(60,105,140,105);atom(185,75,'H','#ffeaa7',12);bond(140,105,185,75);label(100,140,'r√©arrangements possibles','rgba(255,255,255,.5)');}
    else{atom(60,105,'C',14);atom(140,105,'C',14);bond(60,105,140,105);atom(185,75,'H','#ffeaa7',12);atom(55,60,'X','#fdcb6e',12);bond(140,105,185,75);bond(60,105,55,60);label(100,140,'Produit Markovnikov','#a8e6cf');}
  } else {
    // generic display
    atom(80,90,'C',16);atom(160,90,'C',16);bond(96,90,145,90);atom(120,150,'O','#ff6b6b',14);bond(120,106,120,138);atom(50,130,'H','#ffeaa7',12);bond(65,120,80,90);
    label(120,195,'Chargez un m√©canisme','rgba(255,255,255,.35)');
  }
  // title overlay
  ctx.fillStyle='rgba(255,255,255,0.06)';ctx.fillRect(2,h-18,w-4,16);
  ctx.fillStyle='rgba(255,255,255,0.35)';ctx.font='7px Fira Code';ctx.textAlign='center';ctx.fillText('ANIMATION MOL√âCULAIRE ‚Äî SIMUORG',w/2,h-7);
}

function drawEnergyMini(mech){
  const c=document.getElementById('energyMini');if(!c)return;
  const ctx=c.getContext('2d');const w=c.width,h=c.height;
  ctx.fillStyle='#1c1410';ctx.fillRect(0,0,w,h);
  const profiles={sn1:[[10,60],[60,25],[90,35],[150,15],[200,50]],sn2:[[10,60],[100,20],[200,45]],e1:[[10,60],[60,25],[90,35],[150,12],[200,55]],e2:[[10,60],[100,18],[200,48]],ae:[[10,55],[80,22],[120,32],[200,50]],an:[[10,55],[90,20],[200,40]],estherif:[[10,50],[80,25],[120,30],[160,25],[200,48]]};
  const pts=profiles[mech]||[[10,60],[100,20],[200,50]];
  ctx.strokeStyle=darkMode?'#a8e6cf':'#2d6a4f';ctx.lineWidth=2;ctx.beginPath();
  pts.forEach((p,i)=>{const x=p[0]/210*w,y=p[1]/70*h;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});ctx.stroke();
  // dots at peaks
  pts.forEach(p=>{ctx.fillStyle='#fd79a8';ctx.beginPath();ctx.arc(p[0]/210*w,p[1]/70*h,2.5,0,Math.PI*2);ctx.fill();});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STEREO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const stereoConcepts={
  chiral:{title:'Centre Chiral & Chiralit√©',desc:'Un carbone est chiral (asym√©trique) s\'il porte 4 substituants diff√©rents. La mol√©cule est chirale si elle n\'est pas superposable √† son image miroir.',content:`<span class="lvl lv-g">LYC√âE / PR√âPA</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">D√©finitions</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">‚Ä¢ Centre st√©r√©og√®ne (chiral) : C portant 4 groupes diff√©rents<br>‚Ä¢ √ânantiom√®res : images miroirs non superposables<br>‚Ä¢ Mol√©cule achirale : plan ou centre de sym√©trie<br>‚Ä¢ Pouvoir rotatoire [Œ±] : propri√©t√© optique des mol√©cules chirales<br>‚Ä¢ M√©lange rac√©mique (+/-) : 50/50 √©nantiom√®res (activit√© optique nulle)</p><div class="fbox">Condition : C sp¬≥ avec 4 substituants DISTINCTS</div><p style="font-size:.75rem;color:var(--muted);margin-top:7px;">Exemples : C2 de l'alanine, C4 du 2-bromobutane, C1 du glyc√©rald√©hyde</p>`,draw:'chiral'},
  rs:{title:'Configurations R et S ‚Äî R√®gles CIP',desc:'La nomenclature R/S (Cahn-Ingold-Prelog) d√©crit la configuration absolue d\'un centre chiral. Les substituants sont class√©s par num√©ro atomique.',content:`<span class="lvl lv-o">PR√âPA / LICENCE</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">R√®gles CIP</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">1. Classer les 4 substituants par num√©ro atomique (Z) d√©croissant<br>2. En cas d'√©galit√© ‚Üí regarder l'atome suivant (r√®gle de la sph√®re)<br>3. Placer le groupe 4 (priorit√© la plus basse) derri√®re soi<br>4. 1‚Üí2‚Üí3 : sens horaire ‚Üª = <b style="color:var(--p4)">R</b> ; antihoraire ‚Ü∫ = <b style="color:var(--p3)">S</b></p><div class="fbox">R (Rectus) = ‚Üª | S (Sinister) = ‚Ü∫</div><p style="font-size:.75rem;color:var(--muted);margin-top:6px;">Ordre fr√©quent : Br > Cl > O > N > C > H</p>`,draw:'rs'},
  ez:{title:'Isom√®res E/Z (G√©om√©triques)',desc:'Les alc√®nes ne peuvent pas tourner autour de la liaison œÄ ‚Üí isom√®res g√©om√©triques E et Z.',content:`<span class="lvl lv-g">LYC√âE</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">R√®gle E/Z</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">‚Ä¢ Z (zusammen = ensemble) : groupes prioritaires du M√äME c√¥t√©<br>‚Ä¢ E (entgegen = oppos√©s) : groupes prioritaires de part et d'autre<br>‚Ä¢ Priorit√© sur chaque C selon CIP (num√©ro atomique)<br>‚Ä¢ Ne s'applique que si chaque C=C porte 2 groupes DISTINCTS</p><div class="fbox">Z = cis (prioritaires ensemble) | E = trans (prioritaires s√©par√©s)</div>`,draw:'ez'},
  diastereomers:{title:'Diast√©r√©oisom√®res & √ânantiom√®res',desc:'Deux st√©r√©oisom√®res peuvent √™tre √©nantiom√®res (images miroirs) ou diast√©r√©oisom√®res (pas images miroirs).',content:`<span class="lvl lv-o">PR√âPA</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">Classification</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">‚Ä¢ <b>√ânantiom√®res</b> : images miroirs non superposables ‚Äî propri√©t√©s identiques sauf plan polarisation<br>‚Ä¢ <b>Diast√©r√©oisom√®res</b> : st√©r√©oisom√®res non √©nantiom√®res ‚Äî propri√©t√©s physico-chimiques diff√©rentes<br>‚Ä¢ <b>n</b> centres chiraux ‚Üí max <b>2‚Åø</b> st√©r√©oisom√®res<br>‚Ä¢ <b>√âpim√®res</b> : diast√©r√©oisom√®res ne diff√©rant que par 1 centre sur plusieurs<br>‚Ä¢ <b>Anom√®res</b> : √©pim√®res en C anom√©rique des sucres</p><div class="fbox">√ânantiom√®res ‚â† diast√©r√©oisom√®res : test = superposabilit√© sur image miroir</div>`,draw:'diastereo'},
  fischer:{title:'Projection de Fischer',desc:'Repr√©sentation plane des mol√©cules chirales (sucres, acides amin√©s). Les liaisons horizontales sont en avant du plan, verticales en arri√®re.',content:`<span class="lvl lv-g">LYC√âE / PR√âPA</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">Convention de Fischer</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">‚Ä¢ Cha√Æne principale VERTICALE, groupe le plus oxyd√© en HAUT<br>‚Ä¢ Liaisons horizontales : DEVANT le plan (vers l'observateur) ‚ÜêC‚Üí<br>‚Ä¢ Liaisons verticales : DERRI√àRE le plan ‚ÜëC‚Üì<br>‚Ä¢ Permutation de 2 substituants ‚Üí √©nantiom√®re ! Permutation de 3 ‚Üí m√™me config.<br>‚Ä¢ D-glyc√©rald√©hyde : OH √† droite | L-glyc√©rald√©hyde : OH √† gauche</p><div class="fbox">Horizontal = devant | Vertical = derri√®re</div>`,draw:'fischer'},
  newman:{title:'Projection de Newman',desc:'Vue le long d\'une liaison C-C. Cercle = C arri√®re, √©toile/point = C avant. Analyse des conformations.',content:`<span class="lvl lv-o">PR√âPA</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">Lecture Newman</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">‚Ä¢ C avant : point central (3 liaisons)<br>‚Ä¢ C arri√®re : grand cercle (3 liaisons sur le bord)<br>‚Ä¢ Conformation d√©cal√©e (anti) : di√®dre = 180¬∞ ‚Äî la plus stable<br>‚Ä¢ Conformation √©clips√©e (syn) : di√®dre = 0¬∞ ‚Äî la moins stable<br>‚Ä¢ Gauche : di√®dre = 60¬∞ | Anti : 180¬∞ | Syn-p√©riplanaire : 0¬∞<br>‚Ä¢ E2 : H et X doivent √™tre anti-p√©riplanaires (di√®dre 180¬∞)</p><div class="fbox">Di√®dre = angle entre 2 substituants vus depuis liaison C-C</div>`,draw:'newman'},
  meso:{title:'Compos√© M√©so',desc:'Mol√©cule avec des centres chiraux mais qui poss√®de un plan de sym√©trie interne ‚Üí achiral.',content:`<span class="lvl lv-b">LICENCE</span><h3 style="font-family:Fraunces serif;color:var(--p1);margin:7px 0 5px;">D√©finition & exemples</h3><p style="font-size:.79rem;line-height:1.7;color:var(--muted);">‚Ä¢ M√©so = mol√©cule avec au moins 2 centres chiraux + plan de sym√©trie<br>‚Ä¢ Centres chiraux de configurations OPPOS√âES (R et S) qui se compensent<br>‚Ä¢ Non superposable √† son image miroir ? NON ‚Üí achiral (m√©so) !<br>‚Ä¢ Exemple classique : acide m√©so-tartrique (2R,3S)<br>‚Ä¢ 3 st√©r√©oisom√®res du tartrate : (2R,3R), (2S,3S) √©nantiom√®res + m√©so achiral<br>‚Ä¢ Nombre total st√©r√©oisom√®res = 2‚Åø - (nb m√©so)</p><div class="fbox">M√©so : centres chiraux + plan sym√©trie interne ‚Üí achiral global</div>`,draw:'meso'}
};

function showStereoConcept(){
  const k=document.getElementById('stereoConcept').value;
  const c=stereoConcepts[k];
  if(!c)return;
  document.getElementById('stereo-content').innerHTML=`<div class="thy-card"><h3 style="font-family:'Fraunces',serif;font-size:1.05rem;">${c.title}</h3><p style="font-size:.79rem;color:var(--p2);margin-bottom:9px;font-style:italic;">${c.desc}</p>${c.content}</div>`;
  document.getElementById('stereo-canvas-label').textContent=c.title;
  drawStereoCanvas(c.draw);
}

function drawStereoCanvas(t){
  const c=document.getElementById('stereoCanvas');if(!c)return;
  const ctx=c.getContext('2d');const w=c.width,h=c.height;
  ctx.fillStyle='#1c1410';ctx.fillRect(0,0,w,h);
  function atom(x,y,el,col,r=13){ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fillStyle=col||'#a8e6cf';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.15)';ctx.lineWidth=1;ctx.stroke();ctx.fillStyle='#1c1410';ctx.font='bold 8px Fira Code';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(el,x,y);}
  function bond(x1,y1,x2,y2){ctx.strokeStyle='rgba(200,200,200,0.45)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();}
  function lbl(x,y,t,col='rgba(255,255,255,0.55)',sz='7px'){ctx.fillStyle=col;ctx.font=`${sz} Fira Code`;ctx.textAlign='center';ctx.fillText(t,x,y);}

  if(t==='chiral'){
    atom(125,125,'C*','#a8e6cf',16);
    [{x:125,y:65,el:'H',c:'#ffeaa7'},{x:65,y:125,el:'Cl',c:'#fdcb6e'},{x:185,y:125,el:'OH',c:'#ff6b6b'},{x:125,y:185,el:'CH‚ÇÉ',c:'#a8e6cf'}].forEach(a=>{bond(125,125,a.x,a.y);atom(a.x,a.y,a.el,a.c,14);});
    lbl(125,225,'* = centre chiral','#fd79a8','9px');
    lbl(125,240,'4 substituants diff√©rents','rgba(255,255,255,.4)');
  } else if(t==='rs'){
    // R/S diagram
    atom(125,110,'C*','#a8e6cf',15);
    const cfg=[{x:125,y:55,el:'Cl',c:'#fdcb6e',p:'1'},{x:65,y:130,el:'OH',c:'#ff6b6b',p:'2'},{x:185,y:130,el:'NH‚ÇÇ',c:'#74b9ff',p:'3'},{x:125,y:175,el:'H',c:'#ffeaa7',p:'4'}];
    cfg.forEach(a=>{bond(125,110,a.x,a.y);atom(a.x,a.y,a.el,a.c,12);lbl(a.x+(a.x<125?-14:(a.x>125?14:0)),a.y+(a.y<110?-15:15),a.p,'#fd79a8','8px');});
    // draw curved arrow
    ctx.strokeStyle='#fdcb6e';ctx.lineWidth=2;ctx.beginPath();ctx.arc(125,115,40,Math.PI*1.05,Math.PI*0.0,false);ctx.stroke();
    lbl(125,220,'‚Üª (1‚Üí2‚Üí3) sens horaire','#fdcb6e','8px');
    lbl(125,235,'= Configuration R','#fd79a8','9px');
  } else if(t==='ez'){
    // E/Z on alkene
    bond(75,100,125,115,'');bond(125,115,175,100,'');
    ctx.strokeStyle='rgba(255,180,0,.6)';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(75,108);ctx.lineTo(175,108);ctx.stroke();
    atom(75,100,'CH‚ÇÉ','#a8e6cf',14);atom(175,100,'CH‚ÇÉ','#a8e6cf',14);atom(75,145,'H','#ffeaa7',12);atom(175,145,'Cl','#fdcb6e',12);
    bond(75,100,75,145);bond(175,100,175,145);
    lbl(125,80,'C=C','rgba(255,255,255,.5)');lbl(125,185,'Priorit√©s : Cl > H','rgba(255,255,255,.45)');lbl(125,200,'CH‚ÇÉ + Cl m√™me c√¥t√© = Z','#a8e6cf','8px');
    lbl(125,215,'(zusammen)','rgba(255,255,255,.3)');
  } else if(t==='diastereo'){
    // 2 molecules
    atom(80,80,'C','#a8e6cf',13);atom(170,80,'C','#a8e6cf',13);
    [{x:60,y:55,el:'R',c:'#74b9ff'},{x:100,y:55,el:'S',c:'#fd79a8'}].forEach(a=>{bond(80,80,a.x,a.y);lbl(a.x,a.y,'',a.c);atom(a.x,a.y,a.el,a.c,11);});
    [{x:150,y:55,el:'S',c:'#fd79a8'},{x:190,y:55,el:'R',c:'#74b9ff'}].forEach(a=>{bond(170,80,a.x,a.y);atom(a.x,a.y,a.el,a.c,11);});
    lbl(125,170,'Gauche : √©nantiom√®res','#a8e6cf','8px');lbl(125,185,'Droite : diast√©r√©oisom√®res','rgba(255,255,255,.55)','8px');
    lbl(125,150,'|','rgba(255,255,255,.3)');
    ctx.strokeStyle='rgba(255,255,255,0.15)';ctx.setLineDash([4,4]);ctx.beginPath();ctx.moveTo(125,55);ctx.lineTo(125,145);ctx.stroke();ctx.setLineDash([]);
    lbl(125,225,'2 centres ‚Üí max 4 st√©r√©oisom√®res','rgba(255,255,255,.4)','7px');
  } else if(t==='fischer'){
    const mx=125,my=125;
    ctx.strokeStyle='rgba(200,200,200,0.4)';ctx.lineWidth=2;
    ctx.beginPath();ctx.moveTo(mx,my-70);ctx.lineTo(mx,my+70);ctx.stroke();
    ctx.beginPath();ctx.moveTo(mx-55,my);ctx.lineTo(mx+55,my);ctx.stroke();
    atom(mx,my,'C*','#a8e6cf',13);
    atom(mx,my-70,'CHO','#ff6b6b',15);atom(mx,my+70,'CH‚ÇÇOH','#a8e6cf',15);
    atom(mx-55,my,'H','#ffeaa7',12);atom(mx+55,my,'OH','#ff6b6b',13);
    lbl(mx,my+110,'Glyc√©rald√©hyde (D-)','rgba(255,255,255,.55)','8px');
    lbl(mx,my+125,'OH √† droite ‚Üí D','#a8e6cf','8px');
  } else if(t==='newman'){
    ctx.strokeStyle='rgba(200,200,200,0.35)';ctx.lineWidth=2;ctx.beginPath();ctx.arc(125,125,45,0,Math.PI*2);ctx.stroke();
    atom(125,125,'C','#a8e6cf',6);
    // front C bonds
    [[125,72,'CH‚ÇÉ'],[80,152,'H'],[170,152,'H']].forEach(([x,y,el])=>{bond(125,125,x,y);atom(x,y,el,'#ffeaa7',11);});
    // back C bonds (on circle)
    [[125,175,'CH‚ÇÉ'],[78,98,'H'],[172,98,'H']].forEach(([x,y,el])=>{const dx=x-125,dy=y-125,l=Math.sqrt(dx*dx+dy*dy);const sx=125+dx*44/l,sy=125+dy*44/l;bond(sx,sy,x,y);atom(x,y,el,'#a8e6cf',11);});
    lbl(125,228,'Conformation d√©cal√©e ‚Äî anti','rgba(255,255,255,.5)','8px');
  } else if(t==='meso'){
    atom(95,105,'C','#a8e6cf',14);atom(155,105,'C','#a8e6cf',14);bond(95,105,155,105);
    atom(95,65,'OH','#ff6b6b',13);atom(155,65,'OH','#ff6b6b',13);bond(95,105,95,65);bond(155,105,155,65);
    atom(65,125,'H','#ffeaa7',11);atom(185,125,'H','#ffeaa7',11);bond(95,105,65,125);bond(155,105,185,125);
    atom(95,150,'COOH','#ff6b6b',13);atom(155,150,'COOH','#ff6b6b',13);bond(95,105,95,150);bond(155,105,155,150);
    ctx.strokeStyle='rgba(212,160,23,0.55)';ctx.setLineDash([4,4]);ctx.lineWidth=1.5;ctx.beginPath();ctx.moveTo(125,50);ctx.lineTo(125,185);ctx.stroke();ctx.setLineDash([]);
    lbl(125,205,'Plan de sym√©trie interne','#fdcb6e','8px');
    lbl(125,218,'M√©so = achiral global (R,S)','#a8e6cf','8px');
  }
  lbl(w/2,h-7,'SIMUORG ‚Äî ST√âR√âOCHIMIE','rgba(255,255,255,0.1)','6px');
}

function computeCIP(){
  const a=+document.getElementById('cip-a').value,b=+document.getElementById('cip-b').value,c=+document.getElementById('cip-c').value,d=+document.getElementById('cip-d').value;
  const sens=document.getElementById('cip-sens').value;
  // sort 1-2-3 by given order (user already set priorities)
  let config=sens==='cw'?'R':'S';
  // if d (priority 4) is in front, invert
  const result=`<span class="config-badge ${config==='R'?'cfg-R':'cfg-S'}">${config}</span> ‚Äî ${config==='R'?'Rectus (‚Üª sens horaire)':'Sinister (‚Ü∫ sens anti-horaire)'}`;
  document.getElementById('cip-result').innerHTML=result;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FUNCTIONAL GROUPS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FG_DATA=[
  {name:'Alcool',formula:'-OH',formula2:'R-OH',desc:'Groupe hydroxyle. Polaire et protonable. Liaisons H ‚Üí Eb √©lev√©.',react:'SN1/SN2 (‚Üí √©ther), √©limination (‚Üí alc√®ne), oxydation (‚Üí ald√©hyde/c√©tone/acide), est√©rification',examples:'√âthanol (alcool √©thylique), glyc√©rol (3 OH), cholest√©rol',phys:'Eb ‚Üë‚Üë (liaisons H) | Soluble dans H‚ÇÇO (petits) | pKa ‚âà 16-18'},
  {name:'Ald√©hyde',formula:'-CHO',formula2:'R-CHO',desc:'Carbonyle terminal. Tr√®s r√©actif. R√©ducteur. Teste de Tollens (miroir Ag) positif.',react:'AN (NaBH‚ÇÑ‚Üíalcool 1¬∞, HCN‚Üícyanohydrine, RNH‚ÇÇ‚Üíimine), oxydation (‚Üíacide), r√©duction (‚Üíalcool)',examples:'Formald√©hyde (conservateur), ac√©tald√©hyde, benzald√©hyde (amandes)',phys:'Eb < alcool | Peu soluble (R long) | R√©ducteur fort'},
  {name:'C√©tone',formula:'>C=O',formula2:'R-CO-R\'',desc:'Carbonyle interne. Moins r√©actif que l\'ald√©hyde. Pas r√©ducteur. Stable √† l\'oxydation.',react:'AN (NaBH‚ÇÑ‚Üíalcool 2¬∞, RMgX‚Üíalcool 3¬∞), condensation aldolique, r√©action de Grignard',examples:'Ac√©tone, m√©thyl-√©thyl-c√©tone (MEK), butanone',phys:'Eb moyen | Miscible H‚ÇÇO si petite | Non r√©ducteur'},
  {name:'Acide carboxylique',formula:'-COOH',formula2:'R-COOH',desc:'Acide faible (pKa 4-5). Liaison H forte. Forme des dim√®res. Tr√®s polaire.',react:'Est√©rification (‚Üíester), amide (‚Üí amide), r√©duction (LiAlH‚ÇÑ‚Üíalcool 1¬∞), d√©carboxylation (Œ≤-c√©to)',examples:'Acide ac√©tique (vinaigre), acide citrique, acide palmitique (C16)',phys:'pKa ‚âà 4-5 | Eb tr√®s √©lev√© (dim√®res H) | Soluble en milieu basique'},
  {name:'Ester',formula:'-COO-',formula2:'R-COO-R\'',desc:'Produit d\'est√©rification. Odeur fruit√©e. Hydrolysable par eau (acide) ou base (saponification).',react:'Hydrolyse acide (r√©versible), saponification (OH‚Åª, irr√©versible), r√©duction (LiAlH‚ÇÑ‚Üí2 alcools)',examples:'Ac√©tate d\'√©thyle (solvant), asprine (ac√©tate ac√©tylsalicylate), graisses',phys:'Eb < alcool | Odeur fruit√©e | Non miscible eau'},
  {name:'Amine',formula:'-NH‚ÇÇ',formula2:'R-NH‚ÇÇ',desc:'Base azot√©e (pKa conj. 10-11). Nucl√©ophile. Forme des liaisons H. Odeur piquante (amine basse)',react:'Alkylation (‚Üí amine 2¬∞/3¬∞), acylation (‚Üí amide), diazotation (ArNH‚ÇÇ + NaNO‚ÇÇ/HCl)',examples:'M√©thylamine, aniline (aromatique), glycine (acide amin√©)',phys:'pKa(NH‚ÇÉ‚Å∫) ‚âà 10-11 | Base : capte H‚Å∫ | Liaisons H (2¬∞ et 3¬∞ : moins)'},
  {name:'Amide',formula:'-CONH‚ÇÇ',formula2:'R-CO-NH‚ÇÇ',desc:'Liaison amide tr√®s stable (r√©sonance). Point de fusion √©lev√©. Liaison peptidique des prot√©ines.',react:'Hydrolyse acide ou basique (‚Üí acide + amine), r√©duction (LiAlH‚ÇÑ‚Üíamine), Hofmann (‚Üíamine -1C)',examples:'Parac√©tamol, ur√©e, Nylon 6,6 (polyamide), prot√©ines',phys:'Eb tr√®s √©lev√© | Soluble H‚ÇÇO | R√©sonance ‚Üí plan√©it√©'},
  {name:'Halog√©nure alkyle',formula:'R-X',formula2:'R-Cl / R-Br / R-I',desc:'Substrat des r√©actions SN et E. C-X polaris√© (CŒ¥+ XŒ¥‚àí). La base des m√©canismes organiques.',react:'SN1 (tertiaire), SN2 (primaire), E1, E2, Grignard (R-X+Mg), √©limination',examples:'Bromom√©thane, chloroforme (CHCl‚ÇÉ), DDT, fr√©ons (CFC)',phys:'Eb ‚Üë avec masse | Non miscible eau | Polarit√© C-X'},
  {name:'Alc√®ne',formula:'C=C',formula2:'R-CH=CH-R\'',desc:'Double liaison œÄ. Nucl√©ophile. Nombreuses r√©actions d\'addition. Hydrog√©nation possible.',react:'AE (HX, H‚ÇÇSO‚ÇÑ), addition X‚ÇÇ (‚Üí dib.), ozonolyse (‚Üí carbonyles), hydroboration (anti-Markov.)',examples:'√âthyl√®ne (poly√©thyl√®ne), prop√®ne (polypropyl√®ne), butadi√®ne (caoutchouc)',phys:'Non polaire | Non miscible H‚ÇÇO | Eb bas'},
  {name:'Alcyne',formula:'C‚â°C',formula2:'R-C‚â°C-R\'',desc:'Triple liaison. Acide (pKa ‚âà 25 pour alcyne terminal). R√©actions d\'addition et substitution.',react:'Addition 2√ó HX (‚Üí c√©tone ou g√©minal), hydratation (‚Üí c√©tone, Markovnikov), r√©duction (‚Üí alc√®ne)',examples:'Ac√©tyl√®ne (soudage), propyne, √©thynylestradiol (contraceptif)',phys:'Non polaire | Acide C-H terminal (pKa‚âà25) | Lin√©aire'},
  {name:'Aromatique',formula:'Ar-H',formula2:'C‚ÇÜH‚ÇÖ-R (ar√®ne)',desc:'Cycle benz√©nique aromatique. R√®gle de H√ºckel : 4n+2 √©lectrons œÄ. Tr√®s stable. SEAr.',react:'SEAr (nitration, halog√©nation, Friedel-Crafts), oxydation cha√Æne lat√©rale (‚Üí acide), r√©duction (Birch)',examples:'Benz√®ne, tolu√®ne, styr√®ne (polystyr√®ne), aspirine',phys:'Non polaire | Odeur aromatique | Canc√©rig√®ne (benz√®ne)'},
  {name:'Nitrile',formula:'-CN',formula2:'R-C‚â°N',desc:'Groupe cyano. Tr√®s polaire. Pr√©curseur d\'amines et acides. Voie de synth√®se de Kolbe.',react:'Hydrolyse (‚Üí amide ‚Üí acide), r√©duction (LiAlH‚ÇÑ ‚Üí amine), AN avec RMgX, Kolbe',examples:'Acrylonitrile (PAN fibre), ac√©tonitrile (solvant), k√©ros√®ne d\'amandes',phys:'Polaire | Point d\'√©bullition √©lev√© | Toxique'},
  {name:'Ph√©nol',formula:'-OH aromatique',formula2:'C‚ÇÜH‚ÇÖ-OH',desc:'OH sur cycle aromatique. Plus acide qu\'un alcool (pKa ‚âà 10). Activant ortho/para en SEAr.',react:'SEAr ortho/para (activant fort), est√©rification, √©ther de ph√©nol (Williamson), Kolbe-Schmitt',examples:'Ph√©nol (antiseptique Lister), parac√©tamol (OH ph√©nol), BPA',phys:'pKa ‚âà 10 | Soluble eau (base) | Activant majeur en SEAr'},
  {name:'Acide sulfonique',formula:'-SO‚ÇÉH',formula2:'R-SO‚ÇÉH',desc:'Acide fort (pKa < 1). Tr√®s polaire et hydrosoluble. Utilis√© comme tensioactif et √©changeur.',react:'Sulfonation (SEAr r√©versible), sel de sulfonium, r√©sines √©changeuses d\'ions',examples:'Acide p-tolu√®nesulfonique (TsOH), SDS (d√©tergent), sulfanilamide',phys:'pKa < 1 (acide fort) | Tr√®s hydrosoluble | Hygrioscopique'}
];

function initFGGrid(){
  const g=document.getElementById('fg-grid');if(!g||g.children.length>0)return;
  FG_DATA.forEach((fg,i)=>{
    const d=document.createElement('div');d.className='fg-card';
    d.innerHTML=`<div class="fgn">${fg.name}</div><div class="fgf">${fg.formula}</div>`;
    d.onclick=()=>showFGDetail(i,d);g.appendChild(d);
  });
}

function showFGDetail(i,el){
  document.querySelectorAll('.fg-card').forEach(c=>c.classList.remove('sel'));
  if(el)el.classList.add('sel');
  const fg=FG_DATA[i];
  document.getElementById('fg-detail').style.display='block';
  document.getElementById('fg-name-detail').textContent=fg.name;
  document.getElementById('fg-formula-detail').textContent=fg.formula2;
  document.getElementById('fg-desc-detail').textContent=fg.desc;
  document.getElementById('fg-react-detail').innerHTML=fg.react.replace(/\(/g,'<i>(').replace(/\)/g,')</i>');
  document.getElementById('fg-examples-detail').innerHTML=fg.examples.split(', ').map(e=>`‚Ä¢ ${e}`).join('<br>');
  document.getElementById('fg-phys-detail').innerHTML=fg.phys.replace(/\|/g,'<br>');
  drawFGCanvas(fg);
}

function drawFGCanvas(fg){
  const c=document.getElementById('fgCanvas');if(!c)return;
  const ctx=c.getContext('2d');const w=c.width,h=c.height;
  ctx.fillStyle='#1c1410';ctx.fillRect(0,0,w,h);
  function atom(x,y,el,col,r=12){ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fillStyle=col||'#a8e6cf';ctx.fill();ctx.strokeStyle='rgba(255,255,255,.15)';ctx.lineWidth=1;ctx.stroke();ctx.fillStyle='#1c1410';ctx.font='bold 8px Fira Code';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(el,x,y);}
  function bond(x1,y1,x2,y2,dbl=false){ctx.strokeStyle='rgba(200,200,200,0.45)';ctx.lineWidth=dbl?3:2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();if(dbl){ctx.strokeStyle='rgba(255,255,255,0.2)';ctx.lineWidth=1;ctx.beginPath();const dx=y2-y1,dy=x1-x2,l=Math.sqrt(dx*dx+dy*dy)||1;ctx.moveTo(x1+3*dx/l,y1+3*dy/l);ctx.lineTo(x2+3*dx/l,y2+3*dy/l);ctx.stroke();}}
  function lbl(x,y,t){ctx.fillStyle='rgba(255,255,255,0.45)';ctx.font='8px Fira Code';ctx.textAlign='center';ctx.fillText(t,x,y);}
  const n=fg.name;
  if(n==='Alcool'){atom(99,99,'C','#a8e6cf');atom(155,75,'O','#ff6b6b',11);atom(190,58,'H','#ffeaa7',10);bond(99,99,155,75);bond(155,75,190,58);lbl(99,140,'R-C-OH');}
  else if(n==='Ald√©hyde'){atom(80,99,'R','#74b9ff',13);atom(140,99,'C','#a8e6cf');atom(185,75,'O','#ff6b6b',13,false);atom(185,125,'H','#ffeaa7',10);bond(80,99,140,99);bond(140,99,185,75,true);bond(140,99,185,125);lbl(140,155,'R-CHO');}
  else if(n==='C√©tone'){atom(70,99,'R','#74b9ff',13);atom(130,99,'C','#a8e6cf');atom(190,99,'R\'','#74b9ff',13);atom(130,55,'O','#ff6b6b',13);bond(70,99,130,99);bond(130,99,190,99);bond(130,99,130,55,true);lbl(130,150,'R-CO-R\'');}
  else if(n==='Acide carboxylique'){atom(70,100,'R','#74b9ff',13);atom(130,100,'C','#a8e6cf');atom(175,70,'O','#ff6b6b',13);atom(175,130,'O','#ff6b6b',13);atom(195,140,'H','#ffeaa7',9);bond(70,100,130,100);bond(130,100,175,70,true);bond(130,100,175,130);bond(175,130,195,140);lbl(130,160,'-COOH');}
  else if(n==='Amine'){atom(99,100,'C','#a8e6cf');atom(158,78,'N','#74b9ff',13);atom(180,55,'H','#ffeaa7',9);atom(182,90,'H','#ffeaa7',9);bond(99,100,158,78);bond(158,78,180,55);bond(158,78,182,90);lbl(99,140,'R-NH‚ÇÇ');}
  else if(n==='Alc√®ne'){atom(80,100,'C','#a8e6cf');atom(158,100,'C','#a8e6cf');bond(80,100,158,100,true);atom(55,70,'H','#ffeaa7',9);atom(55,130,'H','#ffeaa7',9);atom(183,70,'H','#ffeaa7',9);atom(183,130,'R','#74b9ff',11);bond(80,100,55,70);bond(80,100,55,130);bond(158,100,183,70);bond(158,100,183,130);lbl(120,150,'C=C');}
  else if(n==='Aromatique'){const cx=99,cy=99,r=42;for(let i=0;i<6;i++){const a1=i*Math.PI/3-Math.PI/6,a2=(i+1)*Math.PI/3-Math.PI/6;ctx.strokeStyle='rgba(200,200,200,0.4)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(cx+r*Math.cos(a1),cy+r*Math.sin(a1));ctx.lineTo(cx+r*Math.cos(a2),cy+r*Math.sin(a2));ctx.stroke();}ctx.strokeStyle='rgba(212,160,23,0.55)';ctx.lineWidth=1.5;ctx.beginPath();ctx.arc(cx,cy,25,0,Math.PI*2);ctx.stroke();lbl(cx,155,'C‚ÇÜH‚ÇÖ-R (benz√®ne)');}
  else {atom(80,100,'R','#74b9ff',14);atom(148,100,'G',fg.name==='Halog√©nure alkyle'?'#fdcb6e':'#ff6b6b',14);bond(80,100,148,100);lbl(115,140,fg.formula2);}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SYNTHESIS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SYNTH={
  alcool:{name:'Alcools',color:'var(--p1)',routes:[
    {name:'Hydratation alc√®nes',eq:'R-CH=CH‚ÇÇ + H‚ÇÇO ‚Üí R-CHOH-CH‚ÇÉ',cond:'H‚ÇÇSO‚ÇÑ, H‚ÇÇO, T¬∞ | Markovnikov'},
    {name:'Hydroboration-oxydation',eq:'R-CH=CH‚ÇÇ + BH‚ÇÉ/THF ‚Üí R-CH‚ÇÇ-CH‚ÇÇOH',cond:'1. BH‚ÇÉ/THF  2. H‚ÇÇO‚ÇÇ/NaOH | Anti-Markovnikov'},
    {name:'R√©duction ald√©hyde/c√©tone',eq:'R-CHO + NaBH‚ÇÑ ‚Üí R-CH‚ÇÇOH',cond:'NaBH‚ÇÑ ou LiAlH‚ÇÑ, EtOH'},
    {name:'R√©action de Grignard',eq:'R-MgX + RCHO ‚Üí R-CH(OH)-R\'',cond:'Et‚ÇÇO anhydre, N‚ÇÇ, puis H‚ÇÉO‚Å∫'},
    {name:'Epoxyde + nucl√©ophile',eq:'√âpoxyde + H‚ÇÇO ‚Üí diol vicinal',cond:'Acide dilu√© ‚Üí ouverture Markovnikov'},
    {name:'R√©duction acide carboxylique',eq:'RCOOH + LiAlH‚ÇÑ ‚Üí RCH‚ÇÇOH',cond:'LiAlH‚ÇÑ, √©ther anhydre, N‚ÇÇ'}
  ]},
  aldehyde:{name:'Ald√©hydes & C√©tones',color:'var(--p2)',routes:[
    {name:'Oxydation alcool 1¬∞ (doux)',eq:'R-CH‚ÇÇOH + PCC ‚Üí R-CHO',cond:'PCC (chlorochromate pyridinium) | Solvant anhydre'},
    {name:'Oxydation alcool 2¬∞',eq:'R-CHOH-R\' + [O] ‚Üí R-CO-R\'',cond:'PCC, K‚ÇÇCr‚ÇÇO‚Çá ou MnO‚ÇÇ'},
    {name:'Ozonolise',eq:'R-CH=CH-R\' + O‚ÇÉ ‚Üí R-CHO + R\'-CHO',cond:'O‚ÇÉ puis Me‚ÇÇS (r√©ductif) ‚Üí ald√©hydes'},
    {name:'Acylation Friedel-Crafts',eq:'ArH + RCOCl + AlCl‚ÇÉ ‚Üí Ar-CO-R',cond:'AlCl‚ÇÉ, CH‚ÇÇCl‚ÇÇ, 0¬∞C ‚Üí Tr'},
    {name:'Hydratation alcynes',eq:'R-C‚â°CH + H‚ÇÇO ‚Üí R-CO-CH‚ÇÉ',cond:'H‚ÇÇSO‚ÇÑ, HgSO‚ÇÑ | Markovnikov ‚Üí m√©thylc√©tone'},
    {name:'Condensation aldolique',eq:'2 RCHO ‚Üí R-CH(OH)-CH(R)-CHO',cond:'NaOH dilu√©, T¬∞ ambiante ‚Üí Œ≤-hydroxy-ald√©hyde'}
  ]},
  acide:{name:'Acides Carboxyliques',color:'var(--p3)',routes:[
    {name:'Oxydation alcool 1¬∞ (fort)',eq:'R-CH‚ÇÇOH + KMnO‚ÇÑ ‚Üí R-COOH',cond:'KMnO‚ÇÑ/H‚ÇÇSO‚ÇÑ, eau, reflux'},
    {name:'Oxydation ald√©hyde',eq:'R-CHO + [O] ‚Üí R-COOH',cond:'KMnO‚ÇÑ ou AgNO‚ÇÉ/NH‚ÇÉ (Tollens)'},
    {name:'Grignard + CO‚ÇÇ',eq:'R-MgX + CO‚ÇÇ ‚Üí R-COO‚ÅªMgX‚Å∫ ‚Üí R-COOH',cond:'CO‚ÇÇ gaz, √©ther; puis H‚ÇÉO‚Å∫ ‚Üí +1 carbone'},
    {name:'Hydrolyse ester (acide)',eq:'RCOOR\' + H‚ÇÇO ‚áå RCOOH + R\'OH',cond:'H‚ÇÇSO‚ÇÑ cat., H‚ÇÇO, reflux | r√©versible'},
    {name:'Saponification ester',eq:'RCOOR\' + NaOH ‚Üí RCOONa + R\'OH',cond:'NaOH aq., reflux | irr√©versible'},
    {name:'Hydrolyse nitrile',eq:'R-CN + H‚ÇÇO ‚Üí R-COOH',cond:'HCl aq., reflux | via amide interm√©diaire'}
  ]},
  amine:{name:'Amines',color:'var(--p4)',routes:[
    {name:'R√©duction nitrile',eq:'R-CN + LiAlH‚ÇÑ ‚Üí R-CH‚ÇÇ-NH‚ÇÇ',cond:'LiAlH‚ÇÑ, THF anhydre, N‚ÇÇ; puis H‚ÇÇO'},
    {name:'R√©duction nitroar√®ne',eq:'Ar-NO‚ÇÇ + [H] ‚Üí Ar-NH‚ÇÇ',cond:'Fe/HCl ou Sn/HCl, chaleur'},
    {name:'Alkylation ammoniac',eq:'NH‚ÇÉ + RX ‚Üí RNH‚ÇÇ + R‚ÇÇNH + R‚ÇÉN',cond:'NH‚ÇÉ exc√®s, autoclave | m√©lange'},
    {name:'R√©duction amide',eq:'RCONH‚ÇÇ + LiAlH‚ÇÑ ‚Üí RCH‚ÇÇNH‚ÇÇ',cond:'LiAlH‚ÇÑ, √©ther; puis H‚ÇÇO'},
    {name:'Diazotation ‚Üí halog√®ne (Sandmeyer)',eq:'ArN‚ÇÇ‚Å∫ + CuBr ‚Üí Ar-Br + N‚ÇÇ',cond:'ArNH‚ÇÇ + NaNO‚ÇÇ/HCl (0-5¬∞C) puis Cu‚ÇÇX‚ÇÇ'},
    {name:'R√©arrangement de Hofmann',eq:'RCONH‚ÇÇ + Br‚ÇÇ + NaOH ‚Üí RNH‚ÇÇ',cond:'Br‚ÇÇ/NaOH, eau | perd 1 C (d√©carboxylation)'}
  ]},
  ester:{name:'Esters',color:'var(--p5)',routes:[
    {name:'Est√©rification de Fischer',eq:'RCOOH + R\'OH ‚áå RCOOR\' + H‚ÇÇO',cond:'H‚ÇÇSO‚ÇÑ, reflux | √©quilibre (√©liminer H‚ÇÇO)'},
    {name:'Acylation alcool par chlorure',eq:'RCOCl + R\'OH ‚Üí RCOOR\' + HCl',cond:'Pyridine ou Et‚ÇÉN (base), 0¬∞C | rapide'},
    {name:'Acylation alcool par anhydride',eq:'(RCO)‚ÇÇO + R\'OH ‚Üí RCOOR\' + RCOOH',cond:'Base, T¬∞ ambiante | aspirine (Ac‚ÇÇO)'},
    {name:'R√©action de Williamson (ester)',eq:'RCOONa + R\'X ‚Üí RCOOR\'',cond:'Solvant polaire aprotique'},
    {name:'Trans-est√©rification',eq:'RCOOR\' + R\'\'OH ‚áå RCOOR\'\' + R\'OH',cond:'H‚Å∫ ou base, T¬∞ | biodiesel'},
    {name:'Alkylation lactone',eq:'Lactone + RMgX ‚Üí hydroxy-ester',cond:'RMgX (2 √©q.), √©ther anhydre'}
  ]},
  arene:{name:'Ar√®nes ‚Äî D√©riv√©s Benz√©niques',color:'var(--ink)',routes:[
    {name:'Nitration',eq:'ArH + HNO‚ÇÉ ‚Üí Ar-NO‚ÇÇ',cond:'HNO‚ÇÉ/H‚ÇÇSO‚ÇÑ, T¬∞<60¬∞C'},
    {name:'Halog√©nation catalys√©e',eq:'ArH + Cl‚ÇÇ + AlCl‚ÇÉ ‚Üí Ar-Cl',cond:'AlCl‚ÇÉ ou FeBr‚ÇÉ, anhydre'},
    {name:'Sulfonation',eq:'ArH + SO‚ÇÉ ‚Üí Ar-SO‚ÇÉH',cond:'H‚ÇÇSO‚ÇÑ fumant (ol√©um), T¬∞‚Üë | r√©versible'},
    {name:'Alkylation Friedel-Crafts',eq:'ArH + RCl + AlCl‚ÇÉ ‚Üí Ar-R',cond:'AlCl‚ÇÉ, solvant apolaire | r√©arrangements!'},
    {name:'Acylation Friedel-Crafts',eq:'ArH + RCOCl + AlCl‚ÇÉ ‚Üí Ar-COR',cond:'AlCl‚ÇÉ, 1 √©q. | pas de r√©arrangement'},
    {name:'R√©duction Birch',eq:'ArH + Na/NH‚ÇÉ(l) ‚Üí 1,4-cyclohexadi√®ne',cond:'Na (m√©tal) + NH‚ÇÉ liquide + t-BuOH, -33¬∞C'},
    {name:'Oxydation cha√Æne lat√©rale',eq:'Ar-CH‚ÇÉ + KMnO‚ÇÑ ‚Üí Ar-COOH',cond:'KMnO‚ÇÑ/H‚ÇÇSO‚ÇÑ, chaleur | ‚â•1 H sur C benzylique'},
    {name:'Couplage diazonium',eq:'ArN‚ÇÇ‚Å∫ + Ar\'H ‚Üí Ar-N=N-Ar\'',cond:'pH 8-10, 0-5¬∞C | colorants azo√Øques'}
  ]}
};

function showSynthesis(key,el){
  document.querySelectorAll('.syn-btn').forEach(b=>{b.style.background='var(--panel2)';b.style.border='1px solid var(--border)';b.style.color='var(--muted)';});
  if(el){el.style.background=SYNTH[key].color;el.style.border='none';el.style.color='white';}
  const s=SYNTH[key];
  document.getElementById('synth-content').innerHTML=`<h3 style="font-family:'Fraunces',serif;font-size:1.05rem;color:${s.color};margin-bottom:11px;">Voies de synth√®se ‚Äî ${s.name}</h3><div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(285px,1fr));gap:9px;">${s.routes.map((r,i)=>`<div style="background:var(--panel2);border:1px solid var(--border);border-radius:8px;padding:12px;"><div style="font-weight:700;font-size:.82rem;color:${s.color};margin-bottom:6px;">${i+1}. ${r.name}</div><div style="background:#1c1410;border-radius:5px;padding:7px;font-family:'Fira Code',monospace;font-size:.75rem;color:#a8e6cf;margin-bottom:6px;">${r.eq}</div><div style="font-size:.7rem;color:var(--muted);font-family:'Fira Code',monospace;line-height:1.65;">${r.cond}</div></div>`).join('')}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MOLECULE 3D ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MOL3D={
  methane:{name:'M√©thane',formula:'CH‚ÇÑ',desc:'Gaz naturel. G√©om√©trie t√©tra√©drique parfaite. Sp¬≥. Combustible. Source d\'√©nergie.',geom:'T√©tra√©drique',hybrid:'sp¬≥',extra:'M=16.04 g/mol | Eb=-161.5¬∞C | √ânergies C-H : 412 kJ/mol',atoms:[{el:'C',x:0,y:0,z:0,r:16,c:'#a8e6cf'},{el:'H',x:60,y:45,z:30,r:9,c:'#ffeaa7'},{el:'H',x:-60,y:45,z:-30,r:9,c:'#ffeaa7'},{el:'H',x:0,y:-65,z:45,r:9,c:'#ffeaa7'},{el:'H',x:0,y:-65,z:-45,r:9,c:'#ffeaa7'}],bonds:[[0,1],[0,2],[0,3],[0,4]]},
  ethane:{name:'√âthane',formula:'C‚ÇÇH‚ÇÜ',desc:'Alcane C2. Rotation libre autour de C-C. Conformation d√©cal√©e (anti) stable.',geom:'T√©tra√©drique (√ó2)',hybrid:'sp¬≥',extra:'M=30.07 g/mol | Eb=-88.6¬∞C | Barri√®re rot. 12 kJ/mol',atoms:[{el:'C',x:-35,y:0,z:0,r:15,c:'#a8e6cf'},{el:'C',x:35,y:0,z:0,r:15,c:'#a8e6cf'},{el:'H',x:-75,y:35,z:20,r:9,c:'#ffeaa7'},{el:'H',x:-75,y:35,z:-20,r:9,c:'#ffeaa7'},{el:'H',x:-75,y:-45,z:0,r:9,c:'#ffeaa7'},{el:'H',x:75,y:35,z:20,r:9,c:'#ffeaa7'},{el:'H',x:75,y:35,z:-20,r:9,c:'#ffeaa7'},{el:'H',x:75,y:-45,z:0,r:9,c:'#ffeaa7'}],bonds:[[0,1],[0,2],[0,3],[0,4],[1,5],[1,6],[1,7]]},
  ethanol:{name:'√âthanol',formula:'C‚ÇÇH‚ÇÖOH',desc:'Alcool √©thylique. Liaisons H avec eau ‚Üí miscible. Produit de fermentation.',geom:'T√©tra√©drique + coud√©e',hybrid:'sp¬≥',extra:'M=46.07 g/mol | Eb=78.4¬∞C | pKa=15.9 | Œîf=-277 kJ/mol',atoms:[{el:'C',x:-40,y:5,z:0,r:15,c:'#a8e6cf'},{el:'C',x:25,y:5,z:0,r:15,c:'#a8e6cf'},{el:'O',x:80,y:-30,z:0,r:13,c:'#ff6b6b'},{el:'H',x:-70,y:-35,z:0,r:9,c:'#ffeaa7'},{el:'H',x:-60,y:40,z:25,r:9,c:'#ffeaa7'},{el:'H',x:-60,y:40,z:-25,r:9,c:'#ffeaa7'},{el:'H',x:35,y:50,z:25,r:9,c:'#ffeaa7'},{el:'H',x:35,y:50,z:-25,r:9,c:'#ffeaa7'},{el:'H',x:110,y:-10,z:0,r:9,c:'#ffeaa7'}],bonds:[[0,1],[1,2],[0,3],[0,4],[0,5],[1,6],[1,7],[2,8]]},
  benzene:{name:'Benz√®ne',formula:'C‚ÇÜH‚ÇÜ',desc:'Arch√©type aromatique. 6 √©lectrons œÄ d√©localis√©s. R√®gle de H√ºckel 4n+2 (n=1). Canc√©rig√®ne!',geom:'Planaire (hexagonale)',hybrid:'sp¬≤ (d√©localisation)',extra:'M=78.11 g/mol | Eb=80.1¬∞C | Stabilisation aromatiqu : 151 kJ/mol',atoms:[{el:'C',x:55,y:0,z:0,r:13,c:'#a8e6cf'},{el:'C',x:27,y:-47,z:0,r:13,c:'#a8e6cf'},{el:'C',x:-27,y:-47,z:0,r:13,c:'#a8e6cf'},{el:'C',x:-55,y:0,z:0,r:13,c:'#a8e6cf'},{el:'C',x:-27,y:47,z:0,r:13,c:'#a8e6cf'},{el:'C',x:27,y:47,z:0,r:13,c:'#a8e6cf'},{el:'H',x:90,y:0,z:0,r:8,c:'#ffeaa7'},{el:'H',x:45,y:-77,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-45,y:-77,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-90,y:0,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-45,y:77,z:0,r:8,c:'#ffeaa7'},{el:'H',x:45,y:77,z:0,r:8,c:'#ffeaa7'}],bonds:[[0,1,1],[1,2,2],[2,3,1],[3,4,2],[4,5,1],[5,0,2],[0,6],[1,7],[2,8],[3,9],[4,10],[5,11]]},
  acetone:{name:'Ac√©tone',formula:'(CH‚ÇÉ)‚ÇÇCO',desc:'C√©tone simple. Solvant universel. Miscible √† l\'eau. Carbonyle r√©actif.',geom:'Coud√©e (C=O plan)',hybrid:'sp¬≤ (C=O)',extra:'M=58.08 g/mol | Eb=56.1¬∞C | Miscible H‚ÇÇO | Inflammable',atoms:[{el:'C',x:0,y:0,z:0,r:14,c:'#a8e6cf'},{el:'O',x:0,y:-55,z:0,r:13,c:'#ff6b6b'},{el:'C',x:-60,y:30,z:0,r:13,c:'#a8e6cf'},{el:'C',x:60,y:30,z:0,r:13,c:'#a8e6cf'},{el:'H',x:-88,y:5,z:22,r:8,c:'#ffeaa7'},{el:'H',x:-88,y:5,z:-22,r:8,c:'#ffeaa7'},{el:'H',x:-55,y:65,z:0,r:8,c:'#ffeaa7'},{el:'H',x:88,y:5,z:22,r:8,c:'#ffeaa7'},{el:'H',x:88,y:5,z:-22,r:8,c:'#ffeaa7'},{el:'H',x:55,y:65,z:0,r:8,c:'#ffeaa7'}],bonds:[[0,1,'double'],[0,2],[0,3],[2,4],[2,5],[2,6],[3,7],[3,8],[3,9]]},
  methylamine:{name:'M√©thylamine',formula:'CH‚ÇÉNH‚ÇÇ',desc:'Amine primaire aliphatique. Base. Pr√©curseur de m√©dicaments.',geom:'T√©tra√©drique (N pyramidal)',hybrid:'sp¬≥ (C et N)',extra:'M=31.06 g/mol | Eb=-6.3¬∞C | pKa(NH‚ÇÉ‚Å∫)=10.65 | Base',atoms:[{el:'C',x:-30,y:0,z:0,r:14,c:'#a8e6cf'},{el:'N',x:45,y:0,z:0,r:13,c:'#74b9ff'},{el:'H',x:-65,y:-35,z:0,r:9,c:'#ffeaa7'},{el:'H',x:-55,y:32,z:25,r:9,c:'#ffeaa7'},{el:'H',x:-55,y:32,z:-25,r:9,c:'#ffeaa7'},{el:'H',x:75,y:35,z:20,r:9,c:'#ffeaa7'},{el:'H',x:75,y:35,z:-20,r:9,c:'#ffeaa7'}],bonds:[[0,1],[0,2],[0,3],[0,4],[1,5],[1,6]]},
  acac:{name:'Acide Ac√©tique',formula:'CH‚ÇÉCOOH',desc:'Vinaigre (5%). Acide faible pKa=4.76. Forme des dim√®res par liaisons H.',geom:'Plane (COOH)',hybrid:'sp¬≤ (C=O), sp¬≥ (CH‚ÇÉ)',extra:'M=60.05 g/mol | Eb=118¬∞C | pKa=4.76 | Soluble H‚ÇÇO',atoms:[{el:'C',x:-35,y:10,z:0,r:13,c:'#a8e6cf'},{el:'C',x:30,y:10,z:0,r:13,c:'#a8e6cf'},{el:'O',x:68,y:-35,z:0,r:12,c:'#ff6b6b'},{el:'O',x:68,y:55,z:0,r:12,c:'#ff6b6b'},{el:'H',x:90,y:65,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-65,y:-20,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-60,y:45,z:22,r:8,c:'#ffeaa7'},{el:'H',x:-60,y:45,z:-22,r:8,c:'#ffeaa7'}],bonds:[[0,1],[1,2,'double'],[1,3],[3,4],[0,5],[0,6],[0,7]]},
  propane:{name:'Propane',formula:'C‚ÇÉH‚Çà',desc:'Gaz combustible (GPL). Alcane C3. 2 conformations: anti et gauche.',geom:'T√©tra√©drique (√ó3)',hybrid:'sp¬≥',extra:'M=44.10 g/mol | Eb=-42.1¬∞C | ŒîcH¬∞=-2220 kJ/mol',atoms:[{el:'C',x:-60,y:5,z:0,r:13,c:'#a8e6cf'},{el:'C',x:0,y:5,z:0,r:13,c:'#a8e6cf'},{el:'C',x:60,y:5,z:0,r:13,c:'#a8e6cf'},{el:'H',x:-90,y:-30,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-85,y:38,z:22,r:8,c:'#ffeaa7'},{el:'H',x:-85,y:38,z:-22,r:8,c:'#ffeaa7'},{el:'H',x:0,y:48,z:28,r:8,c:'#ffeaa7'},{el:'H',x:0,y:48,z:-28,r:8,c:'#ffeaa7'},{el:'H',x:90,y:-30,z:0,r:8,c:'#ffeaa7'},{el:'H',x:85,y:38,z:22,r:8,c:'#ffeaa7'},{el:'H',x:85,y:38,z:-22,r:8,c:'#ffeaa7'}],bonds:[[0,1],[1,2],[0,3],[0,4],[0,5],[1,6],[1,7],[2,8],[2,9],[2,10]]},
  toluene:{name:'Tolu√®ne',formula:'C‚ÇáH‚Çà',desc:'Benz√®ne m√©thyl√©. Solvant courant. Oxydable en acide benzo√Øque (KMnO‚ÇÑ).',geom:'Planaire + CH‚ÇÉ t√©tra√©drique',hybrid:'sp¬≤ (cycle) + sp¬≥ (CH‚ÇÉ)',extra:'M=92.14 g/mol | Eb=110.6¬∞C | Solvant industriel',atoms:[{el:'C',x:55,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:27,y:-47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-27,y:-47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-55,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-27,y:47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:27,y:47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:90,y:0,z:0,r:12,c:'#a8e6cf'},{el:'H',x:45,y:-75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-45,y:-75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-88,y:0,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-45,y:75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:45,y:75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:120,y:-22,z:0,r:7,c:'#ffeaa7'},{el:'H',x:120,y:22,z:0,r:7,c:'#ffeaa7'},{el:'H',x:95,y:0,z:30,r:7,c:'#ffeaa7'}],bonds:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0],[0,6],[1,7],[2,8],[3,9],[4,10],[5,11],[6,12],[6,13],[6,14]]},
  aniline:{name:'Aniline',formula:'C‚ÇÜH‚ÇÖNH‚ÇÇ',desc:'Amine aromatique. Base plus faible qu\'amine aliphatique. Colorants azo√Øques par diazotation.',geom:'Planaire (Ar) + pyramidal (N)',hybrid:'sp¬≤ (Ar) + sp¬≥ partiellement (N)',extra:'M=93.13 g/mol | Eb=184¬∞C | pKa(NH‚ÇÉ‚Å∫)=4.6 | Toxique',atoms:[{el:'C',x:55,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:27,y:-47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-27,y:-47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-55,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-27,y:47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:27,y:47,z:0,r:12,c:'#a8e6cf'},{el:'N',x:90,y:0,z:0,r:12,c:'#74b9ff'},{el:'H',x:45,y:-75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-45,y:-75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-88,y:0,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-45,y:75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:45,y:75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:120,y:-18,z:0,r:7,c:'#ffeaa7'},{el:'H',x:120,y:18,z:0,r:7,c:'#ffeaa7'}],bonds:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0],[0,6],[1,7],[2,8],[3,9],[4,10],[5,11],[6,12],[6,13]]},
  ethylene:{name:'√âthyl√®ne',formula:'C‚ÇÇH‚ÇÑ',desc:'Alc√®ne le plus simple. Liaison œÄ. Gaz de maturation des fruits. Monom√®re du poly√©thyl√®ne.',geom:'Plane (sp¬≤)',hybrid:'sp¬≤',extra:'M=28.05 g/mol | Eb=-104¬∞C | M√ªrissement fruits | Angle H-C-H = 116.6¬∞',atoms:[{el:'C',x:-30,y:0,z:0,r:14,c:'#a8e6cf'},{el:'C',x:30,y:0,z:0,r:14,c:'#a8e6cf'},{el:'H',x:-65,y:-35,z:0,r:9,c:'#ffeaa7'},{el:'H',x:-65,y:35,z:0,r:9,c:'#ffeaa7'},{el:'H',x:65,y:-35,z:0,r:9,c:'#ffeaa7'},{el:'H',x:65,y:35,z:0,r:9,c:'#ffeaa7'}],bonds:[[0,1,'double'],[0,2],[0,3],[1,4],[1,5]]},
  butane:{name:'Butane',formula:'C‚ÇÑH‚ÇÅ‚ÇÄ',desc:'Gaz GPL. Alcane C4. Conformations anti et gauche importantes.',geom:'T√©tra√©drique (√ó4)',hybrid:'sp¬≥',extra:'M=58.12 g/mol | Eb=-0.5¬∞C | Isom√®re : isobutane',atoms:[{el:'C',x:-80,y:5,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-25,y:5,z:0,r:12,c:'#a8e6cf'},{el:'C',x:30,y:5,z:0,r:12,c:'#a8e6cf'},{el:'C',x:85,y:5,z:0,r:12,c:'#a8e6cf'},{el:'H',x:-108,y:-28,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-105,y:35,z:22,r:8,c:'#ffeaa7'},{el:'H',x:-105,y:35,z:-22,r:8,c:'#ffeaa7'},{el:'H',x:-25,y:47,z:25,r:8,c:'#ffeaa7'},{el:'H',x:-25,y:47,z:-25,r:8,c:'#ffeaa7'},{el:'H',x:30,y:47,z:25,r:8,c:'#ffeaa7'},{el:'H',x:30,y:47,z:-25,r:8,c:'#ffeaa7'},{el:'H',x:113,y:-28,z:0,r:8,c:'#ffeaa7'},{el:'H',x:110,y:35,z:22,r:8,c:'#ffeaa7'},{el:'H',x:110,y:35,z:-22,r:8,c:'#ffeaa7'}],bonds:[[0,1],[1,2],[2,3],[0,4],[0,5],[0,6],[1,7],[1,8],[2,9],[2,10],[3,11],[3,12],[3,13]]},
  acetylene:{name:'Ac√©tyl√®ne',formula:'C‚ÇÇH‚ÇÇ',desc:'Alcyne. Triple liaison (œÉ+2œÄ). Lin√©aire. Gaz de soudage. pKa=25 (acide).',geom:'Lin√©aire',hybrid:'sp',extra:'M=26.04 g/mol | Eb=-84¬∞C | pKa(C-H)=25 | Soudage oxyac√©tyl√©nique',atoms:[{el:'C',x:-35,y:0,z:0,r:13,c:'#a8e6cf'},{el:'C',x:35,y:0,z:0,r:13,c:'#a8e6cf'},{el:'H',x:-75,y:0,z:0,r:9,c:'#ffeaa7'},{el:'H',x:75,y:0,z:0,r:9,c:'#ffeaa7'}],bonds:[[0,1,'triple'],[0,2],[1,3]]},
  glucose:{name:'D-Glucose (ouvert)',formula:'C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ',desc:'Sucre principal. Forme ouverte. Chiral. 5 centres asym√©triques. Forme Fischer.',geom:'T√©tra√©drique (√ó5 C chiraux)',hybrid:'sp¬≥',extra:'M=180.16 g/mol | pF=146¬∞C | Sucre r√©ducteur | [Œ±]D=+52.7¬∞',atoms:[{el:'C',x:0,y:-90,z:0,r:12,c:'#a8e6cf'},{el:'C',x:0,y:-45,z:0,r:12,c:'#a8e6cf'},{el:'C',x:0,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:0,y:45,z:0,r:12,c:'#a8e6cf'},{el:'C',x:0,y:90,z:0,r:12,c:'#a8e6cf'},{el:'C',x:0,y:135,z:0,r:12,c:'#a8e6cf'},{el:'O',x:0,y:-130,z:0,r:11,c:'#ff6b6b'},{el:'O',x:45,y:-45,z:0,r:10,c:'#ff6b6b'},{el:'O',x:-45,y:0,z:0,r:10,c:'#ff6b6b'},{el:'O',x:45,y:45,z:0,r:10,c:'#ff6b6b'},{el:'O',x:-45,y:90,z:0,r:10,c:'#ff6b6b'},{el:'O',x:0,y:170,z:0,r:10,c:'#ff6b6b'}],bonds:[[0,1],[1,2],[2,3],[3,4],[4,5],[0,6,'double'],[1,7],[2,8],[3,9],[4,10],[5,11]]},
  alanine:{name:'L-Alanine',formula:'C‚ÇÉH‚ÇáNO‚ÇÇ',desc:'Acide amin√© non essentiel. Centre chiral en CŒ±. Configuration L. Composant des prot√©ines.',geom:'T√©tra√©drique (CŒ± chiral)',hybrid:'sp¬≥ (CŒ±), sp¬≤ (COOH)',extra:'M=89.09 g/mol | pI=6.0 | pKa(NH‚ÇÉ‚Å∫)=9.87 | pKa(COOH)=2.34',atoms:[{el:'C',x:0,y:0,z:0,r:14,c:'#a8e6cf'},{el:'N',x:-55,y:-35,z:0,r:12,c:'#74b9ff'},{el:'C',x:55,y:-35,z:0,r:12,c:'#a8e6cf'},{el:'O',x:88,y:-65,z:0,r:11,c:'#ff6b6b'},{el:'O',x:55,y:10,z:0,r:11,c:'#ff6b6b'},{el:'C',x:0,y:60,z:0,r:12,c:'#a8e6cf'},{el:'H',x:0,y:-45,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-78,y:-10,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-78,y:-58,z:0,r:8,c:'#ffeaa7'}],bonds:[[0,1],[0,2],[2,3,'double'],[2,4],[0,5],[0,6],[1,7],[1,8]]},
  ethylacetate:{name:'Ac√©tate d\'√âthyle',formula:'CH‚ÇÉCOOC‚ÇÇH‚ÇÖ',desc:'Ester. Solvant de peintures/vernis. Produit d\'est√©rification.',geom:'Plan (C=O) + t√©tra√©driques',hybrid:'sp¬≤ (C=O) + sp¬≥',extra:'M=88.11 g/mol | Eb=77.1¬∞C | Solvant courant | Odeur fruit√©e',atoms:[{el:'C',x:-70,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-10,y:0,z:0,r:12,c:'#a8e6cf'},{el:'O',x:-10,y:-50,z:0,r:11,c:'#ff6b6b'},{el:'O',x:45,y:25,z:0,r:11,c:'#ff6b6b'},{el:'C',x:95,y:25,z:0,r:12,c:'#a8e6cf'},{el:'C',x:140,y:0,z:0,r:12,c:'#a8e6cf'},{el:'H',x:-95,y:-30,z:0,r:8,c:'#ffeaa7'},{el:'H',x:-95,y:28,z:20,r:8,c:'#ffeaa7'},{el:'H',x:-95,y:28,z:-20,r:8,c:'#ffeaa7'},{el:'H',x:100,y:65,z:20,r:8,c:'#ffeaa7'},{el:'H',x:100,y:65,z:-20,r:8,c:'#ffeaa7'},{el:'H',x:165,y:28,z:20,r:8,c:'#ffeaa7'},{el:'H',x:165,y:28,z:-20,r:8,c:'#ffeaa7'},{el:'H',x:165,y:-32,z:0,r:8,c:'#ffeaa7'}],bonds:[[0,1],[1,2,'double'],[1,3],[3,4],[4,5],[0,6],[0,7],[0,8],[4,9],[4,10],[5,11],[5,12],[5,13]]},
  phenol:{name:'Ph√©nol',formula:'C‚ÇÜH‚ÇÖOH',desc:'Hydroxyle sur aromatique. Plus acide qu\'alcool (pKa‚âà10). Antiseptique (Lister 1865).',geom:'Planaire (Ar) + OH',hybrid:'sp¬≤ (Ar) + sp¬≥ (O)',extra:'M=94.11 g/mol | pKa=10.0 | Antiseptique historique | Activant SEAr',atoms:[{el:'C',x:55,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:27,y:-47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-27,y:-47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-55,y:0,z:0,r:12,c:'#a8e6cf'},{el:'C',x:-27,y:47,z:0,r:12,c:'#a8e6cf'},{el:'C',x:27,y:47,z:0,r:12,c:'#a8e6cf'},{el:'O',x:90,y:0,z:0,r:12,c:'#ff6b6b'},{el:'H',x:116,y:18,z:0,r:8,c:'#ffeaa7'},{el:'H',x:45,y:-75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-45,y:-75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-88,y:0,z:0,r:7,c:'#ffeaa7'},{el:'H',x:-45,y:75,z:0,r:7,c:'#ffeaa7'},{el:'H',x:45,y:75,z:0,r:7,c:'#ffeaa7'}],bonds:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0],[0,6],[6,7],[1,8],[2,9],[3,10],[4,11],[5,12]]}
};

let mol3dState={rotX:0,rotY:0,autoRot:null,currentMol:'methane'};

function draw3DMol(){
  const key=document.getElementById('mol3dSel').value;
  mol3dState.currentMol=key;
  const mol=MOL3D[key];if(!mol)return;
  document.getElementById('mol3d-name').textContent=mol.name;
  document.getElementById('mol3d-formula').textContent=mol.formula;
  document.getElementById('mol3d-desc').textContent=mol.desc;
  document.getElementById('mol3d-geom').textContent=mol.geom;
  document.getElementById('mol3d-hybrid').textContent=mol.hybrid;
  document.getElementById('mol3d-extra').innerHTML=mol.extra.replace(/\|/g,'<br>');
  renderMol3D(key);
}

function renderMol3D(key){
  const c=document.getElementById('mol3dCanvas');if(!c)return;
  const ctx=c.getContext('2d');const w=c.width,h=c.height;
  ctx.fillStyle='#0a0f0a';ctx.fillRect(0,0,w,h);
  const mol=MOL3D[key];if(!mol)return;
  const mode=document.getElementById('mol3dMode').value;
  // project 3D to 2D with rotation
  function project(x,y,z){
    const cosX=Math.cos(mol3dState.rotX*Math.PI/180),sinX=Math.sin(mol3dState.rotX*Math.PI/180);
    const cosY=Math.cos(mol3dState.rotY*Math.PI/180),sinY=Math.sin(mol3dState.rotY*Math.PI/180);
    const y2=y*cosX-z*sinX,z2=y*sinX+z*cosX;
    const x2=x*cosY+z2*sinY,z3=-x*sinY+z2*cosY;
    const scale=220/(220+z3);
    return{px:w/2+x2*scale,py:h/2+y2*scale,z:z3,s:scale};
  }
  // sort atoms by z for painter's algorithm
  const projected=mol.atoms.map((a,i)=>{const p=project(a.x,a.y,a.z);return{...a,...p,idx:i};});
  projected.sort((a,b)=>b.z-a.z);
  // draw bonds first
  mol.bonds.forEach(b=>{
    const a1=projected.find(p=>p.idx===b[0]),a2=projected.find(p=>p.idx===b[1]);
    if(!a1||!a2)return;
    const bondType=b[2]||'single';
    if(mode==='wireframe'){
      ctx.strokeStyle='rgba(168,230,207,0.6)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(a1.px,a1.py);ctx.lineTo(a2.px,a2.py);ctx.stroke();
    } else {
      const grad=ctx.createLinearGradient(a1.px,a1.py,a2.px,a2.py);
      grad.addColorStop(0,a1.c||'#a8e6cf');grad.addColorStop(1,a2.c||'#ffeaa7');
      ctx.strokeStyle=grad;ctx.lineWidth=mode==='sticks'?4:3;
      ctx.beginPath();ctx.moveTo(a1.px,a1.py);ctx.lineTo(a2.px,a2.py);ctx.stroke();
      if(bondType==='double'||bondType==='triple'){
        ctx.strokeStyle='rgba(255,255,255,0.25)';ctx.lineWidth=1.5;
        const dx=a2.py-a1.py,dy=a1.px-a2.px,l=Math.sqrt(dx*dx+dy*dy)||1;
        ctx.beginPath();ctx.moveTo(a1.px+4*dx/l,a1.py+4*dy/l);ctx.lineTo(a2.px+4*dx/l,a2.py+4*dy/l);ctx.stroke();
        if(bondType==='triple'){ctx.beginPath();ctx.moveTo(a1.px-4*dx/l,a1.py-4*dy/l);ctx.lineTo(a2.px-4*dx/l,a2.py-4*dy/l);ctx.stroke();}
      }
    }
  });
  // draw atoms
  projected.forEach(a=>{
    const r=(mode==='vdw'?a.r*1.8:a.r)*(a.s||1);
    if(mode==='wireframe'){
      ctx.beginPath();ctx.arc(a.px,a.py,3,0,Math.PI*2);ctx.fillStyle=a.c||'#a8e6cf';ctx.fill();
    } else {
      const g=ctx.createRadialGradient(a.px-r*0.25,a.py-r*0.25,r*0.1,a.px,a.py,r);
      g.addColorStop(0,'rgba(255,255,255,0.4)');g.addColorStop(0.4,a.c||'#a8e6cf');g.addColorStop(1,'rgba(0,0,0,0.5)');
      ctx.beginPath();ctx.arc(a.px,a.py,r,0,Math.PI*2);ctx.fillStyle=g;ctx.fill();
      ctx.strokeStyle='rgba(0,0,0,0.3)';ctx.lineWidth=0.5;ctx.stroke();
      if(r>10){ctx.fillStyle='#0a0f0a';ctx.font=`bold ${Math.min(11,r*0.7)}px Fira Code`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(a.el,a.px,a.py);}
    }
  });
  // label
  ctx.fillStyle='rgba(255,255,255,0.12)';ctx.fillRect(4,h-20,w-8,16);
  ctx.fillStyle='rgba(255,255,255,0.35)';ctx.font='7px Fira Code';ctx.textAlign='center';ctx.fillText(`${mol.name} | ${mol.formula} | ${mode.toUpperCase()}`,w/2,h-9);
}

function rotateX(a){mol3dState.rotX+=a;renderMol3D(mol3dState.currentMol);}
function rotateY(a){mol3dState.rotY+=a;renderMol3D(mol3dState.currentMol);}
function resetRotation(){mol3dState.rotX=0;mol3dState.rotY=0;renderMol3D(mol3dState.currentMol);}
function rotateMol(){
  if(mol3dState.autoRot){clearInterval(mol3dState.autoRot);mol3dState.autoRot=null;document.getElementById('btn-rotate').textContent='‚ü≥ ROTATION AUTO';return;}
  document.getElementById('btn-rotate').textContent='‚èπ STOP';
  mol3dState.autoRot=setInterval(()=>{mol3dState.rotY+=1.5;renderMol3D(mol3dState.currentMol);},50);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ENERGY DIAGRAMS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ENERGY_PROFILES={
  sn1:{label:'SN1',tertiary:{Ea:75,dH:-40,pts:[[0,0],[30,75],[55,35],[80,75],[100,-40]],inter:'Carbocation'},secondary:{Ea:95,dH:-30,pts:[[0,0],[30,95],[55,45],[80,95],[100,-30]],inter:'Carbocation'},primary:{Ea:130,dH:-20,pts:[[0,0],[30,130],[55,55],[80,130],[100,-20]],inter:'Carbocation (instable)'}},
  sn2:{label:'SN2',tertiary:{Ea:145,dH:-45,pts:[[0,0],[50,145],[100,-45]],inter:'Aucun (concert√©)'},secondary:{Ea:110,dH:-42,pts:[[0,0],[50,110],[100,-42]],inter:'Aucun (concert√©)'},primary:{Ea:80,dH:-48,pts:[[0,0],[50,80],[100,-48]],inter:'Aucun (concert√©)'}},
  e1:{label:'E1',tertiary:{Ea:70,dH:-50,pts:[[0,0],[30,70],[55,30],[80,70],[100,-50]],inter:'Carbocation'},secondary:{Ea:90,dH:-40,pts:[[0,0],[30,90],[55,35],[80,90],[100,-40]],inter:'Carbocation'},primary:{Ea:125,dH:-30,pts:[[0,0],[30,125],[55,50],[80,125],[100,-30]],inter:'Carbocation (rare)'}},
  e2:{label:'E2',tertiary:{Ea:65,dH:-55,pts:[[0,0],[50,65],[100,-55]],inter:'Aucun (concert√©)'},secondary:{Ea:85,dH:-50,pts:[[0,0],[50,85],[100,-50]],inter:'Aucun (concert√©)'},primary:{Ea:100,dH:-45,pts:[[0,0],[50,100],[100,-45]],inter:'Aucun (concert√©)'}},
  ae:{label:'AE',tertiary:{Ea:50,dH:-85,pts:[[0,0],[30,50],[55,20],[80,50],[100,-85]],inter:'Carbocation/bromonium'},secondary:{Ea:65,dH:-80,pts:[[0,0],[30,65],[55,25],[80,65],[100,-80]],inter:'Carbocation'},primary:{Ea:80,dH:-75,pts:[[0,0],[30,80],[55,30],[80,80],[100,-75]],inter:'Carbocation'}},
  an:{label:'AN',tertiary:{Ea:40,dH:-60,pts:[[0,0],[35,40],[65,15],[100,-60]],inter:'Alcoxyde t√©tra√©drique'},secondary:{Ea:50,dH:-55,pts:[[0,0],[35,50],[65,20],[100,-55]],inter:'Alcoxyde'},primary:{Ea:60,dH:-50,pts:[[0,0],[35,60],[65,25],[100,-50]],inter:'Alcoxyde'}},
  estherif:{label:'Est√©rification',tertiary:{Ea:60,dH:-10,pts:[[0,0],[25,60],[50,30],[75,60],[100,-10]],inter:'T√©tra√©drique'},secondary:{Ea:65,dH:-8,pts:[[0,0],[25,65],[50,32],[75,65],[100,-8]],inter:'T√©tra√©drique'},primary:{Ea:70,dH:-5,pts:[[0,0],[25,70],[50,35],[75,70],[100,-5]],inter:'T√©tra√©drique'}}
};

function updateTemp(){
  const T=+document.getElementById('tempRange').value;
  document.getElementById('temp-display').textContent=T+'¬∞C';
  drawEnergyDiagram();
}

function drawEnergyDiagram(){
  const rxn=document.getElementById('energySel').value;
  const sub=document.getElementById('substrateType').value;
  const T=+document.getElementById('tempRange').value;
  const prof=ENERGY_PROFILES[rxn];if(!prof)return;
  const data=prof[sub]||prof.secondary;

  // compute Arrhenius k ratio
  const R=8.314,T_K=T+273.15,A=1e13;
  const k=A*Math.exp(-data.Ea*1000/(R*T_K));
  const halflife=Math.LN2/k;

  document.getElementById('enthalpy').textContent=(data.dH>0?'+':'')+data.dH+' kJ/mol';
  document.getElementById('ea-display').textContent=data.Ea+' kJ/mol';
  document.getElementById('inter-display').textContent=data.inter;
  document.getElementById('kinetics-box').innerHTML=`T = ${T}¬∞C (${(T+273).toFixed(0)} K)\nEa = ${data.Ea} kJ/mol\nk ‚àù e^(-${(data.Ea*1000/(R*T_K)).toFixed(1)})\nk rel = ${k.toExponential(2)}\nŒîH¬∞ = ${data.dH} kJ/mol`;

  const c=document.getElementById('energyCanvas');if(!c)return;
  const ctx=c.getContext('2d');const W=c.width,H=c.height;
  ctx.fillStyle='#0d1810';ctx.fillRect(0,0,W,H);

  // grid
  ctx.strokeStyle='rgba(255,255,255,0.05)';ctx.lineWidth=1;
  for(let i=0;i<=10;i++){ctx.beginPath();ctx.moveTo(60+i*(W-80)/10,20);ctx.lineTo(60+i*(W-80)/10,H-40);ctx.stroke();}
  for(let i=0;i<=8;i++){ctx.beginPath();ctx.moveTo(60,20+i*(H-60)/8);ctx.lineTo(W-20,20+i*(H-60)/8);ctx.stroke();}

  // axes
  ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.lineWidth=1.5;
  ctx.beginPath();ctx.moveTo(60,20);ctx.lineTo(60,H-40);ctx.lineTo(W-20,H-40);ctx.stroke();
  ctx.fillStyle='rgba(255,255,255,0.4)';ctx.font='9px Fira Code';ctx.textAlign='center';
  ctx.fillText('Coordonn√©e de r√©action ‚Üí',W/2,H-12);
  ctx.save();ctx.translate(14,H/2);ctx.rotate(-Math.PI/2);ctx.fillText('√ânergie (kJ/mol)',0,0);ctx.restore();

  // energy curve with Bezier
  const pts=data.pts;
  const maxE=Math.max(...pts.map(p=>p[1]));
  const minE=Math.min(...pts.map(p=>p[1]));
  const eRange=Math.max(Math.abs(maxE)+20,Math.abs(minE)+20,100);
  const baseline=H-40-(H-60)*(-minE+20)/eRange;

  function ex(xpct){return 60+(W-80)*xpct/100;}
  function ey(e){return H-40-(H-60)*(e-minE+20)/eRange;}

  // gradient curve
  const g=ctx.createLinearGradient(60,0,W-20,0);
  g.addColorStop(0,'#2d6a4f');g.addColorStop(0.5,'#b5451b');g.addColorStop(1,'#1d3557');
  ctx.strokeStyle=g;ctx.lineWidth=3;ctx.beginPath();
  pts.forEach((p,i)=>{
    const x=ex(p[0]),y=ey(p[1]);
    if(i===0){ctx.moveTo(x,y);}
    else{
      const pp=pts[i-1],px=ex(pp[0]),py=ey(pp[1]);
      const cpx=(px+x)/2,cpy=py;const cpx2=(px+x)/2,cpy2=y;
      ctx.bezierCurveTo(cpx,cpy,cpx2,cpy2,x,y);
    }
  });ctx.stroke();

  // peak markers
  pts.forEach((p,i)=>{
    const x=ex(p[0]),y=ey(p[1]);
    const isTransition=i>0&&i<pts.length-1&&p[1]>pts[i-1][1]&&p[1]>pts[i+1][1];
    const isInter=i>0&&i<pts.length-1&&p[1]<pts[i-1][1]&&p[1]<pts[i+1][1];
    ctx.beginPath();ctx.arc(x,y,5,0,Math.PI*2);
    ctx.fillStyle=isTransition?'#fd79a8':(isInter?'#fdcb6e':'#a8e6cf');ctx.fill();
    if(isTransition){ctx.fillStyle='#fd79a8';ctx.font='8px Fira Code';ctx.textAlign='center';ctx.fillText('‚Ä° Ea='+data.Ea,x,y-12);}
    if(i===0){ctx.fillStyle='rgba(255,255,255,0.55)';ctx.font='8px Fira Code';ctx.textAlign='center';ctx.fillText('R√©actifs',x+15,y-10);}
    if(i===pts.length-1){ctx.fillStyle='rgba(255,255,255,0.55)';ctx.font='8px Fira Code';ctx.textAlign='center';ctx.fillText('Produits',x-15,y-10);}
  });

  // dH annotation
  const lastP=pts[pts.length-1];
  ctx.strokeStyle='rgba(212,160,23,0.5)';ctx.setLineDash([4,3]);ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(ex(pts[0][0]),ey(pts[0][1]));ctx.lineTo(ex(lastP[0])+20,ey(pts[0][1]));ctx.stroke();
  ctx.beginPath();ctx.moveTo(ex(lastP[0]),ey(lastP[1]));ctx.lineTo(ex(lastP[0])+20,ey(lastP[1]));ctx.stroke();
  ctx.setLineDash([]);
  ctx.strokeStyle='rgba(212,160,23,0.7)';ctx.lineWidth=1.5;ctx.beginPath();
  ctx.moveTo(ex(lastP[0])+15,ey(pts[0][1]));ctx.lineTo(ex(lastP[0])+15,ey(lastP[1]));ctx.stroke();
  ctx.fillStyle='#fdcb6e';ctx.font='8px Fira Code';ctx.textAlign='left';
  ctx.fillText('ŒîH¬∞='+data.dH,ex(lastP[0])+18,ey((pts[0][1]+lastP[1])/2));

  // title
  ctx.fillStyle='rgba(255,255,255,0.6)';ctx.font='bold 11px Fraunces, serif';ctx.textAlign='center';
  ctx.fillText(`Profil √©nerg√©tique ${prof.label} ‚Äî ${sub==='tertiary'?'tertiaire':sub==='secondary'?'secondaire':'primaire'}`,W/2,35);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NOMENCLATURE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PREFIXES=['m√©th','√©th','prop','but','pent','hex','hept','oct','non','d√©c'];
const SUFFIXES={alcane:'ane',alcool:'anol',aldehyde:'anal',cetone:'anone',acide:'ano√Øque',amine:'anamine',ester:'anoate',alcene:'√®ne'};

function updateNomen(){
  const type=document.getElementById('nomenType').value;
  const n=+document.getElementById('chainLength').value;
  document.getElementById('chain-display').textContent=n+' C';
  const pos=Math.min(+document.getElementById('funcPos').value,n);
  const branch=document.getElementById('nomenBranch').value;
  const bp=Math.min(+document.getElementById('branchPos').value,n);
  const suf=SUFFIXES[type]||'ane';
  const pref=PREFIXES[n-1]||'?';
  let name='';
  let expl='';
  // Build name
  let branchPart='';
  if(branch==='methyl')branchPart=bp+'-m√©thyl-';
  else if(branch==='ethyl')branchPart=bp+'-√©thyl-';
  else if(branch==='dimethyl')branchPart=bp+','+Math.min(bp+2,n-1)+'-dim√©thyl-';
  if(type==='alcane'){name=branchPart+pref+suf;}
  else if(type==='alcool'){name=branchPart+pref+'an-'+pos+'-ol';}
  else if(type==='aldehyde'){name=branchPart+pref+suf;}
  else if(type==='cetone'){name=branchPart+pref+'an-'+pos+'-one';}
  else if(type==='acide'){name='Acide '+branchPart+pref+suf;}
  else if(type==='amine'){name=branchPart+pref+'an-'+pos+'-amine';}
  else if(type==='ester'){name=branchPart+'√©thyl '+pref+'anoate';}
  else if(type==='alcene'){name=branchPart+pref+'√®ne-'+pos;}
  // Explanation
  expl=`Cha√Æne principale : ${n} carbones ‚Üí ${pref}-\nType : ${type} ‚Üí suffix ${suf}\nPosition : ${pos}${branch?` | Ramif. : ${branch} en C${bp}`:''}`;
  document.getElementById('nomen-result').textContent=name;
  document.getElementById('nomen-explanation').innerHTML=expl.replace(/\n/g,'<br>');
  drawNomenChain(n,type,pos,branch,bp);
  drawNomenCanvas(n,type,pos);
}

function drawNomenChain(n,type,pos,branch,bp){
  const container=document.getElementById('nomen-chain');container.innerHTML='';
  const suffixSymbols={alcane:'',alcool:'OH',aldehyde:'CHO',cetone:'=O',acide:'COOH',amine:'NH‚ÇÇ',ester:'COO',alcene:'='};
  for(let i=1;i<=n;i++){
    const d=document.createElement('div');d.className='nomen-c';
    let label='C'+i;
    if(i===pos&&type!=='alcane'){d.style.background='var(--p2)';label='C'+i+'('+suffixSymbols[type]+')';}
    if(branch&&i===bp){d.style.background='var(--p3)';}
    d.textContent=label;d.title=`Carbone ${i}`;container.appendChild(d);
    if(i<n){const arrow=document.createElement('div');arrow.style.cssText='color:rgba(255,255,255,.4);font-family:Fira Code;font-size:.7rem;align-self:center;';arrow.textContent='‚Äî';container.appendChild(arrow);}
  }
}

function drawNomenCanvas(n,type,pos){
  const c=document.getElementById('nomenCanvas');if(!c)return;
  const ctx=c.getContext('2d');const w=c.width,h=c.height;
  ctx.fillStyle='#1c1410';ctx.fillRect(0,0,w,h);
  const dx=Math.min(165/n,35),sx=25;
  for(let i=0;i<n;i++){
    const x=sx+i*dx;const y=h/2;
    ctx.strokeStyle='rgba(200,200,200,0.4)';ctx.lineWidth=2;
    if(i<n-1){ctx.beginPath();ctx.moveTo(x+11,y);ctx.lineTo(x+dx-11,y);ctx.stroke();}
    ctx.beginPath();ctx.arc(x,y,11,0,Math.PI*2);
    ctx.fillStyle=(i+1)===pos&&type!=='alcane'?'#b5451b':'#2d6a4f';ctx.fill();
    ctx.fillStyle='white';ctx.font='bold 7px Fira Code';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText('C'+(i+1),x,y);
    // vertical substituents
    if(i===0&&(type==='aldehyde'||type==='acide')){ctx.fillStyle='#ff6b6b';ctx.font='7px Fira Code';ctx.textAlign='center';ctx.fillText('O',x,y-25);}
    if((i+1)===pos&&type==='alcool'){ctx.fillStyle='#ff6b6b';ctx.font='7px Fira Code';ctx.textAlign='center';ctx.fillText('OH',x,y-25);}
    if((i+1)===pos&&type==='amine'){ctx.fillStyle='#74b9ff';ctx.font='7px Fira Code';ctx.textAlign='center';ctx.fillText('NH‚ÇÇ',x,y-25);}
  }
  ctx.fillStyle='rgba(255,255,255,.35)';ctx.font='8px Fira Code';ctx.textAlign='center';ctx.fillText('Structure simplifi√©e',w/2,h-8);
}

let nomenQuiz={q:null,correct:null,answered:false};
function genNomenQuiz(){
  const types=['alcane','alcool','aldehyde','cetone','acide'];
  const t=types[Math.floor(Math.random()*types.length)];
  const n=2+Math.floor(Math.random()*6);
  const pos=1+Math.floor(Math.random()*(n-1));
  const suf=SUFFIXES[t];const pref=PREFIXES[n-1];
  let correct;
  if(t==='alcane')correct=pref+suf;
  else if(t==='aldehyde')correct=pref+suf;
  else if(t==='alcool')correct=pref+'an-'+pos+'-ol';
  else if(t==='cetone')correct=pref+'an-'+pos+'-one';
  else if(t==='acide')correct='acide '+pref+suf;
  nomenQuiz={t,n,pos,correct,answered:false};
  // generate wrong answers
  const wrongs=[PREFIXES[n]?PREFIXES[n]+suf:PREFIXES[n-2]+suf,pref+'an-'+(pos===1?2:pos-1)+'-ol',pref+SUFFIXES[t==='alcool'?'acide':'alcool']];
  const opts=[correct,...wrongs.slice(0,2)].sort(()=>Math.random()-0.5);
  document.getElementById('nomen-quiz').innerHTML=`<p style="font-size:.81rem;font-weight:700;margin-bottom:8px;">Nommez : ${pref.charAt(0).toUpperCase()+pref.slice(1)}ane (C${n}) type ${t}, position ${pos}</p>${opts.map(o=>`<button onclick="checkNomenAnswer('${o}')" style="display:block;width:100%;text-align:left;margin-bottom:5px;background:var(--panel);border:1.5px solid var(--border);border-radius:6px;padding:7px 11px;cursor:pointer;font-family:'Manrope',sans-serif;font-size:.79rem;">${o}</button>`).join('')}<button onclick="genNomenQuiz()" class="btn btn-o" style="width:auto;padding:5px 13px;font-size:.75rem;margin-top:7px;">üé≤ Autre</button>`;
}

function checkNomenAnswer(ans){
  if(nomenQuiz.answered)return;
  nomenQuiz.answered=true;
  const btns=document.querySelectorAll('#nomen-quiz button');
  btns.forEach(b=>{if(b.textContent===nomenQuiz.correct)b.style.background='#d4edda';if(b.textContent===ans&&ans!==nomenQuiz.correct)b.style.background='#f8d7da';});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ISOMERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ISOMERS_DATA={
  C4H10:{name:'C‚ÇÑH‚ÇÅ‚ÇÄ ‚Äî Butane',isomers:[{name:'n-butane',type:'Constitution',smiles:'C-C-C-C',desc:'Cha√Æne droite. 4 carbones en ligne.',formula:'CH‚ÇÉ-CH‚ÇÇ-CH‚ÇÇ-CH‚ÇÉ',eb:'-0.5¬∞C'},{name:'isobutane (2-m√©thylpropane)',type:'Constitution',smiles:'CC(C)C',desc:'Ramifi√©. Cha√Æne de 3C + 1 m√©thyle en C2.',formula:'(CH‚ÇÉ)‚ÇÉCH',eb:'-11.7¬∞C'}]},
  C5H12:{name:'C‚ÇÖH‚ÇÅ‚ÇÇ ‚Äî Pentane',isomers:[{name:'n-pentane',type:'Constitution',smiles:'CCCCC',desc:'Cha√Æne droite (5C).',formula:'CH‚ÇÉ(CH‚ÇÇ)‚ÇÉCH‚ÇÉ',eb:'36.1¬∞C'},{name:'isopentane (2-m√©thylbutane)',type:'Constitution',smiles:'CCC(C)C',desc:'Ramifi√©. M√©thyle en C2.',formula:'(CH‚ÇÉ)‚ÇÇCHCH‚ÇÇCH‚ÇÉ',eb:'27.9¬∞C'},{name:'n√©opentane (2,2-dim√©thylpropane)',type:'Constitution',smiles:'CC(C)(C)C',desc:'Tr√®s ramifi√©. Sym√©trique.',formula:'C(CH‚ÇÉ)‚ÇÑ',eb:'9.5¬∞C'}]},
  C4H8:{name:'C‚ÇÑH‚Çà ‚Äî But√®nes (DB=1)',isomers:[{name:'but-1-√®ne',type:'Position',smiles:'C=CCC',desc:'Double liaison en C1-C2.',formula:'CH‚ÇÇ=CH-CH‚ÇÇ-CH‚ÇÉ',eb:'-6.3¬∞C'},{name:'(Z)-but-2-√®ne',type:'St√©r√©o',smiles:'C/C=C\\C',desc:'Cis-isom√®re (Z). M√©thyles m√™me c√¥t√©.',formula:'Z-CH‚ÇÉ-CH=CH-CH‚ÇÉ',eb:'3.7¬∞C'},{name:'(E)-but-2-√®ne',type:'St√©r√©o',smiles:'C/C=C/C',desc:'Trans-isom√®re (E). M√©thyles oppos√©s.',formula:'E-CH‚ÇÉ-CH=CH-CH‚ÇÉ',eb:'0.9¬∞C'},{name:'isobutyl√®ne (2-m√©thylprop√®ne)',type:'Constitution',smiles:'C=C(C)C',desc:'Alc√®ne terminal, ramifi√©.',formula:'CH‚ÇÇ=C(CH‚ÇÉ)‚ÇÇ',eb:'-6.9¬∞C'}]},
  C3H8O:{name:'C‚ÇÉH‚ÇàO ‚Äî Propanol (DBE=0)',isomers:[{name:'propan-1-ol',type:'Position',smiles:'CCCO',desc:'OH sur C1 terminal. Alcool primaire.',formula:'CH‚ÇÉ-CH‚ÇÇ-CH‚ÇÇOH',eb:'97.2¬∞C'},{name:'propan-2-ol (isopropanol)',type:'Position',smiles:'CC(O)C',desc:'OH sur C2. Alcool secondaire. D√©sinfectant.',formula:'(CH‚ÇÉ)‚ÇÇCHOH',eb:'82.6¬∞C'},{name:'m√©thoxy√©thane (m√©thyl-√©thyl-√©ther)',type:'Fonction',smiles:'COC C',desc:'√âther (R-O-R\'). M√™me formule, groupe fonctionnel diff√©rent.',formula:'CH‚ÇÉ-O-CH‚ÇÇCH‚ÇÉ',eb:'7.4¬∞C'}]},
  C4H8O:{name:'C‚ÇÑH‚ÇàO ‚Äî DBE=1',isomers:[{name:'butanal',type:'Constitution',smiles:'CCCC=O',desc:'Ald√©hyde en C1. R√©ducteur. Tollens +.',formula:'CH‚ÇÉCH‚ÇÇCH‚ÇÇCHO',eb:'74.8¬∞C'},{name:'butanone (MEK)',type:'Constitution',smiles:'CCC(=O)C',desc:'C√©tone. Non r√©ducteur. Solvant industriel.',formula:'CH‚ÇÉ-CO-CH‚ÇÇCH‚ÇÉ',eb:'79.6¬∞C'},{name:'2-m√©thylpropanal',type:'Constitution',smiles:'CC(C)C=O',desc:'Ald√©hyde ramifi√©. Isom√®re de constitution.',formula:'(CH‚ÇÉ)‚ÇÇCHCHO',eb:'61¬∞C'},{name:'t√©trahydrofurane (THF)',type:'Fonction',smiles:'C1CCCO1',desc:'√âther cyclique (lactone). Solvant.',formula:'Cycle O-CH‚ÇÇ-CH‚ÇÇ-CH‚ÇÇ-CH‚ÇÇ',eb:'66¬∞C'}]},
  C4H9Br:{name:'C‚ÇÑH‚ÇâBr ‚Äî Bromobutanes',isomers:[{name:'1-bromobutane',type:'Position',smiles:'CCCCBr',desc:'Br en C1. Substrat primaire SN2.',formula:'CH‚ÇÉCH‚ÇÇCH‚ÇÇCH‚ÇÇBr',eb:'101.6¬∞C'},{name:'2-bromobutane',type:'Position',smiles:'CCC(Br)C',desc:'Br en C2. Centre chiral ‚Üí √©nantiom√®res R et S.',formula:'CH‚ÇÉCHBrCH‚ÇÇCH‚ÇÉ',eb:'91.2¬∞C'},{name:'(R)-2-bromobutane',type:'St√©r√©o',smiles:'[C@@H](Br)(CC)C',desc:'√ânantiom√®re R. Propri√©t√©s diff√©rentes si chirale.',formula:'(R)-CH‚ÇÉCHBrC‚ÇÇH‚ÇÖ',eb:'91¬∞C'},{name:'(S)-2-bromobutane',type:'St√©r√©o',smiles:'[C@H](Br)(CC)C',desc:'√ânantiom√®re S. Image miroir de R.',formula:'(S)-CH‚ÇÉCHBrC‚ÇÇH‚ÇÖ',eb:'91¬∞C'},{name:'1-bromo-2-m√©thylpropane',type:'Constitution',smiles:'CC(C)CBr',desc:'Br sur C de cha√Æne ramifi√©e. Primaire.',formula:'(CH‚ÇÉ)‚ÇÇCHCH‚ÇÇBr',eb:'91.5¬∞C'},{name:'2-bromo-2-m√©thylpropane (t-BuBr)',type:'Constitution',smiles:'CC(C)(C)Br',desc:'Tertiaire. SN1/E1 favoris√©.',formula:'(CH‚ÇÉ)‚ÇÉCBr',eb:'73.3¬∞C'}]}
};

const ISOMER_COLORS={Constitution:'var(--p1)',Position:'var(--p2)',Fonction:'var(--p3)',St√©r√©o:'var(--gold)'};
function showIsomers(){
  const key=document.getElementById('isomerFormula').value;
  const data=ISOMERS_DATA[key];if(!data)return;
  document.getElementById('isomers-content').innerHTML=`<h3 style="font-family:'Fraunces',serif;color:var(--p1);margin-bottom:9px;">${data.name}</h3><div class="isomer-grid">${data.isomers.map((iso,i)=>`<div class="isomer-card" onclick="this.style.borderColor='${ISOMER_COLORS[iso.type]}'"><div style="background:${ISOMER_COLORS[iso.type]};color:white;border-radius:4px;padding:2px 7px;font-size:.6rem;font-family:'Fira Code',monospace;font-weight:700;margin-bottom:6px;display:inline-block;">${iso.type}</div><div style="font-weight:700;font-size:.79rem;margin-bottom:4px;">${iso.name}</div><div style="font-family:'Fira Code',monospace;font-size:.72rem;color:var(--p1);margin-bottom:5px;">${iso.formula}</div><div style="font-size:.71rem;color:var(--muted);line-height:1.6;">${iso.desc}</div><div style="font-size:.68rem;color:var(--p2);margin-top:4px;font-family:'Fira Code',monospace;">Eb = ${iso.eb}</div></div>`).join('')}</div><div style="margin-top:9px;font-size:.75rem;color:var(--muted);">Code couleur : <span style="color:var(--p1)">‚ñ† Constitution</span> ¬∑ <span style="color:var(--p2)">‚ñ† Position</span> ¬∑ <span style="color:var(--p3)">‚ñ† Fonction</span> ¬∑ <span style="color:var(--gold)">‚ñ† St√©r√©o</span></div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALCULATOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ATOMIC_MASSES={H:1.008,C:12.011,N:14.007,O:15.999,F:18.998,Cl:35.453,Br:79.904,I:126.9,S:32.06,P:30.97,Na:22.99,K:39.1,Ca:40.08,Mg:24.31,Al:26.98,Si:28.09};

function updateCalcUI(){
  const t=document.getElementById('calcType').value;
  const inputs=document.getElementById('calc-inputs');
  const formulas=document.getElementById('calc-formula');
  const templates={
    mol:{inputs:`<div class="fg"><label>FORMULE BRUTE (ex: C2H5OH, C6H12O6)</label><input type="text" id="ci-formula" value="C2H5OH" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div>`,formula:'M = Œ£(n√óM_atome)\nC=12.011, H=1.008, O=15.999...'},
    yield:{inputs:`<div class="fg"><label>MASSE TH√âORIQUE (g)</label><input type="number" id="ci-theoric" value="10" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div><div class="fg"><label>MASSE EXP√âRIMENTALE (g)</label><input type="number" id="ci-exp" value="7.5" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div>`,formula:'œÑ = (m_exp / m_th√©o) √ó 100 (%)'},
    dilution:{inputs:`<div class="fg"><label>C‚ÇÅ (mol/L)</label><input type="number" id="ci-c1" value="1" step="0.01" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div><div class="fg"><label>V‚ÇÅ (mL)</label><input type="number" id="ci-v1" value="50" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div><div class="fg"><label>C‚ÇÇ VOULUE (mol/L)</label><input type="number" id="ci-c2" value="0.1" step="0.01" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div>`,formula:'C‚ÇÅV‚ÇÅ = C‚ÇÇV‚ÇÇ ‚Üí V‚ÇÇ = C‚ÇÅV‚ÇÅ/C‚ÇÇ'},
    ph:{inputs:`<div class="fg"><label>CONCENTRATION C (mol/L)</label><input type="number" id="ci-ph-c" value="0.1" step="0.001" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div><div class="fg"><label>pKa (ex: 4.76 pour acide ac√©tique)</label><input type="number" id="ci-pka" value="4.76" step="0.01" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div>`,formula:'pH = ¬Ω(pKa - log C)  (acide faible)'},
    degree:{inputs:`<div class="fg"><label>FORMULE BRUTE (ex: C6H6, C4H8O)</label><input type="text" id="ci-dbe" value="C6H6" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div>`,formula:'DBE = (2C + 2 + N - H - X) / 2\nChaque DBE = 1 double liaison ou 1 cycle'},
    rf:{inputs:`<div class="fg"><label>DISTANCE COMPOS√â (mm)</label><input type="number" id="ci-dc" value="35" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div><div class="fg"><label>DISTANCE SOLVANT (mm)</label><input type="number" id="ci-ds" value="80" style="width:100%;background:var(--panel2);border:1px solid var(--border);border-radius:5px;padding:7px;color:var(--ink);font-family:'Fira Code',monospace;"></div>`,formula:'Rf = d_compos√© / d_solvant  (0 ‚â§ Rf ‚â§ 1)'}
  };
  const tmpl=templates[t];
  inputs.innerHTML=tmpl?tmpl.inputs:'';
  formulas.textContent=tmpl?tmpl.formula:'‚Äî';
}

function parseMolecularFormula(f){
  let M=0;const re=/([A-Z][a-z]?)(\d*)/g;let m;
  while((m=re.exec(f))!==null){const el=m[1];const n=+m[2]||1;if(ATOMIC_MASSES[el])M+=ATOMIC_MASSES[el]*n;}
  return M;
}
function parseDBE(f){
  let C=0,H=0,N=0,X=0;const re=/([A-Z][a-z]?)(\d*)/g;let m;
  while((m=re.exec(f))!==null){const el=m[1];const n=+m[2]||1;if(el==='C')C+=n;else if(el==='H')H+=n;else if(el==='N')N+=n;else if(['F','Cl','Br','I'].includes(el))X+=n;}
  return(2*C+2+N-H-X)/2;
}

function calculate(){
  const t=document.getElementById('calcType').value;
  const res=document.getElementById('calc-result');
  let result='';
  try{
    if(t==='mol'){
      const f=document.getElementById('ci-formula').value.trim();
      const M=parseMolecularFormula(f);
      result=`Formule : ${f}\nMasse molaire = ${M.toFixed(3)} g/mol\n\nComposition √©l√©mentaire :\n${Object.entries(ATOMIC_MASSES).filter(([el])=>f.includes(el)).map(([el])=>{const re=new RegExp(el+'(\\d*)','g');let n=0,mm;while((mm=re.exec(f))!==null)n+=+(mm[1])||1;return `${el} : ${n} atome(s) √ó ${ATOMIC_MASSES[el]} = ${(n*ATOMIC_MASSES[el]).toFixed(3)} g/mol (${(n*ATOMIC_MASSES[el]/M*100).toFixed(1)}%)`;}).join('\n')}`;
    } else if(t==='yield'){
      const mth=+document.getElementById('ci-theoric').value;
      const mexp=+document.getElementById('ci-exp').value;
      const yield_=mexp/mth*100;
      result=`Rendement = ${yield_.toFixed(2)}%\n\nm_exp = ${mexp} g\nm_th√©o = ${mth} g\n\n${yield_>90?'‚úÖ Excellent rendement':yield_>70?'üëç Bon rendement':yield_>50?'‚ö†Ô∏è Rendement moyen':'‚ùå Faible rendement'}\n\nPerte = ${(mth-mexp).toFixed(3)} g (${(100-yield_).toFixed(2)}%)`;
    } else if(t==='dilution'){
      const c1=+document.getElementById('ci-c1').value;
      const v1=+document.getElementById('ci-v1').value;
      const c2=+document.getElementById('ci-c2').value;
      const v2=c1*v1/c2;
      result=`C‚ÇÅV‚ÇÅ = C‚ÇÇV‚ÇÇ\n\nV‚ÇÇ = (${c1} √ó ${v1}) / ${c2}\nV‚ÇÇ = ${v2.toFixed(2)} mL\n\nVolume d'eau √† ajouter : ${(v2-v1).toFixed(2)} mL\nFacteur de dilution : ${(c1/c2).toFixed(2)}√ó`;
    } else if(t==='ph'){
      const c=+document.getElementById('ci-ph-c').value;
      const pka=+document.getElementById('ci-pka').value;
      const pH=(pka-Math.log10(c))/2;
      const alpha=Math.pow(10,-pH)/c;
      result=`pH = ¬Ω(${pka} - log(${c}))\npH = ${pH.toFixed(2)}\n\npKa = ${pka} | C = ${c} mol/L\n[H‚Å∫] = ${(Math.pow(10,-pH)).toExponential(3)} mol/L\nTaux d'ionisation Œ± = ${(alpha*100).toFixed(2)}%\n${alpha<0.05?'‚úÖ Approximation acide faible valide':'‚ö†Ô∏è Approximation limite ‚Äî utiliser formule exacte'}`;
    } else if(t==='degree'){
      const f=document.getElementById('ci-dbe').value.trim();
      const dbe=parseDBE(f);
      result=`Formule : ${f}\nDegr√© d'insaturation = ${dbe}\n\n${dbe===0?'Alcane satur√© (pas de DB/cycle)':dbe===1?'1 double liaison OU 1 cycle':dbe===2?'2 DB, 1 triple liaison OU 2 cycles':dbe===4?'Cycle benz√©nique possible ! (3DB+1cycle=4)':dbe+' degr√©s d\'insaturation'}\n\nH√ºckel : aromatique si 4n+2 œÄ-√©lectrons\nBenz√®ne : DBE=4 (3√óC=C + 1 cycle)`;
    } else if(t==='rf'){
      const dc=+document.getElementById('ci-dc').value;
      const ds=+document.getElementById('ci-ds').value;
      const rf=dc/ds;
      result=`Rf = ${dc} / ${ds} = ${rf.toFixed(3)}\n\n${rf<0.2?'Rf tr√®s faible ‚Üí compos√© tr√®s polaire':rf<0.5?'Rf mod√©r√© ‚Üí polarit√© interm√©diaire':rf<0.8?'Rf √©lev√© ‚Üí compos√© peu polaire':'Rf tr√®s √©lev√© ‚Üí compos√© apolaire'}\n\nEluant √† adapter si Rf < 0.2 (plus polaire) ou > 0.8 (moins polaire)`;
    }
    res.textContent=result||'‚Äî';
  }catch(e){res.textContent='‚ùå Erreur : v√©rifiez les valeurs saisies. '+e.message;}
}

function clearCalc(){document.getElementById('calc-result').textContent='S√©lectionnez un type de calcul...';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const QUIZ_QUESTIONS={
  mechanisms:[
    {q:'Quel est l\'ordre cin√©tique de la r√©action SN1 ?',opts:['Ordre 1 (v = k[RX])','Ordre 2 (v = k[RX][Nu])','Ordre 0','Pseudo-ordre 1'],a:0,exp:'SN1 = unimol√©culaire. L\'√©tape lente (ionisation) ne d√©pend que du substrat. v = k[RX]. Ordre 1.'},
    {q:'Quel m√©canisme donne une inversion totale de configuration de Walden ?',opts:['SN1','SN2','E1','E2'],a:1,exp:'SN2 : attaque 180¬∞ de X, √©tat de transition bipyramidal ‚Üí inversion totale du parapluie. 100% st√©r√©osp√©cifique.'},
    {q:'La r√®gle de Markovnikov s\'applique √†...',opts:['AE sur alc√®nes','SN2 sur halog√©nures','E2 √©limination','AN sur carbonyles'],a:0,exp:'Markovnikov : dans l\'addition √©lectrophile sur alc√®ne, H‚Å∫ va sur le C le plus riche en H (‚Üí carbocation le plus stable).'},
    {q:'Quel solvant favorise la r√©action SN2 ?',opts:['Polaire aprotique (DMSO, DMF)','Polaire protique (EtOH, H‚ÇÇO)','Apolaire (hexane)','Aqueux acide'],a:0,exp:'Solvant polaire aprotique : solubilise le substrat mais ne complexe pas Nu‚Åª ‚Üí Nu‚Åª libre et r√©actif. Id√©al pour SN2.'},
    {q:'L\'acylation de Friedel-Crafts utilise quel catalyseur ?',opts:['AlCl‚ÇÉ (acide de Lewis)','H‚ÇÇSO‚ÇÑ concentr√©','NaOH','KMnO‚ÇÑ'],a:0,exp:'AlCl‚ÇÉ est l\'acide de Lewis par excellence pour F-C. Il active RCOCl ‚Üí RCO‚Å∫ (acylium) qui fait la SEAr.'},
    {q:'Dans E2, quelle g√©om√©trie H-C-C-X est requise ?',opts:['Anti-p√©riplanaire (180¬∞)','Syn-p√©riplanaire (0¬∞)','Gauche (60¬∞)','√âclips√©e (120¬∞)'],a:0,exp:'E2 exige que H et X soient anti-p√©riplanaires (di√®dre 180¬∞). Conformation indispensable. Visible en Newman.'},
    {q:'La saponification se distingue de l\'hydrolyse acide par...',opts:['Son irr√©versibilit√© (RCOO‚Åª stable)','Sa vitesse','Sa temp√©rature','Son catalyseur acide'],a:0,exp:'Saponification (OH‚Åª) ‚Üí RCOO‚Åª (carboxylate) imm√©diatement. √âtape de neutralisation irr√©versible. ‚â† hydrolyse acide (r√©versible).'},
    {q:'Quel r√©actif transforme un ald√©hyde en alcool primaire ?',opts:['NaBH‚ÇÑ','KMnO‚ÇÑ','AlCl‚ÇÉ','NaNO‚ÇÇ'],a:0,exp:'NaBH‚ÇÑ (borohydrure) fournit H‚Åª (nucl√©ophile). Addition nucl√©ophile sur C=O ‚Üí alcoxyde ‚Üí alcool 1¬∞ (depuis ald√©hyde).'},
    {q:'La r√®gle de Za√Øtsev concerne...',opts:['L\'alc√®ne le plus substitu√© form√© en E1/E2','Le produit Markovnikov','La st√©r√©ochimie SN2','Les carbocations tertiaires'],a:0,exp:'Za√Øtsev : l\'√©limination favorise l\'alc√®ne le plus substitu√© (plus stable thermodynamiquement). Base faible ‚Üí Za√Øtsev.'},
    {q:'Le r√©actif de Grignard doit √™tre pr√©par√© dans...',opts:['√âther anhydre sous N‚ÇÇ','Eau distill√©e','√âthanol','DMSO aqueux'],a:0,exp:'Grignard d√©truit instantan√©ment par H‚ÇÇO. √âther anhydre (Et‚ÇÇO ou THF) + atmosph√®re N‚ÇÇ/Ar indispensables.'}
  ],
  functional:[
    {q:'Quel groupe fonctionnel est pr√©sent dans une c√©tone ?',opts:['C=O interne (>C=O)','C=O terminal (-CHO)','O-H (-OH)','C-O-C'],a:0,exp:'C√©tone : C=O carbonyle interne. Ald√©hyde : C=O terminal (-CHO). Alcool : O-H. √âther : C-O-C.'},
    {q:'Quel est le pKa approximatif d\'un acide carboxylique ?',opts:['4-5','9-10','15-18','25'],a:0,exp:'Acide carboxylique : pKa ‚âà 4-5 (acide faible). Alcool : 15-18. Ph√©nol : 10. Alcyne terminal : 25.'},
    {q:'Quel test positif identifie un ald√©hyde ?',opts:['R√©action de Tollens (miroir d\'argent)','Test de Lucas','Test au permanganate','Test de Baeyer'],a:0,exp:'Tollens (AgNO‚ÇÉ/NH‚ÇÉ) : ald√©hyde ‚Üí miroir d\'argent (Ag¬∞). C√©tones : ne r√©duisent pas Tollens. Aldehydes r√©ducteurs.'},
    {q:'Les amines aromatiques (anilines) sont...',opts:['Bases plus faibles que les amines aliphatiques','Bases plus fortes','Acides','Neutres'],a:0,exp:'Aniline (ArNH‚ÇÇ) : doublet N d√©localis√© dans le cycle ‚Üí pKa(NH‚ÇÉ‚Å∫)=4.6. Amine aliphatique : pKa ‚âà 10-11.'},
    {q:'La saponification d\'un ester donne...',opts:['Un carboxylate + un alcool','Un acide + un √©ther','Une c√©tone + un alcool','Un acide + un alc√®ne'],a:0,exp:'RCOOR\' + OH‚Åª ‚Üí RCOO‚Åª + R\'OH. Carboxylate (sel) + alcool. R√©action irr√©versible.'},
    {q:'Quel groupe fonctionnel rend une mol√©cule miscible √† l\'eau (si petite) ?',opts:['Hydroxyle (-OH)','Alkyle (-R)','Halog√®ne (-X) apolaire','Alk√®ne (C=C)'],a:0,exp:'OH forme des liaisons H avec H‚ÇÇO ‚Üí miscibilit√©. CH‚ÇÉOH, C‚ÇÇH‚ÇÖOH miscibles. Au-del√† de C5-C6, partie hydrophobe domine.'},
    {q:'Le ph√©nol est-il plus ou moins acide qu\'un alcool ?',opts:['Plus acide (pKa‚âà10 vs 16-18)','Moins acide','M√™me acidit√©','Neutre'],a:0,exp:'Ph√©nol : pKa‚âà10. Alcool : pKa‚âà16-18. Ph√©nolate ArO‚Åª stabilis√© par r√©sonance avec cycle ‚Üí ph√©nol plus acide.'}
  ],
  stereo:[
    {q:'Un centre chiral porte combien de groupes diff√©rents ?',opts:['4 substituants tous diff√©rents','3 substituants diff√©rents','2 paires identiques','Aucune restriction'],a:0,exp:'Centre chiral (st√©r√©og√®ne) : C sp¬≥ avec 4 substituants tous diff√©rents. Condition n√©cessaire et suffisante.'},
    {q:'La configuration R correspond √†...',opts:['Sens horaire 1‚Üí2‚Üí3 avec groupe 4 derri√®re','Sens antihoraire','Groupe 4 devant','Double liaison'],a:0,exp:'CIP : classer 1>2>3>4. Mettre 4 derri√®re. 1‚Üí2‚Üí3 : ‚Üª = R (Rectus), ‚Ü∫ = S (Sinister).'},
    {q:'Un m√©lange rac√©mique contient...',opts:['50% R + 50% S (√©nantiom√®res)','Un seul √©nantiom√®re pur','Diast√©r√©oisom√®res','Un compos√© m√©so'],a:0,exp:'Rac√©mique (¬±) : m√©lange 50/50 des 2 √©nantiom√®res. Activit√© optique nulle. Produit typique de SN1 (carbocation plan).'},
    {q:'Les diast√©r√©oisom√®res ont...',opts:['Des propri√©t√©s physico-chimiques diff√©rentes','Exactement les m√™mes propri√©t√©s','M√™me point de fusion','M√™me Rf en CCM'],a:0,exp:'Diast√©r√©oisom√®res : diff√©rences de propri√©t√©s physiques (Eb, pF, Rf, solubilit√©). ‚â† √©nantiom√®res (propri√©t√©s identiques sauf plan polarisation).'},
    {q:'Dans la projection de Newman, les liaisons horizontales repr√©sentent...',opts:['Les liaisons DEVANT le plan (vers observateur)','Les liaisons derri√®re','La cha√Æne principale','Le cycle benz√©nique'],a:0,exp:'Fischer : horizontal = devant le plan (en avant). Vertical = derri√®re. Mn√©mo : les bras tendent vers vous.'},
    {q:'Un compos√© m√©so est...',opts:['Achiral malgr√© des centres chiraux (plan de sym√©trie)','Toujours chiral','Un √©nantiom√®re pur','Un rac√©mique'],a:0,exp:'M√©so : centres chiraux (R et S qui se compensent) + plan de sym√©trie interne ‚Üí achiral au total. Ex: acide m√©so-tartrique.'},
    {q:'E/Z fait r√©f√©rence √†...',opts:['La st√©r√©ochimie des alc√®nes (isom√®res g√©om√©triques)','La st√©r√©ochimie des alcanes','La configuration R/S','Les projections Newman'],a:0,exp:'E/Z : alc√®nes (liaison œÄ fixe). Z (zusammen) = prioritaires m√™me c√¥t√©. E (entgegen) = prioritaires c√¥t√©s oppos√©s.'}
  ],
  nomenclature:[
    {q:'Quel est le nom IUPAC de CH‚ÇÉ-CH‚ÇÇ-OH ?',opts:['√âthanol','M√©thanol','Propan-1-ol','√âthyl√®ne glycol'],a:0,exp:'CH‚ÇÉ-CH‚ÇÇ-OH : 2 carbones (√©th-) + alcool (-anol) = √©thanol. Pas besoin de num√©ro de position (seul C1 possible).'},
    {q:'Comment nomme-t-on CH‚ÇÉ-CO-CH‚ÇÇ-CH‚ÇÉ ?',opts:['Butan-2-one','Butanal','Pentan-2-one','M√©thyl-√©thyl-c√©tone IUPAC'],a:0,exp:'CH‚ÇÉ-CO-CH‚ÇÇ-CH‚ÇÉ : 4 carbones (but-), c√©tone (-one), C=O en C2 = butan-2-one.'},
    {q:'Le pr√©fixe "prop" indique...',opts:['3 carbones dans la cha√Æne','2 carbones','4 carbones','Un cycle'],a:0,exp:'Pr√©fixes : meth=1, √©th=2, prop=3, but=4, pent=5, hex=6, hept=7, oct=8.'},
    {q:'L\'acide CH‚ÇÉCOOH se nomme...',opts:['Acide √©thano√Øque (ou ac√©tique)','Acide m√©thano√Øque','Acide propano√Øque','√âthanald√©hyde'],a:0,exp:'CH‚ÇÉCOOH : acide (pr√©fixe "acide ") + 2 carbones (√©th-) + acide carboxylique (-ano√Øque) = acide √©thano√Øque.'},
    {q:'Le num√©ro de position d\'un groupe fonctionnel doit √™tre...',opts:['Le plus petit possible','Le plus grand','Au milieu de la cha√Æne','Toujours 1'],a:0,exp:'R√®gle IUPAC : donner le num√©ro le plus bas au groupe fonctionnel (prioritaire) ou √† la premi√®re ramification.'},
    {q:'CH‚ÇÇ=CH-CH‚ÇÉ se nomme...',opts:['Prop√®ne (prop-1-√®ne)','Propane','But√®ne','√âthyl√®ne'],a:0,exp:'CH‚ÇÇ=CH-CH‚ÇÉ : 3C (prop-) + alc√®ne (-√®ne) + double liaison en C1 = prop-1-√®ne (ou prop√®ne). ‚â† √©thyl√®ne (C‚ÇÇH‚ÇÑ).'}
  ],
  synthesis:[
    {q:'Pour synth√©tiser un alcool tertiaire √† partir d\'une c√©tone, on utilise...',opts:['Un r√©actif de Grignard (RMgX)','NaBH‚ÇÑ','KMnO‚ÇÑ','PCC'],a:0,exp:'Grignard (R-MgX) + c√©tone (R\'COR\'\'): carbanion attaque C=O ‚Üí alcool tertiaire R-CR\'(OH)R\'\'.'},
    {q:'PCC oxyde s√©lectivement un alcool primaire en...',opts:['Ald√©hyde (pas d\'acide)','Acide carboxylique','C√©tone','√âther'],a:0,exp:'PCC (anhydre) : alcool 1¬∞ ‚Üí ald√©hyde (s\'arr√™te l√†). KMnO‚ÇÑ aqueux oxyde l\'ald√©hyde en acide. PCC en milieu anhydre √©vite l\'hydratation.'},
    {q:'L\'hydroboration-oxydation d\'un alc√®ne donne...',opts:['Alcool anti-Markovnikov','Alcool Markovnikov','Ald√©hyde','Halog√©nure'],a:0,exp:'Hydroboration : BH‚ÇÉ sur alc√®ne ‚Üí B sur C terminal ‚Üí H‚ÇÇO‚ÇÇ/NaOH ‚Üí alcool sur C terminal (anti-Markovnikov).'},
    {q:'Pour faire une est√©rification, on utilise...',opts:['Acide carboxylique + alcool + H‚Å∫ (cat.)','Alcool + alcool','Ald√©hyde + alcool','Acide + amine'],a:0,exp:'Est√©rification de Fischer : RCOOH + R\'OH ‚áå RCOOR\' + H‚ÇÇO (H‚ÇÇSO‚ÇÑ cat., reflux). √âquilibre ‚Üí √©liminer H‚ÇÇO.'},
    {q:'Quelle m√©thode permet de synth√©tiser une amine depuis un nitrile ?',opts:['R√©duction avec LiAlH‚ÇÑ','Oxydation KMnO‚ÇÑ','Saponification','Grignard sur amine'],a:0,exp:'R-CN + LiAlH‚ÇÑ (√©ther, N‚ÇÇ) ‚Üí R-CH‚ÇÇ-NH‚ÇÇ (amine primaire). +1 carbone conserv√©. Hydrolyse du nitrile ‚Üí amide ‚Üí acide.'},
    {q:'La nitration du benz√®ne n√©cessite...',opts:['HNO‚ÇÉ + H‚ÇÇSO‚ÇÑ conc. (NO‚ÇÇ‚Å∫)','HNO‚ÇÉ dilu√© seul','N‚ÇÇ/AlCl‚ÇÉ','KNO‚ÇÉ en solution'],a:0,exp:'M√©lange nitrant : HNO‚ÇÉ + H‚ÇÇSO‚ÇÑ conc. ‚Üí NO‚ÇÇ‚Å∫ (ion nitronium). NO‚ÇÇ‚Å∫ fait la SEAr. T¬∞<60¬∞C.'}
  ],
  mixed:[
    {q:'Quelle r√©action est st√©r√©osp√©cifique avec inversion totale ?',opts:['SN2','SN1','E1','AN (ald√©hyde)'],a:0,exp:'SN2 = st√©r√©osp√©cifique par d√©finition. Inversion totale (Walden) √† 100%. SN1 = rac√©misation.'},
    {q:'Le groupe NO‚ÇÇ est...',opts:['D√©sactivant m√©ta en SEAr','Activant ortho/para','Inductif donneur','R√©sonance donneur'],a:0,exp:'NO‚ÇÇ = fortement d√©sactivant (attracteur) et orienteur m√©ta. Attracteurs inductifs et m√©som√©ros = m√©ta.'},
    {q:'Quel hybride correspond √† un carbone sp¬≥ ?',opts:['T√©tra√©drique (angle 109.5¬∞)','Plan trigonal (120¬∞)','Lin√©aire (180¬∞)','Pyramidal (sp¬≤)'],a:0,exp:'sp¬≥ : 3 liaisons œÉ + 1 orbital p ‚Üí t√©tra√©drique, 4 liaisons orient√©es √† 109.5¬∞ (angle t√©tra√©drique).'},
    {q:'L\'ion acylium RCO‚Å∫ est stabilis√© par...',opts:['R√©sonance R-C‚â°O‚Å∫','Induction','Hyperconjugaison seule','Solvatation'],a:0,exp:'R-CO‚Å∫ ‚Üî R-C‚Å∫=O : double liaison œÄ cumul√©e ‚Üí stabilisation par r√©sonance. C\'est pourquoi pas de r√©arrangement (‚â† alkylation FC).'},
    {q:'DBE = 4 pour C‚ÇÜH‚ÇÜ correspond √†...',opts:['3 doubles liaisons + 1 cycle = aromatique','4 doubles liaisons','2 cycles','4 cycles'],a:0,exp:'C‚ÇÜH‚ÇÜ : DBE = (2√ó6+2-6)/2 = 4. Benz√®ne = 3√óC=C + 1 cycle = 4. Indice d\'aromaticit√©.'},
    {q:'La conformation la plus stable de l\'√©thane est...',opts:['D√©cal√©e (anti, di√®dre 60¬∞)','√âclips√©e (di√®dre 0¬∞)','Gauche (syn)','Plan (sp¬≤)'],a:0,exp:'√âthane : conformation d√©cal√©e (anti) = minimise les r√©pulsions st√©riques et torsionnelles entre H. Barri√®re rot. = 12 kJ/mol.'},
    {q:'Un alcool tertiaire soumis √† KMnO‚ÇÑ...',opts:['Ne r√©agit pas (pas de H sur C-OH)','Donne une c√©tone','Donne un acide','Donne un ald√©hyde'],a:0,exp:'Alcool 3¬∞ (R‚ÇÉC-OH) : pas de H sur le C portant OH ‚Üí impossible de former C=O. R√©sistant √† l\'oxydation.'}
  ]
};

let quizState={questions:[],current:0,score:0,answered:false};

function startQuiz(){
  const cat=document.getElementById('quizCat').value;
  const n=+document.getElementById('quizCount').value;
  let pool=cat==='mixed'?Object.values(QUIZ_QUESTIONS).flat():QUIZ_QUESTIONS[cat]||[];
  pool=[...pool].sort(()=>Math.random()-0.5).slice(0,n);
  quizState={questions:pool,current:0,score:0,answered:false};
  sessionStats.quizTotal=n;updateSessionStats();
  showQuizQuestion();
  updateQuizScore();
}

function showQuizQuestion(){
  const area=document.getElementById('quiz-area');
  if(quizState.current>=quizState.questions.length){
    const pct=Math.round(quizState.score/quizState.questions.length*100);
    area.innerHTML=`<div style="text-align:center;padding:25px;"><div style="font-family:'Fraunces',serif;font-size:1.6rem;font-weight:700;color:var(--p1);margin-bottom:7px;">${pct >= 80 ? 'üèÜ' : pct >= 60 ? 'üëç' : 'üìñ'} ${pct}%</div><div style="font-size:1.05rem;font-weight:600;margin-bottom:5px;">Score final : ${quizState.score} / ${quizState.questions.length}</div><div style="color:var(--muted);font-size:.82rem;margin-bottom:14px;">${pct>=80?'Excellent ! Ma√Ætrise parfaite.':pct>=60?'Bien ! Quelques points √† revoir.':'Continuez vos r√©visions.'}</div><button onclick="startQuiz()" class="btn btn-p" style="width:auto;padding:8px 20px;">üîÑ Nouveau quiz</button></div>`;
    return;
  }
  const q=quizState.questions[quizState.current];
  quizState.answered=false;
  area.innerHTML=`<div class="quiz-card"><div style="font-size:.65rem;color:var(--muted);font-family:'Fira Code',monospace;margin-bottom:5px;">QUESTION ${quizState.current+1} / ${quizState.questions.length}</div><div class="quiz-q">${q.q}</div><div class="quiz-opts">${q.opts.map((o,i)=>`<button class="quiz-opt" onclick="answerQuiz(${i})">${String.fromCharCode(65+i)}. ${o}</button>`).join('')}</div><div class="quiz-feedback" id="quiz-fb"></div></div><button onclick="nextQuizQ()" id="next-q-btn" style="display:none;" class="btn btn-p" style="margin-top:8px;">QUESTION SUIVANTE ‚Üí</button>`;
  document.getElementById('quiz-prog-bar').style.width=(quizState.current/quizState.questions.length*100)+'%';
  document.getElementById('quiz-progress-text').textContent=`Question ${quizState.current+1} / ${quizState.questions.length}`;
}

function answerQuiz(i){
  if(quizState.answered)return;
  quizState.answered=true;
  const q=quizState.questions[quizState.current];
  const correct=i===q.a;
  if(correct){quizState.score++;sessionStats.quizCorrect++;}
  sessionStats.quizTotal=quizState.questions.length;updateSessionStats();
  document.querySelectorAll('.quiz-opt').forEach((b,j)=>{
    b.style.pointerEvents='none';
    if(j===q.a)b.classList.add('correct');
    else if(j===i&&!correct)b.classList.add('wrong');
  });
  const fb=document.getElementById('quiz-fb');
  fb.className='quiz-feedback show '+(correct?'qf-correct':'qf-wrong');
  fb.innerHTML=(correct?'‚úÖ Correct ! ':'‚ùå Incorrect. La bonne r√©ponse est : <b>'+q.opts[q.a]+'</b><br>')+q.exp;
  document.getElementById('next-q-btn').style.display='block';
  updateQuizScore();
}

function nextQuizQ(){quizState.current++;showQuizQuestion();}

function updateQuizScore(){
  const total=quizState.questions.length||1;
  document.getElementById('quiz-score').textContent=`${quizState.score} / ${quizState.current}`;
  const pct=quizState.current>0?Math.round(quizState.score/quizState.current*100):0;
  document.getElementById('quiz-pct').textContent=quizState.current>0?pct+'% de bonnes r√©ponses':'';
  document.getElementById('score-bar').style.width=pct+'%';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê THEORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const THEORY_CARDS=[
  {lvl:'lv-g',lvlTxt:'LYC√âE',title:'Groupes Fonctionnels Essentiels',content:'La chimie organique est organis√©e autour des <b>groupes fonctionnels</b> : alcool (-OH), ald√©hyde (-CHO), c√©tone (>C=O), acide carboxylique (-COOH), ester (-COO-), amine (-NH‚ÇÇ). Chaque groupe fonctionnel conf√®re des propri√©t√©s chimiques et physiques caract√©ristiques.',formula:'R-OH : alcool | R-CHO : ald√©hyde | R-CO-R\' : c√©tone | RCOOH : acide',extra:'Cl√© : le groupe fonctionnel d√©termine la r√©activit√©. M√™me squelette ‚Üí m√™me famille.'},
  {lvl:'lv-g',lvlTxt:'LYC√âE',title:'Nomenclature IUPAC ‚Äî R√®gles',content:'L\'IUPAC d√©finit des r√®gles universelles : (1) Trouver la cha√Æne principale la plus longue portant le groupe fonctionnel prioritaire. (2) Num√©roter pour donner le n¬∞ le plus bas au groupe prioritaire. (3) Nommer : pr√©fixe + suffixe selon le type.',formula:'m√©th(1)-√©th(2)-prop(3)-but(4)-pent(5)-hex(6)-hept(7)',extra:'Priorit√© : -COOH > -CHO > -OH > C=C > C‚â°C > -NH‚ÇÇ'},
  {lvl:'lv-o',lvlTxt:'PR√âPA',title:'M√©canismes SN1 et SN2',content:'SN1 : substrat tertiaire, solvant polaire protique, carbocation interm√©diaire, rac√©misation. Ordre 1. SN2 : substrat primaire, solvant polaire aprotique, attaque 180¬∞, inversion Walden. Ordre 2. Comp√©tition selon le substrat et les conditions.',formula:'v(SN1) = k‚ÇÅ[RX] | v(SN2) = k‚ÇÇ[RX][Nu]',extra:'Primaire ‚Üí SN2 | Tertiaire ‚Üí SN1 | Secondaire ‚Üí comp√©tition'},
  {lvl:'lv-o',lvlTxt:'PR√âPA',title:'√âliminations E1 et E2',content:'E1 : substrat tertiaire, solvant polaire protique, m√™me carbocation que SN1, Za√Øtsev (alc√®ne + substitu√©). E2 : base forte, anti-p√©riplanaire requis, ordre 2, Za√Øtsev ou Hofmann selon la base.',formula:'v(E1) = k‚ÇÅ[substrat] | v(E2) = k‚ÇÇ[substrat][base]',extra:'T¬∞‚Üë ‚Üí E1 // Base encombr√©e (t-BuOK) ‚Üí Hofmann // Anti-p√©riplanaire pour E2'},
  {lvl:'lv-o',lvlTxt:'PR√âPA',title:'Additions AE et AN',content:'AE (alc√®nes) : √©lectrophile H‚Å∫ + carbocation ‚Üí produit Markovnikov. X‚ÇÇ ‚Üí bromonium ‚Üí anti-addition. AN (carbonyles) : nucl√©ophile attaque C=O plan. Angle de B√ºrgi-Dunitz (107¬∞).',formula:'Markovnikov : H‚Å∫ ‚Üí C le plus riche en H ‚Üí C‚Å∫ le plus stable',extra:'Ald√©hyde > c√©tone en r√©activit√© AN (st√©rique + √©lectronique)'},
  {lvl:'lv-o',lvlTxt:'PR√âPA',title:'St√©r√©ochimie ‚Äî R√®gles CIP',content:'Chiralit√© : 4 groupes diff√©rents sur C sp¬≥. R√®gles CIP (Cahn-Ingold-Prelog) : classer substituants par Z. Mettre priorit√© 4 derri√®re. 1‚Üí2‚Üí3 horaire = R, antihoraire = S.',formula:'Z croissant ‚Üí R = ‚Üª | S = ‚Ü∫',extra:'√ânantiom√®res : image miroir non superposable. Diast√©r√©oisom√®res : st√©r√©oisom√®res non-√©nantiom√®res.'},
  {lvl:'lv-b',lvlTxt:'LICENCE',title:'Aromaticit√© & Substitution SEAr',content:'Aromaticit√© : r√®gle de H√ºckel 4n+2 œÄ-√©lectrons (benz√®ne n=1, naphtal√®ne n=2). Stabilisation. SEAr : (1) g√©n√©ration E‚Å∫, (2) œÉ-complexe (Wheland, lent), (3) d√©part H‚Å∫ ‚Üí aromaticit√©. Orientation selon substituants.',formula:'H√ºckel : 4n+2 (n=0,1,2...) | ŒîE aromaticit√© benz√®ne = 151 kJ/mol',extra:'Donneurs (OH, NH‚ÇÇ, OR) ‚Üí ortho/para | Attracteurs (NO‚ÇÇ, CN, COOH) ‚Üí m√©ta'},
  {lvl:'lv-b',lvlTxt:'LICENCE',title:'Thermodynamique & Cin√©tique',content:'Contr√¥le cin√©tique : produit de la r√©action la plus rapide (Ea la plus basse). Contr√¥le thermodynamique : produit le plus stable (ŒîG¬∞ le plus bas). Loi d\'Arrh√©nius : k = A¬∑e^(-Ea/RT).',formula:'k = A ¬∑ e^(-Ea/RT) | ln k = ln A - Ea/RT',extra:'T¬∞‚Üë ‚Üí faveur produit thermodynamique. T¬∞‚Üì ‚Üí cin√©tique. Retour √† l\'√©quilibre si r√©versible.'},
  {lvl:'lv-b',lvlTxt:'LICENCE',title:'R√©actif de Grignard ‚Äî Applications',content:'R-MgX est un carbanion √©quivalent (base et nucl√©ophile forts). Pr√©par√© dans √©ther anhydre sous atmosph√®re inerte. Applications : +HCHO ‚Üí alcool 1¬∞, +RCHO ‚Üí alcool 2¬∞, +RCOR\' ‚Üí alcool 3¬∞, +CO‚ÇÇ ‚Üí acide (+1C).',formula:'R-X + Mg ‚Üí R-MgX | R-MgX + C=O ‚Üí alcool (H‚ÇÉO‚Å∫)',extra:'Condition absolue : anhydre et N‚ÇÇ/Ar. H‚ÇÇO d√©truit imm√©diatement le r√©actif.'}
];

function initTheory(){
  const g=document.getElementById('theory-grid');
  if(g.children.length>0)return;
  g.innerHTML=THEORY_CARDS.map(card=>`<div class="thy-card"><span class="lvl ${card.lvl}">${card.lvlTxt}</span><h3>${card.title}</h3><p style="margin-bottom:7px;">${card.content}</p><div class="fbox">${card.formula}</div><p style="margin-top:6px;font-size:.72rem;color:var(--p2);">${card.extra}</p></div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REPORT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generateReport(){
  const now=new Date();
  const mechSel=document.getElementById('mechSel');const mechName=mechSel.options[mechSel.selectedIndex].text||'Non √©tudi√©';
  const molSel=document.getElementById('mol3dSel');const molName=molSel.options[molSel.selectedIndex].text||'Non visualis√©e';
  const sc=document.getElementById('stereoConcept');const scName=sc.options[sc.selectedIndex].text||'Non √©tudi√©';
  const qScore=`${sessionStats.quizCorrect} / ${sessionStats.quizTotal}`;
  document.getElementById('rpt-content').innerHTML=`‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           SIMUORG v2.0 ‚Äî RAPPORT DE S√âANCE                  ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
  Nom       : Edmond Atinzoun TCHOKPON
  Programme : Licence Physique-Chimie
  Date      : ${now.toLocaleDateString('fr-FR')} | ${now.toLocaleTimeString('fr-FR')}
  Outil     : SimuOrg v2.0 ‚Äî Simulateur P√©dagogique
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
  M√âCANISME √âTUDI√â
    ‚Üí ${mechName}
    ‚Üí Substrat : ${document.getElementById('substrateSel').options[document.getElementById('substrateSel').selectedIndex].text}
    ‚Üí Nucl√©ophile : ${document.getElementById('nucleophileSel').options[document.getElementById('nucleophileSel').selectedIndex].text}
    ‚Üí Solvant : ${document.getElementById('solventSel').options[document.getElementById('solventSel').selectedIndex].text}
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
  ST√âR√âOCHIMIE
    ‚Üí Concept : ${scName}
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
  VISUALISATION 3D
    ‚Üí Mol√©cule : ${molName}
    ‚Üí Mode : ${document.getElementById('mol3dMode').options[document.getElementById('mol3dMode').selectedIndex].text}
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
  QUIZ & √âVALUATION
    ‚Üí Score    : ${qScore}
    ‚Üí M√©canismes charg√©s : ${sessionStats.mechLoaded}
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
  CONCLUSION
  S√©ance r√©alis√©e sur SimuOrg v2.0 dans le cadre des √©tudes
  de Chimie Organique en Licence Physique-Chimie.
  Le simulateur couvre : m√©canismes SN/E/AE/AN/SEAr, st√©r√©o-
  chimie, groupes fonctionnels, synth√®se, 3D mol√©culaire,
  nomenclature IUPAC, isom√®res et calculs pratiques.
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATUS BAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setStatus(color,text){
  const dot=document.getElementById('sdot');const t=document.getElementById('stext');
  dot.className='sdot'+(color==='orange'?' orange':'');t.textContent=text;
}
function updateClock(){const n=new Date();document.getElementById('sclock').textContent=n.toLocaleTimeString('fr-FR');}
setInterval(updateClock,1000);updateClock();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded',()=>{
  initFGGrid();
  initTheory();
  loadMechanism();
  draw3DMol();
  drawEnergyDiagram();
  updateNomen();
  showIsomers();
  updateCalcUI();
  showStereoConcept();
  showSynthesis('alcool',document.querySelector('.syn-btn'));
  setStatus('green','SimuOrg v2.0 charg√© ‚Äî Bienvenue, Edmond Atinzoun TCHOKPON');
  setTimeout(()=>setStatus('green','Pr√™t ‚Äî S√©lectionnez un module'),2500);
});
</script>
</body>
</html>
